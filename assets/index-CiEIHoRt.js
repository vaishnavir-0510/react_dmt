import{c as Wr,f as Be,a as Ge,b as eo,u as xt,d as Ct,e as ke,r as o,j as e,B as n,C as ie,T as je,g as r,E as Xt,M as to,h as re,L as Yt,i as Wt,k as X,l as _s,S as Ps,P as Fn,m as Fs,n as sr,F as Ae,I as Me,o as We,D as wt,p as Mt,q as He,s as xa,t as ne,v as An,w as nt,x as rs,y as vt,z as ye,A as so,G as ao,H as Wn,J as ro,K as H,N as ar,O as ns,Q as no,R as io,U as zr,V as Or,W as rr,X as oo,Y as Ke,Z as us,_ as $t,$ as qt,a0 as lo,a1 as nr,a2 as as,a3 as fs,a4 as cs,a5 as Et,a6 as zn,a7 as co,a8 as it,a9 as uo,aa as Mr,ab as ho,ac as xo,ad as po,ae as ir,af as mo,ag as On,ah as Lr,ai as It,aj as Pt,ak as Ir,al as Rt,am as go,an as $r,ao as Qt,ap as qr,aq as Ur,ar as me,as as Va,at as ae,au as Mn,av as Br,aw as aa,ax as Nr,ay as fo,az as jo,aA as yo,aB as Ln,aC as j,aD as $n,aE as bo,aF as As,aG as qn,aH as ms,aI as mt,aJ as is,aK as Ut,aL as ct,aM as Un,aN as hs,aO as Kt,aP as ht,aQ as tt,aR as Je,aS as Xe,aT as pe,aU as x,aV as Ye,aW as ds,aX as dt,aY as vo,aZ as _o,a_ as ws,a$ as Gr,b0 as Vr,b1 as Hr,b2 as Cs,b3 as So,b4 as Dt,b5 as ia,b6 as gs,b7 as De,b8 as Ee,b9 as Bn,ba as ko,bb as wo,bc as or,bd as Nn,be as Gn,bf as Vn,bg as Hn,bh as Co,bi as Ts,bj as ft,bk as ra,bl as Pr,bm as na,bn as Ss,bo as lr,bp as dn,bq as To,br as cr,bs as dr,bt as ur,bu as Ns,bv as Io,bw as ja,bx as Zn,by as Qn,bz as Po,bA as Ro,bB as Ws,bC as Bs,bD as Do,bE as Jn,bF as Eo,bG as Fo,bH as Ao,bI as Wo,bJ as zo,bK as un,bL as Oo,bM as Ha,bN as Mo,bO as Rr,bP as hn,bQ as Lo,bR as Gs,bS as Za,bT as $o,bU as Ds,bV as Zr,bW as Qr,bX as ys,bY as Qa,bZ as Ja,b_ as qo,b$ as xn,c0 as xr,c1 as pr,c2 as ya,c3 as Uo,c4 as Bo,c5 as No,c6 as Go,c7 as Vo,c8 as Ho,c9 as Zt,ca as Zo,cb as Jr,cc as Qo,cd as Yr,ce as Jo,cf as Ya,cg as Ka,ch as Xa,ci as Yo,cj as Yn,ck as Kn,cl as Xn,cm as pn,cn as Ko,co as Xo,cp as el,cq as tl,cr as sl,cs as al,ct as rl,cu as nl,cv as ei,cw as il,cx as ol,cy as ll,cz as cl,cA as dl,cB as ul,cC as Jt,cD as hl,cE as xl,cF as pl,cG as ml,cH as gl,cI as fl,cJ as Qe,cK as jl}from"./vendor-B1HGDnz3.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(l){if(l.ep)return;l.ep=!0;const d=a(l);fetch(l.href,d)}})();const Dr=t=>{if(!t)return!1;try{return JSON.parse(atob(t.split(".")[1])).exp*1e3>Date.now()}catch{return!1}},yl=()=>{try{const t=localStorage.getItem("accessToken"),s=localStorage.getItem("refreshToken");if(t||s){const a=t?Dr(t):!1,i=s?Dr(s):!1;if(!a&&!i){console.group("üîê Clearing Expired Tokens on Startup"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚ö†Ô∏è Both access and refresh tokens are expired - clearing all data"),console.groupEnd(),localStorage.clear(),sessionStorage.clear();return}!a&&i&&console.log("‚ö†Ô∏è Access token expired but refresh token valid - will refresh on next API call")}}catch(t){console.error("Error checking token expiry on startup:",t),localStorage.clear(),sessionStorage.clear()}};yl();const mn=localStorage.getItem("accessToken"),bl=localStorage.getItem("refreshToken"),vl={user:null,accessToken:mn,refreshToken:bl,isAuthenticated:Dr(mn),isLoading:!1,error:null},ti=Wr({name:"auth",initialState:vl,reducers:{setCredentials:(t,s)=>{const{access_token:a,refresh_token:i,user_id:l}=s.payload;console.group("üîê Setting User Credentials"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log(`üë§ User ID: ${l}`);try{const d=JSON.parse(atob(a.split(".")[1])),c=new Date(d.exp*1e3),u=d.exp*1e3-Date.now(),f=Math.floor(u/6e4),y=Math.floor(u%6e4/1e3);console.log(`üìÖ Access Token Expiry: ${c.toLocaleString()}`),console.log(`‚è≥ Remaining Time: ${f}m ${y}s`)}catch{console.warn("Could not parse access token expiry")}try{const d=JSON.parse(atob(i.split(".")[1])),c=new Date(d.exp*1e3);console.log(`üìÖ Refresh Token Expiry: ${c.toLocaleString()}`)}catch{console.warn("Could not parse refresh token expiry")}t.accessToken=a,t.refreshToken=i,t.isAuthenticated=!0,t.error=null,t.user={user_id:l,user:"",tenant_id:"",role_id:""},localStorage.setItem("accessToken",a),localStorage.setItem("refreshToken",i),localStorage.setItem("lastActivity",Date.now().toString()),console.log("‚úÖ Credentials saved to Redux and localStorage"),console.groupEnd()},logout:t=>{t.user=null,t.accessToken=null,t.refreshToken=null,t.isAuthenticated=!1,t.error=null;try{console.group("üßπ Clearing All Storage on Logout"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("lastActivity"),localStorage.removeItem("app_state"),localStorage.removeItem("migration_state"),localStorage.removeItem("sidebar_session"),localStorage.removeItem("local_workspace_project"),localStorage.removeItem("tokenRefreshInProgress");const s=[];for(let a=0;a<localStorage.length;a++){const i=localStorage.key(a);i&&s.push(i)}s.forEach(a=>localStorage.removeItem(a)),localStorage.clear(),sessionStorage.clear(),console.log("‚úÖ All localStorage and sessionStorage cleared"),console.groupEnd()}catch(s){console.error("‚ùå Error clearing storage on logout:",s);try{localStorage.clear(),sessionStorage.clear()}catch(a){console.error("‚ùå Error during fallback clear:",a)}}},setLoading:(t,s)=>{t.isLoading=s.payload},updateTokens:(t,s)=>{console.group("üîÑ Updating Tokens"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`);try{const a=JSON.parse(atob(s.payload.accessToken.split(".")[1])),i=new Date(a.exp*1e3),l=a.exp*1e3-Date.now(),d=Math.floor(l/6e4),c=Math.floor(l%6e4/1e3);console.log(`üìÖ New Access Token Expiry: ${i.toLocaleString()}`),console.log(`‚è≥ Remaining Time: ${d}m ${c}s`)}catch{console.warn("Could not parse access token expiry")}try{const a=JSON.parse(atob(s.payload.refreshToken.split(".")[1])),i=new Date(a.exp*1e3);console.log(`üìÖ New Refresh Token Expiry: ${i.toLocaleString()}`)}catch{console.warn("Could not parse refresh token expiry")}t.accessToken=s.payload.accessToken,t.refreshToken=s.payload.refreshToken,localStorage.setItem("accessToken",s.payload.accessToken),localStorage.setItem("refreshToken",s.payload.refreshToken),localStorage.setItem("lastActivity",Date.now().toString()),console.log("‚úÖ Tokens updated in Redux and localStorage"),console.groupEnd()},setUser:(t,s)=>{t.user&&(t.user={...t.user,...s.payload})},setError:(t,s)=>{t.error=s.payload},clearError:t=>{t.error=null}}}),{setCredentials:si,logout:Ot,setLoading:ls,updateTokens:zs,setUser:Eh,setError:Vs,clearError:Es}=ti.actions,_l=ti.reducer,mr=Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}});let gr=!1,Ms=null;const Sl=async(t,s,a)=>{const i=t.url?.includes("/auth/v3/refresh_token");let l=await mr(t,s,a);if(l.error&&l.error.status===401&&!i){if(localStorage.getItem("tokenRefreshInProgress")==="true"&&gr&&Ms)try{return await Ms,l=await mr(t,s,a),l}catch{return s.dispatch(Ot()),window.location.href="/login",l}const c=localStorage.getItem("refreshToken");if(!c)return s.dispatch(Ot()),window.location.href="/login",l;gr=!0,localStorage.setItem("tokenRefreshInProgress","true"),Ms=(async()=>{try{const f=await Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:y=>(y.set("Accept","application/json"),y.set("Content-Type","application/json"),y)})({url:`/auth/v3/refresh_token?refresh_token=${encodeURIComponent(c)}`,method:"POST"},s,a);if(f.data&&!f.error){const{access_token:y,refresh_token:h}=f.data;return s.dispatch(zs({accessToken:y,refreshToken:h||c})),{success:!0}}else throw new Error("Refresh token failed")}catch(u){throw console.error("Token refresh failed:",u),u}finally{gr=!1,Ms=null,localStorage.removeItem("tokenRefreshInProgress")}})();try{await Ms,l=await mr(t,s,a)}catch(u){console.error("Token refresh failed, logging out:",u),s.dispatch(Ot()),window.location.href="/login"}}return l},ba=Ge({reducerPath:"workspaceApi",baseQuery:Sl,tagTypes:["Workspace","Projects"],endpoints:t=>({getUserWorkspace:t.query({query:()=>"/management/user_workspace/user_workspace/",providesTags:["Workspace"]}),updateWorkspace:t.mutation({query:s=>({url:"/management/user_workspace/user_workspace/",method:"PUT",body:s}),invalidatesTags:["Workspace"]}),createWorkspace:t.mutation({query:s=>({url:`/management/user_workspace/user_workspace/project/${s.project}`,method:"POST",body:s}),invalidatesTags:["Workspace"]}),updateEnvironmentWorkspace:t.mutation({query:({environment:s})=>({url:`/management/user_workspace/user_workspace/environment/${s}`,method:"POST",body:{environment:s}}),invalidatesTags:["Workspace"]}),getProjects:t.query({query:()=>"/management/v2/project",providesTags:["Projects"],transformResponse:s=>s.data||s})})}),{useGetUserWorkspaceQuery:ai,useGetProjectsQuery:ri,useCreateWorkspaceMutation:kl,useUpdateEnvironmentWorkspaceMutation:wl}=ba,va=Ge({reducerPath:"systemsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["Systems"],endpoints:t=>({getSystemsByProject:t.query({query:s=>`/management/v2/project/${s}/system`,providesTags:["Systems"]}),createSystem:t.mutation({query:s=>({url:"/management/v2/system",method:"POST",body:s}),invalidatesTags:["Systems"]}),updateSystem:t.mutation({query:({id:s,data:a})=>({url:`/management/v2/system/${s}`,method:"PUT",body:a}),invalidatesTags:["Systems"]}),deleteSystem:t.mutation({query:s=>({url:`/management/v2/system/${s}`,method:"DELETE"}),invalidatesTags:["Systems"]})})}),{useGetSystemsByProjectQuery:ks,useCreateSystemMutation:Cl,useUpdateSystemMutation:Tl,useDeleteSystemMutation:Il}=va,_a=Ge({reducerPath:"environmentApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["Environments"],endpoints:t=>({getEnvironmentsByProject:t.query({query:s=>`/management/v2/environment/project/${s}`,providesTags:["Environments"]}),createEnvironment:t.mutation({query:s=>({url:"/management/v2/environment",method:"POST",body:s}),invalidatesTags:["Environments"]}),updateEnvironment:t.mutation({query:({id:s,data:a})=>({url:`/management/v2/environment/${s}`,method:"PUT",body:a}),invalidatesTags:["Environments"]}),deleteEnvironment:t.mutation({query:s=>({url:`/management/v2/environment/${s}`,method:"DELETE"}),invalidatesTags:["Environments"]})})}),{useGetEnvironmentsByProjectQuery:oa,useCreateEnvironmentMutation:Pl,useUpdateEnvironmentMutation:Rl,useDeleteEnvironmentMutation:Dl}=_a,Hs=Ge({reducerPath:"objectsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["Objects","CompoundFields","MetadataFields","PicklistValues"],endpoints:t=>({getObjectsBySystem:t.query({query:s=>`/management/v2/system/${s}/objects`,providesTags:["Objects"]}),createObject:t.mutation({query:s=>({url:"/management/v2/object",method:"POST",body:s}),invalidatesTags:["Objects"]}),updateObject:t.mutation({query:({id:s,data:a})=>({url:`/management/v2/object/${s}`,method:"PUT",body:a}),invalidatesTags:["Objects"]}),deleteObject:t.mutation({query:s=>({url:`/management/v2/object/${s}`,method:"DELETE"}),invalidatesTags:["Objects"]}),getCompoundFields:t.query({query:s=>`/migration/metadata/object/compound/${s}`,providesTags:["CompoundFields"]}),getMetadataFields:t.query({query:s=>`/migration/metadata/object/${s}`,providesTags:["MetadataFields"]}),getPicklistValues:t.query({query:({objectId:s,fieldId:a})=>`/migration/v1/object/${s}/picklist_values/${a}`,providesTags:["PicklistValues"]})})}),{useGetObjectsBySystemQuery:Is,useCreateObjectMutation:El,useUpdateObjectMutation:Fl,useDeleteObjectMutation:ni,useGetCompoundFieldsQuery:Al,useGetMetadataFieldsQuery:Wl,useGetPicklistValuesQuery:zl}=Hs,Ol=t=>{if(!t)return!1;try{return JSON.parse(atob(t.split(".")[1])).exp*1e3>Date.now()}catch{return!1}},Ml=()=>{const t=typeof window<"u"?localStorage.getItem("accessToken"):null,s=Ol(t),a=typeof window<"u"?window.location.pathname:"/";if(a==="/login"||a==="/register"||!s){if((!s||a==="/login"||a==="/register")&&typeof window<"u")try{const h=localStorage.getItem("app_state");if(h){const p=JSON.parse(h);p?.lastRoute&&(p.lastRoute=null,localStorage.setItem("app_state",JSON.stringify(p)))}}catch{}return{selectedProject:null,selectedEnvironment:null,selectedSystem:null,isSidebarOpen:!0,activeMenu:"dashboard",isSettingsMenuOpen:!1,currentView:"application",currentApp:"migration",lastRoute:null}}try{const h=localStorage.getItem("app_state");if(h){const p=JSON.parse(h);if(p&&typeof p=="object")return{selectedProject:p.selectedProject||null,selectedEnvironment:p.selectedEnvironment||null,selectedSystem:p.selectedSystem||null,isSidebarOpen:p.isSidebarOpen!==void 0?p.isSidebarOpen:!0,activeMenu:p.activeMenu||"dashboard",isSettingsMenuOpen:p.isSettingsMenuOpen||!1,currentView:p.currentView||"application",currentApp:p.currentApp||"migration",lastRoute:p.lastRoute||null}}}catch(h){console.error("Failed to load app state from localStorage:",h)}let i=typeof window<"u"?window.location.pathname:"/";if(i==="/"&&typeof window<"u")try{const h=localStorage.getItem("app_state");if(h){const p=JSON.parse(h);p?.lastRoute&&p.lastRoute!=="/"&&(i=p.lastRoute)}}catch{}if(["/account","/users","/projects","/security-policies"].includes(i)){let h="account";return i==="/users"&&(h="user"),i==="/projects"&&(h="project"),i==="/security-policies"&&(h="security-policies"),{selectedProject:null,selectedEnvironment:null,selectedSystem:null,isSidebarOpen:!0,activeMenu:h,isSettingsMenuOpen:!0,currentView:"settings",currentApp:null,lastRoute:i}}const c=i.startsWith("/migration")||i==="/dashboard"||i==="/entities"||i==="/management",u=i.startsWith("/backup"),f=i.startsWith("/translation"),y=i.startsWith("/file-migration");if(c||u||f||y){let h="dashboard",p="migration";return u&&(p="backup"),f&&(p="translation"),y&&(p="file migration"),(i==="/entities"||i.startsWith("/migration"))&&(h="entities"),i==="/management"&&(h="management"),i==="/backup/dashboard"&&(h="backup dashboard"),i==="/backup/jobs"&&(h="backup jobs"),i==="/backup/restore"&&(h="restore"),i==="/backup/history"&&(h="backup history"),i==="/translation/dashboard"&&(h="translation dashboard"),i==="/translation/languages"&&(h="language packs"),i==="/translation/memory"&&(h="translation memory"),i==="/translation/progress"&&(h="progress tracking"),i==="/translation/translations"&&(h="translations"),i==="/file-migration/upload"&&(h="file upload"),i==="/file-migration/relationship"&&(h="file relationship"),i==="/file-migration/filter"&&(h="file filter"),i==="/file-migration/metadata"&&(h="file metadata"),i==="/file-migration/cleanup"&&(h="file cleanup"),i==="/file-migration/transform"&&(h="file transform"),i==="/file-migration/mapping"&&(h="file mapping"),i==="/file-migration/validate"&&(h="file validate"),i==="/file-migration/load"&&(h="file load"),i==="/file-migration/error"&&(h="file error"),i==="/file-migration/workflows"&&(h="file workflows"),i==="/file-migration/analysis"&&(h="file analysis"),i==="/file-migration/storage"&&(h="file storage"),{selectedProject:null,selectedEnvironment:null,selectedSystem:null,isSidebarOpen:!0,activeMenu:h,isSettingsMenuOpen:!1,currentView:"application",currentApp:p,lastRoute:i}}return{selectedProject:null,selectedEnvironment:null,selectedSystem:null,isSidebarOpen:!0,activeMenu:"dashboard",isSettingsMenuOpen:!1,currentView:"application",currentApp:"migration",lastRoute:i}},Ll=Ml(),At=t=>{try{localStorage.setItem("app_state",JSON.stringify(t))}catch(s){console.error("Failed to save app state to localStorage:",s)}},ii=Wr({name:"app",initialState:Ll,reducers:{setSelectedProject:(t,s)=>{if(t.selectedProject=s.payload,s.payload){const a=s.payload.project_type;t.currentApp=a==="filemigration"?"file migration":a||"migration"}At(t)},setSelectedEnvironment:(t,s)=>{t.selectedEnvironment=s.payload,At(t)},setSelectedSystem:(t,s)=>{t.selectedSystem=s.payload,At(t)},toggleSidebar:t=>{t.isSidebarOpen=!t.isSidebarOpen,At(t)},setActiveMenu:(t,s)=>{t.activeMenu=s.payload,At(t)},openSettingsMenu:t=>{t.isSettingsMenuOpen=!0,t.currentView="settings",t.activeMenu="account",t.currentApp=null,At(t)},closeSettingsMenu:t=>{t.isSettingsMenuOpen=!1,t.currentView="application",t.selectedProject?.project_type==="backup"?(t.activeMenu="backup dashboard",t.currentApp="backup"):t.selectedProject?.project_type==="translation"?(t.activeMenu="translation dashboard",t.currentApp="translation"):t.selectedProject?.project_type==="file migration"||t.selectedProject?.project_type==="filemigration"?(t.activeMenu="file upload",t.currentApp="file migration"):(t.activeMenu="dashboard",t.currentApp="migration"),At(t)},switchToApplicationView:t=>{t.currentView="application",t.isSettingsMenuOpen=!1,t.selectedProject?.project_type==="backup"?t.currentApp="backup":t.selectedProject?.project_type==="translation"?t.currentApp="translation":t.selectedProject?.project_type==="file migration"||t.selectedProject?.project_type==="filemigration"?t.currentApp="file migration":t.currentApp="migration",At(t)},switchToSettingsView:t=>{t.currentView="settings",t.isSettingsMenuOpen=!0,t.currentApp=null,At(t)},setCurrentApp:(t,s)=>{t.currentApp=s.payload,At(t)},syncStateWithRoute:(t,s)=>{const{pathname:a}=s.payload;if(a==="/login"||a==="/register")return;const i=["/account","/users","/projects","/security-policies"],l=a.startsWith("/migration")||a==="/dashboard"||a==="/entities"||a==="/management",d=a.startsWith("/backup"),c=a.startsWith("/translation"),u=a.startsWith("/file-migration");if(i.includes(a)){t.currentView!=="settings"&&(t.currentView="settings"),t.isSettingsMenuOpen||(t.isSettingsMenuOpen=!0),t.currentApp!==null&&(t.currentApp=null);let f="account";a==="/users"&&(f="user"),a==="/projects"&&(f="project"),a==="/security-policies"&&(f="security-policies"),t.activeMenu!==f&&(t.activeMenu=f)}else if(l||d||c||u){t.currentView!=="application"&&(t.currentView="application"),t.isSettingsMenuOpen&&(t.isSettingsMenuOpen=!1);let f="migration";d?f="backup":c?f="translation":u&&(f="file migration"),t.currentApp!==f&&(t.currentApp=f),a==="/dashboard"&&(t.activeMenu="dashboard"),(a==="/entities"||a.startsWith("/migration"))&&(t.activeMenu="entities"),a==="/management"&&(t.activeMenu="management"),a==="/backup/dashboard"&&(t.activeMenu="backup dashboard"),a==="/backup/jobs"&&(t.activeMenu="backup jobs"),a==="/backup/restore"&&(t.activeMenu="restore"),a==="/backup/history"&&(t.activeMenu="backup history"),a==="/translation/dashboard"&&(t.activeMenu="translation dashboard"),a==="/translation/languages"&&(t.activeMenu="language packs"),a==="/translation/memory"&&(t.activeMenu="translation memory"),a==="/translation/progress"&&(t.activeMenu="progress tracking"),a==="/translation/translations"&&(t.activeMenu="translations"),a==="/file-migration/upload"&&(t.activeMenu="file upload"),a==="/file-migration/relationship"&&(t.activeMenu="file relationship"),a==="/file-migration/filter"&&(t.activeMenu="file filter"),a==="/file-migration/metadata"&&(t.activeMenu="file metadata"),a==="/file-migration/cleanup"&&(t.activeMenu="file cleanup"),a==="/file-migration/transform"&&(t.activeMenu="file transform"),a==="/file-migration/mapping"&&(t.activeMenu="file mapping"),a==="/file-migration/validate"&&(t.activeMenu="file validate"),a==="/file-migration/load"&&(t.activeMenu="file load"),a==="/file-migration/error"&&(t.activeMenu="file error"),a==="/file-migration/workflows"&&(t.activeMenu="file workflows"),a==="/file-migration/analysis"&&(t.activeMenu="file analysis"),a==="/file-migration/storage"&&(t.activeMenu="file storage")}t.lastRoute=a,At(t)},clearSelectedProject:t=>{t.selectedProject=null,t.currentApp="migration",At(t)},clearSelectedSystem:t=>{t.selectedSystem=null,At(t)},clearSelectedEnvironment:t=>{t.selectedEnvironment=null,At(t)},clearAllSelections:t=>{t.selectedProject=null,t.selectedSystem=null,t.selectedEnvironment=null,t.currentApp="migration",At(t)},clearAppState:t=>{t.selectedProject=null,t.selectedEnvironment=null,t.selectedSystem=null,t.activeMenu="dashboard",t.isSettingsMenuOpen=!1,t.currentView="application",t.currentApp="migration",t.lastRoute=null;try{localStorage.removeItem("app_state")}catch(s){console.error("Failed to clear app state from localStorage:",s)}}}}),{setSelectedProject:gn,setSelectedEnvironment:er,setSelectedSystem:fn,toggleSidebar:$l,setActiveMenu:zt,openSettingsMenu:oi,closeSettingsMenu:Fh,switchToApplicationView:tr,switchToSettingsView:Ah,setCurrentApp:Wh,syncStateWithRoute:ql,clearSelectedProject:zh,clearSelectedSystem:Oh,clearSelectedEnvironment:pa,clearAllSelections:Mh,clearAppState:Lh}=ii.actions,Ul=ii.reducer,Sa=Ge({reducerPath:"userApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["ProjectUsers","SystemUsers"],endpoints:t=>({getSystemUsers:t.query({query:()=>"/auth/v3/users/",providesTags:["SystemUsers"],transformResponse:s=>Array.isArray(s)?s:s&&typeof s=="object"&&s.users?s.users:s&&typeof s=="object"&&s.data?s.data:[]}),getProjectUsers:t.query({query:s=>`/management/v2/project/user/${s}`,providesTags:["ProjectUsers"]}),addUserToProject:t.mutation({query:s=>({url:"/management/v2/project/user",method:"POST",body:s}),invalidatesTags:["ProjectUsers"]}),removeUserFromProject:t.mutation({query:({projectId:s,userId:a})=>({url:`/management/v2/project/user/${s}/user/${a}`,method:"DELETE"}),invalidatesTags:["ProjectUsers"]})})}),{useGetSystemUsersQuery:Kr,useGetProjectUsersQuery:Bl,useAddUserToProjectMutation:Nl,useRemoveUserFromProjectMutation:Gl}=Sa,ka=Ge({reducerPath:"usersApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Users"],endpoints:t=>({getSystemUsers:t.query({query:()=>"/auth/v3/users/",providesTags:["Users"],transformResponse:s=>Array.isArray(s)?s:s&&typeof s=="object"&&s.users?s.users:s&&typeof s=="object"&&s.data?s.data:[]}),inviteUser:t.mutation({query:s=>({url:"/auth/v3/invite/",method:"POST",body:s}),invalidatesTags:["Users"]}),updateUser:t.mutation({query:({id:s,...a})=>({url:`/auth/v3/user/${s}/`,method:"PUT",body:a}),invalidatesTags:["Users"]}),deleteUser:t.mutation({query:s=>({url:`/auth/v3/user/${s}/`,method:"DELETE"}),invalidatesTags:["Users"]})})}),{useGetSystemUsersQuery:Vl,useInviteUserMutation:Hl,useUpdateUserMutation:Zl,useDeleteUserMutation:Ql}=ka,wa=Ge({reducerPath:"accountApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Account","Summary"],endpoints:t=>({getAccount:t.query({query:()=>"/management/v2/account/",providesTags:["Account"]}),updateAccount:t.mutation({query:s=>({url:"/management/v2/account/",method:"PUT",body:s}),invalidatesTags:["Account"]}),getSummary:t.query({query:()=>"/management/v2/summary",providesTags:["Summary"]})})}),{useGetAccountQuery:Xr,useUpdateAccountMutation:Jl,useGetSummaryQuery:Yl}=wa,Ca=Ge({reducerPath:"projectApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["Projects"],endpoints:t=>({createProject:t.mutation({query:s=>({url:"/management/v2/project",method:"POST",body:s}),invalidatesTags:["Projects"]}),updateProject:t.mutation({query:({id:s,data:a})=>({url:`/management/v2/project/${s}`,method:"PUT",body:a}),invalidatesTags:["Projects"]}),deleteProject:t.mutation({query:s=>({url:`/management/v2/project/${s}`,method:"DELETE"}),invalidatesTags:["Projects"]})})}),{useCreateProjectMutation:Kl,useUpdateProjectMutation:Xl,useDeleteProjectMutation:ec}=Ca,Zs=Ge({reducerPath:"projectEstimatorApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["ProjectEstimator"],endpoints:t=>({getProjectEstimator:t.query({query:()=>"/management/v2/project/estimator/",providesTags:["ProjectEstimator"]}),getProjectSummary:t.query({query:()=>"/management/v2/estimator/project/summary/",providesTags:["ProjectEstimator"]}),createProjectEstimator:t.mutation({query:s=>({url:"/management/v2/project/estimator",method:"POST",body:s})}),updateProjectEstimator:t.mutation({query:({id:s,data:a})=>({url:`/management/v2/project/estimator/${s}`,method:"PUT",body:a})}),bulkUpdateProjectEstimator:t.mutation({query:({updates:s})=>({url:"/management/v2/project/estimator/bulk",method:"PUT",body:{updates:s}}),invalidatesTags:["ProjectEstimator"]})})}),{useGetProjectEstimatorQuery:tc,useGetProjectSummaryQuery:li,useCreateProjectEstimatorMutation:sc,useUpdateProjectEstimatorMutation:ac}=Zs,Ta=Ge({reducerPath:"planEstimatorApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["PlanEstimator"],endpoints:t=>({getPlanEstimator:t.query({query:()=>"/management/v2/plan/estimator/",providesTags:["PlanEstimator"]}),updatePlanEstimator:t.mutation({query:({projectId:s,data:a})=>({url:`/management/v2/plan/estimator/${s}/efforts`,method:"PUT",body:a}),invalidatesTags:["PlanEstimator"]})})}),{useGetPlanEstimatorQuery:rc,useUpdatePlanEstimatorMutation:nc}=Ta,ic=()=>{const t=typeof window<"u"?window.location.pathname:"/";if(t==="/login"||t==="/register")return{selectedObject:null,activeTab:"summary",migrationName:"",summaryData:null,relationshipData:null,filterData:null,metadataData:null,cleanupData:null,transformData:null,mappingData:null,validateData:null,loadData:null,errorData:null,workflowsData:null};try{const s=localStorage.getItem("migration_state");if(s)return JSON.parse(s)}catch(s){console.error("Failed to load migration state from localStorage:",s)}return{selectedObject:null,activeTab:"summary",migrationName:"",summaryData:null,relationshipData:null,filterData:null,metadataData:null,cleanupData:null,transformData:null,mappingData:null,validateData:null,loadData:null,errorData:null,workflowsData:null}},oc=ic(),ci=Wr({name:"migration",initialState:oc,reducers:{setSelectedObject:(t,s)=>{t.selectedObject=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setActiveTab:(t,s)=>{t.activeTab=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setMigrationName:(t,s)=>{t.migrationName=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setSummaryData:(t,s)=>{t.summaryData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setRelationshipData:(t,s)=>{t.relationshipData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setFilterData:(t,s)=>{t.filterData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setMetadataData:(t,s)=>{t.metadataData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setCleanupData:(t,s)=>{t.cleanupData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setTransformData:(t,s)=>{t.transformData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setMappingData:(t,s)=>{t.mappingData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setValidateData:(t,s)=>{t.validateData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setLoadData:(t,s)=>{t.loadData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setErrorData:(t,s)=>{t.errorData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},setWorkflowsData:(t,s)=>{t.workflowsData=s.payload;try{localStorage.setItem("migration_state",JSON.stringify(t))}catch(a){console.error("Failed to save migration state to localStorage:",a)}},clearMigrationData:t=>{t.selectedObject=null,t.migrationName="",t.summaryData=null,t.relationshipData=null,t.filterData=null,t.metadataData=null,t.cleanupData=null,t.transformData=null,t.mappingData=null,t.validateData=null,t.loadData=null,t.errorData=null,t.workflowsData=null;try{localStorage.removeItem("migration_state")}catch(s){console.error("Failed to clear migration state from localStorage:",s)}}}}),{setSelectedObject:di,setActiveTab:ui,setMigrationName:$h,setSummaryData:qh,setRelationshipData:Uh,setFilterData:Bh,setMetadataData:Nh,setCleanupData:Gh,setTransformData:Vh,setMappingData:Hh,setValidateData:Zh,setLoadData:Qh,setErrorData:Jh,setWorkflowsData:Yh,clearMigrationData:jn}=ci.actions,lc=ci.reducer,Qs=Ge({reducerPath:"metadataApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Metadata","MappedObject","Ontology"],endpoints:t=>({getObjectMetadata:t.query({query:s=>`/migration/metadata/object/${s}`,providesTags:["Metadata"]}),getObjectMetadataPaginated:t.query({query:({objectId:s,environmentId:a,page:i=1,page_size:l=5})=>{const d=new URLSearchParams({page:i.toString(),page_size:l.toString()});return a&&d.append("environment",a),`/migration/v2/metadata/object/${s}?${d.toString()}`},providesTags:["Metadata"]}),getMappedTargetObject:t.query({query:({sourceObjectId:s,projectId:a,environmentId:i})=>`/migration/v1/entity-mapped-object/?source_object_id=${s}&project=${a}&environment=${i}`,providesTags:["MappedObject"]}),updateFieldMetadata:t.mutation({query:({objectId:s,fieldId:a,updates:i})=>({url:`/migration/v1/object/${s}/fields/${a}`,method:"PUT",body:i}),invalidatesTags:["Metadata"]}),getOntologyMappings:t.query({query:s=>`https://api-dev.datamatter.tech/agent/ontology-mapper-context-gathering/mapper/object/${s}`,providesTags:["Ontology"]}),updateOntologyMapping:t.mutation({query:({mappingId:s,updates:a})=>({url:`https://api-dev.datamatter.tech/agent/ontology-mapper-context-gathering/mapper/?mapping_id=${s}`,method:"PUT",body:a}),invalidatesTags:["Ontology"]})})}),{useGetObjectMetadataQuery:js,useGetObjectMetadataPaginatedQuery:yn,useGetMappedTargetObjectQuery:hr,useUpdateFieldMetadataMutation:hi,useGetOntologyMappingsQuery:xi,useUpdateOntologyMappingMutation:pi}=Qs,Js=Ge({reducerPath:"cleanupApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Cleanup"],endpoints:t=>({getCleanupData:t.query({query:({objectId:s,environmentId:a,includeAll:i=!0})=>{const l=new URLSearchParams({object_id:s,tab_name:"cleanup",include_all:i.toString()});return a&&l.append("environment",a),`/migration/affected/fields?${l.toString()}`},providesTags:["Cleanup"]})})}),{useGetCleanupDataQuery:cc}=Js,Ia=Ge({reducerPath:"cleanupDataApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["CleanupData"],endpoints:t=>({getCleanupData:t.query({query:({objectId:s,changeLogId:a,page:i=1,pageSize:l=50})=>`/migration/cleanup/data?object_id=${s}&change_log_id=${a}&page=${i}&page_size=${l}`,providesTags:["CleanupData"]})})}),{useGetCleanupDataQuery:dc}=Ia,Pa=Ge({reducerPath:"cleanupFunctionsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["CleanupFunctions"],endpoints:t=>({getCleanupFunctions:t.query({query:({changeLogId:s})=>`/migration/cleanup/action?changelog_id=${s}`,providesTags:["CleanupFunctions"],transformResponse:s=>s})})}),{useGetCleanupFunctionsQuery:uc}=Pa,Ra=Ge({reducerPath:"cleanupRuleApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["CleanupRule","CleanupTask"],endpoints:t=>({applyCleanupRule:t.mutation({query:s=>({url:"/migration/v2/cleaner/rule",method:"POST",body:s}),transformErrorResponse:(s,a,i)=>{if(s.status===409){const l=s.data;return{status:409,data:{error:"RULE_ALREADY_APPLIED",message:l?.message||"This cleanup rule has already been applied or is in progress",change_log_id:i.change_log_id,task_id:l?.task_id}}}return s},invalidatesTags:["CleanupRule"]}),getTaskStatus:t.query({query:({taskId:s})=>`migration/v2/cleaner/tasks/${s}/status`,providesTags:(s,a,{taskId:i})=>[{type:"CleanupTask",id:i}]}),applyCleanupRuleWithRetry:t.mutation({query:s=>({url:"/migration/v2/cleaner/rule",method:"POST",body:s}),extraOptions:{maxRetries:1}})})}),{useApplyCleanupRuleMutation:hc,useLazyGetTaskStatusQuery:xc}=Ra,fr=Ge({reducerPath:"validateFunctionsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["ValidateFunctions"],endpoints:t=>({getValidateFunctions:t.query({query:({changeLogId:s})=>`/migration/validate/action?changelog_id=${s}`,providesTags:["ValidateFunctions"],transformResponse:s=>s})})}),jr=Ge({reducerPath:"validateDataApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["ValidateData"],endpoints:t=>({getValidateData:t.query({query:({objectId:s,changeLogId:a,page:i=1,pageSize:l=50})=>`/migration/validate/data?object_id=${s}&change_log_id=${a}&page=${i}&page_size=${l}`,providesTags:["ValidateData"]})})}),Ys=Ge({reducerPath:"validateApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Validate"],endpoints:t=>({getValidateData:t.query({query:({objectId:s,environmentId:a,includeAll:i=!0})=>{const l=new URLSearchParams({object_id:s,tab_name:"validate",include_all:i.toString()});return a&&l.append("environment",a),`/migration/affected/fields?${l.toString()}`},providesTags:["Validate"]})})}),{useGetValidateDataQuery:pc}=Ys,Da=Ge({reducerPath:"validateRuleApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["ValidateRule","ValidateTask"],endpoints:t=>({applyValidateRule:t.mutation({query:s=>({url:"/migration/v2/validator/rule",method:"POST",body:s}),transformErrorResponse:(s,a,i)=>{if(s.status===409){const l=s.data;return{status:409,data:{error:"RULE_ALREADY_APPLIED",message:l?.message||"This validate rule has already been applied or is in progress",change_log_id:i.change_log_id,task_id:l?.task_id}}}return s},invalidatesTags:["ValidateRule"]}),getTaskStatus:t.query({query:({taskId:s})=>`/migration/v2/cleaner/tasks/${s}/status`,providesTags:(s,a,{taskId:i})=>[{type:"ValidateTask",id:i}]}),applyValidateRuleWithRetry:t.mutation({query:s=>({url:"/migration/v2/validator/rule",method:"POST",body:s}),extraOptions:{maxRetries:1}})})}),{useLazyGetTaskStatusQuery:mc}=Da,Ks=Ge({reducerPath:"mappingApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Mapping"],endpoints:t=>({getMappingData:t.query({query:({sourceObjectId:s,environmentId:a})=>{const i=new URLSearchParams({source_object_id:s});return a&&i.append("environment",a),`/migration/v1/field/mapping/?${i.toString()}`},providesTags:["Mapping"]})})}),{useGetMappingDataQuery:gc}=Ks,Xs=Ge({reducerPath:"transformApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech/migration/v2",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["TransformData"],endpoints:t=>({getTransformData:t.query({query:({objectId:s,environmentId:a,page:i=1,pageSize:l=50})=>{const d=new URLSearchParams({object_id:s,file_name:`${s}.csv`,page:i.toString(),page_size:l.toString()});return a&&d.append("environment",a),`/data/?${d.toString()}`},providesTags:["TransformData"]})})}),{useGetTransformDataQuery:mi}=Xs,Ea=Ge({reducerPath:"transformActionsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech/migration/v2/transform",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["TransformActions"],endpoints:t=>({getTransformActions:t.query({query:()=>"/actions/",providesTags:["TransformActions"]}),getTransformActionConfig:t.query({query:s=>`/action/config/${s}`,providesTags:["TransformActions"]})})}),{useGetTransformActionsQuery:fc,useGetTransformActionConfigQuery:jc}=Ea,Fa=Ge({reducerPath:"transformRuleApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech/migration/v2/transform",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["TransformRule","TransformTask"],endpoints:t=>({applyTransformRule:t.mutation({query:s=>({url:"/rule/",method:"POST",body:s}),transformErrorResponse:(s,a,i)=>{if(s.status===409){const l=s.data;return{status:409,data:{error:"TRANSFORM_ALREADY_APPLIED",message:l?.message||"This transform rule has already been applied or is in progress",object_id:i.object_id,task_id:l?.task_id}}}return s},invalidatesTags:["TransformRule"]}),getTransformTaskStatus:t.query({query:({taskId:s})=>`/rule/tasks/${s}/status`,providesTags:(s,a,{taskId:i})=>[{type:"TransformTask",id:i}]}),getTransformRules:t.query({query:({objectId:s})=>`/rules/?object_id=${s}`,providesTags:["TransformRule"]}),applyAllRules:t.mutation({query:({object_id:s,rule_ids:a})=>({url:`https://api-dev.datamatter.tech/migration/v2/cleaner/rules?object_id=${s}`,method:"POST",body:a})}),getCleanerTaskStatus:t.query({query:({taskId:s})=>`https://api-dev.datamatter.tech/migration/v2/cleaner/tasks/${s}/status`}),deleteTransformRule:t.mutation({query:({ruleId:s})=>({url:`https://api-dev.datamatter.tech/migration/v2/transform/rule/${s}`,method:"DELETE"}),invalidatesTags:["TransformRule"]}),deleteCleanerRule:t.mutation({query:({ruleId:s})=>({url:`https://api-dev.datamatter.tech/migration/cleanup/rule?rule_id=${s}`,method:"DELETE"}),invalidatesTags:["TransformRule"]}),getCleanupRules:t.query({query:({objectId:s})=>`https://api-dev.datamatter.tech/migration/v2/cleaner/rules?object_id=${s}&tab_name=cleanup`,providesTags:["TransformRule"]}),getValidateRules:t.query({query:({objectId:s})=>`https://api-dev.datamatter.tech/migration/v2/cleaner/rules?object_id=${s}&tab_name=validate`,providesTags:["TransformRule"]})})}),{useApplyTransformRuleMutation:yc,useGetTransformTaskStatusQuery:bc,useGetTransformRulesQuery:vc,useApplyAllRulesMutation:en,useLazyGetCleanerTaskStatusQuery:tn,useDeleteTransformRuleMutation:_c,useDeleteCleanerRuleMutation:gi,useGetCleanupRulesQuery:Sc,useGetValidateRulesQuery:kc}=Fa,ea=Ge({reducerPath:"filterApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["FilterData"],endpoints:t=>({getFilterData:t.query({query:({objectId:s,environmentId:a,page:i=1,limit:l=10,search:d=""})=>{const c=new URLSearchParams({page:i.toString(),limit:l.toString(),search:d});return a&&c.append("environment",a),`/management/v2/filtered_file/${s}/${s}.csv?${c.toString()}`},providesTags:["FilterData"]}),removeColumns:t.mutation({query:s=>({url:"/management/v2/remove_columns",method:"POST",body:s}),invalidatesTags:["FilterData"]})})}),{useGetFilterDataQuery:wc,useRemoveColumnsMutation:Cc}=ea,ta=Ge({reducerPath:"loadApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["LoadIteration","SalesforceConnection"],endpoints:t=>({getLoadIteration:t.query({query:({objectId:s,projectId:a,environmentId:i})=>{if(!s||!a)throw new Error("objectId and projectId are required");const l=new URLSearchParams({object:s,project:a});return i&&l.append("environment",i),`/migration/v1/iteration/data/?${l.toString()}`},providesTags:["LoadIteration"]}),loadData:t.mutation({query:({iterationId:s,sourceObjectId:a,operation:i})=>({url:`/load/ingest/v1/load/file?operation=${i}&iteration_id=${s}&source_object_id=${a}`,method:"POST"}),invalidatesTags:["LoadIteration"]}),generateLoadFile:t.mutation({query:s=>{if(!s)throw new Error("objectId is required");return{url:`/load/ingest/v1/generate/load/file?source_object_id=${s}`,method:"POST",body:{source_object_id:s}}}}),checkSalesforceConnection:t.query({query:()=>"/load/v1/check-connection/",providesTags:["SalesforceConnection"]}),connectToSalesforce:t.mutation({query:s=>({url:"/load/v1/connect/",method:"POST",body:s}),invalidatesTags:["SalesforceConnection"]}),disconnectFromSalesforce:t.mutation({query:()=>({url:"/load/v1/disconnect/",method:"DELETE"}),invalidatesTags:["SalesforceConnection"]}),extractSalesforceSample:t.mutation({query:({object_name:s})=>({url:`/load/v1/salesforce/sample/${s}`,method:"POST",body:{object_name:s}})}),refreshSalesforceMetadata:t.mutation({query:s=>({url:`/load/v1/salesforce/metadata/${s.object_name}`,method:"POST",body:s})})})}),{useGetLoadIterationQuery:Tc,useGenerateLoadFileMutation:Ic,useLoadDataMutation:Pc,useCheckSalesforceConnectionQuery:Rc,useConnectToSalesforceMutation:Dc,useDisconnectFromSalesforceMutation:Ec,useExtractSalesforceSampleMutation:Fc,useRefreshSalesforceMetadataMutation:Ac}=ta,Aa=Ge({reducerPath:"entitiesApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["SalesforceObjects"],endpoints:t=>({getSalesforceObjects:t.query({query:()=>"/load/v1/salesforce/objects/",providesTags:["SalesforceObjects"]})})}),{useGetSalesforceObjectsQuery:Wc}=Aa,Wa=Ge({reducerPath:"backupApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["Backup"],endpoints:t=>({createLoadBackup:t.mutation({query:({objectId:s})=>({url:`backup/v1/preload/backup/?source_object_id=${s}`,method:"POST",body:{object_id:s}}),invalidatesTags:["Backup"]}),getBackupStatus:t.query({query:s=>`backup/v1/backup/status/?backup_job_id=${s}`,providesTags:["Backup"]})})}),{useCreateLoadBackupMutation:zc,useLazyGetBackupStatusQuery:Oc}=Wa,za=Ge({reducerPath:"backupStatsApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["BackupStats","BackupActivity","BackupObjects","BackupPlan","BackupHistory","BackupDownload"],endpoints:t=>({getBackupStats:t.query({query:()=>"/backup/v1/backup/stats/",providesTags:["BackupStats"]}),getRecentActivity:t.query({query:({page:s=1,limit:a=5})=>`/backup/v1/backup/recent-activity/?page=${s}&limit=${a}`,providesTags:["BackupActivity"]}),getTopObjects:t.query({query:({limit:s=5})=>`/backup/v1/backup/top-objects/?limit=${s}`,providesTags:["BackupObjects"]}),createBackupPlan:t.mutation({query:({object_id:s,Select:a,backup_type:i,backup_model:l,schedule_info:d})=>({url:`/backup/v1/backup/plan/?object_id=${s}&Select=${a}&backup_type=${encodeURIComponent(i)}`,method:"POST",body:{backup_model:l,schedule_info:d}}),invalidatesTags:["BackupPlan"]}),getBackupProcessStatus:t.query({query:s=>({url:`/backup/v1/backup/process/?summary_id=${s}`,method:"POST"}),providesTags:["BackupPlan"]}),getBackupSummaryDetails:t.query({query:s=>`/backup/v1/backup/summary-details/?object_id=${s}`,providesTags:["BackupHistory"]}),downloadBackup:t.query({query:({object_id:s,filename:a,version:i})=>`/backup/v1/backup/download/?object_id=${s}&filename=${a}&version=${i}`,providesTags:["BackupDownload"]})})}),{useGetBackupStatsQuery:Mc,useGetRecentActivityQuery:Lc,useGetTopObjectsQuery:$c,useCreateBackupPlanMutation:qc,useGetBackupProcessStatusQuery:Uc,useGetBackupSummaryDetailsQuery:Bc,useLazyDownloadBackupQuery:Nc}=za,yr=Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t},fetchFn:async(t,s)=>{console.log("üåê HTTP REQUEST:",{url:t,method:s?.method,headers:s?.headers?Object.fromEntries(s.headers.entries()):void 0,body:s?.body?typeof s.body=="string"?JSON.parse(s.body):s.body:void 0});const a=await fetch(t,s);console.log("üåê HTTP RESPONSE:",{url:t,status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries())});const i=a.clone();try{const l=await i.json();console.log("üåê HTTP RESPONSE BODY:",l)}catch{console.log("üåê HTTP RESPONSE BODY: (not JSON or empty)")}return a}});let br=!1,Ls=null;const Gc=async(t,s,a)=>{const i=t.url?.includes("/auth/v3/refresh_token");let l=await yr(t,s,a);if(l.error&&l.error.status===401&&!i){console.group("üîê 401 Unauthorized - Token Refresh Required"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log(`üì° Failed Request: ${t.method||"GET"} ${t.url}`),console.log("üîç Checking for refresh token...");const d=localStorage.getItem("refreshToken");if(!d)return console.error("‚ùå No refresh token available - logging out"),console.groupEnd(),s.dispatch(Ot()),window.location.href="/login",l;if(br&&Ls){console.log("‚è≥ Refresh already in progress - waiting for completion...");try{return await Ls,console.log("‚úÖ Refresh completed - retrying original request"),l=await yr(t,s,a),console.groupEnd(),l}catch{return console.error("‚ùå Refresh failed while waiting - logging out"),s.dispatch(Ot()),window.location.href="/login",console.groupEnd(),l}}console.log("üîÑ Starting new token refresh process..."),br=!0,localStorage.setItem("tokenRefreshInProgress","true"),Ls=(async()=>{try{const u=await Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:f=>(f.set("Accept","application/json"),f.set("Content-Type","application/json"),f)})({url:`/auth/v3/refresh_token?refresh_token=${encodeURIComponent(d)}`,method:"POST"},s,a);if(u.data&&!u.error){const{access_token:f,refresh_token:y}=u.data;console.group("üîÑ Token Refresh (API Interceptor)"),console.log(`‚è∞ Refresh Time: ${new Date().toLocaleString()}`),console.log("‚úÖ Refresh token API call successful");try{const h=JSON.parse(atob(f.split(".")[1])),p=new Date(h.exp*1e3),m=h.exp*1e3-Date.now(),S=Math.floor(m/6e4),T=Math.floor(m%6e4/1e3);console.log(`üìÖ New Access Token Expiry: ${p.toLocaleString()}`),console.log(`‚è≥ Remaining Time: ${S}m ${T}s`)}catch{console.warn("Could not parse access token expiry")}return s.dispatch(zs({accessToken:f,refreshToken:y||d})),console.log("‚úÖ Tokens updated in Redux store"),console.groupEnd(),{success:!0}}else throw console.error("‚ùå Refresh token API returned error:",u.error),new Error("Refresh token failed")}catch(c){throw console.error("Token refresh failed:",c),c}finally{br=!1,Ls=null,localStorage.removeItem("tokenRefreshInProgress")}})();try{await Ls,console.log("‚úÖ Token refresh successful - retrying original request"),l=await yr(t,s,a),l.error?console.warn("‚ö†Ô∏è Original request still failed after refresh:",l.error):console.log("‚úÖ Original request succeeded after token refresh"),console.groupEnd()}catch(c){console.error("‚ùå Token refresh failed, logging out:",c),console.groupEnd(),s.dispatch(Ot()),window.location.href="/login"}}return l},Oa=Ge({reducerPath:"authApi",baseQuery:Gc,tagTypes:["User"],endpoints:t=>({login:t.mutation({query:s=>({url:"/auth/v3/login/",method:"POST",body:s}),async onQueryStarted(s,{dispatch:a,queryFulfilled:i}){a(Es()),a(ls(!0));try{await i}catch(l){const d=l?.error?.data?.message||"Login failed";a(Vs(d))}finally{a(ls(!1))}}}),register:t.mutation({query:s=>({url:"/auth/v3/register/",method:"POST",body:s}),async onQueryStarted(s,{dispatch:a,queryFulfilled:i}){a(Es()),a(ls(!0));try{await i}catch(l){const d=l?.error?.data?.message||"Registration failed";a(Vs(d))}finally{a(ls(!1))}}}),forgotPassword:t.mutation({query:s=>({url:"/auth/v3/forgot_password/",method:"POST",body:s}),async onQueryStarted(s,{dispatch:a,queryFulfilled:i}){a(Es()),a(ls(!0));try{await i}catch(l){const d=l?.error?.data?.message||"Failed to send reset email";a(Vs(d))}finally{a(ls(!1))}}}),refreshToken:t.mutation({query:s=>({url:`/auth/v3/refresh_token?refresh_token=${encodeURIComponent(s.refresh_token)}`,method:"POST"})}),logout:t.mutation({query:()=>({url:"/auth/v3/logout/",method:"POST"}),async onQueryStarted(s,{dispatch:a}){a(Ot())}}),getUserProfile:t.query({query:()=>"/auth/v3/user/",providesTags:["User"]})})}),{useLoginMutation:Vc,useRegisterMutation:Hc,useForgotPasswordMutation:Zc,useRefreshTokenMutation:Qc,useLogoutMutation:Jc}=Oa,Ma=Ge({reducerPath:"errorApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["ErrorTracker"],endpoints:t=>({getErrorTracker:t.query({query:({objectId:s,page:a=1,pageSize:i=10})=>{if(!s)throw new Error("objectId is required");return`/load/ingest/v1/error_tracker/?object_id=${s}&page=${a}&page_size=${i}`},providesTags:["ErrorTracker"]}),updateError:t.mutation({query:({id:s,...a})=>({url:"/load/ingest/v1/errortracker/",method:"PUT",body:{id:s,...a}}),invalidatesTags:["ErrorTracker"]}),getErrorTrackerDataRecords:t.query({query:({summaryId:s,objectId:a,page:i=1,pageSize:l=50})=>({url:"/load/ingest/v1/data_records/error_tracker/",params:{summary_id:s,object_id:a,page:i,page_size:l}}),providesTags:["ErrorTracker"]}),updateErrorRecord:t.mutation({query:({summaryId:s,objectId:a,recordData:i})=>({url:"/load/ingest/v1/edit_selected/error_records",method:"POST",params:{summary_id:s,object_id:a},body:[i]}),invalidatesTags:["ErrorTracker"]}),emailAllErrorRecords:t.query({query:s=>({url:"/load/ingest/v1/email_all/error_tracker/records",params:{object_id:s}})}),loadAllErrorRecords:t.mutation({query:s=>({url:"/load/ingest/v1/generate/load/file",method:"POST",params:{source_object_id:s}})}),emailErrorRecord:t.query({query:({errorId:s,objectId:a})=>({url:`/load/ingest/v1/email/error_tracker/${s}`,params:{object_id:a}})}),ignoreErrorRecord:t.query({query:({errorTrackerId:s,iterationId:a,objectId:i})=>({url:"/load/ingest/v1/ignore/data_records",params:{error_tracker_id:s,iteration_id:a,object_id:i}})}),downloadErrorCsv:t.query({query:({errorId:s,objectId:a,iterationId:i})=>({url:`/load/ingest/v1/download/error_csv/${s}`,params:{object_id:a,iteration_id:i}})})})}),{useGetErrorTrackerQuery:Yc,useUpdateErrorMutation:Kc,useGetErrorTrackerDataRecordsQuery:Xc,useUpdateErrorRecordMutation:ed,useLazyEmailAllErrorRecordsQuery:td,useLoadAllErrorRecordsMutation:sd,useLazyEmailErrorRecordQuery:ad,useLazyIgnoreErrorRecordQuery:rd,useLazyDownloadErrorCsvQuery:nd}=Ma,La=Ge({reducerPath:"odfFileApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t}}),tagTypes:["ODFFile","ChartData","Distribution","Metadata","Completion"],endpoints:t=>({getODFFile:t.query({query:({id:s,objectId:a})=>`/management/v3/view/object_file/${s}?object_id=${a}`,providesTags:["ODFFile"]}),uploadODFFile:t.mutation({query:({file:s,objectId:a,importType:i})=>{const l=new FormData;return l.append("file",s),l.append("import_type",i),{url:`/management/v3/import/object_file/${a}`,method:"POST",body:l}},invalidatesTags:["ODFFile"]}),uploadFile:t.mutation({query:s=>({url:"/management/v3/file/upload",method:"POST",body:s})}),getViewFile:t.query({query:({objectId:s,fileId:a})=>`/management/v3/view/object_file/${a}?object_id=${s}`,providesTags:["ODFFile"]}),extractMetadata:t.mutation({query:s=>({url:"/migration/metadata/extract/",method:"POST",body:{environment_id:s.environment_id,file_name:s.file_name,object_id:s.object_id,object_name:s.object_name,project:s.project}}),invalidatesTags:["Metadata"]}),checkMetadataStatus:t.query({query:s=>`/migration/metadata/extract-status/${s}`,providesTags:["Metadata"]}),getColumnDensity:t.query({query:({object_id:s,refresh:a=!0})=>({url:"/migration/v2/summary/chart/column-density/",params:{object_id:s,refresh:String(a)}}),providesTags:["ChartData"]}),getObjectCompletion:t.query({query:s=>`/management/v2/object/estimator/${s}/completion`,providesTags:["Completion"]}),getDataDensity:t.query({query:({object_id:s,refresh:a=!0})=>({url:"/migration/v2/data/density/",params:{object_id:s,refresh:String(a)}}),providesTags:["ChartData"]}),getDataQuality:t.query({query:({object_id:s,refresh:a=!0})=>({url:"/migration/v2/data/quality/",params:{object_id:s,refresh:String(a)}}),providesTags:["ChartData"]}),getEntityMappedObject:t.query({query:({source_object_id:s,project:a,environment:i})=>({url:"/migration/v1/entity-mapped-object/",params:{source_object_id:s,project:a,environment:i}})}),getPicklistDistribution:t.query({query:({object_id:s,picklist_field:a})=>({url:`/migration/v1/object/${s}/summary/chart/distribution/picklist_record/${encodeURIComponent(a)}`}),providesTags:["Distribution"]}),getChartFilter:t.query({query:s=>`/migration/v1/object/${s}/summary/chart/filter`,providesTags:["ChartData"]}),getDateDistribution:t.query({query:({object_id:s,field_id:a,file_name:i})=>`/migration/v1/object/${s}/summary/chart/distribution/date/${a}?file_name=${i}`,providesTags:["Distribution"]}),getAllPicklistDistributions:t.query({async queryFn({object_id:s},a,i,l){const d=await l(`/migration/v1/object/${s}/summary/chart/filter`);if(d.error)return{error:d.error};const f=(d.data.picklist_values||[]).map(async p=>{const m=await l(`/migration/v1/object/${s}/summary/chart/distribution/picklist_record/${encodeURIComponent(p)}`);return{field:p,data:m.data}}),y=await Promise.all(f),h={};return y.forEach(({field:p,data:m})=>{m&&!m.error&&(h[p]=m)}),{data:h}},providesTags:["Distribution"]})})}),{useGetODFFileQuery:id,useUploadFileMutation:od,useExtractMetadataMutation:ld,useCheckMetadataStatusQuery:cd,useLazyGetObjectCompletionQuery:dd,useLazyGetColumnDensityQuery:ud,useLazyGetDataDensityQuery:hd,useLazyGetDataQualityQuery:xd,useGetEntityMappedObjectQuery:pd,useLazyGetEntityMappedObjectQuery:md,useLazyGetPicklistDistributionQuery:gd,useLazyGetChartFilterQuery:fd,useLazyGetAllPicklistDistributionsQuery:jd,useLazyGetDateDistributionQuery:yd}=La,$a=Ge({reducerPath:"pipelineApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t}}),tagTypes:["Pipeline","PipelineStep","Execution","ExecutionStep"],endpoints:t=>({getPipelines:t.query({query:({object_id:s,environment_id:a})=>({url:`/pipeline/object/${s}/environment/${a}`}),providesTags:["Pipeline"]}),getPipelineSteps:t.query({query:s=>`/pipeline/${s}/steps`,providesTags:["PipelineStep"]}),generatePipeline:t.mutation({query:s=>({url:"/pipeline/",method:"POST",body:s}),invalidatesTags:["Pipeline"]}),runPipeline:t.mutation({query:({pipelineId:s,environmentId:a})=>({url:`/pipeline/${s}/execute`,method:"POST",params:{environment_id:a},body:{pipeline_id:s}}),invalidatesTags:["Pipeline","PipelineStep"]}),runPipelineStep:t.mutation({query:({pipelineId:s,stepId:a})=>({url:`/pipeline/${s}/step/${a}/run`,method:"POST"}),invalidatesTags:["PipelineStep"]}),getExecutions:t.query({query:({pipeline_id:s,environment_id:a})=>({url:"/pipeline/executions",params:{pipeline_id:s,environment_id:a}}),providesTags:["Execution"]}),getExecutionSteps:t.query({query:s=>`/pipeline/executions/${s}/steps`,providesTags:["ExecutionStep"]}),promotePipeline:t.mutation({query:({pipelineId:s,...a})=>({url:`/pipeline/${s}/promote`,method:"POST",body:a}),invalidatesTags:["Pipeline"]})})}),{useGetPipelinesQuery:bd,useGetPipelineStepsQuery:vd,useGeneratePipelineMutation:_d,useRunPipelineMutation:Sd,useGetExecutionsQuery:kd,useGetExecutionStepsQuery:wd,usePromotePipelineMutation:Cd}=$a,qa=Ge({reducerPath:"lookupApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t}}),tagTypes:["LookupRelations"],endpoints:t=>({getLookupRelations:t.query({query:s=>`/load/lookup/v1/lookup/${s}/`,providesTags:["LookupRelations"]}),createLookupRelation:t.mutation({query:s=>({url:"/load/lookup/v1/lookup/",method:"POST",body:s}),invalidatesTags:["LookupRelations"]}),updateLookupRelation:t.mutation({query:s=>({url:"/load/lookup/v1/lookup/",method:"PUT",body:s}),invalidatesTags:["LookupRelations"]})})}),{useGetLookupRelationsQuery:Td,useCreateLookupRelationMutation:Id,useUpdateLookupRelationMutation:Pd}=qa,vr=Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Content-Type","application/json"),t},fetchFn:async(t,s)=>{console.log("üåê ESTIMATOR REQUEST:",{url:t,method:s?.method,headers:s?.headers?Object.fromEntries(s.headers.entries()):void 0,body:s?.body?typeof s.body=="string"?JSON.parse(s.body):s.body:void 0});const a=await fetch(t,s);console.log("üåê ESTIMATOR RESPONSE:",{url:t,status:a.status,statusText:a.statusText,headers:Object.fromEntries(a.headers.entries())});const i=a.clone();try{const l=await i.json();console.log("üåê ESTIMATOR RESPONSE BODY:",l)}catch{console.log("üåê ESTIMATOR RESPONSE BODY: (not JSON or empty)")}return a}});let _r=!1,$s=null;const Rd=async(t,s,a)=>{const i=t.url?.includes("/auth/v3/refresh_token");let l=await vr(t,s,a);if(l.error&&l.error.status===401&&!i){if(localStorage.getItem("tokenRefreshInProgress")==="true"&&_r&&$s)try{return await $s,l=await vr(t,s,a),l}catch{return s.dispatch(Ot()),window.location.href="/login",l}const c=localStorage.getItem("refreshToken");if(!c)return s.dispatch(Ot()),window.location.href="/login",l;_r=!0,localStorage.setItem("tokenRefreshInProgress","true"),$s=(async()=>{try{const f=await Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:y=>(y.set("Accept","application/json"),y.set("Content-Type","application/json"),y)})({url:`/auth/v3/refresh_token?refresh_token=${encodeURIComponent(c)}`,method:"POST"},s,a);if(f.data&&!f.error){const{access_token:y,refresh_token:h}=f.data;return s.dispatch(zs({accessToken:y,refreshToken:h||c})),{success:!0}}else throw new Error("Refresh token failed")}catch(u){throw console.error("Token refresh failed:",u),u}finally{_r=!1,$s=null,localStorage.removeItem("tokenRefreshInProgress")}})();try{await $s,l=await vr(t,s,a)}catch(u){console.error("Token refresh failed, logging out:",u),s.dispatch(Ot()),window.location.href="/login"}}return l},Ua=Ge({reducerPath:"estimatorApi",baseQuery:Rd,tagTypes:["Estimator"],endpoints:t=>({getObjectEstimatorStatus:t.query({query:()=>"/management/v2/object/estimator/project/environment/status/",providesTags:["Estimator"],transformResponse:s=>s.data||s})})}),Sr=Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}});let kr=!1,qs=null;const Dd=async(t,s,a)=>{const i=t.url?.includes("/auth/v3/refresh_token");let l=await Sr(t,s,a);if(l.error&&l.error.status===401&&!i){if(localStorage.getItem("tokenRefreshInProgress")==="true"&&kr&&qs)try{return await qs,l=await Sr(t,s,a),l}catch{return s.dispatch(Ot()),window.location.href="/login",l}const c=localStorage.getItem("refreshToken");if(!c)return s.dispatch(Ot()),window.location.href="/login",l;kr=!0,localStorage.setItem("tokenRefreshInProgress","true"),qs=(async()=>{try{const f=await Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:y=>(y.set("Accept","application/json"),y.set("Content-Type","application/json"),y)})({url:`/auth/v3/refresh_token?refresh_token=${encodeURIComponent(c)}`,method:"POST"},s,a);if(f.data&&!f.error){const{access_token:y,refresh_token:h}=f.data;return s.dispatch(zs({accessToken:y,refreshToken:h||c})),{success:!0}}else throw new Error("Refresh token failed")}catch(u){throw console.error("Token refresh failed:",u),u}finally{kr=!1,qs=null,localStorage.removeItem("tokenRefreshInProgress")}})();try{await qs,l=await Sr(t,s,a)}catch(u){console.error("Token refresh failed, logging out:",u),s.dispatch(Ot()),window.location.href="/login"}}return l},sa=Ge({reducerPath:"dashboardApi",baseQuery:Dd,tagTypes:["MigrationStatus"],endpoints:t=>({getMigrationStatus:t.query({query:()=>"/management/v2/object/estimator/project/environment/status/",providesTags:["MigrationStatus"]})})}),{useGetMigrationStatusQuery:Ed}=sa,Ba=Ge({reducerPath:"activityApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t}}),tagTypes:["ActivityStatus","Completion"],endpoints:t=>({getActivityStatus:t.query({query:({objectId:s})=>({url:"/management/v2/activity_status/object_estimator",params:{object_id:s}}),providesTags:["ActivityStatus"]}),updateActivityStatus:t.mutation({query:({object_id:s,activity:a,flag:i,allow:l})=>({url:"/management/v2/activity/status/completed/",method:"PUT",params:{object_id:s,activity:a,flag:i.toString(),allow:l.toString()}}),invalidatesTags:["ActivityStatus","Completion"]}),getActivityStatusLegacy:t.query({query:({objectId:s})=>({url:"/activity-status",params:{object_id:s}})})})}),{useGetActivityStatusQuery:Fd,useUpdateActivityStatusMutation:Ad}=Ba,Na=Ge({reducerPath:"securityPoliciesApi",baseQuery:Be({baseUrl:"https://api-dev.datamatter.tech",prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t.set("Accept","application/json"),t.set("Content-Type","application/json"),t}}),tagTypes:["SecurityPolicies"],endpoints:t=>({getSecurityPolicies:t.query({query:()=>"/agent/semantic_policy/policies",providesTags:["SecurityPolicies"]}),createSecurityPolicy:t.mutation({query:s=>({url:"/agent/semantic_policy/policy",method:"POST",body:s}),invalidatesTags:["SecurityPolicies"]}),updateSecurityPolicy:t.mutation({query:({id:s,data:a})=>({url:`/agent/semantic_policy/policies/${s}`,method:"PUT",body:a}),invalidatesTags:["SecurityPolicies"]}),deleteSecurityPolicy:t.mutation({query:s=>({url:`/agent/semantic_policy/policies/${s}`,method:"DELETE"}),invalidatesTags:["SecurityPolicies"]}),updateDefaultPolicy:t.mutation({query:({policyId:s})=>({url:`/agent/semantic_policy/policies/${s}/default`,method:"PUT"}),invalidatesTags:["SecurityPolicies"]}),updateDefaultPolicyScope:t.mutation({query:s=>({url:"/agent/semantic_policy/update_default_policy",method:"PUT",body:s}),invalidatesTags:["SecurityPolicies"]}),getRevealActivities:t.query({query:()=>"/agent/reveal",providesTags:["SecurityPolicies"]}),getPolicyChangeHistory:t.query({query:()=>"/agent/v1/policy/all",providesTags:["SecurityPolicies"]})})}),{useGetSecurityPoliciesQuery:sn,useCreateSecurityPolicyMutation:Wd,useUpdateSecurityPolicyMutation:zd,useDeleteSecurityPolicyMutation:Od,useUpdateDefaultPolicyMutation:Md,useUpdateDefaultPolicyScopeMutation:Ld,useGetRevealActivitiesQuery:$d,useGetPolicyChangeHistoryQuery:qd}=Na,la=()=>"dev",Ud=()=>{const t=la().toLowerCase();return t==="dev"||t==="development"},Bd=()=>la().toLowerCase()==="qa",Nd=()=>la().toLowerCase()==="uat",Gd=()=>{const t=la().toLowerCase();return t==="prod"||t==="production"},fi=()=>"https://api-dev.datamatter.tech",ji=()=>"wss://api-dev.datamatter.tech",Vd=t=>{const s=fi(),a=t.startsWith("/")?t:`/${t}`;return`${s.endsWith("/")?s.slice(0,-1):s}${a}`},Hd=t=>{const s=ji(),a=t.startsWith("/")?t:`/${t}`;return`${s.endsWith("/")?s.slice(0,-1):s}${a}`},Zd={get environment(){return la()},get isDevelopment(){return Ud()},get isQA(){return Bd()},get isUAT(){return Nd()},get isProduction(){return Gd()},get baseUrl(){return fi()},get webSocketUrl(){return ji()},getUrl:Vd,getWebSocketUrlForEndpoint:Hd},Ga=Ge({reducerPath:"revealApi",baseQuery:Be({baseUrl:Zd.baseUrl,prepareHeaders:(t,{getState:s})=>{const a=s().auth.accessToken;return a&&t.set("authorization",`Bearer ${a}`),t}}),tagTypes:["Reveal"],endpoints:t=>({getRevealStatus:t.query({query:s=>({url:"agent/reveal/latest_entry",params:{object_id:s}}),transformResponse:s=>s,providesTags:["Reveal"]}),createReveal:t.mutation({query:s=>({url:"agent/reveal",method:"POST",body:s}),invalidatesTags:["Reveal"]}),updateReveal:t.mutation({query:({objectId:s,data:a})=>({url:`agent/reveal/${s}`,method:"PUT",body:a}),invalidatesTags:["Reveal"]})})}),{useGetRevealStatusQuery:Qd,useCreateRevealMutation:Jd,useUpdateRevealMutation:Yd}=Ga,Er=eo({reducer:{auth:_l,app:Ul,migration:lc,[Oa.reducerPath]:Oa.reducer,[za.reducerPath]:za.reducer,[ba.reducerPath]:ba.reducer,[va.reducerPath]:va.reducer,[_a.reducerPath]:_a.reducer,[Hs.reducerPath]:Hs.reducer,[Sa.reducerPath]:Sa.reducer,[ka.reducerPath]:ka.reducer,[wa.reducerPath]:wa.reducer,[Ca.reducerPath]:Ca.reducer,[Ua.reducerPath]:Ua.reducer,[Zs.reducerPath]:Zs.reducer,[Ta.reducerPath]:Ta.reducer,[Qs.reducerPath]:Qs.reducer,[Js.reducerPath]:Js.reducer,[Ia.reducerPath]:Ia.reducer,[Pa.reducerPath]:Pa.reducer,[Ra.reducerPath]:Ra.reducer,[Ys.reducerPath]:Ys.reducer,[jr.reducerPath]:jr.reducer,[fr.reducerPath]:fr.reducer,[Da.reducerPath]:Da.reducer,[Ks.reducerPath]:Ks.reducer,[Xs.reducerPath]:Xs.reducer,[Ea.reducerPath]:Ea.reducer,[Fa.reducerPath]:Fa.reducer,[ea.reducerPath]:ea.reducer,[ta.reducerPath]:ta.reducer,[Aa.reducerPath]:Aa.reducer,[Wa.reducerPath]:Wa.reducer,[Ma.reducerPath]:Ma.reducer,[La.reducerPath]:La.reducer,[$a.reducerPath]:$a.reducer,[qa.reducerPath]:qa.reducer,[sa.reducerPath]:sa.reducer,[Ba.reducerPath]:Ba.reducer,[Na.reducerPath]:Na.reducer,[Ga.reducerPath]:Ga.reducer},middleware:t=>t({serializableCheck:{ignoredActions:["persist/PERSIST","auth/updateLastActivity"],ignoredPaths:["auth.lastActivity"]}}).concat(Oa.middleware,za.middleware,ba.middleware,va.middleware,_a.middleware,Hs.middleware,Sa.middleware,ka.middleware,wa.middleware,Ca.middleware,Ua.middleware,Zs.middleware,Ta.middleware,Qs.middleware,Js.middleware,Ia.middleware,Pa.middleware,Ra.middleware,Ys.middleware,jr.middleware,fr.middleware,Da.middleware,Ks.middleware,Xs.middleware,Ea.middleware,Fa.middleware,ea.middleware,ta.middleware,Aa.middleware,Wa.middleware,Ma.middleware,La.middleware,$a.middleware,qa.middleware,sa.middleware,Ba.middleware,Na.middleware,Ga.middleware)}),bn="local_workspace_project",ca=()=>{const t=xt(),s=Ct(),{selectedProject:a,currentView:i}=ke(R=>R.app),{accessToken:l}=ke(R=>R.auth),[d,c]=o.useState(!1),[u]=kl(),{data:f,isLoading:y,error:h,refetch:p}=ai(void 0,{skip:!l}),{data:m=[],isLoading:S,error:T,refetch:g}=ri(void 0,{skip:!l}),P=o.useCallback(R=>({id:R.project_id,name:R.project_name,description:R.description,status:R.status,project_id:R.project_id,project_name:R.project_name,account_name:R.account_name,active:R.active,start_date:R.start_date,end_date:R.end_date,client:R.client,client_website:R.client_website,business_function:R.business_function,project_type:R.project_type==="filemigration"?"file migration":R.project_type,owner_id:R.owner_id,owner_name:R.owner_name,project_manager:R.project_manager,created_date:R.created_date,modified_date:R.modified_date,created_by:R.created_by,modified_by:R.modified_by,is_deleted:R.is_deleted,tenant_key:R.tenant_key,user_count:R.user_count}),[]),$=o.useCallback(R=>{switch(t(tr()),R.project_type){case"backup":s("/backup/dashboard"),t(zt("backup dashboard"));break;case"translation":s("/translation/dashboard"),t(zt("translation dashboard"));break;case"file migration":s("/file-migration/upload"),t(zt("file upload"));break;case"migration":default:s("/dashboard"),t(zt("dashboard"));break}},[t,s]),V=o.useCallback(()=>{const R=localStorage.getItem(bn);if(R&&m.length>0){const W=m.find(b=>b.project_id===R);if(W)return P(W)}if(f?.workspace?.project&&m.length>0){const W=m.find(b=>b.project_id===f.workspace.project);if(W)return P(W)}return m.length>0?P(m[0]):null},[f,m,P]);o.useEffect(()=>{if(!d&&m.length>0&&!a){const R=V();R&&(t(gn(R)),$(R),c(!0))}},[f,m,a,t,V,$,d]);const v=o.useCallback(async R=>{try{const W=m.find(C=>C.project_id===R);if(!W)throw new Error("Project not found");const b=P(W);localStorage.setItem(bn,R),t(gn(b));const F=f?.workspace?.environment||void 0;await u({project:R,environment:F}),await p(),t(Zs.util.invalidateTags(["ProjectEstimator"])),t(sa.util.invalidateTags(["MigrationStatus"])),t(Hs.util.invalidateTags(["Objects"])),t(Ua.util.invalidateTags(["Estimator"]));const G=window.location.pathname,E={migration:{routes:["/dashboard","/entities","/management"],startsWith:"/migration",menuMapping:{"/dashboard":"dashboard","/entities":"entities","/management":"management","/migration":"entities"}},backup:{routes:["/backup/dashboard","/backup/jobs","/backup/restore","/backup/history"],startsWith:"/backup",menuMapping:{"/backup/dashboard":"backup dashboard","/backup/jobs":"backup jobs","/backup/restore":"restore","/backup/history":"backup history"}},translation:{routes:["/translation/dashboard","/translation/languages","/translation/memory","/translation/progress"],startsWith:"/translation",menuMapping:{"/translation/dashboard":"translation dashboard","/translation/languages":"language packs","/translation/memory":"translation memory","/translation/progress":"progress tracking"}},"file migration":{routes:["/file-migration/upload","/file-migration/relationship","/file-migration/filter","/file-migration/metadata","/file-migration/cleanup","/file-migration/transform","/file-migration/mapping","/file-migration/validate","/file-migration/load","/file-migration/error","/file-migration/workflows"],startsWith:"/file-migration",menuMapping:{"/file-migration/upload":"file upload","/file-migration/relationship":"file relationship","/file-migration/filter":"file filter","/file-migration/metadata":"file metadata","/file-migration/cleanup":"file cleanup","/file-migration/transform":"file transform","/file-migration/mapping":"file mapping","/file-migration/validate":"file validate","/file-migration/load":"file load","/file-migration/error":"file error","/file-migration/workflows":"file workflows"}}},_=b.project_type,D=_&&E[_];if(D&&(D.routes.includes(G)||G.startsWith(D.startsWith))){const oe=D.menuMapping,Z=Object.keys(oe).find(he=>G===he||he!==G&&G.startsWith(he));return Z&&oe[Z]&&t(zt(oe[Z])),b}return $(b),b}catch(W){throw console.error("Failed to switch project:",W),W}},[m,P,t,$,i,f,u,p]),q=m.map(P),w=f?.workspace?.project,O=f?.workspace?.environment,N=a?.id;return{workspace:f?.workspace,projects:q,isLoading:y||S,error:h||T,refetchWorkspace:p,refetchProjects:g,switchProject:v,currentWorkspaceProjectId:w,currentSelectedProjectId:N,currentWorkspaceEnvironmentId:O,isInitialized:d}},yi=()=>{const{selectedProject:t,currentView:s}=ke(g=>g.app),{projects:a,switchProject:i,isLoading:l,currentWorkspaceProjectId:d}=ca(),[c,u]=o.useState(null),f=!!c,y=g=>{u(g.currentTarget)},h=()=>{u(null)},p=g=>{i(g),h()},m=g=>{switch(g){case"backup":return e.jsx(sr,{fontSize:"small"});case"translation":return e.jsx(Fs,{fontSize:"small"});case"file migration":case"filemigration":return e.jsx(Fn,{fontSize:"small"});case"migration":default:return e.jsx(Ps,{fontSize:"small"})}},S=g=>{switch(g){case"backup":return"info";case"translation":return"warning";case"file migration":case"filemigration":return"secondary";case"migration":default:return"primary"}};if(l)return e.jsx(n,{sx:{display:"flex",alignItems:"center",color:"white"},children:e.jsx(ie,{size:20,color:"inherit"})});const T=s==="settings";return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:T?"Select Project":`Current: ${t?.name||"No project selected"}`,children:e.jsx(n,{onClick:y,sx:{display:"flex",alignItems:"center",gap:1,px:1.5,py:.7,borderRadius:1,cursor:"pointer",bgcolor:"rgba(255,255,255,0.15)",color:"white","&:hover":{bgcolor:"rgba(255,255,255,0.25)"}},children:T?e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"body2",sx:{fontWeight:500},children:"Select Project"}),e.jsx(Xt,{fontSize:"small"})]}):t?e.jsxs(e.Fragment,{children:[m(t.project_type),e.jsx(r,{variant:"body2",sx:{fontWeight:500},children:t.name}),e.jsx(Xt,{fontSize:"small"})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"body2",sx:{fontWeight:500},children:"No project selected"}),e.jsx(Xt,{fontSize:"small"})]})})}),e.jsxs(to,{anchorEl:c,open:f,onClose:h,PaperProps:{sx:{width:350,maxHeight:400}},children:[e.jsxs(n,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"SELECT PROJECT"}),e.jsxs(r,{variant:"body2",color:"text.primary",fontWeight:"medium",children:["Current: ",t?.name||"No project selected"]})]}),a.map(g=>{const P=t?.id===g.id,$=g.id===d;return e.jsxs(re,{onClick:()=>p(g.id),selected:P,sx:{py:1.5,borderLeft:P?3:0,borderColor:"primary.main",backgroundColor:P?"action.selected":"transparent"},children:[e.jsx(Yt,{children:m(g.project_type)}),e.jsx(Wt,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:g.name}),e.jsx(X,{label:g.project_type==="file migration"?"FILE MIGRATION":g.project_type?.toUpperCase()||"MIGRATION",size:"small",color:S(g.project_type),variant:"outlined",sx:{fontSize:"0.55rem",height:18}}),$&&e.jsx(X,{label:"WORKSPACE",size:"small",color:"success",variant:"filled",sx:{fontSize:"0.55rem",height:18}})]}),secondary:e.jsx(r,{variant:"caption",color:"text.secondary",children:g.description||"No description"})}),P&&e.jsx(_s,{color:"primary",fontSize:"small"})]},g.id)}),a.length===0&&!l&&e.jsx(re,{disabled:!0,children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No projects available"})}),l&&e.jsx(re,{disabled:!0,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"body2",children:"Loading projects..."})]})}),e.jsx(n,{sx:{p:1.5,borderTop:1,borderColor:"divider",bgcolor:"grey.50"},children:e.jsxs(r,{variant:"caption",color:"text.secondary",children:["‚Ä¢ WORKSPACE: Your default project from server",e.jsx("br",{}),"‚Ä¢ Selection is saved locally"]})})]})]})},bi=()=>{const t=xt(),{selectedEnvironment:s,selectedProject:a,currentView:i}=ke(g=>g.app),{accessToken:l}=ke(g=>g.auth),[d]=wl(),{refetch:c}=ai(void 0,{skip:!l}),u=()=>{t(ea.util.invalidateTags(["FilterData"])),t(Qs.util.invalidateTags(["Metadata","MappedObject","Ontology"])),t(Ks.util.invalidateTags(["Mapping"])),t(Ys.util.invalidateTags(["Validate"])),t(ta.util.invalidateTags(["LoadIteration","SalesforceConnection"])),t(Xs.util.invalidateTags(["TransformData"])),t(Js.util.invalidateTags(["Cleanup"]))},{data:f=[],isLoading:y,error:h,isFetching:p}=oa(a?.id||"",{skip:!a?.id});o.useEffect(()=>{a&&t(pa())},[a?.id,t]),o.useEffect(()=>{if(a&&f.length>0&&!s){const g=f[0];t(er(g)),d({environment:g.id}).unwrap().then(()=>c()).catch(console.error)}},[f,s,a,t,d,c]),o.useEffect(()=>{s&&f.length>0&&!f.some(g=>g.id===s.id)&&t(pa())},[f,s,t]),o.useEffect(()=>{s&&(!s.id||!s.name)&&t(pa())},[s,t]);const m=g=>{const P=g.target.value;if(!P){t(pa()),t(jn()),u();return}const $=f.find(V=>V.id===P);$&&(t(er($)),t(jn()),u(),d({environment:$.id}).unwrap().then(()=>c()).catch(console.error))};if(!a)return e.jsxs(Ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Environment"}),e.jsx(We,{label:"Environment",value:"",disabled:!0,children:e.jsx(re,{value:"",children:i==="settings"?"Select environment":"Select project first"})})]});if(y||p)return e.jsxs(Ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Environment"}),e.jsx(We,{label:"Environment",value:"",disabled:!0,children:e.jsx(re,{value:"",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),"Loading..."]})})})]});if(h)return e.jsxs(Ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Environment"}),e.jsx(We,{label:"Environment",value:"",disabled:!0,children:e.jsx(re,{value:"",children:"Error loading"})})]});if(f.length===0)return e.jsxs(Ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Environment"}),e.jsx(We,{label:"Environment",value:"",disabled:!0,children:e.jsx(re,{value:"",children:"No environments"})})]});const S=()=>s&&f.some(g=>g.id===s.id)?s.id:"",T=i==="settings";return e.jsxs(Ae,{variant:"outlined",size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Environment"}),e.jsxs(We,{value:T?"":S(),onChange:m,label:"Environment",disabled:T,children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select environment"})}),!T&&f.map(g=>e.jsx(re,{value:g.id,children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:g.name}),e.jsxs(n,{sx:{display:"flex",gap:.5,ml:1},children:[e.jsx(n,{sx:{fontSize:"0.7rem",color:g.type==="prod"?"error.main":g.type==="dev"?"primary.main":g.type==="qa"?"secondary.main":"text.secondary",fontWeight:"bold"},children:g.type}),g.is_prod&&e.jsx(n,{sx:{fontSize:"0.7rem",color:"success.main",fontWeight:"bold"},children:"‚Ä¢ Prod"})]})]})},g.id))]})]})},Kd=({open:t,onClose:s})=>{const[a,i]=o.useState(0),[l,d]=o.useState(0),[c,u]=o.useState({environmentName:"Development",autoConnect:!0,sourceSystem:"",targetSystem:"",sourceUsername:"",targetUsername:"",sourcePassword:"",targetPassword:"",sourceSecurityToken:"",targetSecurityToken:"",sourceLoginUrl:"",targetLoginUrl:""}),f=(S,T)=>{i(T),u({...c,environmentName:["Development","Production","Quality"][T]})},y=()=>{console.log(`Testing ${l===0?"source":"target"} connection...`)},h=()=>{console.log("Deleting configuration...")},p=()=>{console.log("Saving configuration:",c),s()},m=l===0;return e.jsx(wt,{open:t,onClose:s,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{height:"700px",maxHeight:"95vh"}},children:e.jsxs(n,{sx:{display:"flex",height:"100%"},children:[e.jsxs(n,{sx:{width:160,bgcolor:"#1976d2",color:"white",flexShrink:0},children:[e.jsx(n,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(r,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600},children:"Configurations"})}),e.jsxs(Mt,{orientation:"vertical",value:a,onChange:f,sx:{"& .MuiTab-root":{color:"rgba(255,255,255,0.7)",alignItems:"flex-start",textAlign:"left",minHeight:48,"&.Mui-selected":{color:"white",bgcolor:"rgba(255,255,255,0.1)"}},"& .MuiTabs-indicator":{left:0,right:"auto",width:3,bgcolor:"white"}},children:[e.jsx(He,{icon:e.jsx(xa,{sx:{fontSize:16,mr:1}}),iconPosition:"start",label:"Development"}),e.jsx(He,{icon:e.jsx(xa,{sx:{fontSize:16,mr:1}}),iconPosition:"start",label:"Production"}),e.jsx(He,{icon:e.jsx(xa,{sx:{fontSize:16,mr:1}}),iconPosition:"start",label:"Quality"})]})]}),e.jsxs(n,{sx:{flex:1,display:"flex",flexDirection:"column",minWidth:0},children:[e.jsx(n,{sx:{p:1.5,borderBottom:"1px solid #e0e0e0",display:"flex",justifyContent:"flex-end",flexShrink:0},children:e.jsx(ne,{onClick:s,size:"small",children:e.jsx(An,{})})}),e.jsx(n,{sx:{flex:1,overflow:"auto",minHeight:0},children:e.jsxs(n,{sx:{p:2.5},children:[e.jsx(r,{variant:"h6",sx:{mb:1.5,fontSize:"1rem",fontWeight:500},children:"General"}),e.jsxs(n,{sx:{mb:1.5},children:[e.jsx(r,{variant:"body2",sx:{mb:.5,fontWeight:500,fontSize:"0.85rem"},children:"Environment Name"}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(Ae,{fullWidth:!0,size:"small",children:e.jsxs(We,{value:c.environmentName,onChange:S=>u({...c,environmentName:S.target.value}),sx:{height:36},children:[e.jsx(re,{value:"Development",children:"Development"}),e.jsx(re,{value:"Production",children:"Production"}),e.jsx(re,{value:"Quality",children:"Quality"})]})}),e.jsx(nt,{control:e.jsx(rs,{checked:c.autoConnect,onChange:S=>u({...c,autoConnect:S.target.checked}),size:"small"}),label:"Auto Connect",sx:{whiteSpace:"nowrap","& .MuiFormControlLabel-label":{fontSize:"0.85rem"}}})]})]}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",mb:1.5},children:e.jsxs(Mt,{value:l,onChange:(S,T)=>d(T),sx:{minHeight:36,"& .MuiTab-root":{minHeight:36,textTransform:"none",fontSize:"0.85rem",fontWeight:500,py:.5}},children:[e.jsx(He,{label:"Source"}),e.jsx(He,{label:"Target"})]})}),e.jsxs(n,{children:[e.jsx(Ae,{fullWidth:!0,size:"small",sx:{mb:1.5},children:e.jsxs(We,{value:m?c.sourceSystem:c.targetSystem,displayEmpty:!0,onChange:S=>u({...c,[m?"sourceSystem":"targetSystem"]:S.target.value}),startAdornment:e.jsx(vt,{position:"start",children:e.jsx(xa,{sx:{fontSize:17,color:"action.active"}})}),sx:{height:36},children:[e.jsx(re,{value:"",disabled:!0,children:"Select a System"}),e.jsx(re,{value:"salesforce",children:"Salesforce"}),e.jsx(re,{value:"dynamics",children:"Dynamics 365"}),e.jsx(re,{value:"sap",children:"SAP"}),e.jsx(re,{value:"oracle",children:"Oracle"})]})}),e.jsx(r,{variant:"body2",sx:{mb:.5,fontWeight:500,fontSize:"0.8rem"},children:"Username"}),e.jsx(ye,{fullWidth:!0,size:"small",placeholder:"Enter username",value:m?c.sourceUsername:c.targetUsername,onChange:S=>u({...c,[m?"sourceUsername":"targetUsername"]:S.target.value}),sx:{mb:1.5,"& .MuiInputBase-root":{height:36}},InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(so,{sx:{fontSize:17,color:"action.active"}})})}}),e.jsx(r,{variant:"body2",sx:{mb:.5,fontWeight:500,fontSize:"0.8rem"},children:"Password"}),e.jsx(ye,{fullWidth:!0,size:"small",type:"password",placeholder:"Enter password",value:m?c.sourcePassword:c.targetPassword,onChange:S=>u({...c,[m?"sourcePassword":"targetPassword"]:S.target.value}),sx:{mb:1.5,"& .MuiInputBase-root":{height:36}},InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(ao,{sx:{fontSize:17,color:"action.active"}})})}}),e.jsx(r,{variant:"body2",sx:{mb:.5,fontWeight:500,fontSize:"0.8rem"},children:"Security Token"}),e.jsx(ye,{fullWidth:!0,size:"small",placeholder:"Enter token",value:m?c.sourceSecurityToken:c.targetSecurityToken,onChange:S=>u({...c,[m?"sourceSecurityToken":"targetSecurityToken"]:S.target.value}),sx:{mb:1.5,"& .MuiInputBase-root":{height:36}},InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Wn,{sx:{fontSize:17,color:"action.active"}})})}}),e.jsx(r,{variant:"body2",sx:{mb:.5,fontWeight:500,fontSize:"0.8rem"},children:"Login URL"}),e.jsx(ye,{fullWidth:!0,size:"small",placeholder:"Enter login URL",value:m?c.sourceLoginUrl:c.targetLoginUrl,onChange:S=>u({...c,[m?"sourceLoginUrl":"targetLoginUrl"]:S.target.value}),sx:{mb:1.5,"& .MuiInputBase-root":{height:36}},InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(ro,{sx:{fontSize:17,color:"action.active"}})})}}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mb:1.5},children:e.jsxs(H,{variant:"contained",onClick:y,size:"small",sx:{bgcolor:"#616161","&:hover":{bgcolor:"#757575"},textTransform:"none",fontSize:"0.85rem",height:34,px:2},children:["Test ",m?"Source":"Target"]})}),e.jsx(r,{variant:"caption",sx:{color:"text.secondary",display:"block",fontSize:"0.75rem"},children:"Your credentials are encrypted and securely stored."})]})]})}),e.jsxs(n,{sx:{p:2,borderTop:"1px solid #e0e0e0",display:"flex",justifyContent:"space-between",flexShrink:0,bgcolor:"background.paper"},children:[e.jsx(H,{variant:"contained",color:"error",onClick:h,sx:{textTransform:"none",fontSize:"0.85rem",height:36},children:"Delete"}),e.jsx(H,{variant:"contained",onClick:p,sx:{textTransform:"none",fontSize:"0.85rem",height:36},children:"Save Configuration"})]})]})]})})},an=()=>{const t=xt(),[s]=Vc(),[a]=Jc();return{...ke(c=>c.auth),login:async c=>{try{t(Es()),t(ls(!0));const u=await s(c).unwrap();return t(si(u)),u}catch(u){const f=u?.data?.message||"Login failed. Please try again.";throw t(Vs(f)),u}finally{t(ls(!1))}},logout:async()=>{console.log("üö™ LOGOUT: Starting logout process...");try{console.log("üö™ LOGOUT: Calling logout API...");const c=await a();console.log("üö™ LOGOUT: API call completed, result:",c)}catch(c){console.error("üö™ LOGOUT: Logout API failed:",{error:c,message:c?.message,status:c?.status,data:c?.data,stack:c?.stack})}finally{console.log("üö™ LOGOUT: Dispatching logout action..."),t(Ot()),console.log("üö™ LOGOUT: Logout process completed")}}}},Xd=()=>{const t=xt(),s=Ct(),{logout:a}=an(),{currentView:i,currentApp:l,isSettingsMenuOpen:d,selectedProject:c,activeMenu:u}=ke(g=>g.app),[f,y]=o.useState(!1),h=()=>{i==="application"?(t(oi()),setTimeout(()=>{s("/account")},0)):(t(tr()),setTimeout(()=>{c?.project_type==="backup"?s("/backup/dashboard"):c?.project_type==="translation"?s("/translation/dashboard"):s("/dashboard")},0))},p=()=>{t(tr()),c?.project_type==="backup"?s("/backup/dashboard"):c?.project_type==="translation"?s("/translation/dashboard"):s("/dashboard")},m=async()=>{console.log("Starting logout process...");try{console.log("Calling logout API...");const $=await a();console.log("Logout API successful:",$)}catch($){console.error("Logout API failed:",{error:$,message:$?.message,status:$?.status,data:$?.data,stack:$?.stack}),$?.data&&console.error("API Error Response:",$.data),$?.status&&console.error("HTTP Status:",$.status),console.log("Continuing with logout despite API failure...")}console.log("Clearing localStorage...");const g=Object.keys(localStorage);console.log("localStorage keys before clear:",g),localStorage.clear();const P=Object.keys(localStorage);console.log("localStorage keys after clear:",P),console.log("üö™ LOGOUT: Waiting 3 seconds before navigation..."),setTimeout(()=>{console.log("üö™ LOGOUT: Now navigating to login page..."),s("/login")},3e3)},S=()=>{if(i==="settings")return"Settings";switch(l){case"backup":return"Backup App";case"translation":return"Translation App";case"migration":default:return"Data Migration App"}},T=()=>{if(i==="settings")switch(u){case"account":return"Account";case"user":return"User Management";case"project":return"Project Management";default:return"Settings"}switch(u){case"dashboard":return"Dashboard";case"entities":return"Entities";case"management":return"Management";case"backup dashboard":return"Backup Dashboard";case"backup jobs":return"Backup Jobs";case"restore":return"Restore";case"backup history":return"Backup History";case"translation dashboard":return"Translation Dashboard";case"language packs":return"Language Packs";case"translation memory":return"Translation Memory";case"progress tracking":return"Progress Tracking";case"translations":return"Translations";default:return S()}};return e.jsxs(ar,{position:"fixed",sx:{zIndex:g=>g.zIndex.drawer+1},children:[e.jsxs(ns,{children:[i==="settings"?e.jsx(ne,{color:"inherit","aria-label":"back to application",edge:"start",onClick:p,sx:{mr:2},children:e.jsx(no,{})}):e.jsx(ne,{color:"inherit","aria-label":"toggle sidebar",edge:"start",onClick:()=>t($l()),sx:{mr:2},children:e.jsx(io,{})}),e.jsxs(r,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:[S()," ",i==="settings"?` - ${T()}`:` - ${T()}`]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(yi,{}),e.jsx(bi,{}),e.jsx(ne,{color:"inherit","aria-label":"connector",onClick:()=>y(!0),sx:{"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},title:"Connector",children:e.jsx(zr,{})}),e.jsx(ne,{color:"inherit","aria-label":"settings",onClick:h,sx:{backgroundColor:i==="settings"?"rgba(255, 255, 255, 0.2)":"transparent","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(Or,{color:"secondary",variant:i==="settings"?"dot":"standard",children:e.jsx(rr,{})})}),e.jsx(ne,{color:"inherit","aria-label":"logout",onClick:m,sx:{"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},title:"Logout",children:e.jsx(oo,{})})]})]}),e.jsx(Kd,{open:f,onClose:()=>y(!1)})]})},eu=[{text:"Dashboard",icon:e.jsx(zn,{}),path:"/dashboard"},{text:"Entities",icon:e.jsx(co,{}),path:"/entities"},{text:"Management",icon:e.jsx(rr,{}),path:"/management"}],tu=()=>{const t=xt(),s=Ct(),a=us(),{isSidebarOpen:i,activeMenu:l,selectedProject:d,selectedSystem:c,selectedEnvironment:u}=ke(b=>b.app),{selectedObject:f}=ke(b=>b.migration),[y,h]=o.useState({}),[p,m]=o.useState(!1),[S,T]=o.useState(!1),{data:g=[],isLoading:P,error:$}=ks(d?.id||"",{skip:!d?.id}),{data:V=[],isLoading:v,error:q}=oa(d?.id||"",{skip:!d?.id}),w=g.filter(b=>b.type==="source");o.useEffect(()=>{const b=localStorage.getItem("sidebar_session");if(b)try{const F=JSON.parse(b);F.expandedSystems&&h(F.expandedSystems)}catch(F){console.error("Failed to load sidebar session:",F)}T(!0)},[]),o.useEffect(()=>{if(S&&d&&w.length>0){const F=a.pathname.match(/\/migration\/([^\/]+)/);if(F){const G=F[1],E=localStorage.getItem("migration_objects");if(E)try{const D=JSON.parse(E).find(C=>C.object_id===G);if(D){const C=w.find(oe=>oe.id===D.system_id);C&&!y[C.id]&&(h(oe=>({...oe,[C.id]:!0})),t(fn(C)))}}catch(_){console.error("Error processing stored objects:",_)}}}},[a.pathname,d,w,S,t]),o.useEffect(()=>{if(S){const b={expandedSystems:y,timestamp:Date.now()};localStorage.setItem("sidebar_session",JSON.stringify(b))}},[y,S]);const O=(b,F)=>{t(zt(b)),s(F)},N=o.useCallback(b=>{h(F=>({...F,[b]:!F[b]}))},[]),R=b=>{t(fn(b))},W=b=>a.pathname===b;return o.useEffect(()=>{d||h({})},[d]),o.useEffect(()=>{u&&V.length>0&&!V.some(b=>b.id===u.id)&&t(er(null))},[V,u,t]),e.jsxs(Et,{variant:"permanent",sx:{width:i?280:60,flexShrink:0,"& .MuiDrawer-paper":{width:i?280:60,boxSizing:"border-box",position:"relative",height:"calc(100vh - 64px)",top:"auto",left:"auto",transition:b=>b.transitions.create("width",{easing:b.transitions.easing.sharp,duration:b.transitions.duration.enteringScreen})}},children:[e.jsx(ns,{}),e.jsxs(n,{sx:{overflow:"auto",height:"100%"},children:[e.jsx(fs,{children:eu.map(b=>e.jsx($t,{disablePadding:!0,children:i?e.jsxs(qt,{selected:W(b.path),onClick:()=>O(b.text.toLowerCase(),b.path),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText","&:hover":{backgroundColor:"primary.main"}}},children:[e.jsx(Yt,{sx:{color:W(b.path)?"primary.contrastText":"inherit"},children:b.icon}),e.jsx(Wt,{primary:b.text,primaryTypographyProps:{fontWeight:W(b.path)?"bold":"normal"}})]}):e.jsx(je,{title:b.text,children:e.jsx(qt,{selected:W(b.path),onClick:()=>O(b.text.toLowerCase(),b.path),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText","&:hover":{backgroundColor:"primary.main"}}},children:e.jsx(Yt,{sx:{color:W(b.path)?"primary.contrastText":"inherit"},children:b.icon})})})},b.text))}),d&&w.length>0&&e.jsx(fs,{sx:{mt:2},children:w.map(b=>e.jsx(vi,{system:b,isOpen:!!y[b.id],onToggle:()=>N(b.id),onSystemSelect:R,isSelected:c?.id===b.id,selectedObjectId:f?.object_id,isSidebarOpen:i},b.id))}),d&&!P&&w.length===0&&e.jsx(fs,{sx:{mt:2}})]})]})},vi=Ke.memo(({system:t,isOpen:s,onToggle:a,onSystemSelect:i,isSelected:l,selectedObjectId:d,isSidebarOpen:c})=>{const u=xt(),f=Ct(),y=us(),{data:h=[],isLoading:p,error:m,isFetching:S}=Is(t.id,{skip:!t.id||!s}),T=()=>{i(t),a()},g=o.useCallback(v=>{const q={object_id:v.object_id,object_name:v.name,system_id:v.system,system_name:v.system_name,project_id:v.project,records_count:v.records_count,field_count:v.field_count,operation:v.operation,description:v.description||"",is_completed:v.is_completed};u(di(q));try{const R=localStorage.getItem("migration_objects");let W=R?JSON.parse(R):[];W=W.filter(b=>b.object_id!==v.object_id),W.push(q),localStorage.setItem("migration_objects",JSON.stringify(W))}catch(R){console.error("Failed to store object in localStorage:",R)}const O=y.pathname.match(/\/migration\/[^\/]+\/([^\/]+)/),N=O?O[1]:"summary";f(`/migration/${v.object_id}/${N}`)},[u,f,y.pathname]),P=h.filter(v=>v.is_completed).length,$=h.length,V=h.some(v=>d===v.object_id||y.pathname.includes(`/migration/${v.object_id}`));return e.jsxs(e.Fragment,{children:[e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{onClick:T,selected:l||V,sx:{"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[e.jsx(Yt,{sx:{minWidth:36,ml:1},children:e.jsx(Or,{badgeContent:$,color:"primary",overlap:"circular",sx:{"& .MuiBadge-badge":{fontSize:"0.6rem",height:16,minWidth:16}},children:e.jsx(lo,{fontSize:"small"})})}),c&&e.jsx(Wt,{primary:t.name,secondary:`${P}/${$} completed`,primaryTypographyProps:{fontSize:"0.85rem",fontWeight:l||V?"bold":"medium"},secondaryTypographyProps:{fontSize:"0.75rem"}}),c&&e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:p||S?e.jsx(ie,{size:16}):e.jsx(e.Fragment,{children:s?e.jsx(nr,{}):e.jsx(Xt,{})})})]})}),e.jsx(as,{in:s,timeout:"auto",unmountOnExit:!0,children:e.jsx(fs,{component:"div",disablePadding:!0,children:p||S?e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{sx:{pl:c?6:1},disabled:!0,children:[e.jsx(ie,{size:16,sx:{mr:2}}),c&&e.jsx(Wt,{primary:"Loading objects...",primaryTypographyProps:{fontSize:"0.8rem",color:"text.secondary"}})]})}):m?e.jsx($t,{disablePadding:!0,children:e.jsx(qt,{sx:{pl:c?6:1},disabled:!0,children:c&&e.jsx(Wt,{primary:"Failed to load objects",primaryTypographyProps:{fontSize:"0.8rem",color:"error.main"}})})}):h.length===0?e.jsx($t,{disablePadding:!0,children:e.jsx(qt,{sx:{pl:c?6:1},disabled:!0,children:c&&e.jsx(Wt,{primary:"No objects found",primaryTypographyProps:{fontSize:"0.8rem",color:"text.secondary"}})})}):h.map(v=>{const q=d===v.object_id||y.pathname.includes(`/migration/${v.object_id}`),w=e.jsxs(qt,{onClick:()=>g(v),selected:q,sx:{pl:c?6:1,"&:hover":{backgroundColor:"action.hover"},"&.Mui-selected":{backgroundColor:"action.selected","&:hover":{backgroundColor:"action.hover"}}},children:[e.jsx(Yt,{sx:{minWidth:32},children:c?e.jsx(Ps,{fontSize:"small",color:q?"primary":v.is_completed?"success":"action"}):e.jsx(cs,{sx:{width:24,height:24,bgcolor:q?"primary.main":v.is_completed?"success.main":"grey.400",fontSize:"0.8rem",fontWeight:"bold"},children:v.name.charAt(0).toUpperCase()})}),c&&e.jsx(Wt,{primary:v.name,secondary:e.jsxs(n,{component:"span",sx:{display:"block"},children:[e.jsxs(r,{component:"span",variant:"caption",display:"block",sx:{fontSize:"0.7rem"},children:["Records: ",v.records_count," | Fields: ",v.field_count]}),e.jsxs(r,{component:"span",variant:"caption",display:"block",sx:{fontSize:"0.7rem"},children:["Operation: ",v.operation]})]}),primaryTypographyProps:{fontSize:"0.8rem",fontWeight:q?"bold":"medium"}}),c&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e.jsx(X,{label:v.operation,size:"small",color:v.operation==="insert"?"success":"primary",variant:"outlined",sx:{fontSize:"0.55rem",height:18}}),v.is_completed&&e.jsx(X,{label:"Completed",size:"small",color:"success",variant:"filled",sx:{fontSize:"0.55rem",height:18}}),q&&e.jsx(X,{label:"Active",size:"small",color:"primary",variant:"filled",sx:{fontSize:"0.55rem",height:18}})]})]});return e.jsx($t,{disablePadding:!0,children:c?w:e.jsx(je,{title:v.name,placement:"right",children:w})},v.object_id)})})})]})});vi.displayName="SourceSystemItem";const su=()=>{const t=xt(),s=Ct(),a=us(),i=()=>{t(zt("account")),s("/account")},l=()=>{t(zt("user")),s("/users")},d=()=>{t(zt("project")),s("/projects")},c=()=>{t(zt("security-policies")),s("/security-policies")},u=f=>a.pathname===f;return e.jsxs(Et,{variant:"permanent",sx:{width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",backgroundColor:"background.paper",borderRight:"1px solid",borderColor:"divider"}},children:[e.jsx(ns,{}),e.jsxs(n,{sx:{p:2,pb:1},children:[e.jsx(r,{variant:"h6",color:"primary",fontWeight:"bold",children:"Settings"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage your account and preferences"})]}),e.jsx(it,{}),e.jsx(n,{sx:{overflow:"auto",height:"100%"},children:e.jsxs(fs,{children:[e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{onClick:i,selected:u("/account"),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[e.jsx(Yt,{children:e.jsx(uo,{})}),e.jsx(Wt,{primary:"Account",primaryTypographyProps:{fontSize:"0.95rem",fontWeight:"medium"}})]})}),e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{onClick:l,selected:u("/users"),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[e.jsx(Yt,{children:e.jsx(Mr,{})}),e.jsx(Wt,{primary:"User Management",primaryTypographyProps:{fontSize:"0.95rem",fontWeight:"medium"}})]})}),e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{onClick:d,selected:u("/projects"),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[e.jsx(Yt,{children:e.jsx(Fn,{})}),e.jsx(Wt,{primary:"Project Management",primaryTypographyProps:{fontSize:"0.95rem",fontWeight:"medium"}})]})}),e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{onClick:c,selected:u("/security-policies"),sx:{"&.Mui-selected":{backgroundColor:"primary.light",color:"primary.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"primary.main"},"& .MuiListItemIcon-root":{color:"primary.contrastText"}}},children:[e.jsx(Yt,{children:e.jsx(ho,{})}),e.jsx(Wt,{primary:"Security Policies",primaryTypographyProps:{fontSize:"0.95rem",fontWeight:"medium"}})]})})]})})]})},au=[{text:"Backup",icon:e.jsx(sr,{}),path:"/backup/dashboard",menuKey:"backup"}],ru=()=>{const t=xt(),s=Ct(),a=us(),{selectedProject:i}=ke(c=>c.app),l=(c,u)=>{t(zt(c)),s(u)},d=c=>a.pathname===c||a.pathname.startsWith(c+"/");return e.jsxs(Et,{variant:"permanent",sx:{width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",backgroundColor:"background.paper",borderRight:"1px solid",borderColor:"divider"}},children:[e.jsx(ns,{}),e.jsxs(n,{sx:{overflow:"auto",height:"100%"},children:[i&&e.jsxs(n,{sx:{p:2,backgroundColor:"info.light",color:"info.contrastText"},children:[e.jsx(r,{variant:"subtitle2",fontWeight:"bold",children:"BACKUP PROJECT"}),e.jsx(r,{variant:"body1",fontWeight:"bold",gutterBottom:!0,children:i.name}),e.jsx(r,{variant:"caption",display:"block",children:i.description})]}),e.jsx(it,{}),e.jsx(fs,{children:au.map(c=>e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{selected:d(c.path),onClick:()=>l(c.menuKey,c.path),sx:{"&.Mui-selected":{backgroundColor:"info.light",color:"info.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"info.main"},"& .MuiListItemIcon-root":{color:"info.contrastText"}}},children:[e.jsx(Yt,{children:c.icon}),e.jsx(Wt,{primary:c.text,primaryTypographyProps:{fontWeight:d(c.path)?"bold":"normal"}})]})},c.text))})]})]})},nu=[{text:"Translation Dashboard",icon:e.jsx(Fs,{}),path:"/translation/dashboard",menuKey:"translation dashboard"},{text:"Language Packs",icon:e.jsx(xo,{}),path:"/translation/languages",menuKey:"language packs"},{text:"Translation Memory",icon:e.jsx(po,{}),path:"/translation/memory",menuKey:"translation memory"},{text:"Progress Tracking",icon:e.jsx(ir,{}),path:"/translation/progress",menuKey:"progress tracking"},{text:"Translations",icon:e.jsx(Fs,{}),path:"/translation/translations",menuKey:"translations"}],iu=()=>{const t=xt(),s=Ct(),a=us(),{selectedProject:i}=ke(c=>c.app),l=(c,u)=>{t(zt(c)),s(u)},d=c=>a.pathname===c||a.pathname.startsWith(c+"/");return e.jsxs(Et,{variant:"permanent",sx:{width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",backgroundColor:"background.paper",borderRight:"1px solid",borderColor:"divider"}},children:[e.jsx(ns,{}),e.jsxs(n,{sx:{overflow:"auto",height:"100%"},children:[i&&e.jsxs(n,{sx:{p:2,backgroundColor:"warning.light",color:"warning.contrastText"},children:[e.jsx(r,{variant:"subtitle2",fontWeight:"bold",children:"TRANSLATION PROJECT"}),e.jsx(r,{variant:"body1",fontWeight:"bold",gutterBottom:!0,children:i.name}),e.jsx(r,{variant:"caption",display:"block",children:i.description})]}),e.jsx(it,{}),e.jsx(fs,{children:nu.map(c=>e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{selected:d(c.path),onClick:()=>l(c.menuKey,c.path),sx:{"&.Mui-selected":{backgroundColor:"warning.light",color:"warning.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"warning.main"},"& .MuiListItemIcon-root":{color:"warning.contrastText"}}},children:[e.jsx(Yt,{children:c.icon}),e.jsx(Wt,{primary:c.text,primaryTypographyProps:{fontWeight:d(c.path)?"bold":"normal"}})]})},c.text))})]})]})},ou=[{text:"File Upload",icon:e.jsx(mo,{}),path:"/file-migration/upload",menuKey:"file upload"},{text:"File Analysis",icon:e.jsx(On,{}),path:"/file-migration/analysis",menuKey:"file analysis"},{text:"File Transform",icon:e.jsx(Lr,{}),path:"/file-migration/transform",menuKey:"file transform"},{text:"File Storage",icon:e.jsx(Ps,{}),path:"/file-migration/storage",menuKey:"file storage"}],lu=()=>{const t=xt(),s=Ct(),a=us(),{selectedProject:i}=ke(c=>c.app),l=(c,u)=>{t(zt(c)),s(u)},d=c=>a.pathname===c||a.pathname.startsWith(c+"/");return e.jsxs(Et,{variant:"permanent",sx:{width:280,flexShrink:0,"& .MuiDrawer-paper":{width:280,boxSizing:"border-box",backgroundColor:"background.paper",borderRight:"1px solid",borderColor:"divider"}},children:[e.jsx(ns,{}),e.jsxs(n,{sx:{overflow:"auto",height:"100%"},children:[i&&e.jsxs(n,{sx:{p:2,backgroundColor:"secondary.light",color:"secondary.contrastText"},children:[e.jsx(r,{variant:"subtitle2",fontWeight:"bold",children:"FILE MIGRATION PROJECT"}),e.jsx(r,{variant:"body1",fontWeight:"bold",gutterBottom:!0,children:i.name}),e.jsx(r,{variant:"caption",display:"block",children:i.description})]}),e.jsx(it,{}),e.jsx(fs,{children:ou.map(c=>e.jsx($t,{disablePadding:!0,children:e.jsxs(qt,{selected:d(c.path),onClick:()=>l(c.menuKey,c.path),sx:{"&.Mui-selected":{backgroundColor:"secondary.light",color:"secondary.contrastText",borderRadius:"6px",padding:"8px 16px",margin:"8px 12px","&:hover":{backgroundColor:"secondary.main"},"& .MuiListItemIcon-root":{color:"secondary.contrastText"}}},children:[e.jsx(Yt,{children:c.icon}),e.jsx(Wt,{primary:c.text,primaryTypographyProps:{fontWeight:d(c.path)?"bold":"normal"}})]})},c.text))})]})]})},_i=({open:t,countdown:s,onStayActive:a,onLogout:i})=>(Ke.useEffect(()=>{console.log(`üìä IdleTimeoutDialog - open prop changed: ${t}, countdown: ${s}`),t?(console.group("‚ö†Ô∏è Idle Timeout Dialog Opened"),console.log(`‚è∞ Dialog opened at: ${new Date().toLocaleString()}`),console.log(`‚è≥ Countdown: ${s} seconds`),console.log("üìã Dialog will auto-logout user if no action taken"),console.log("‚úÖ Dialog should be visible on screen now"),console.groupEnd()):console.log("‚ùå Idle Timeout Dialog Closed")},[t,s]),Ke.useEffect(()=>{t&&(s%10===0||s<=5)&&console.log(`‚è≥ Idle Dialog Countdown: ${s} seconds remaining`)},[t,s]),e.jsxs(wt,{open:t,onClose:a,disableEscapeKeyDown:!0,maxWidth:"sm",fullWidth:!0,children:[e.jsx(It,{children:"‚ö†Ô∏è Session Timeout Warning"}),e.jsxs(Pt,{children:[e.jsxs(Ir,{children:["You have been idle for 14 minutes. You will be automatically logged out in"," ",e.jsx(r,{component:"span",fontWeight:"bold",color:"error",fontSize:"1.2rem",children:s})," ","seconds."]}),e.jsx(Ir,{sx:{mt:2,fontSize:"0.875rem",color:"text.secondary"},children:'Click "Stay Active" to continue your session or "Logout Now" to end it immediately.'})]}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:()=>{console.log('üö™ User clicked "Logout Now" button'),i()},color:"error",children:"Logout Now"}),e.jsx(H,{onClick:()=>{console.log('‚úÖ User clicked "Stay Active" button'),a()},variant:"contained",autoFocus:!0,children:"Stay Active"})]})]})),Si=()=>{const{accessToken:t,logout:s,isAuthenticated:a}=an(),i=xt(),[l]=Qc(),[d,c]=o.useState(!1),[u,f]=o.useState(0),y=o.useRef(void 0),h=o.useRef(void 0),p=o.useRef(0),m=o.useRef(navigator.onLine),S=o.useRef(!1),T=o.useRef(0),g=o.useRef(0),P=o.useCallback(W=>{try{return JSON.parse(atob(W.split(".")[1])).exp*1e3}catch{return Date.now()+1800*1e3}},[]),$=o.useCallback(W=>{const b=Date.now(),F=W-b;if(F<=0)return"EXPIRED";const G=Math.floor(F/6e4),E=Math.floor(F%6e4/1e3);return G>0?`${G}m ${E}s`:`${E}s`},[]),V=o.useCallback((W,b)=>{if(!W){console.log(`üîë ${b} Token: NOT AVAILABLE`);return}try{const F=JSON.parse(atob(W.split(".")[1])),G=F.exp*1e3,E=Date.now(),_=G-E,D=new Date(G),C=_<=0;if(console.group(`üîë ${b} Token Information`),console.log(`üìÖ Expiry Date: ${D.toLocaleString()}`),console.log(`‚è∞ Expiry Timestamp: ${G}`),console.log(`‚è≥ Remaining Time: ${$(G)}`),console.log(`‚úÖ Status: ${C?"‚ùå EXPIRED":"‚úÖ VALID"}`),F.iat){const oe=new Date(F.iat*1e3);console.log(`üìÜ Issued Date: ${oe.toLocaleString()}`)}console.groupEnd()}catch(F){console.error(`‚ùå Error parsing ${b} token:`,F)}},[$]),v=o.useCallback(async()=>{if(localStorage.getItem("tokenRefreshInProgress")==="true"){console.log("‚è≥ Token refresh already in progress (from another source) - skipping");return}if(S.current){console.log("‚è≥ Token refresh already in progress (in useIdleTimer) - skipping");return}const F=Date.now()-T.current,G=120*1e3;if(T.current>0&&F<G){const _=Math.ceil((G-F)/1e3);console.log(`‚è∏Ô∏è Token refresh cooldown active - ${_}s remaining. Skipping refresh.`);return}const E=Date.now();console.group("üîÑ Token Refresh Process Started (Proactive)"),console.log(`‚è∞ Start Time: ${new Date(E).toLocaleString()}`),S.current=!0,localStorage.setItem("tokenRefreshInProgress","true");try{const _=localStorage.getItem("refreshToken");if(!_){console.error("‚ùå No refresh token available"),console.groupEnd(),S.current=!1,localStorage.removeItem("tokenRefreshInProgress"),await s(),window.location.href="/login";return}V(_,"Refresh"),console.log("üîÑ Calling refresh token API...");const D=await l({refresh_token:_}).unwrap(),C=Date.now(),oe=C-E;i(zs({accessToken:D.access_token,refreshToken:D.refresh_token||_})),T.current=Date.now(),console.log(`‚úÖ Token refreshed successfully in ${oe}ms`),console.log(`‚è∞ End Time: ${new Date(C).toLocaleString()}`),console.log("‚è∏Ô∏è Cooldown period started (2 minutes) - will not refresh again during this time"),console.log("üìã New Tokens:"),V(D.access_token,"Access"),D.refresh_token&&V(D.refresh_token,"Refresh"),console.groupEnd(),S.current=!1,localStorage.removeItem("tokenRefreshInProgress")}catch(_){const C=Date.now()-E;console.error(`‚ùå Token refresh failed after ${C}ms:`,_);const oe=_;console.error("Error Details:",{status:oe?.status,message:oe?.data?.message||oe?.message,data:oe?.data}),S.current=!1,localStorage.removeItem("tokenRefreshInProgress"),oe?.status===401||(oe?.data?.message?.toLowerCase().includes("token")??!1)||(oe?.data?.message?.toLowerCase().includes("unauthorized")??!1)?(console.error("üö™ Invalid or expired refresh token - logging out"),console.groupEnd(),await s(),window.location.href="/login"):(console.warn("‚ö†Ô∏è Token refresh failed but not logging out (might be temporary network issue)"),console.groupEnd())}},[l,i,s,V]);o.useEffect(()=>{if(!a||!t){console.log("‚è∏Ô∏è Token refresh check paused - not authenticated or no access token");return}console.group("üîê Authentication Status"),V(t,"Access");const W=localStorage.getItem("refreshToken");W&&V(W,"Refresh"),console.groupEnd();const b=()=>{try{if(S.current||localStorage.getItem("tokenRefreshInProgress")==="true"){console.log("‚è∏Ô∏è Token refresh in progress - skipping check");return}const F=P(t),G=Date.now(),E=F-G,_=300*1e3;if(console.log(`‚è±Ô∏è Token Check - Remaining: ${$(F)}`),E<=_)console.log(`üîÑ Token expires soon (${$(F)} remaining) - Refreshing at 25 min mark...`),v();else{const D=Math.floor((E-_)/6e4);console.log(`‚úÖ Token valid - Will refresh in ~${D} minutes (at 25 min mark)`)}}catch(F){console.error("‚ùå Token check failed:",F)}};return b(),console.log("‚è∞ Setting up token refresh check interval (every 60 seconds)"),y.current=window.setInterval(b,60*1e3),()=>{y.current&&(console.log("üõë Clearing token refresh check interval"),window.clearInterval(y.current),y.current=void 0)}},[t,a,P,v,$,V]);const q=o.useCallback(async()=>{console.group("üö™ Logout Process Started"),console.log(`‚è∞ Logout Time: ${new Date().toLocaleString()}`),console.log(`üåê Network Status: ${m.current?"ONLINE":"OFFLINE"}`),console.log("üìã Current Token Status:"),V(t||null,"Access");const W=localStorage.getItem("refreshToken");W&&V(W,"Refresh"),c(!1),f(0),h.current&&(console.log("üõë Clearing countdown interval"),window.clearInterval(h.current),h.current=void 0),console.log("üßπ Calling logout to clear localStorage..."),console.log("‚ÑπÔ∏è Logout works offline - clears localStorage and redirects"),await s(),console.log("üîÑ Redirecting to login page..."),console.log("‚ÑπÔ∏è Redirect will work even if network is disconnected"),console.groupEnd(),window.location.href="/login"},[s,t,V]),w=o.useCallback(()=>{console.group("üëÜ Stay Active - User Interaction"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚úÖ User chose to stay active - resetting idle timer"),console.log("üìã Current Token Status:"),V(t||null,"Access"),console.groupEnd(),c(!1),f(0),h.current&&(window.clearInterval(h.current),h.current=void 0),document.dispatchEvent(new MouseEvent("mousemove"))},[t,V]),O=o.useCallback(()=>{if(console.group("‚è±Ô∏è IDLE TIMEOUT CALLBACK TRIGGERED"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log(`üîê isAuthenticated: ${a}`),console.log(`üåê Network Status: ${m.current?"ONLINE":"OFFLINE"}`),!a){console.warn("‚ö†Ô∏è onIdle called but user is not authenticated - ignoring"),console.groupEnd();return}console.log("‚ö†Ô∏è User has been idle for 14 minutes"),console.log("üìã Current Token Status:"),V(t||null,"Access");const W=localStorage.getItem("refreshToken");W&&V(W,"Refresh"),console.log("‚è≥ Starting 60-second countdown before auto-logout..."),console.log("üì¢ Setting showIdleDialog to TRUE"),console.log("‚ÑπÔ∏è Note: Countdown and logout will work even if network is disconnected"),console.groupEnd(),c(!0),f(60),console.log("‚úÖ Idle dialog state updated - showIdleDialog: true, countdown: 60"),h.current=window.setInterval(()=>{f(b=>{if(b<=1)return console.group("‚è∞ Auto-Logout Triggered"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log(`üåê Network Status: ${m.current?"ONLINE":"OFFLINE"}`),console.log("‚ö†Ô∏è User has been idle for 15 minutes (14 min idle + 1 min countdown)"),console.log("üö™ Logging out user automatically..."),console.groupEnd(),h.current&&(window.clearInterval(h.current),h.current=void 0),q(),0;if(b%10===0||b<=5){const F=m.current?"ONLINE":"OFFLINE";console.log(`‚è≥ Idle timeout countdown: ${b} seconds remaining (Network: ${F})`)}return b-1})},1e3)},[a,q,t,V]),N=o.useCallback(()=>{if(d)console.log("üëÜ User activity detected while idle dialog is open"),w();else{const W=Date.now();(!p.current||W-p.current>6e4)&&(console.log(`üëÜ User activity detected - Idle timer reset at ${new Date().toLocaleString()}`),p.current=W)}},[d,w]),R=go({onIdle:O,onActive:N,timeout:840*1e3,throttle:500,events:["mousedown","mousemove","keypress","scroll","touchstart","wheel","click"],startOnMount:!1,stopOnIdle:!1});return o.useEffect(()=>{if(a){console.group("üîÑ Starting Idle Timer"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚úÖ User is authenticated - Starting idle timer"),console.log("‚è±Ô∏è Timeout: 14 minutes (840,000ms)"),console.log("üìã Events monitored:",["mousedown","mousemove","keypress","scroll","touchstart","wheel","click"]);try{const b=localStorage.getItem("lastActivity");b&&(g.current=parseInt(b)),console.log("üîÑ Resetting idle timer..."),R.reset(),console.log("‚ñ∂Ô∏è Starting idle timer..."),R.start(),setTimeout(()=>{const F=R.getRemainingTime(),G=R.getElapsedTime(),E=R.isIdle();console.log("‚úÖ Timer Status:",{isIdle:E,remaining:`${Math.floor(F/1e3)}s (${Math.floor(F/6e4)}m)`,elapsed:`${Math.floor(G/1e3)}s (${Math.floor(G/6e4)}m)`,expectedTimeout:"14 minutes (840 seconds)"}),(F<=0||F>900*1e3)&&(console.warn("‚ö†Ô∏è Timer remaining time seems incorrect:",F),console.warn("‚ö†Ô∏è Attempting to restart timer..."),R.reset(),R.start())},200)}catch(b){console.error("‚ùå Error starting idle timer:",b)}const W=R.getLastActiveTime();if(W){console.log(`üìÖ Last activity: ${new Date(W).toLocaleString()}`);const b=Date.now()-W.getTime(),F=Math.floor(b/6e4);console.log(`‚è≥ Time since last activity: ${F} minutes`)}console.log("üìä Timer State:",{isIdle:R.isIdle(),isRunning:!R.isIdle(),getRemainingTime:`${Math.floor(R.getRemainingTime()/1e3)}s`,getElapsedTime:`${Math.floor(R.getElapsedTime()/1e3)}s`,getTotalIdleTime:`${Math.floor(R.getTotalIdleTime()/1e3)}s`}),console.groupEnd()}else console.group("‚è∏Ô∏è Pausing Idle Timer"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚ùå User not authenticated - Pausing idle timer"),R.pause(),console.log("‚úÖ Timer paused"),console.groupEnd()},[a,R]),o.useEffect(()=>{if(!a)return;const W=G=>{if(G.key==="lastActivity"&&G.newValue){const E=parseInt(G.newValue),_=g.current;E>_&&!R.isIdle()&&(console.log("üîÑ Cross-tab activity detected - resetting idle timer"),g.current=E,R.reset())}},b=G=>{const E=parseInt(G.detail);E>g.current&&!R.isIdle()&&(g.current=E)};window.addEventListener("storage",W),window.addEventListener("activityUpdated",b);const F=localStorage.getItem("lastActivity");return F&&(g.current=parseInt(F)),()=>{window.removeEventListener("storage",W),window.removeEventListener("activityUpdated",b)}},[a,R]),o.useEffect(()=>{if(!a)return;const W=setInterval(()=>{const b=R.getRemainingTime(),F=R.getElapsedTime(),G=Math.floor(b/6e4),E=Math.floor(b%6e4/1e3),_=Math.floor(F/6e4),D=Math.floor(F%6e4/1e3),C=F+b;_%2===0&&_>0&&console.log(`‚è±Ô∏è Idle Timer Status - Elapsed: ${_}m ${D}s, Remaining: ${G}m ${E}s (Total: ${Math.floor(C/6e4)}m ${Math.floor(C%6e4/1e3)}s)`),G<=2&&G>0&&console.log(`‚ö†Ô∏è Approaching idle timeout - ${G}m ${E}s remaining`)},6e4);return()=>clearInterval(W)},[a,R]),o.useEffect(()=>{console.log(`üìä Idle Dialog State Changed - showIdleDialog: ${d}, countdown: ${u}`),d?(console.log("‚úÖ Idle dialog should be visible now"),console.log("üîç Verifying dialog will render...")):console.log("‚ùå Idle dialog is closed")},[d,u]),o.useEffect(()=>{const W=()=>{m.current=!0,console.group("üåê Network Status Changed"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚úÖ Network: ONLINE"),console.log("‚ÑπÔ∏è Idle timer continues to work normally"),console.groupEnd()},b=()=>{m.current=!1,console.group("üåê Network Status Changed"),console.log(`‚è∞ Time: ${new Date().toLocaleString()}`),console.log("‚ö†Ô∏è Network: OFFLINE"),console.log("‚ÑπÔ∏è Idle timer will continue to work offline"),console.log("‚ÑπÔ∏è Auto-logout will still trigger after 15 minutes of idle time"),console.log("‚ÑπÔ∏è Countdown timer works independently of network status"),console.groupEnd()};return m.current=navigator.onLine,console.log(`üåê Initial Network Status: ${m.current?"ONLINE":"OFFLINE"}`),window.addEventListener("online",W),window.addEventListener("offline",b),()=>{window.removeEventListener("online",W),window.removeEventListener("offline",b)}},[]),o.useEffect(()=>(window.testIdleDialog=()=>{console.log("üß™ TEST: Manually triggering idle dialog"),c(!0),f(60)},window.getIdleTimerInfo=()=>({isIdle:R.isIdle(),remaining:R.getRemainingTime(),elapsed:R.getElapsedTime(),lastActive:R.getLastActiveTime(),showIdleDialog:d,countdown:u,isAuthenticated:a,isOnline:m.current}),()=>{delete window.testIdleDialog,delete window.getIdleTimerInfo}),[R,d,u,a]),{showIdleDialog:d,countdown:u,handleStayActive:w,handleLogout:q,lastActivity:R.getLastActiveTime()}},bt=({children:t})=>{const{currentView:s,currentApp:a,isSidebarOpen:i}=ke(y=>y.app),{showIdleDialog:l,countdown:d,handleStayActive:c,handleLogout:u}=Si(),f=()=>{if(s==="settings")return e.jsx(su,{});switch(a){case"backup":return e.jsx(ru,{});case"translation":return e.jsx(iu,{});case"file migration":return e.jsx(lu,{});case"migration":default:return e.jsx(tu,{})}};return e.jsxs(n,{sx:{display:"flex"},children:[e.jsx(Xd,{}),f(),e.jsx(n,{component:"main",sx:{flexGrow:1,p:3,width:"100%",transition:y=>y.transitions.create(["margin"],{easing:y.transitions.easing.sharp,duration:y.transitions.duration.leavingScreen})},children:e.jsx(n,{sx:{mt:8},children:t})}),e.jsx(_i,{open:l,countdown:d,onStayActive:c,onLogout:u})]})},cu=$r({username:Qt().required("Username is required"),password:Qt().required("Password is required"),domain_name:Qt().required("Domain name is required")}),du=()=>{const{login:t,isLoading:s,error:a}=an(),i=Ct(),{register:l,handleSubmit:d,formState:{errors:c,isSubmitted:u,isValid:f},setFocus:y}=qr({resolver:Nr(cu),mode:"onTouched",reValidateMode:"onChange"});o.useEffect(()=>{y("username")},[y]);const h=async p=>{try{await t(p)}catch(m){console.error("Login failed:",m)}};return e.jsx(n,{sx:{minHeight:"100vh",bgcolor:"linear-gradient(to right, #ece9e6, #ffffff, #f6d365, #fda085)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ur,{in:!0,children:e.jsxs(me,{elevation:6,sx:{p:5,borderRadius:4,minWidth:400,maxWidth:420,width:"100%",boxShadow:"0 8px 25px rgba(0,0,0,0.06)",bgcolor:"#fff"},children:[e.jsxs(n,{sx:{textAlign:"center",mb:2},children:[e.jsx(Va,{color:"primary",sx:{fontSize:48,mb:1}}),e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,sx:{fontWeight:700},children:"Welcome Back"}),e.jsx(r,{variant:"subtitle1",sx:{color:"text.secondary",mb:2},children:"Sign in to continue to your account"})]}),a&&e.jsx(ae,{severity:"error",sx:{mb:2},children:typeof a=="string"?a:"Login failed. Please check your credentials."}),e.jsxs("form",{noValidate:!0,onSubmit:d(h),children:[e.jsx(ye,{fullWidth:!0,label:"Username",...l("username"),error:!!c.username,helperText:c.username?.message,margin:"normal",variant:"outlined",autoComplete:"username",InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Mn,{color:"action"})})}}),e.jsx(ye,{fullWidth:!0,label:"Password",type:"password",...l("password"),error:!!c.password,helperText:c.password?.message,margin:"normal",variant:"outlined",autoComplete:"current-password",InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Va,{color:"action"})})}}),e.jsx(ye,{fullWidth:!0,label:"Domain Name",...l("domain_name"),error:!!c.domain_name,helperText:c.domain_name?.message??"e.g., paas, dev, staging, prod",margin:"normal",variant:"outlined",placeholder:"e.g., paas, dev, staging, prod",autoComplete:"organization",InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Br,{color:"action"})})}}),e.jsx(it,{sx:{my:3}}),e.jsx(H,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",size:"large",sx:{py:1.5,fontWeight:600,textTransform:"none",letterSpacing:1},disabled:s,children:s?e.jsx(ie,{size:26,color:"inherit"}):"Login"})]}),e.jsxs(n,{sx:{mt:2,textAlign:"center"},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:1},children:e.jsx(aa,{component:"button",type:"button",onClick:()=>i("/forgot-password"),sx:{fontWeight:600,cursor:"pointer"},children:"Forgot username and password?"})}),e.jsxs(r,{variant:"body2",sx:{color:"text.secondary"},children:["Don't have an account?"," ",e.jsx(aa,{component:"button",type:"button",onClick:()=>i("/register"),sx:{fontWeight:600,cursor:"pointer"},children:"Sign up"})]})]}),e.jsxs(r,{variant:"caption",sx:{display:"block",mt:3,textAlign:"center",color:"text.secondary"},children:["¬© ",new Date().getFullYear()," Your Company. All rights reserved."]})]})})})},uu=()=>{const t=Ct(),{isAuthenticated:s}=ke(a=>a.auth);return o.useEffect(()=>{s&&t("/dashboard")},[s,t]),e.jsx(du,{})},hu=$r({username:Qt().required("Username is required"),email:Qt().required("Email is required").email(),first_name:Qt().optional(),last_name:Qt().optional(),password:Qt().required().min(6),confirmPassword:Qt().required().oneOf([fo("password")],"Passwords must match"),domain_name:Qt().required("Domain name is required")}),xu=()=>{const t=Ct(),s=xt(),[a,{isLoading:i}]=Hc(),{error:l}=ke(h=>h.auth),{register:d,handleSubmit:c,formState:{errors:u},setFocus:f}=qr({resolver:Nr(hu)});o.useEffect(()=>{f("username"),s(Es())},[f,s]);const y=async h=>{try{s(ls(!0));const{confirmPassword:p,...m}=h,S=await a(m).unwrap();s(si(S)),t("/dashboard")}catch(p){s(Vs(p?.data?.message||"Registration failed"))}finally{s(ls(!1))}};return e.jsx(n,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,md:"60px"},background:"#f8fafc"},children:e.jsx(Ur,{in:!0,children:e.jsxs(n,{sx:{width:"100%",height:"100%",display:"flex",borderRadius:4,overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",flexDirection:{xs:"column",md:"row"}},children:[e.jsx(n,{sx:{flex:1.7,background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",display:"flex",alignItems:"flex-start",justifyContent:"center",p:{xs:3,md:5}},children:e.jsxs(n,{sx:{textAlign:"center",width:"100%",mt:0},children:[e.jsx("img",{src:"/images/doneeregister.png",alt:"Register",style:{maxWidth:"55%",height:"auto",display:"block",margin:"0 auto 0px"}}),e.jsx(r,{variant:"h6",sx:{color:"white",fontWeight:600,mt:0},children:"Ready to take control?"}),e.jsx(r,{variant:"body2",sx:{color:"white",maxWidth:380,mx:"auto",mt:.2},children:"Secure, fast and reliable Salesforce migration platform."}),e.jsxs(n,{sx:{mt:.8,display:"flex",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx(X,{icon:e.jsx(jo,{}),label:"Synced",sx:{m:.4}}),e.jsx(X,{icon:e.jsx(Wn,{}),label:"Secure",sx:{m:.4}}),e.jsx(X,{icon:e.jsx(yo,{}),label:"Fast",sx:{m:.4}})]})]})}),e.jsxs(n,{sx:{flex:1,background:"white",p:{xs:3,md:5},display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs(n,{sx:{textAlign:"center",mb:2},children:[e.jsx(Ln,{color:"primary",sx:{fontSize:40}}),e.jsx(r,{variant:"h5",fontWeight:700,children:"Create Account"})]}),l&&e.jsx(ae,{severity:"error",children:l}),e.jsxs("form",{onSubmit:c(y),children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(ye,{fullWidth:!0,label:"First Name",...d("first_name"),error:!!u.first_name,helperText:u.first_name?.message})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(ye,{fullWidth:!0,label:"Last Name",...d("last_name"),error:!!u.last_name,helperText:u.last_name?.message})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Username",...d("username"),error:!!u.username,helperText:u.username?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Mn,{})})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Email",...d("email"),error:!!u.email,helperText:u.email?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx($n,{})})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,type:"password",label:"Password",...d("password"),error:!!u.password,helperText:u.password?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Va,{})})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,type:"password",label:"Confirm Password",...d("confirmPassword"),error:!!u.confirmPassword,helperText:u.confirmPassword?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Va,{})})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Domain Name",...d("domain_name"),error:!!u.domain_name,helperText:u.domain_name?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Br,{})})}})})]}),e.jsx(it,{sx:{my:3}}),e.jsx(H,{fullWidth:!0,size:"large",type:"submit",variant:"contained",disabled:i,children:i?e.jsx(ie,{size:22}):"Register"}),e.jsxs(r,{align:"center",sx:{mt:2},children:["Already have an account?"," ",e.jsx(aa,{onClick:()=>t("/login"),sx:{cursor:"pointer"},children:"Sign in"})]}),e.jsx(r,{align:"center",sx:{mt:1},children:e.jsx(aa,{onClick:()=>t("/forgot-password"),sx:{cursor:"pointer"},children:"Forgot username/password?"})})]})]})]})})})},pu=()=>{const t=Ct(),{isAuthenticated:s}=ke(a=>a.auth);return o.useEffect(()=>{s&&t("/dashboard")},[s,t]),e.jsx(xu,{})},mu=$r({email:Qt().required("Email is required").email(),domain_name:Qt().required("Domain name is required")}),gu=()=>{const t=Ct(),s=xt(),[a,{isLoading:i}]=Zc(),{error:l}=ke(h=>h.auth),{register:d,handleSubmit:c,formState:{errors:u},setFocus:f}=qr({resolver:Nr(mu)});o.useEffect(()=>{f("email"),s(Es())},[f,s]);const y=async h=>{try{await a(h).unwrap(),t("/login")}catch{}};return e.jsx(n,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",p:{xs:2,md:"60px"},background:"#f8fafc"},children:e.jsx(Ur,{in:!0,children:e.jsxs(n,{sx:{width:"100%",height:"100%",display:"flex",borderRadius:4,overflow:"hidden",boxShadow:"0 10px 30px rgba(0,0,0,0.12)",flexDirection:{xs:"column",md:"row"}},children:[e.jsx(n,{sx:{flex:1.7,background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",display:"flex",alignItems:"flex-start",justifyContent:"center",p:{xs:3,md:5}},children:e.jsxs(n,{sx:{textAlign:"center",width:"100%",mt:0},children:[e.jsx("img",{src:"/images/doneeregister.png",alt:"Forgot Password",style:{maxWidth:"55%",height:"auto",display:"block",margin:"0 auto 0px"}}),e.jsx(r,{variant:"h6",sx:{color:"white",fontWeight:600,mt:0},children:"Reset Your Password"}),e.jsx(r,{variant:"body2",sx:{color:"white",maxWidth:380,mx:"auto",mt:.2},children:"Enter your email and domain to receive password reset instructions."})]})}),e.jsxs(n,{sx:{flex:1,background:"white",p:{xs:3,md:5},display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs(n,{sx:{textAlign:"center",mb:2},children:[e.jsx(Ln,{color:"primary",sx:{fontSize:40}}),e.jsx(r,{variant:"h5",fontWeight:700,children:"Forgot Password"})]}),l&&e.jsx(ae,{severity:"error",children:l}),e.jsxs("form",{onSubmit:c(y),children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Email",...d("email"),error:!!u.email,helperText:u.email?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx($n,{})})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Domain Name",...d("domain_name"),error:!!u.domain_name,helperText:u.domain_name?.message,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(Br,{})})}})})]}),e.jsx(H,{fullWidth:!0,size:"large",type:"submit",variant:"contained",startIcon:e.jsx(bo,{}),disabled:i,sx:{mt:3},children:i?"Sending...":"Send to Email"}),e.jsx(r,{align:"center",sx:{mt:2},children:e.jsx(aa,{onClick:()=>t("/login"),sx:{cursor:"pointer"},children:"Back to Login"})})]})]})]})})})},fu=()=>e.jsx(gu,{}),ju=()=>{const{selectedProject:t,selectedEnvironment:s}=ke(g=>g.app),{user:a}=ke(g=>g.auth);ca();const[i,l]=Ke.useState(0),{data:d=[],isLoading:c,isFetching:u}=Ed({projectId:t?.id,environmentId:s?.id},{skip:!t||!s}),f=g=>new Date(g).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),y=Array.from(new Set(d.map(g=>g.activity))),h=d.reduce((g,P)=>(g[P.Object_name]||(g[P.Object_name]=[]),g[P.Object_name].push(P),g),{}),p=d.length,m=d.filter(g=>g.completion>0).length,S=p===0?0:Math.round(m/p*100),T=Object.keys(h).map(g=>{const P=h[g],$=P.reduce((V,v)=>V+v.completion,0)/P.length;return{objectName:g,progress:Math.round($)}});return e.jsxs(n,{sx:{p:1},children:[e.jsx(r,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"Dashboard"}),t&&e.jsxs(me,{elevation:2,sx:{p:1,mb:1},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,children:"Project Details"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:12,md:3,children:[e.jsx(Mr,{})," ",t.owner_name||"N/A"]}),e.jsxs(j,{item:!0,xs:12,md:3,children:[e.jsx(As,{})," ",t.start_date?f(t.start_date):"N/A"]}),e.jsxs(j,{item:!0,xs:12,md:3,children:[e.jsx(As,{})," ",t.end_date?f(t.end_date):"N/A"]}),e.jsxs(j,{item:!0,xs:12,md:3,children:[e.jsx(qn,{})," ",t.client||"N/A"]})]})]}),e.jsxs(me,{elevation:3,sx:{p:1,mb:1},children:[e.jsx(r,{fontWeight:600,children:"Overall Migration Progress"}),e.jsx(ms,{variant:"determinate",value:S,sx:{height:10,borderRadius:5,mt:1}}),e.jsxs(r,{variant:"caption",children:[S,"% completed"]})]}),e.jsxs(Mt,{value:i,onChange:(g,P)=>l(P),sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Migration Process"}),e.jsx(He,{label:"Data Load Progress"})]}),i===0&&e.jsxs(me,{elevation:3,sx:{mt:1,p:1,overflowX:"auto"},children:[(c||u)&&e.jsx(r,{children:"Loading migration status..."}),!c&&e.jsxs("table",{style:{borderCollapse:"collapse",width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:8,textAlign:"left"},children:"Object Name"}),y.map(g=>e.jsx("th",{style:{padding:8},children:g},g))]})}),e.jsx("tbody",{children:Object.keys(h).map(g=>e.jsxs("tr",{children:[e.jsx("td",{style:{padding:8,fontWeight:600},children:g}),y.map(P=>{const $=h[g].find(v=>v.activity===P);if(!$)return e.jsx("td",{},P);const V=$.completion>0;return e.jsx("td",{style:{textAlign:"center"},children:e.jsx(n,{sx:{width:36,height:36,borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",bgcolor:V?"#1976d2":"#fbc02d",color:"#fff"},children:V?e.jsx(mt,{fontSize:"small"}):e.jsx(is,{fontSize:"small"})})},P)})]},g))})]})]}),i===1&&e.jsx(me,{elevation:3,sx:{mt:1,p:1},children:T.map(g=>e.jsxs(n,{sx:{mb:1},children:[e.jsx(r,{fontWeight:600,children:g.objectName}),e.jsx(ms,{variant:"determinate",value:g.progress,sx:{height:10,borderRadius:5,mt:1}}),e.jsxs(r,{variant:"caption",children:[g.progress,"%"]})]},g.objectName))})]})},ki=({open:t,onClose:s,object:a,systemId:i,systemType:l})=>{const{selectedProject:d}=ke(_=>_.app),[c,u]=o.useState({name:"",description:"",operation:"insert",criteria:"",post_mig_strategy:"",owner_id:"",estimated_rows:"",migration_rows:"",migration_columns:""}),[f,y]=o.useState({}),[h,{isLoading:p,error:m}]=El(),[S,{isLoading:T,error:g}]=Fl(),{data:P=[]}=Kr(),{data:$,isLoading:V,error:v}=Wc(),q=$?.objects||[],w=!!a;o.useEffect(()=>{P.length>0&&!c.owner_id&&!w&&u(_=>({..._,owner_id:P[0].id}))},[P,c.owner_id,w]);const O=p||T,N=m||g;o.useEffect(()=>{if(t)if(a){const _=P.find(D=>D.firstname+" "+D.lastname===a.owner_name||D.username===a.owner_name);u({name:a.name||"",description:a.description||"",operation:a.operation||"insert",criteria:a.criteria||"",post_mig_strategy:a.post_mig_strategy||"",owner_id:_?.id||"",estimated_rows:a.records_count||"",migration_rows:a.migration_count||"",migration_columns:a.field_count?.toString()||""})}else u({name:"",description:"",operation:"insert",criteria:"",post_mig_strategy:"",owner_id:"",estimated_rows:"",migration_rows:"",migration_columns:""})},[t,a,P]);const R=_=>D=>{u(C=>({...C,[_]:D.target.value}))},W=_=>D=>{u(C=>({...C,[_]:D.target.value})),f[_]&&y(C=>({...C,[_]:""}))},b=()=>{const _={};return l==="source"?(c.name.trim()||(_.name="Object name is required"),c.owner_id||(_.owner_id="Owner is required"),c.estimated_rows.trim()||(_.estimated_rows="Estimated rows is required"),c.migration_rows.trim()||(_.migration_rows="Migration rows is required"),c.migration_columns.trim()||(_.migration_columns="Migration columns is required"),c.description.trim()||(_.description="Description is required"),c.operation||(_.operation="Operation is required")):(c.name.trim()||(_.name="Target object is required"),c.owner_id||(_.owner_id="Owner is required")),y(_),Object.keys(_).length===0},F=async()=>{if(b())try{let _;l==="target"?_={name:c.name,owner:c.owner_id,system:i,project:d?.id||"",description:"",operation:"insert",criteria:"",post_mig_strategy:"",records_count:"",migration_count:"",field_count:0}:_={name:c.name,description:c.description,operation:c.operation,criteria:c.criteria,post_mig_strategy:c.post_mig_strategy,owner:c.owner_id,records_count:c.estimated_rows,migration_count:c.migration_rows,field_count:parseInt(c.migration_columns)||0,system:i,project:d?.id||""},w&&a?await S({id:a.object_id,data:_}).unwrap():await h(_).unwrap(),s()}catch(_){console.error("Failed to save object:",_)}},G=[{value:"insert",label:"Insert"},{value:"upsert",label:"Upsert"},{value:"update",label:"Update"},{value:"delete",label:"Delete"}];return e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:_=>_.zIndex.modal},children:e.jsx(me,{sx:{width:500,height:"100vh",margin:0,borderRadius:0,overflow:"auto",boxShadow:24},children:e.jsxs(n,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:w?"Edit Object":"Add New Object"}),e.jsx(ne,{onClick:s,disabled:O,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(X,{label:`${l.toUpperCase()} System`,color:l==="source"?"primary":"secondary",sx:{mb:1}}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["System ID: ",i]})]}),N&&e.jsxs(ae,{severity:"error",sx:{mb:2},children:["Failed to ",w?"update":"create"," object. Please try again."]}),v&&l==="target"&&e.jsx(ae,{severity:"warning",sx:{mb:2},children:"Failed to load Salesforce objects. Please check your connection."}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsx(j,{container:!0,spacing:2,children:l==="target"?e.jsxs(e.Fragment,{children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(Un,{value:c.name,onChange:(_,D)=>{u(C=>({...C,name:D||""})),f.name&&y(C=>({...C,name:""}))},options:q,loading:V,disabled:O||!!v,renderInput:_=>e.jsx(ye,{..._,label:"Target Object",error:!!f.name,helperText:f.name||(v?"Failed to load objects":""),disabled:O||!!v}),noOptionsText:v?"Failed to load objects":"No objects available"})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,disabled:O,error:!!f.owner_id,children:[e.jsx(Me,{children:"Owner"}),e.jsxs(We,{value:c.owner_id,onChange:W("owner_id"),label:"Owner",children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select owner"})}),P.map(_=>e.jsxs(re,{value:_.id,children:[_.firstname," ",_.lastname," (",_.username,")"]},_.id))]}),f.owner_id&&e.jsx(r,{variant:"caption",color:"error",sx:{mt:.5,ml:2},children:f.owner_id})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"System",value:i,disabled:!0,InputProps:{readOnly:!0}})})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Object Name",value:c.name,onChange:R("name"),required:!0,disabled:O,error:!!f.name,helperText:f.name})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,disabled:O,error:!!f.owner_id,children:[e.jsx(Me,{children:"Owner"}),e.jsxs(We,{value:c.owner_id,onChange:W("owner_id"),label:"Owner",children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select owner"})}),P.map(_=>e.jsxs(re,{value:_.id,children:[_.firstname," ",_.lastname," (",_.username,")"]},_.id))]}),f.owner_id&&e.jsx(r,{variant:"caption",color:"error",sx:{mt:.5,ml:2},children:f.owner_id})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Estimated Number of Rows in Source System",value:c.estimated_rows,onChange:R("estimated_rows"),type:"number",disabled:O,placeholder:"e.g., 10000",error:!!f.estimated_rows,helperText:f.estimated_rows})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Estimated Number of ROWS for Migration",value:c.migration_rows,onChange:R("migration_rows"),type:"number",disabled:O,placeholder:"e.g., 5000",error:!!f.migration_rows,helperText:f.migration_rows})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Estimated Number of COLUMNS for Migration",value:c.migration_columns,onChange:R("migration_columns"),type:"number",disabled:O,placeholder:"e.g., 25",error:!!f.migration_columns,helperText:f.migration_columns})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Description",value:c.description,onChange:R("description"),multiline:!0,rows:3,disabled:O,error:!!f.description,helperText:f.description})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,disabled:O,error:!!f.operation,children:[e.jsx(Me,{children:"Operation"}),e.jsx(We,{value:c.operation,onChange:W("operation"),label:"Operation",children:G.map(_=>e.jsx(re,{value:_.value,children:_.label},_.value))}),f.operation&&e.jsx(r,{variant:"caption",color:"error",sx:{mt:.5,ml:2},children:f.operation})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Criteria",value:c.criteria,onChange:R("criteria"),multiline:!0,rows:2,disabled:O,placeholder:"e.g., status='active'"})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:"Post-Migration Strategy",value:c.post_mig_strategy,onChange:R("post_mig_strategy"),multiline:!0,rows:2,disabled:O,placeholder:"e.g., archive old records"})})]})})}),e.jsxs(n,{sx:{display:"flex",gap:1,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(H,{fullWidth:!0,variant:"outlined",onClick:s,disabled:O,children:"Cancel"}),e.jsx(H,{fullWidth:!0,variant:"contained",onClick:F,disabled:O||!c.name,startIcon:O?e.jsx(ie,{size:16}):e.jsx(hs,{}),children:O?"Saving...":w?"Update":"Create"})]})]})})})},yu=()=>{const{selectedProject:t}=ke(E=>E.app),[s,a]=o.useState(""),[i,l]=o.useState(!1),[d,c]=o.useState(null),[u,f]=o.useState(null),[y,h]=o.useState({open:!1,message:"",severity:"info"}),{data:p=[],isLoading:m,error:S}=ks(t?.id||"",{skip:!t?.id,refetchOnMountOrArgChange:!0}),T=p.filter(E=>E.type==="source"),{data:g=[],isLoading:P,error:$}=Is(s,{skip:!s,refetchOnMountOrArgChange:!0}),[V,{isLoading:v}]=ni();o.useEffect(()=>{T.length>0?a(T[0].id):a("")},[T,t]),o.useEffect(()=>{a("")},[t]);const q=E=>{a(E.target.value)},w=()=>{c(null),l(!0)},O=()=>{if(!u){h({open:!0,message:"Please select a row first which you want to edit",severity:"warning"});return}c(u),l(!0)},N=E=>{f(E),h({open:!0,message:`Selected object: ${E.name}`,severity:"info"})},R=async E=>{try{await V(E.object_id).unwrap(),h({open:!0,message:`Successfully deleted object: ${E.name}`,severity:"success"}),u?.object_id===E.object_id&&f(null)}catch(_){console.error("Failed to delete object:",_),h({open:!0,message:`Failed to delete object: ${E.name}`,severity:"error"})}},W=()=>{l(!1),c(null)},b=()=>{h(E=>({...E,open:!1}))},F=E=>E?"success":"warning",G=E=>{switch(E){case"insert":return"primary";case"upsert":return"secondary";case"update":return"info";default:return"default"}};return t?e.jsxs(n,{sx:{p:1},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(Ae,{size:"small",sx:{minWidth:200},children:[e.jsx(Me,{children:"Source System"}),e.jsx(We,{value:s,onChange:q,label:"Source System",disabled:m,children:T.map(E=>e.jsxs(re,{value:E.id,children:[E.name," (",E.type,")"]},E.id))})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:w,disabled:!s||m,children:"Add Object"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:O,disabled:!s||m||!u,children:"Edit Object"})]})]}),P&&s&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:1},children:e.jsx(ie,{})}),$&&e.jsx(ae,{severity:"error",sx:{mb:1},children:"Failed to load objects. Please try again."}),!s&&!m&&T.length>0&&e.jsx(ae,{severity:"info",children:"Please select a source system to view objects."}),!m&&T.length===0&&e.jsx(ae,{severity:"info",children:"No source systems found for the selected project."}),s&&!P&&g.length===0&&e.jsx(ae,{severity:"info",children:"No objects found for the selected source system."}),g.length>0&&e.jsx(tt,{component:me,elevation:1,children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Object Name"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Description"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Records"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Fields"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Operation"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Actions"})]})}),e.jsx(Ye,{children:g.map(E=>e.jsxs(pe,{hover:!0,onClick:()=>N(E),sx:{cursor:"pointer",backgroundColor:u?.object_id===E.object_id?"action.selected":"inherit"},children:[e.jsx(x,{children:e.jsx(r,{variant:"body2",fontWeight:"medium",children:E.name})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:E.description||"No description"})}),e.jsx(x,{children:e.jsx(X,{label:E.records_count||"0",size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:E.field_count?.toString()||"0",size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:E.operation,size:"small",color:G(E.operation)})}),e.jsx(x,{children:e.jsx(X,{label:E.is_completed?"Completed":"In Progress",size:"small",color:F(E.is_completed)})}),e.jsx(x,{children:e.jsx(je,{title:"Delete Object",children:e.jsx(ne,{size:"small",onClick:_=>{_.stopPropagation(),R(E)},color:"error",disabled:v,children:e.jsx(ds,{})})})})]},E.object_id))})]})}),e.jsx(ki,{open:i,onClose:W,object:d,systemId:s,systemType:"source"}),e.jsx(dt,{open:y.open,autoHideDuration:3e3,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:b,severity:y.severity,sx:{width:"100%"},children:y.message})})]}):e.jsx(n,{sx:{p:1},children:e.jsx(ae,{severity:"warning",children:"Please select a project to view source objects."})})},bu=({open:t,onClose:s,object:a})=>{const[i,l]=o.useState([]),{data:d,isLoading:c,error:u}=Al(a?.object_id||"",{skip:!a?.object_id||!t});o.useEffect(()=>{a&&l([])},[a]);const f=m=>{l(S=>S.includes(m)?S.filter(T=>T!==m):[...S,m])},y=()=>{d&&l(d.map(m=>m.field_id))},h=()=>{l([])},p=()=>{const m=d?.filter(S=>i.includes(S.field_id)).map(S=>S.name)||[];localStorage.setItem("selectedCompoundFields",JSON.stringify(m)),console.log("Selected compound field names saved:",m),s()};return e.jsx(Et,{anchor:"right",open:t,onClose:s,PaperProps:{sx:{width:{xs:"100%",sm:400}}},children:e.jsxs(n,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",children:"Select Compound Fields"}),e.jsx(ne,{onClick:s,size:"small",children:e.jsx(ct,{})})]}),a&&e.jsxs(n,{sx:{mb:3},children:[e.jsx(r,{variant:"subtitle1",fontWeight:"medium",children:a.name}),e.jsx(r,{variant:"body2",color:"text.secondary",children:a.description||"No description"})]}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(H,{size:"small",variant:"outlined",onClick:y,disabled:!d?.length,children:"Select All"}),e.jsx(H,{size:"small",variant:"outlined",onClick:h,disabled:i.length===0,children:"Deselect All"}),e.jsx(X,{label:`${i.length} selected`,size:"small",color:"primary",variant:"outlined"})]}),c&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ie,{})}),u&&e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to load compound fields. Please try again."}),!c&&d&&e.jsx(fs,{sx:{flex:1,overflow:"auto"},children:d.map((m,S)=>e.jsxs($t,{dense:!0,sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(rs,{checked:i.includes(m.field_id),onChange:()=>f(m.field_id),size:"small"}),e.jsx(Wt,{primary:e.jsx(r,{variant:"body2",fontWeight:"medium",children:m.label||m.name}),secondary:e.jsxs(r,{variant:"caption",color:"text.secondary",children:[m.name," ‚Ä¢ ID: ",m.id]})})]},m.field_id||m.id||`compound-field-${S}`))}),!c&&!u&&(!d||d.length===0)&&e.jsx(n,{sx:{textAlign:"center",py:4},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No compound fields available for this object."})}),e.jsxs(n,{sx:{display:"flex",gap:2,mt:3},children:[e.jsx(H,{variant:"outlined",onClick:s,fullWidth:!0,children:"Cancel"}),e.jsxs(H,{variant:"contained",onClick:p,fullWidth:!0,disabled:i.length===0,children:["Save Selection (",i.length,")"]})]})]})})},vu=({open:t,onClose:s,onSuccess:a})=>{const[i,l]=o.useState({username:"",password:"",security_token:"",client_id:"",client_secret:""}),[d,{isLoading:c,error:u}]=Dc(),f=m=>S=>{l(T=>({...T,[m]:S.target.value}))},y=async()=>{try{await d(i).unwrap(),a?.(),s()}catch(m){console.error("Failed to connect to Salesforce:",m)}},h=()=>{c||(l({username:"",password:"",security_token:"",client_id:"",client_secret:""}),s())};return e.jsx(Ut,{open:t,onClose:h,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:m=>m.zIndex.modal},children:e.jsx(n,{sx:{width:500,height:"100vh",margin:0,borderRadius:0,overflow:"auto",boxShadow:24,bgcolor:"background.paper"},children:e.jsxs(n,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:"Connect to Salesforce"}),e.jsx(ne,{onClick:h,disabled:c,children:e.jsx(ct,{})})]}),u&&e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to connect to Salesforce. Please check your credentials and try again."}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(ye,{fullWidth:!0,label:"Username",value:i.username,onChange:f("username"),required:!0,disabled:c,placeholder:"your.email@company.com"}),e.jsx(ye,{fullWidth:!0,label:"Password",type:"password",value:i.password,onChange:f("password"),required:!0,disabled:c}),e.jsx(ye,{fullWidth:!0,label:"Security Token",value:i.security_token,onChange:f("security_token"),required:!0,disabled:c,placeholder:"Your Salesforce security token"}),e.jsx(ye,{fullWidth:!0,label:"Client ID",value:i.client_id,onChange:f("client_id"),required:!0,disabled:c,placeholder:"Your Connected App Consumer Key"}),e.jsx(ye,{fullWidth:!0,label:"Client Secret",type:"password",value:i.client_secret,onChange:f("client_secret"),required:!0,disabled:c,placeholder:"Your Connected App Consumer Secret"})]})}),e.jsxs(n,{sx:{display:"flex",gap:1,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(H,{fullWidth:!0,variant:"outlined",onClick:h,disabled:c,children:"Cancel"}),e.jsx(H,{fullWidth:!0,variant:"contained",onClick:y,disabled:c||!i.username||!i.password||!i.security_token||!i.client_id||!i.client_secret,startIcon:c?e.jsx(ie,{size:16}):void 0,children:c?"Connecting...":"Connect"})]})]})})})},wi=()=>{const t=us(),{selectedProject:s}=ke(Y=>Y.app),a=t.pathname.startsWith("/backup"),[i,l]=o.useState(""),[d,c]=o.useState(!1),[u,f]=o.useState(null),[y,h]=o.useState(null),[p,m]=o.useState(!1),[S,T]=o.useState(null),[g,P]=o.useState(!1),[$,V]=o.useState(!1),[v,q]=o.useState({open:!1,message:"",severity:"info"}),{data:w=[],isLoading:O,error:N}=ks(s?.id||"",{skip:!s?.id,refetchOnMountOrArgChange:!0}),R=w.filter(Y=>Y.type==="target"),{data:W=[],isLoading:b,error:F}=Is(i,{skip:!i,refetchOnMountOrArgChange:!0}),{data:G,isLoading:E,error:_,refetch:D}=Rc(void 0,{refetchOnMountOrArgChange:!0}),[C,{isLoading:oe}]=Ec(),[Z]=Fc(),[he]=Ac(),[_e,{isLoading:z}]=ni();o.useEffect(()=>{R.length>0?l(R[0].id):l("")},[R,s]),o.useEffect(()=>{l("")},[s]);const A=Y=>{l(Y.target.value)},te=()=>{f(null),c(!0)},I=()=>{if(!y){q({open:!0,message:"Please select a row first which you want to edit",severity:"warning"});return}f(y),c(!0)},J=Y=>{h(Y),q({open:!0,message:`Selected object: ${Y.name}`,severity:"info"})},se=async Y=>{try{await _e(Y.object_id).unwrap(),q({open:!0,message:`Successfully deleted object: ${Y.name}`,severity:"success"}),y?.object_id===Y.object_id&&h(null)}catch(ge){console.error("Failed to delete object:",ge),q({open:!0,message:`Failed to delete object: ${Y.name}`,severity:"error"})}},Ie=Y=>{localStorage.setItem("selectedBackupObject",JSON.stringify(Y)),console.log("Selected object for backup:",Y)},Fe=Y=>{T(Y),m(!0)},de=()=>{c(!1),f(null)},qe=()=>{m(!1),T(null)},Ne=()=>{P(!0)},Oe=()=>{P(!1)},st=()=>{D(),q({open:!0,message:"Successfully connected to Salesforce!",severity:"success"})},K=()=>{V(!0)},Ce=async()=>{try{await C().unwrap(),V(!1),D(),q({open:!0,message:"Successfully disconnected from Salesforce!",severity:"success"})}catch(Y){console.error("Failed to disconnect from Salesforce:",Y),q({open:!0,message:"Failed to disconnect from Salesforce. Please try again.",severity:"error"})}},k=()=>{V(!1)},Q=async Y=>{try{await Z({object_name:Y.name}).unwrap(),q({open:!0,message:`Successfully extracted sample data for ${Y.name}`,severity:"success"})}catch(ge){console.error("Failed to extract sample:",ge),q({open:!0,message:`Failed to extract sample data for ${Y.name}: ${ge?.data?.message||ge?.message||"Unknown error"}`,severity:"error"})}},U=async Y=>{try{await he({object_name:Y.name,object_id:Y.object_id,project_id:s?.id||"",system_id:i}).unwrap(),q({open:!0,message:`Successfully refreshed metadata for ${Y.name}`,severity:"success"})}catch(ge){console.error("Failed to refresh metadata:",ge),q({open:!0,message:`Failed to refresh metadata for ${Y.name}: ${ge?.data?.message||ge?.message||"Unknown error"}`,severity:"error"})}},ue=()=>{q(Y=>({...Y,open:!1}))},M=()=>_?{isConnected:!1,message:"Connection check failed",isError:!0}:G?G.detail==="Authentication failed."?{isConnected:!1,message:"User is not connected to salesforce",isError:!0}:G.detail?.includes("not connected")?{isConnected:!1,message:"User is not connected to salesforce",isError:!0}:G.message==="User is connected to salseforce"?{isConnected:!0,message:"User is connected to salesforce",isError:!1}:{isConnected:!1,message:G.detail||"Unknown connection status",isError:!0}:{isConnected:!1,message:"Checking connection...",isError:!1},{isConnected:ce,message:le,isError:Se}=M(),ve=Y=>Y?"success":"warning",B=Y=>{switch(Y){case"insert":return"primary";case"upsert":return"secondary";case"update":return"info";default:return"default"}};return s?e.jsxs(n,{sx:{p:2},children:[e.jsx(n,{sx:{mb:2},children:e.jsx(ae,{severity:Se?"error":ce?"success":"info",sx:{"& .MuiAlert-message":{fontWeight:"bold"}},children:E?"Checking Salesforce connection...":le})}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(Ae,{size:"small",sx:{minWidth:200},children:[e.jsx(Me,{children:"Target System"}),e.jsx(We,{value:i,onChange:A,label:"Target System",disabled:O,children:R.map(Y=>e.jsxs(re,{value:Y.id,children:[Y.name," (",Y.type,")"]},Y.id))})]}),e.jsx(n,{sx:{display:"flex",gap:1},children:ce?e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"outlined",onClick:K,disabled:E||oe,children:oe?"Disconnecting...":"Disconnect"}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:te,disabled:!i||O,children:"Add Object"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:I,disabled:!i||O||!y,children:"Edit Object"})]})]}):e.jsx(H,{variant:"contained",onClick:Ne,disabled:E,children:"Connect"})})]}),b&&i&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(ie,{})}),F&&e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to load objects. Please try again."}),!i&&!O&&R.length>0&&e.jsx(ae,{severity:"info",children:"Please select a target system to view objects."}),!O&&R.length===0&&e.jsx(ae,{severity:"info",children:"No target systems found for the selected project."}),i&&!b&&W.length===0&&e.jsx(ae,{severity:"info",children:"No objects found for the selected target system."}),W.length>0&&e.jsx(tt,{component:me,elevation:1,children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Object Name"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Description"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Records"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Fields"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Operation"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Extract Sample"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Refresh Metadata"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Actions"})]})}),e.jsx(Ye,{children:W.map(Y=>e.jsxs(pe,{hover:!0,onClick:()=>J(Y),sx:{cursor:"pointer",backgroundColor:y?.object_id===Y.object_id?"action.selected":"inherit"},children:[e.jsx(x,{children:e.jsx(r,{variant:"body2",fontWeight:"medium",children:Y.name})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",color:"text.secondary",children:Y.description||"No description"})}),e.jsx(x,{children:e.jsx(X,{label:Y.records_count||"0",size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:Y.field_count?.toString()||"0",size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:Y.operation,size:"small",color:B(Y.operation)})}),e.jsx(x,{children:e.jsx(X,{label:Y.is_completed?"Completed":"In Progress",size:"small",color:ve(Y.is_completed)})}),e.jsx(x,{children:e.jsx(H,{size:"small",variant:"outlined",onClick:ge=>{ge.stopPropagation(),Q(Y)},disabled:!ce,children:"Extract"})}),e.jsx(x,{children:e.jsx(H,{size:"small",variant:"outlined",onClick:ge=>{ge.stopPropagation(),U(Y)},disabled:!ce,children:"Refresh"})}),e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(je,{title:"Delete Object",children:e.jsx(ne,{size:"small",onClick:ge=>{ge.stopPropagation(),se(Y)},color:"error",disabled:z,children:e.jsx(ds,{})})}),a&&e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Select Compound Fields",children:e.jsx(ne,{size:"small",onClick:ge=>{ge.stopPropagation(),Fe(Y)},color:"secondary",children:e.jsx(vo,{})})}),e.jsx(je,{title:"Select for Backup",children:e.jsx(ne,{size:"small",onClick:ge=>{ge.stopPropagation(),Ie(Y)},color:"success",children:e.jsx(sr,{})})})]})]})})]},Y.object_id))})]})}),e.jsx(ki,{open:d,onClose:de,object:u,systemId:i,systemType:"target"}),e.jsx(bu,{open:p,onClose:qe,object:S}),e.jsx(vu,{open:g,onClose:Oe,onSuccess:st}),e.jsxs(wt,{open:$,onClose:k,maxWidth:"sm",fullWidth:!0,children:[e.jsx(It,{children:"Confirm Disconnect"}),e.jsx(Pt,{children:e.jsx(r,{children:"Are you sure you want to disconnect from Salesforce? This will remove your saved credentials."})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:k,disabled:oe,children:"Cancel"}),e.jsx(H,{onClick:Ce,variant:"contained",color:"error",disabled:oe,startIcon:oe?e.jsx(ie,{size:16}):void 0,children:oe?"Disconnecting...":"Disconnect"})]})]}),e.jsx(dt,{open:v.open,autoHideDuration:6e3,onClose:ue,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:ue,severity:v.severity,sx:{width:"100%"},children:v.message})})]}):e.jsx(n,{sx:{p:2},children:e.jsx(ae,{severity:"warning",children:"Please select a project to view target objects."})})},vn=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`entities-tabpanel-${a}`,"aria-labelledby":`entities-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{p:0},children:t})}),_u=()=>{const[t,s]=o.useState(0),{selectedProject:a}=ke(l=>l.app),i=(l,d)=>{s(d)};return e.jsxs(n,{sx:{p:1,mb:2},children:[e.jsxs(Mt,{value:t,onChange:i,"aria-label":"entities tabs",sx:{borderBottom:1,borderColor:"divider",mb:2,"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Source Objects",id:"entities-tab-0","aria-controls":"entities-tabpanel-0"}),e.jsx(He,{label:"Target Objects",id:"entities-tab-1","aria-controls":"entities-tabpanel-1"})]}),e.jsx(vn,{value:t,index:0,children:e.jsx(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:e.jsx(yu,{})})}),e.jsx(vn,{value:t,index:1,children:e.jsx(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:e.jsx(wi,{})})})]})},pt="#2b4a83",Su=()=>{const{selectedProject:t}=ke(b=>b.app),{data:s=[],isLoading:a,error:i,refetch:l}=tc(),{refetch:d}=li(),{data:c,refetch:u}=Xr(),[f]=sc(),[y]=ac(),[h,p]=o.useState({}),[m,S]=o.useState(!1),[T,g]=o.useState(!1),[P,$]=o.useState(""),[V,v]=o.useState(0),[q,w]=o.useState(-1);o.useEffect(()=>{if(s.length>0){const b={};s.forEach(F=>{const G=F.project_est_data?F.dev_set_value:F.dev_recc_effort;b[F.activity]={value:G,isModified:!1,isLoading:!1,originalValue:G,hasError:!1}}),p(b)}},[s]);const O=b=>(F,G)=>{p(E=>({...E,[b]:{...E[b],value:G,isModified:G!==E[b]?.originalValue,hasError:!1}}))},N=async(b,F,G,E)=>{try{if(b.project_est_data){const _={dev_set_value:Math.floor(F.value),modified_by:E};await y({id:b.id,data:_}).unwrap()}else{const _={project_id:t.id,account_id:G,name:b.name,activity:b.activity,phase:b.phase,recc_effort:Math.floor(b.dev_recc_effort).toString(),dev_set_value:Math.floor(F.value).toString()};await f(_).unwrap()}return p(_=>({..._,[b.activity]:{value:F.value,isModified:!1,isLoading:!1,originalValue:F.value,hasError:!1}})),!0}catch(_){return console.error(`Failed to process ${b.activity}:`,_),p(D=>({...D,[b.activity]:{...D[b.activity],isLoading:!1,hasError:!0}})),!1}},R=async()=>{if(!t){$("Please select a project first");return}S(!0),$(""),g(!1),v(0),w(-1);try{const b=s.filter(D=>h[D.activity]?.isModified);if(b.length===0&&!s.some(C=>!C.project_est_data)){$("No changes detected. Please modify at least one slider."),S(!1);return}const F=b.length>0?b:s,G=c?.id||"41d4357c-10c9-4048-9d31-595386c68f06",E="877ee3bd-de6e-4b74-9328-c37bbc63d123";let _=0;for(let D=0;D<F.length;D++){const C=F[D],oe=h[C.activity];w(D),p(he=>({...he,[C.activity]:{...he[C.activity],isLoading:!0,hasError:!1}})),await N(C,oe,G,E)&&(_++,v(_))}if(w(-1),_>0)try{await l(),await d(),await u(),console.log("All data refetched successfully")}catch(D){console.error("Failed to refetch data:",D)}_===F.length?g(!0):_>0?$(`Partially completed: ${_}/${F.length} updates successful.`):$("All updates failed. Please try again.")}catch(b){console.error("Unexpected error in handleCalculateEstimations:",b),$("An unexpected error occurred. Please try again."),w(-1)}finally{S(!1)}},W=()=>Object.values(h).filter(b=>b?.isModified).length;return a?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(ie,{})}):i?e.jsx(n,{sx:{p:2},children:e.jsx(ae,{severity:"error",children:"Failed to load estimation data. Please try again."})}):e.jsxs(n,{sx:{p:2,bgcolor:"white"},children:[e.jsxs(r,{variant:"body1",sx:{mb:4,color:"#444",fontWeight:500},children:["Adjust the slider to indicate time taken for ",e.jsx("b",{children:"10 fields"})," and ",e.jsx("b",{children:"50K records"})," Processing"]}),e.jsx(n,{sx:{px:2},children:s.map((b,F)=>{const G=h[b.activity],E=b.project_est_data?b.dev_set_value:b.dev_recc_effort,_=G?.value||E,D=G?.isModified||!1,C=G?.isLoading||!1,oe=G?.hasError||!1,Z=q===F;return e.jsxs(j,{container:!0,spacing:4,alignItems:"center",sx:{mb:3},children:[e.jsx(j,{item:!0,xs:2.5,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{sx:{color:"#666",fontSize:"0.95rem",minWidth:"100px"},children:b.name}),C?e.jsx(ie,{size:16}):oe?e.jsx(ht,{sx:{color:"#f44336",fontSize:20}}):D?e.jsx(ht,{sx:{color:pt,fontSize:20}}):e.jsx(mt,{sx:{color:"#4caf50",fontSize:20}})]})}),e.jsx(j,{item:!0,xs:.5,children:e.jsx(r,{sx:{color:"#666",textAlign:"right",fontSize:"0.9rem"},children:b.range_min})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(_o,{value:_,min:b.range_min,max:b.range_max,step:1,onChange:O(b.activity),disabled:C||m,sx:{color:Z?pt:oe?"#f44336":pt,height:4,"& .MuiSlider-thumb":{width:36,height:36,backgroundColor:"#fff",border:`2px solid ${Z?pt:oe?"#f44336":pt}`,"&:before":{boxShadow:"none"},"&:hover, &.Mui-focusVisible":{boxShadow:`0 0 0 8px ${Z?pt:oe?"#f44336":pt}22`},position:"relative",overflow:"visible","&::after":{content:`"${_}"`,position:"absolute",top:"30px",left:"25px",right:"30px",transform:"translate(-50%, -50%)",fontSize:"0.75rem",color:Z?pt:oe?"#f44336":pt,fontWeight:"bold",lineHeight:1,zIndex:1}},"& .MuiSlider-track":{border:"none",height:6},"& .MuiSlider-rail":{opacity:.2,backgroundColor:"#bfbfbf",height:4}}})}),e.jsx(j,{item:!0,xs:.5,children:e.jsx(r,{sx:{color:"#666",fontSize:"0.9rem"},children:b.range_max})}),e.jsx(j,{item:!0,xs:2,children:e.jsx(n,{sx:{border:`1px solid ${Z?pt:oe?"#f44336":pt}`,borderRadius:"4px",px:2,py:.5,textAlign:"center",color:Z?pt:oe?"#f44336":pt,width:"fit-content",minWidth:"80px",ml:"auto",backgroundColor:C?`${pt}15`:oe?"#ffebee":"transparent",transition:"all 0.3s ease"},children:e.jsxs(r,{sx:{fontSize:"0.9rem",fontWeight:500},children:[_," Hr."]})})})]},b.id)})}),e.jsxs(n,{sx:{borderTop:"1px solid #e0e0e0",mt:4,pt:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{sx:{fontWeight:500,color:"#333"},children:"Generate object Estimation"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[W()>0&&e.jsxs(r,{variant:"body2",color:"primary",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ht,{fontSize:"small"}),W()," modified"]}),m&&q>=0&&e.jsxs(r,{variant:"body2",color:"primary",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:12}),"Processing ",q+1,"/",s.length,"..."]}),e.jsx(H,{variant:"contained",onClick:R,disabled:m||W()===0,sx:{bgcolor:pt,textTransform:"none",px:4,minWidth:200,"&:hover":{bgcolor:"#1e355e"},"&.Mui-disabled":{bgcolor:"#e0e0e0",color:"#9e9e9e"}},children:m?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:20,color:"inherit"}),"Processing..."]}):"Calculate Estimations"})]})]}),e.jsx(dt,{open:T,autoHideDuration:4e3,onClose:()=>g(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ae,{severity:"success",onClose:()=>g(!1),children:"All estimations saved successfully!"})}),e.jsx(dt,{open:!!P,autoHideDuration:6e3,onClose:()=>$(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ae,{severity:V>0?"warning":"error",onClose:()=>$(""),children:P})})]})},_n=[{name:"Extract",value:5,color:"#F6C854"},{name:"Relationship",value:10,color:"#B9B569"},{name:"Filter",value:5,color:"#E591A2"},{name:"Metadata",value:10,color:"#2ADBD7"},{name:"Cleanup",value:15,color:"#578EFA"},{name:"Mapping",value:10,color:"#FF946E"},{name:"Validate",value:10,color:"#88D154"},{name:"Transform",value:15,color:"#CC90E0"},{name:"Load",value:10,color:"#E86199"},{name:"Error Handling",value:10,color:"#7E6BFE"}],ku=({active:t,payload:s})=>t&&s&&s.length?e.jsx(n,{sx:{backgroundColor:"#333",color:"#fff",padding:"6px 12px",borderRadius:"4px",fontSize:"12px",position:"relative",fontWeight:500,"&:after":{content:'""',position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",borderWidth:"6px",borderStyle:"solid",borderColor:"#333 transparent transparent transparent"}},children:`${s[0].name} : ${s[0].value}%`}):null,wu=()=>e.jsx(me,{elevation:0,sx:{p:2,width:"100%",height:500},children:e.jsx(n,{sx:{width:"100%",height:"100%"},children:e.jsx(ws,{width:"100%",height:"100%",children:e.jsxs(Gr,{children:[e.jsx("text",{x:"50%",y:"50%",textAnchor:"middle",dominantBaseline:"middle",style:{fontSize:"20px",fontWeight:500,fill:"#444"},children:"BenchMark"}),e.jsx(Vr,{data:_n,cx:"50%",cy:"50%",innerRadius:"65%",outerRadius:"85%",paddingAngle:0,dataKey:"value",stroke:"none",label:({cx:t,cy:s,midAngle:a,outerRadius:i,value:l})=>{const d=Math.PI/180,c=i+20,u=t+c*Math.cos(-a*d),f=s+c*Math.sin(-a*d);return e.jsx("text",{x:u,y:f,fill:"#333",textAnchor:u>t?"start":"end",dominantBaseline:"central",style:{fontSize:"13px",fontWeight:"bold"},children:`${l}%`})},labelLine:{stroke:"#ccc",strokeWidth:1},children:_n.map((t,s)=>e.jsx(Hr,{fill:t.color},`cell-${s}`))}),e.jsx(Cs,{content:e.jsx(ku,{}),cursor:{fill:"transparent"},offset:-40}),e.jsx(So,{verticalAlign:"bottom",align:"center",iconType:"circle",iconSize:8,wrapperStyle:{fontSize:"12px",paddingTop:"20px"}})]})})})}),Cu=()=>{const{data:t=[],isLoading:s,error:a}=li(),i=["Extract","Relationship","Filter","Metadata","Cleanup","Mapping","Validate","Transform","Load","Error Handling"];return s?e.jsx(me,{elevation:3,sx:{p:3},children:e.jsx(r,{children:"Loading object estimation data..."})}):a?e.jsx(me,{elevation:3,sx:{p:3},children:e.jsx(r,{color:"error",children:"Failed to load object estimation data"})}):e.jsxs(me,{elevation:3,sx:{p:"10px"},children:[e.jsxs(n,{sx:{mb:"10px"},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",gutterBottom:!0,sx:{fontSize:"16px"},children:"Object Load Estimation"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"16px"},children:"Detailed effort breakdown by object and activity"})]}),e.jsx(tt,{children:e.jsxs(Je,{sx:{minWidth:800},children:[e.jsx(Xe,{children:e.jsxs(pe,{sx:{backgroundColor:"grey.100"},children:[e.jsx(x,{sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Object Name"}),i.map(l=>e.jsx(x,{align:"center",sx:{fontWeight:"bold",fontSize:"0.9rem"},children:l},l)),e.jsx(x,{align:"center",sx:{fontWeight:"bold",fontSize:"0.9rem"},children:"Total"})]})}),e.jsx(Ye,{children:t.map(l=>e.jsxs(pe,{sx:{"&:hover":{backgroundColor:"action.hover"},"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(x,{component:"th",scope:"row",sx:{fontWeight:"medium"},children:l.Object_name}),i.map(d=>{const c=l.Info.find(u=>u.activity===d)?.efforts||0;return e.jsx(x,{align:"center",children:e.jsx(X,{label:c,size:"small",variant:"outlined",color:c>100?"error":c>50?"warning":"primary"})},`${l.Object_name}-${d}`)}),e.jsx(x,{align:"center",children:e.jsx(X,{label:l.total_efforts,size:"medium",color:"primary",variant:"filled",sx:{fontWeight:"bold",fontSize:"0.9rem"}})})]},l.Object_name))})]})})]})},Tu=({open:t,onClose:s,onSave:a,initialStartDate:i,initialEndDate:l,activity:d})=>{const[c,u]=o.useState(i.split("T")[0]),[f,y]=o.useState(l.split("T")[0]);o.useEffect(()=>{u(i.split("T")[0]),y(l.split("T")[0])},[i,l]);const h=()=>{a(c,f),s()};return e.jsxs(wt,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(It,{children:["Edit Dates - ",d]}),e.jsx(Pt,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Start Date"}),e.jsx(ye,{type:"date",value:c,onChange:p=>u(p.target.value),fullWidth:!0,size:"small"})]}),e.jsxs(n,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"End Date"}),e.jsx(ye,{type:"date",value:f,onChange:p=>y(p.target.value),fullWidth:!0,size:"small"})]})]})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:s,children:"Cancel"}),e.jsx(H,{onClick:h,variant:"contained",children:"Save Changes"})]})]})},Iu=()=>{const{selectedProject:t}=ke(v=>v.app),[s,a]=o.useState(!1),[i,l]=o.useState(""),[d,c]=o.useState({open:!1,planId:"",activity:"",startDate:"",endDate:""}),{data:u=[],isLoading:f,error:y,refetch:h}=rc(),[p]=nc(),m=async()=>{if(!t){l("Please select a project first");return}try{await p({projectId:t.id,data:{start_date:null,end_date:null}}).unwrap(),await h(),a(!0),l("")}catch(v){console.error("Failed to generate efforts:",v),l("Failed to generate efforts. Please try again.")}},S=v=>{c({open:!0,planId:v.id,activity:v.activity,startDate:v.start_date,endDate:v.end_date})},T=()=>{c({open:!1,planId:"",activity:"",startDate:"",endDate:""})},g=async(v,q)=>{try{console.log("Saving dates:",{startDate:v,endDate:q,planId:d.planId}),a(!0),l(""),await h()}catch(w){console.error("Failed to update dates:",w),l("Failed to update dates. Please try again.")}},P=v=>new Date(v).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),$=v=>{switch(v){case"dev":return"primary";case"qa":return"secondary";case"prod":return"success";default:return"default"}},V=v=>v>=100?"success":v>=75?"info":v>=50?"warning":"error";return t?e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:"Project Planning"}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:h,disabled:f,children:"Refresh"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(ia,{}),onClick:m,disabled:f,children:"Generate Efforts"})]})]}),e.jsx(me,{elevation:2,children:f?e.jsxs(n,{sx:{p:3,textAlign:"center"},children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading planning data..."})]}):y?e.jsx(n,{sx:{p:3},children:e.jsx(ae,{severity:"error",children:"Failed to load planning data. Please try again."})}):u.length===0?e.jsx(n,{sx:{p:3,textAlign:"center"},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:'No planning data found. Click "Generate Efforts" to create planning data.'})}):e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Activity"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Environment"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Type"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Efforts (Hours)"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Completion"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Start Date"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"End Date"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Actions"})]})}),e.jsx(Ye,{children:u.map(v=>e.jsxs(pe,{hover:!0,children:[e.jsx(x,{children:e.jsx(r,{variant:"body2",fontWeight:"medium",children:v.activity})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:v.environment})}),e.jsx(x,{children:e.jsx(X,{label:v.env_type.toUpperCase(),size:"small",color:$(v.env_type),variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:`${v.efforts} hrs`,size:"small",color:"primary",variant:"filled"})}),e.jsx(x,{children:e.jsx(X,{label:`${v.completion}%`,size:"small",color:V(v.completion)})}),e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(As,{fontSize:"small",color:"action"}),e.jsx(r,{variant:"body2",children:P(v.start_date)})]})}),e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(As,{fontSize:"small",color:"action"}),e.jsx(r,{variant:"body2",children:P(v.end_date)})]})}),e.jsx(x,{children:e.jsx(ne,{size:"small",color:"primary",onClick:()=>S(v),title:"Edit Dates",children:e.jsx(ht,{fontSize:"small"})})})]},v.id))})]})})}),e.jsx(Tu,{open:d.open,onClose:T,onSave:g,initialStartDate:d.startDate,initialEndDate:d.endDate,activity:d.activity}),e.jsx(dt,{open:s,autoHideDuration:4e3,onClose:()=>a(!1),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ae,{severity:"success",onClose:()=>a(!1),children:d.open?"Dates updated successfully!":"Efforts generated successfully!"})}),e.jsx(dt,{open:!!i,autoHideDuration:6e3,onClose:()=>l(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(ae,{severity:"error",onClose:()=>l(""),children:i})})]}):e.jsx(ae,{severity:"warning",children:"Please select a project to view planning details."})},Sn=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`management-tabpanel-${a}`,"aria-labelledby":`management-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{p:0},children:t})}),Pu=()=>{const[t,s]=Ke.useState(0),{selectedProject:a}=ke(d=>d.app),i=(d,c)=>{s(c)},l=d=>d?new Date(d).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}):"N/A";return a?e.jsxs(n,{sx:{pt:"5px",px:"10px",pb:"10px"},children:[e.jsxs(Mt,{value:t,onChange:i,"aria-label":"management tabs",sx:{borderBottom:1,borderColor:"divider",mb:2,"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Estimation",id:"management-tab-0","aria-controls":"management-tabpanel-0"}),e.jsx(He,{label:"Planning",id:"management-tab-1","aria-controls":"management-tabpanel-1"})]}),e.jsx(Sn,{value:t,index:0,children:e.jsxs(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:[e.jsx(n,{sx:{mb:3},children:e.jsxs(j,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(r,{variant:"h5",component:"h2",fontWeight:"bold",color:"primary",sx:{fontSize:"16px"},children:["Project Name: ",a.project_name||a.name]})}),e.jsx(j,{item:!0,xs:12,md:9,children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Project Owner: ",a.owner_name||"gauri06"]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Start Date: ",l(a.start_date)]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["End Date: ",l(a.end_date)]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Account: ",a.account_name||"Data"]})})]})})]})}),e.jsx(it,{sx:{mb:3}}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,lg:6,children:e.jsx(Su,{})}),e.jsx(j,{item:!0,xs:12,lg:6,children:e.jsx(wu,{})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(Cu,{})})]})]})}),e.jsx(Sn,{value:t,index:1,children:e.jsxs(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:[e.jsx(n,{sx:{mb:3},children:e.jsxs(j,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(r,{variant:"h5",component:"h2",fontWeight:"bold",color:"primary",sx:{fontSize:"16px"},children:["Project Name: ",a.project_name||a.name]})}),e.jsx(j,{item:!0,xs:12,md:9,children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Project Owner: ",a.owner_name||"gauri06"]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Start Date: ",l(a.start_date)]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["End Date: ",l(a.end_date)]})}),e.jsx(j,{item:!0,xs:6,md:3,children:e.jsxs(r,{variant:"body1",fontWeight:"medium",sx:{fontSize:"16px"},children:["Account: ",a.account_name||"Data"]})})]})})]})}),e.jsx(it,{sx:{mb:3}}),e.jsx(Iu,{})]})})]}):e.jsx(n,{sx:{p:3},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"Please select a project to view management details."})})},Ru=({open:t,account:s,onClose:a,onSave:i})=>{const[l,d]=o.useState({name:""}),[c,u]=o.useState({});o.useEffect(()=>{d({name:s?.name||""}),u({})},[s,t]);const f=()=>{const p={};return l.name.trim()?l.name.trim().length<2&&(p.name="Account name must be at least 2 characters"):p.name="Account name is required",u(p),Object.keys(p).length===0},y=()=>{s&&f()&&i({name:l.name.trim()})},h=p=>{d({name:p}),c.name&&u({})};return e.jsx(Et,{anchor:"right",open:t,onClose:a,sx:{zIndex:p=>p.zIndex.drawer+3,"& .MuiDrawer-paper":{width:420,boxSizing:"border-box",height:"100vh",top:0}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)"}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(r,{fontWeight:600,children:"Edit Account Name"}),e.jsx(ne,{onClick:a,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{flexGrow:1,children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ae,{severity:"info",children:"The account name is used across the platform."})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Account Name",value:l.name,onChange:p=>h(p.target.value),fullWidth:!0,required:!0,error:!!c.name,helperText:c.name,placeholder:"Enter account name"})})]})}),e.jsxs(n,{display:"flex",justifyContent:"flex-end",gap:2,mt:3,children:[e.jsx(H,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(hs,{}),onClick:y,disabled:!l.name.trim(),children:"Update Account"})]})]})})},Du=t=>({id:t.project_id,name:t.project_name,description:t.description,status:t.status,project_id:t.project_id,project_name:t.project_name,account_name:t.account_name,active:t.active,start_date:t.start_date,end_date:t.end_date,client:t.client,client_website:t.client_website,business_function:t.business_function,project_type:t.project_type,owner_id:t.owner_id,owner_name:t.owner_name,project_manager:t.project_manager,created_date:t.created_date,modified_date:t.modified_date,created_by:t.created_by,modified_by:t.modified_by,is_deleted:t.is_deleted,tenant_key:t.tenant_key,user_count:t.user_count}),Eu=()=>{const[t,s]=o.useState(!1),[a,i]=o.useState(0),[l,d]=o.useState(5),[c,u]=o.useState({open:!1,message:"",severity:"success"}),{data:f,isLoading:y,error:h,refetch:p}=Xr(),{data:m,isLoading:S,error:T}=Yl(),{data:g=[],isLoading:P,error:$}=ri(),[V]=Jl(),v=g.map(Du),q=(b,F)=>{i(F)},w=b=>{d(parseInt(b.target.value,10)),i(0)},O=async b=>{try{await V(b).unwrap(),u({open:!0,message:"Account updated successfully",severity:"success"}),s(!1),p()}catch{u({open:!0,message:"Failed to update account",severity:"error"})}},N=()=>{u({...c,open:!1})},R=b=>new Date(b).toLocaleDateString("en-US",{day:"2-digit",month:"2-digit",year:"numeric"}),W=v.slice(a*l,a*l+l);return y?e.jsx(n,{sx:{p:1,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px"},children:e.jsx(ie,{})}):h?e.jsx(n,{sx:{p:1},children:e.jsx(ae,{severity:"error",children:"Failed to load account information."})}):e.jsxs(n,{sx:{p:1,minHeight:"100vh"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:1,gap:1},children:[e.jsx(r,{variant:"h5",component:"h1",fontWeight:"600",sx:{color:"#1a1a1a"},children:"SETUP: Account Information"}),e.jsx(ne,{size:"small",sx:{ml:"auto"},children:e.jsx(gs,{sx:{color:"#666"}})})]}),e.jsx(me,{elevation:0,sx:{p:1,mb:1,borderRadius:2,border:"1px solid #e0e0e0",bgcolor:"#ffffff"},children:e.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3},children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:{xs:"100%",md:200},pb:{xs:2,md:0},pr:{xs:0,md:3},borderRight:{xs:"none",md:"1px solid #e0e0e0"},borderBottom:{xs:"1px solid #e0e0e0",md:"none"}},children:[e.jsx(r,{variant:"caption",sx:{color:"#666",mb:2,fontWeight:500},children:"Company Logo"}),e.jsx(cs,{sx:{width:80,height:80,bgcolor:"#ffffff",border:"2px solid #1976d2"},children:e.jsx(r,{sx:{color:"#1976d2",fontWeight:600,fontSize:"1.2rem"},children:"LOGONAME"})})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,flexWrap:"wrap",gap:1},children:[e.jsx(r,{variant:"h6",fontWeight:"600",sx:{color:"#1a1a1a"},children:"Account Information"}),e.jsx(H,{variant:"contained",size:"small",startIcon:e.jsx(ht,{}),onClick:()=>s(!0),sx:{textTransform:"none",borderRadius:1,px:2},children:"Edit Account"})]}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,sm:6,md:4,children:[e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Account Name:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a",mb:2.5},children:f?.name})]}),e.jsx(it,{sx:{my:2}}),e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Account Owner:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a"},children:f?.owner})]})]}),e.jsx(j,{item:!0,xs:12,sm:6,md:"auto",sx:{display:{xs:"none",md:"flex"}},children:e.jsx(it,{orientation:"vertical",flexItem:!0})}),e.jsxs(j,{item:!0,xs:12,sm:6,md:3.5,children:[e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Created Date:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a",mb:2.5},children:f?R(f.created_date):"N/A"})]}),e.jsx(it,{sx:{my:2}}),e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Created By:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a"},children:f?.created_by})]})]}),e.jsx(j,{item:!0,xs:12,sm:6,md:"auto",sx:{display:{xs:"none",md:"flex"}},children:e.jsx(it,{orientation:"vertical",flexItem:!0})}),e.jsxs(j,{item:!0,xs:12,sm:6,md:3.5,children:[e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Last Modified Date:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a",mb:2.5},children:f?R(f.modified_date):"N/A"})]}),e.jsx(it,{sx:{my:2}}),e.jsxs(n,{children:[e.jsx(r,{variant:"caption",sx:{color:"#666",display:"block",mb:.5,fontWeight:500},children:"Last Modified By:"}),e.jsx(r,{variant:"body2",fontWeight:"500",sx:{color:"#1a1a1a"},children:f?.modified_by})]})]})]})]})]})}),S?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:3},children:e.jsx(ie,{size:30})}):T?e.jsx(ae,{severity:"error",sx:{mb:3},children:"Failed to load summary data."}):e.jsxs(j,{container:!0,spacing:1,sx:{mb:1},children:[e.jsx(j,{item:!0,xs:6,sm:6,md:3,children:e.jsx(De,{elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2,bgcolor:"#ffffff"},children:e.jsx(Ee,{sx:{p:2.5,"&:last-child":{pb:2.5}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{p:1.5,borderRadius:1.5,bgcolor:"#e3f2fd",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Bn,{sx:{fontSize:28,color:"#1976d2"}})}),e.jsxs(n,{children:[e.jsx(r,{variant:"h4",fontWeight:"700",sx:{color:"#1a1a1a",mb:.5},children:m?.project_count||0}),e.jsx(r,{variant:"body2",sx:{color:"#666"},children:"Project Count"})]})]})})})}),e.jsx(j,{item:!0,xs:6,sm:6,md:3,children:e.jsx(De,{elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2,bgcolor:"#ffffff"},children:e.jsx(Ee,{sx:{p:2.5,"&:last-child":{pb:2.5}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{p:1.5,borderRadius:1.5,bgcolor:"#fff3e0",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(mt,{sx:{fontSize:28,color:"#f57c00"}})}),e.jsxs(n,{children:[e.jsx(r,{variant:"h4",fontWeight:"700",sx:{color:"#1a1a1a",mb:.5},children:m?.active_project_count||0}),e.jsx(r,{variant:"body2",sx:{color:"#666"},children:"Active Project Count"})]})]})})})}),e.jsx(j,{item:!0,xs:6,sm:6,md:3,children:e.jsx(De,{elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2,bgcolor:"#ffffff"},children:e.jsx(Ee,{sx:{p:2.5,"&:last-child":{pb:2.5}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{p:1.5,borderRadius:1.5,bgcolor:"#e0f7fa",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ko,{sx:{fontSize:28,color:"#00acc1"}})}),e.jsxs(n,{children:[e.jsx(r,{variant:"h4",fontWeight:"700",sx:{color:"#1a1a1a",mb:.5},children:m?.user_count||0}),e.jsx(r,{variant:"body2",sx:{color:"#666"},children:"User Count"})]})]})})})}),e.jsx(j,{item:!0,xs:6,sm:6,md:3,children:e.jsx(De,{elevation:0,sx:{border:"1px solid #e0e0e0",borderRadius:2,bgcolor:"#ffffff"},children:e.jsx(Ee,{sx:{p:2.5,"&:last-child":{pb:2.5}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(n,{sx:{p:1.5,borderRadius:1.5,bgcolor:"#fce4ec",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(wo,{sx:{fontSize:28,color:"#c2185b"}})}),e.jsxs(n,{children:[e.jsx(r,{variant:"h4",fontWeight:"700",sx:{color:"#1a1a1a",mb:.5},children:m?.user_active_count||0}),e.jsx(r,{variant:"body2",sx:{color:"#666"},children:"Active User Count"})]})]})})})})]}),e.jsxs(me,{elevation:0,sx:{borderRadius:2,border:"1px solid #e0e0e0",bgcolor:"#ffffff",overflow:"hidden"},children:[e.jsx(n,{sx:{p:1,borderBottom:"1px solid #e0e0e0"},children:e.jsx(r,{variant:"h6",fontWeight:"600",sx:{color:"#1a1a1a"},children:"Projects"})}),P?e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:1},children:e.jsx(ie,{size:30})}):$?e.jsx(ae,{severity:"error",sx:{m:1},children:"Failed to load projects."}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{children:e.jsxs(Je,{sx:{minWidth:{xs:600,md:"auto"}},children:[e.jsx(Xe,{children:e.jsxs(pe,{sx:{bgcolor:"#fafafa"},children:[e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Project Name"}),e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Project Type"}),e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Owner"}),e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Client"}),e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Client Website"}),e.jsx(x,{sx:{fontWeight:600,color:"#666",fontSize:"0.875rem",py:2},children:"Business Function"})]})}),e.jsx(Ye,{children:W.length===0?e.jsx(pe,{children:e.jsx(x,{colSpan:6,align:"center",sx:{py:1},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No projects found"})})}):W.map((b,F)=>e.jsxs(pe,{sx:{"&:hover":{bgcolor:"#f5f5f5"},borderBottom:F===W.length-1?"none":"1px solid #e0e0e0"},children:[e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.name||b.project_name}),e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.project_type}),e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.owner_name}),e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.client||"N/A"}),e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.client_website||"N/A"}),e.jsx(x,{sx:{py:2,color:"#1a1a1a",fontSize:"0.875rem"},children:b.business_function||"N/A"})]},b.id))})]})}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",p:1,borderTop:"1px solid #e0e0e0",flexWrap:"wrap",gap:2},children:[e.jsxs(r,{variant:"body2",sx:{color:"#666"},children:["Showing ",a*l+1," - ",Math.min((a+1)*l,v.length)," of ",v.length," results"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",sx:{color:"#666"},children:"Project Per Page:"}),e.jsxs("select",{value:l,onChange:w,style:{padding:"6px 32px 6px 12px",border:"1px solid #00acc1",borderRadius:"4px",backgroundColor:"white",color:"#00acc1",fontSize:"14px",cursor:"pointer",outline:"none",appearance:"none",backgroundImage:`url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300acc1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e")`,backgroundRepeat:"no-repeat",backgroundPosition:"right 8px center",backgroundSize:"16px"},children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{onClick:b=>q(b,a-1),disabled:a===0,size:"small",sx:{border:"1px solid #e0e0e0",borderRadius:1,width:32,height:32,"&:disabled":{opacity:.3}},children:e.jsx(r,{sx:{fontSize:"18px",color:"#666"},children:"‚Äπ"})}),[...Array(Math.ceil(v.length/l))].map((b,F)=>e.jsx(H,{onClick:G=>q(G,F),variant:a===F?"contained":"outlined",size:"small",sx:{minWidth:32,width:32,height:32,p:0,border:"1px solid",borderColor:a===F?"#00acc1":"#e0e0e0",bgcolor:a===F?"#00acc1":"white",color:a===F?"white":"#666",borderRadius:1,"&:hover":{bgcolor:a===F?"#00acc1":"#f5f5f5",borderColor:a===F?"#00acc1":"#e0e0e0"}},children:F+1},F)),e.jsx(ne,{onClick:b=>q(b,a+1),disabled:a>=Math.ceil(v.length/l)-1,size:"small",sx:{border:"1px solid #e0e0e0",borderRadius:1,width:32,height:32,"&:disabled":{opacity:.3}},children:e.jsx(r,{sx:{fontSize:"18px",color:"#666"},children:"‚Ä∫"})})]})]})]})]})]}),e.jsx(Ru,{open:t,account:f||null,onClose:()=>s(!1),onSave:O}),e.jsx(dt,{open:c.open,autoHideDuration:4e3,onClose:N,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:N,severity:c.severity,sx:{width:"100%"},children:c.message})})]})},Fu=[{id:"admin",name:"Admin"},{id:"user",name:"User"}],Au=({open:t,onClose:s,onSave:a})=>{const[i,l]=o.useState({email:"",role:"user"}),[d,c]=o.useState({});o.useEffect(()=>{l({email:"",role:"user"}),c({})},[t]);const u=()=>{const p={};return i.email.trim()?/\S+@\S+\.\S+/.test(i.email)||(p.email="Please enter a valid email address"):p.email="Email is required",i.role||(p.role="Role is required"),c(p),Object.keys(p).length===0},f=()=>{u()&&a(i)},y=(p,m)=>{l(S=>({...S,[p]:m})),d[p]&&c(S=>({...S,[p]:""}))};return e.jsx(Et,{anchor:"right",open:t,onClose:s,sx:{zIndex:p=>p.zIndex.drawer+3,"& .MuiDrawer-paper":{width:500,boxSizing:"border-box",height:"100vh",top:0,zIndex:p=>p.zIndex.drawer+3}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:p=>p.zIndex.drawer+2}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",marginTop:"64px",height:"calc(100vh - 64px)",overflow:"auto"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:"Invite User"}),e.jsx(ne,{onClick:s,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ae,{severity:"info",sx:{mb:2},children:e.jsx(r,{variant:"body2",children:"Enter email address to invite user to this account"})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Email Address",value:i.email,onChange:p=>y("email",p.target.value),fullWidth:!0,required:!0,error:!!d.email,helperText:d.email,placeholder:"Enter email address"})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!d.role,children:[e.jsx(Me,{children:"Role"}),e.jsx(We,{value:i.role,label:"Role",onChange:p=>y("role",p.target.value),children:Fu.map(p=>e.jsx(re,{value:p.id,children:p.name},p.id))}),d.role&&e.jsx(r,{variant:"caption",color:"error",children:d.role})]})})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(H,{onClick:s,variant:"outlined",children:"Cancel"}),e.jsx(H,{onClick:f,variant:"contained",startIcon:e.jsx(hs,{}),disabled:!i.email||!i.role,children:"Send Invitation"})]})]})})},Wu=[{id:"admin",name:"Admin"},{id:"user",name:"User"}],zu=[{id:"active",name:"Active"},{id:"inactive",name:"Inactive"},{id:"rejected",name:"Rejected"}],Ou=t=>t==="active"||t==="inactive"||t==="rejected",Mu=t=>Ou(t)?t:"active",Lu=({open:t,user:s,onClose:a,onSave:i})=>{const[l,d]=o.useState({first_name:"",last_name:"",username:"",email:"",phone_no:"",role:"user",status:"active",mfa_active:!1}),[c,u]=o.useState({});o.useEffect(()=>{d(s?{first_name:s.first_name||"",last_name:s.last_name||"",username:s.username||"",email:s.email||"",phone_no:s.phone_no||"",role:s.role||"user",status:Mu(s.status),mfa_active:s.mfa_active||!1}:{first_name:"",last_name:"",username:"",email:"",phone_no:"",role:"user",status:"active",mfa_active:!1}),u({})},[s,t]);const f=()=>{const p={};return l.first_name.trim()||(p.first_name="First name is required"),l.last_name.trim()||(p.last_name="Last name is required"),l.username.trim()||(p.username="Username is required"),l.email.trim()?/\S+@\S+\.\S+/.test(l.email)||(p.email="Enter a valid email"):p.email="Email is required",l.role||(p.role="Role is required"),l.status||(p.status="Status is required"),u(p),Object.keys(p).length===0},y=()=>{s&&f()&&i({id:s.id,...l})},h=(p,m)=>{d(S=>({...S,[p]:m})),c[p]&&u(S=>({...S,[p]:""}))};return e.jsx(Et,{anchor:"right",open:t,onClose:a,sx:{zIndex:p=>p.zIndex.drawer+3,"& .MuiDrawer-paper":{width:500,boxSizing:"border-box",height:"100vh",top:0}},BackdropProps:{sx:{backgroundColor:"rgba(0,0,0,0.7)"}},children:e.jsxs(n,{p:3,display:"flex",flexDirection:"column",height:"100%",children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(r,{fontWeight:600,children:"Edit User"}),e.jsx(ne,{onClick:a,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{flexGrow:1,children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:6,children:e.jsx(ye,{label:"First Name",value:l.first_name,onChange:p=>h("first_name",p.target.value),fullWidth:!0,required:!0,error:!!c.first_name,helperText:c.first_name})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(ye,{label:"Last Name",value:l.last_name,onChange:p=>h("last_name",p.target.value),fullWidth:!0,required:!0,error:!!c.last_name,helperText:c.last_name})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(ye,{label:"Username",value:l.username,onChange:p=>h("username",p.target.value),fullWidth:!0,required:!0,error:!!c.username,helperText:c.username})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(ye,{label:"Email",value:l.email,onChange:p=>h("email",p.target.value),fullWidth:!0,required:!0,error:!!c.email,helperText:c.email})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(ye,{label:"Phone Number",value:l.phone_no,onChange:p=>h("phone_no",p.target.value),fullWidth:!0})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!c.role,children:[e.jsx(Me,{children:"Role"}),e.jsx(We,{value:l.role,label:"Role",onChange:p=>h("role",p.target.value),children:Wu.map(p=>e.jsx(re,{value:p.id,children:p.name},p.id))})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!c.status,children:[e.jsx(Me,{children:"Status"}),e.jsx(We,{value:l.status,label:"Status",onChange:p=>h("status",p.target.value),children:zu.map(p=>e.jsx(re,{value:p.id,children:p.name},p.id))})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsx(nt,{control:e.jsx(or,{checked:l.mfa_active,onChange:p=>h("mfa_active",p.target.checked)}),label:"MFA Active"})})]})}),e.jsxs(n,{display:"flex",justifyContent:"flex-end",gap:2,mt:3,children:[e.jsx(H,{variant:"outlined",onClick:a,children:"Cancel"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(hs,{}),onClick:y,disabled:!s,children:"Update User"})]})]})})},$u=()=>{const[t,s]=o.useState(0),[a,i]=o.useState(5),[l,d]=o.useState(!1),[c,u]=o.useState(!1),[f,y]=o.useState(null),[h,p]=o.useState({open:!1,message:"",severity:"success"}),{data:m=[],isLoading:S,error:T,refetch:g}=Vl(),[P]=Hl(),[$]=Zl(),[V]=Ql(),v=m.filter(C=>!C.is_deleted),q=v.slice(t*a,t*a+a),w=C=>{i(parseInt(C.target.value,10)),s(0)},O=()=>s(0),N=()=>s(C=>Math.max(C-1,0)),R=()=>s(C=>Math.min(C+1,Math.ceil(v.length/a)-1)),W=()=>s(Math.ceil(v.length/a)-1),b=async C=>{try{await P(C).unwrap(),p({open:!0,message:"User invitation sent successfully",severity:"success"}),d(!1),g()}catch{p({open:!0,message:"Failed to send invitation",severity:"error"})}},F=C=>{y(C),u(!0)},G=async C=>{try{await $(C).unwrap(),p({open:!0,message:"User updated successfully",severity:"success"}),u(!1),y(null),g()}catch{p({open:!0,message:"Failed to update user",severity:"error"})}},E=async C=>{if(window.confirm("Are you sure you want to delete this user?"))try{await V(C).unwrap(),p({open:!0,message:"User deleted successfully",severity:"success"}),g()}catch{p({open:!0,message:"Failed to delete user",severity:"error"})}},_=()=>{p({...h,open:!1})},D=C=>new Date(C).toLocaleDateString();return S?e.jsx(n,{sx:{p:1,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(ie,{})}):T?e.jsx(n,{sx:{p:1},children:e.jsx(ae,{severity:"error",children:"Failed to load users. Please try again."})}):e.jsxs(n,{sx:{p:1},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"User Management"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:3,children:e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Users Overview"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage system users and permissions"})]}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:()=>d(!0),children:"Invite User"})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(me,{elevation:2,children:[e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Username"}),e.jsx(x,{children:"Email"}),e.jsx(x,{children:"Phone"}),e.jsx(x,{children:"Role"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"MFA"}),e.jsx(x,{children:"Last Login"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:q.map(C=>e.jsxs(pe,{sx:{"&:hover":{backgroundColor:"action.hover"}},children:[e.jsxs(x,{children:[e.jsx(r,{fontWeight:"medium",children:C.username}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:[C.firstname," ",C.lastname]})]}),e.jsx(x,{children:C.email}),e.jsx(x,{children:C.phone_no||"N/A"}),e.jsx(x,{children:e.jsx(X,{label:C.role,size:"small",color:C.role==="admin"?"error":"primary",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:C.status,size:"small",color:C.status==="active"?"success":C.status==="inactive"?"default":"error"})}),e.jsx(x,{children:e.jsx(X,{label:C.mfa_active?"Enabled":"Disabled",size:"small",color:C.mfa_active?"success":"default",variant:"outlined"})}),e.jsx(x,{children:C.is_logged_in==="Yes"?"Online":D(C.modified_date)}),e.jsxs(x,{children:[e.jsx(je,{title:"Edit User",children:e.jsx(ne,{size:"small",color:"primary",onClick:()=>F(C),children:e.jsx(ht,{})})}),e.jsx(je,{title:"Delete User",children:e.jsx(ne,{size:"small",color:"error",onClick:()=>E(C.id),children:e.jsx(ds,{})})})]})]},C.id))})]})}),v.length===0&&e.jsxs(n,{sx:{p:1,textAlign:"center"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"No users found"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'Click "Invite User" to add your first user'})]}),v.length>0&&e.jsxs(n,{sx:{p:1,display:"flex",justifyContent:"space-between",alignItems:"center",borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsx(Ae,{size:"small",sx:{minWidth:80},children:e.jsxs(We,{value:a.toString(),onChange:w,displayEmpty:!0,children:[e.jsx(re,{value:5,children:"5"}),e.jsx(re,{value:10,children:"10"}),e.jsx(re,{value:25,children:"25"}),e.jsx(re,{value:50,children:"50"})]})})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[t*a+1,"-",Math.min((t+1)*a,v.length)," of ",v.length]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{title:"First Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:O,disabled:t===0,size:"small",children:e.jsx(Nn,{})})})}),e.jsx(je,{title:"Previous Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:N,disabled:t===0,size:"small",children:e.jsx(Gn,{})})})}),e.jsx(je,{title:"Next Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:R,disabled:t>=Math.ceil(v.length/a)-1,size:"small",children:e.jsx(Vn,{})})})}),e.jsx(je,{title:"Last Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:W,disabled:t>=Math.ceil(v.length/a)-1,size:"small",children:e.jsx(Hn,{})})})})]})]})]})})]}),e.jsx(Au,{open:l,onClose:()=>d(!1),onSave:b}),e.jsx(Lu,{open:c,user:f,onClose:()=>{u(!1),y(null)},onSave:G}),e.jsx(dt,{open:h.open,autoHideDuration:4e3,onClose:_,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:_,severity:h.severity,children:h.message})})]})},qu=({open:t,project:s,onClose:a,onSave:i})=>{const[l,d]=o.useState({project_name:"",description:"",status:"InProgress",start_date:"",end_date:"",client:"",client_website:"",business_function:"",project_type:"migration"}),[c,u]=o.useState({});o.useEffect(()=>{d(s?{project_name:s.name||s.project_name||"",description:s.description||"",status:s.status||"InProgress",start_date:s.start_date||"",end_date:s.end_date||"",client:s.client||"",client_website:s.client_website||"",business_function:s.business_function||"",project_type:s.project_type||"migration"}:{project_name:"",description:"",status:"InProgress",start_date:"",end_date:"",client:"",client_website:"",business_function:"",project_type:"migration"}),u({})},[s,t]);const f=()=>{const m={};return l.project_name.trim()||(m.project_name="Project name is required"),l.client.trim()||(m.client="Client name is required"),l.start_date||(m.start_date="Start date is required"),l.end_date&&new Date(l.end_date)<new Date(l.start_date)&&(m.end_date="End date cannot be before start date"),u(m),Object.keys(m).length===0},y=()=>{f()&&i(l)},h=(m,S)=>{d(T=>({...T,[m]:S})),c[m]&&u(T=>({...T,[m]:""}))};return e.jsx(Ut,{open:t,onClose:a,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:m=>m.zIndex.modal},children:e.jsx(me,{sx:{width:600,height:"100vh",margin:0,borderRadius:0,overflow:"auto",boxShadow:24},children:e.jsxs(n,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:s?"Edit Project":"Add New Project"}),e.jsx(ne,{onClick:a,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Project Name",value:l.project_name,onChange:m=>h("project_name",m.target.value),fullWidth:!0,required:!0,error:!!c.project_name,helperText:c.project_name})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Description",value:l.description,onChange:m=>h("description",m.target.value),fullWidth:!0,multiline:!0,rows:3})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Status"}),e.jsxs(We,{value:l.status,label:"Status",onChange:m=>h("status",m.target.value),children:[e.jsx(re,{value:"InProgress",children:"In Progress"}),e.jsx(re,{value:"Active",children:"Active"}),e.jsx(re,{value:"Completed",children:"Completed"}),e.jsx(re,{value:"OnHold",children:"On Hold"})]})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"Start Date",type:"date",value:l.start_date,onChange:m=>h("start_date",m.target.value),fullWidth:!0,InputLabelProps:{shrink:!0},error:!!c.start_date,helperText:c.start_date})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"End Date",type:"date",value:l.end_date,onChange:m=>h("end_date",m.target.value),fullWidth:!0,InputLabelProps:{shrink:!0},error:!!c.end_date,helperText:c.end_date})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"Client",value:l.client,onChange:m=>h("client",m.target.value),fullWidth:!0,required:!0,error:!!c.client,helperText:c.client})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"Client Website",value:l.client_website,onChange:m=>h("client_website",m.target.value),fullWidth:!0})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"Business Function",value:l.business_function,onChange:m=>h("business_function",m.target.value),fullWidth:!0})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Project Type"}),e.jsxs(We,{value:l.project_type,label:"Project Type",onChange:m=>h("project_type",m.target.value),children:[e.jsx(re,{value:"migration",children:"Migration"}),e.jsx(re,{value:"backup",children:"Backup"}),e.jsx(re,{value:"translation",children:"Translation"}),e.jsx(re,{value:"file migration",children:"File Migration"})]})]})})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(H,{onClick:a,variant:"outlined",children:"Cancel"}),e.jsxs(H,{onClick:y,variant:"contained",startIcon:e.jsx(hs,{}),children:[s?"Update":"Create"," Project"]})]})]})})})},Uu=({open:t,system:s,projectId:a,onClose:i,onSave:l,isLoading:d=!1})=>{const[c,u]=o.useState({name:"",type:"source",project:a}),[f,y]=o.useState({});o.useEffect(()=>{u(s?{name:s.name||"",type:s.type||"source",project:a}:{name:"",type:"source",project:a}),y({})},[s,a,t]);const h=()=>{const T={};return c.name.trim()||(T.name="System name is required"),c.type||(T.type="System type is required"),y(T),Object.keys(T).length===0},p=()=>{h()&&l(c)},m=(T,g)=>{u(P=>({...P,[T]:g})),f[T]&&y(P=>({...P,[T]:""}))};return e.jsx(Et,{anchor:"right",open:t,onClose:i,sx:{zIndex:T=>T.zIndex.drawer+3,"& .MuiDrawer-paper":{width:500,boxSizing:"border-box",height:"100vh",top:0,zIndex:T=>T.zIndex.drawer+3}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:T=>T.zIndex.drawer+2}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",marginTop:"64px",height:"calc(100vh - 64px)",overflow:"auto"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:s?"Edit System":"Add New System"}),e.jsx(ne,{onClick:i,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"System Name",value:c.name,onChange:T=>m("name",T.target.value),fullWidth:!0,required:!0,error:!!f.name,helperText:f.name})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!f.type,children:[e.jsx(Me,{children:"System Type"}),e.jsxs(We,{value:c.type,label:"System Type",onChange:T=>m("type",T.target.value),children:[e.jsx(re,{value:"source",children:"Source"}),e.jsx(re,{value:"target",children:"Target"})]}),f.type&&e.jsx(r,{variant:"caption",color:"error",children:f.type})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Project ID:"})," ",a]})})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(H,{onClick:i,variant:"outlined",children:"Cancel"}),e.jsxs(H,{onClick:p,variant:"contained",startIcon:d?e.jsx(ie,{size:20}):e.jsx(hs,{}),disabled:d,children:[s?"Update":"Create"," System"]})]})]})})},Bu=({open:t,environment:s,projectId:a,onClose:i,onSave:l,isLoading:d=!1})=>{const[c,u]=o.useState({name:"",type:"dev",is_prod:!1,project:a}),[f,y]=o.useState({});o.useEffect(()=>{u(s?{name:s.name||"",type:s.type||"dev",is_prod:s.is_prod||!1,project:a}:{name:"",type:"dev",is_prod:!1,project:a}),y({})},[s,a,t]);const h=()=>{const T={};return c.name.trim()||(T.name="Environment name is required"),c.type||(T.type="Environment type is required"),y(T),Object.keys(T).length===0},p=()=>{h()&&l(c)},m=(T,g)=>{u(P=>({...P,[T]:g})),f[T]&&y(P=>({...P,[T]:""}))};return e.jsx(Et,{anchor:"right",open:t,onClose:i,sx:{zIndex:T=>T.zIndex.drawer+3,"& .MuiDrawer-paper":{width:500,boxSizing:"border-box",height:"100vh",top:0,zIndex:T=>T.zIndex.drawer+3}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:T=>T.zIndex.drawer+2}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",marginTop:"64px",height:"calc(100vh - 64px)",overflow:"auto"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:s?"Edit Environment":"Add New Environment"}),e.jsx(ne,{onClick:i,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Environment Name",value:c.name,onChange:T=>m("name",T.target.value),fullWidth:!0,required:!0,error:!!f.name,helperText:f.name})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!f.type,children:[e.jsx(Me,{children:"Environment Type"}),e.jsxs(We,{value:c.type,label:"Environment Type",onChange:T=>m("type",T.target.value),children:[e.jsx(re,{value:"dev",children:"Development"}),e.jsx(re,{value:"qa",children:"QA"}),e.jsx(re,{value:"staging",children:"Staging"}),e.jsx(re,{value:"prod",children:"Production"}),e.jsx(re,{value:"test",children:"Test"})]}),f.type&&e.jsx(r,{variant:"caption",color:"error",children:f.type})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(nt,{control:e.jsx(rs,{checked:c.is_prod,onChange:T=>m("is_prod",T.target.checked),color:"primary"}),label:"Is Production Environment"})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Project ID:"})," ",a]})})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(H,{onClick:i,variant:"outlined",children:"Cancel"}),e.jsxs(H,{onClick:p,variant:"contained",startIcon:d?e.jsx(ie,{size:20}):e.jsx(hs,{}),disabled:d,children:[s?"Update":"Create"," Environment"]})]})]})})},Nu=[{id:"admin",name:"Admin"},{id:"user",name:"User"},{id:"viewer",name:"Viewer"}],Gu=({open:t,projectId:s,existingUsers:a,onClose:i,onSave:l})=>{const[d,c]=o.useState({user_id:"",role_id:"user"}),[u,f]=o.useState({}),[y,h]=o.useState(null),{data:p=[],isLoading:m,error:S,refetch:T}=Kr();o.useEffect(()=>{p&&p.length>0&&console.log("System Users:",p),S&&console.error("System Users API Error:",S)},[p,S]),o.useEffect(()=>{c({user_id:"",role_id:"user"}),h(null),f({})},[t]),o.useEffect(()=>{t&&T()},[t,T]);const g=()=>{const w={};return d.user_id?a.some(N=>N.user_id===d.user_id)&&(w.user_id="This user is already added to the project"):w.user_id="User is required",d.role_id||(w.role_id="Role is required"),f(w),Object.keys(w).length===0},P=()=>{if(g()){const w={...d,project_id:s};l(w)}},$=(w,O)=>{console.log("Selected user:",O),h(O),c(N=>({...N,user_id:O?.id||""})),u.user_id&&f(N=>({...N,user_id:""}))},V=w=>{c(O=>({...O,role_id:w})),u.role_id&&f(O=>({...O,role_id:""}))},v=p.filter(w=>!a.some(O=>O.user_id===w.id)&&w.status==="active"&&!w.is_deleted);return console.log("Available users:",v),console.log("Existing users:",a),console.log("All system users:",p),e.jsx(Et,{anchor:"right",open:t,onClose:i,sx:{zIndex:w=>w.zIndex.drawer+3,"& .MuiDrawer-paper":{width:500,boxSizing:"border-box",height:"100vh",top:0,zIndex:w=>w.zIndex.drawer+3}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:w=>w.zIndex.drawer+2}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",marginTop:"64px",height:"calc(100vh - 64px)",overflow:"auto"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:"Add User to Project"}),e.jsx(ne,{onClick:i,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Select a user to add to this project. Only active users not already added to the project are shown."})}),e.jsx(j,{item:!0,xs:12,children:m?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,p:2},children:[e.jsx(ie,{size:20}),e.jsx(r,{variant:"body2",children:"Loading users..."})]}):S?e.jsxs(ae,{severity:"error",sx:{mb:2},children:["Failed to load users. Please try again.",e.jsx(H,{size:"small",onClick:T,sx:{ml:1},children:"Retry"})]}):v.length===0?e.jsx(ae,{severity:"warning",sx:{mb:2},children:p.length===0?"No users found in the system.":"All available users are already added to this project."}):e.jsx(Un,{options:v,getOptionLabel:w=>`${w.firstname} ${w.lastname} (${w.email}) - ${w.username}`.trim(),value:y,onChange:$,renderInput:w=>e.jsx(ye,{...w,label:"Select User",required:!0,error:!!u.user_id,helperText:u.user_id,placeholder:"Type to search users..."}),isOptionEqualToValue:(w,O)=>w.id===O.id,renderOption:(w,O)=>e.jsx("li",{...w,children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column"},children:[e.jsxs(r,{variant:"body2",children:[O.firstname," ",O.lastname]}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:[O.email," ‚Ä¢ ",O.username," ‚Ä¢ ",O.role]}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["ID: ",O.id]})]})})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!u.role_id,children:[e.jsx(Me,{children:"Role"}),e.jsx(We,{value:d.role_id,label:"Role",onChange:w=>V(w.target.value),children:Nu.map(w=>e.jsx(re,{value:w.id,children:w.name},w.id))}),u.role_id&&e.jsx(r,{variant:"caption",color:"error",children:u.role_id})]})}),y&&e.jsx(j,{item:!0,xs:12,children:e.jsxs(n,{sx:{p:2,backgroundColor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Selected User Details:"}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Name:"}),e.jsxs(r,{variant:"body2",children:[y.firstname," ",y.lastname]})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Username:"}),e.jsx(r,{variant:"body2",children:y.username})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Email:"}),e.jsx(r,{variant:"body2",children:y.email})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Current Role:"}),e.jsx(r,{variant:"body2",children:y.role})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"User ID:"}),e.jsx(r,{variant:"body2",fontFamily:"monospace",children:y.id})]})]})]})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Project ID:"})," ",s]})})]})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,justifyContent:"flex-end"},children:[e.jsx(H,{onClick:i,variant:"outlined",children:"Cancel"}),e.jsx(H,{onClick:P,variant:"contained",startIcon:e.jsx(hs,{}),disabled:!d.user_id||!d.role_id||m||v.length===0,children:"Add User"})]})]})})},Vu=()=>{xt(),Ct();const{selectedProject:t}=ke(ee=>ee.app),{user:s}=ke(ee=>ee.auth),{projects:a,isLoading:i,error:l,refetchProjects:d,currentWorkspaceProjectId:c,switchProject:u}=ca(),[f,y]=o.useState(!1),[h,p]=o.useState(null),[m,S]=o.useState(null),[T,g]=o.useState(!1),[P,$]=o.useState(null),[V,v]=o.useState(null),[q,w]=o.useState(null),[O,N]=o.useState(!1),[R,W]=o.useState(null),[b,F]=o.useState(null),[G,E]=o.useState(!1),[_,D]=o.useState(null),[C,oe]=o.useState(!1),[Z,he]=o.useState(null),[_e,z]=o.useState(!1),[A,te]=o.useState(null),[I,J]=o.useState(!1),[se,Ie]=o.useState(null),[Fe,de]=o.useState(!1),[qe,Ne]=o.useState(!1),[Oe,st]=o.useState(!1),[K,Ce]=o.useState(!1),[k,Q]=o.useState(!1),[U,ue]=o.useState(!1),[M,ce]=o.useState(!1),[le,Se]=o.useState(0),[ve,B]=o.useState(0),[Y,ge]=o.useState(3),[Ze,ze]=o.useState({open:!1,message:"",severity:"success"}),{data:ut=[],isLoading:es,refetch:lt}=Bl(q||"",{skip:!q}),{data:Bt=[],isLoading:bs,error:Tt,refetch:Lt}=ks(q||"",{skip:!q}),{data:xe=[],isLoading:Ue,error:we,refetch:Le}=oa(q||"",{skip:!q}),[Ve]=Cl(),[_t]=Tl(),[Nt]=Il(),[Ft]=Pl(),[Te]=Rl(),[$e]=Dl(),[at]=Kl(),[L]=Xl(),[Pe]=ec(),{data:be}=Xr(),[Re]=Nl(),[ot]=Gl();o.useEffect(()=>{if(c&&a.length>0&&!m){const ee=a.find(rt=>rt.id===c);ee&&(S(ee),w(ee.id))}},[c,a,m]),o.useEffect(()=>{v(null),F(null),D(null)},[q]),o.useEffect(()=>{q&&le>0&&(Lt(),Le(),lt())},[le,q,Lt,Le,lt]);const St=ee=>{ge(parseInt(ee.target.value,10)),B(0)},Gt=a.slice(ve*Y,ve*Y+Y),jt=()=>B(0),da=()=>B(ee=>Math.max(ee-1,0)),ua=()=>B(ee=>Math.min(ee+1,Math.ceil(a.length/Y)-1)),ha=()=>B(Math.ceil(a.length/Y)-1),fe=async ee=>{try{await u(ee.id),ze({open:!0,message:`Switched to ${ee.name||ee.project_name}`,severity:"success"})}catch{ze({open:!0,message:"Failed to switch project",severity:"error"})}},Vt=ee=>{S(ee),w(ee.id),v(null),F(null),D(null),Se(rt=>rt+1)},kt=()=>{p(null),y(!0)},Os=()=>{m?(p(m),y(!0)):ze({open:!0,message:"Please select a project to edit",severity:"warning"})},gt=ee=>{v(ee),F(null),D(null)},yt=()=>{if(!q){ze({open:!0,message:"Please select a project first",severity:"warning"});return}$(null),g(!0)},Ht=()=>{V?($(V),g(!0)):ze({open:!0,message:"Please select a system to edit",severity:"warning"})},ts=async ee=>{try{const rt=be?.id,ps=s?.user_id;if(!rt){ze({open:!0,message:"Unable to get account information. Please try again.",severity:"error"});return}if(!ps){ze({open:!0,message:"Unable to get user information. Please try again.",severity:"error"});return}const Rs={...ee,account:rt,owner:ps};P?(await _t({id:P.id,data:Rs}).unwrap(),ze({open:!0,message:"System updated successfully",severity:"success"})):(await Ve(Rs).unwrap(),ze({open:!0,message:"System created successfully",severity:"success"})),g(!1),$(null),Lt()}catch{ze({open:!0,message:"Failed to save system",severity:"error"})}},Mi=ee=>{te(ee),z(!0)},Li=async()=>{if(A)try{await Nt(A.id).unwrap(),ze({open:!0,message:"System deleted successfully",severity:"success"}),Lt(),v(null)}catch{ze({open:!0,message:"Failed to delete system",severity:"error"})}finally{z(!1),te(null)}},rn=()=>{z(!1),te(null)},$i=ee=>{F(ee),v(null),D(null)},qi=()=>{if(!q){ze({open:!0,message:"Please select a project first",severity:"warning"});return}W(null),N(!0)},Ui=()=>{b?(W(b),N(!0)):ze({open:!0,message:"Please select an environment to edit",severity:"warning"})},Bi=async ee=>{try{const rt=be?.id,ps=s?.user_id;if(!rt){ze({open:!0,message:"Unable to get account information. Please try again.",severity:"error"});return}if(!ps){ze({open:!0,message:"Unable to get user information. Please try again.",severity:"error"});return}const{is_prod:Rs,...Xi}=ee,cn={...Xi,account:rt,owner:ps};R?(await Te({id:R.id,data:cn}).unwrap(),ze({open:!0,message:"Environment updated successfully",severity:"success"})):(await Ft(cn).unwrap(),ze({open:!0,message:"Environment created successfully",severity:"success"})),N(!1),W(null),Le()}catch{ze({open:!0,message:"Failed to save environment",severity:"error"})}},Ni=ee=>{Ie(ee),J(!0)},Gi=async()=>{if(se)try{await $e(se.id).unwrap(),ze({open:!0,message:"Environment deleted successfully",severity:"success"}),Le(),F(null)}catch{ze({open:!0,message:"Failed to delete environment",severity:"error"})}finally{J(!1),Ie(null)}},nn=()=>{J(!1),Ie(null)},Vi=ee=>{D(ee)},Hi=()=>{if(!q){ze({open:!0,message:"Please select a project first",severity:"warning"});return}E(!0)},Zi=async ee=>{try{await Re(ee).unwrap(),ze({open:!0,message:"User added to project successfully",severity:"success"}),E(!1),lt()}catch{ze({open:!0,message:"Failed to add user to project",severity:"error"})}},Qi=async ee=>{if(q)try{await ot({projectId:q,userId:ee}).unwrap(),ze({open:!0,message:"User removed from project successfully",severity:"success"}),lt(),D(null)}catch{ze({open:!0,message:"Failed to remove user from project",severity:"error"})}},Ji=async ee=>{try{const rt=be?.id,ps=s?.user_id;if(!rt){ze({open:!0,message:"Unable to get account information. Please try again.",severity:"error"});return}if(!ps){ze({open:!0,message:"Unable to get user information. Please try again.",severity:"error"});return}const Rs={project_name:ee.project_name,description:ee.description,account_id:rt,status:ee.status,start_date:ee.start_date,end_date:ee.end_date,client:ee.client,client_website:ee.client_website,business_function:ee.business_function,project_type:ee.project_type,owner:ps,project_manager:ps};h?(await L({id:h.id,data:Rs}).unwrap(),ze({open:!0,message:"Project updated successfully",severity:"success"})):(await at(Rs).unwrap(),ze({open:!0,message:"Project created successfully",severity:"success"})),y(!1),p(null),d()}catch{ze({open:!0,message:h?"Failed to update project":"Failed to create project",severity:"error"})}},on=()=>{ze({...Ze,open:!1})},Yi=ee=>{he(ee),oe(!0)},Ki=async()=>{if(Z)try{await Pe(Z.id).unwrap(),ze({open:!0,message:"Project deleted successfully",severity:"success"}),d(),S(null)}catch{ze({open:!0,message:"Failed to delete project",severity:"error"})}finally{oe(!1),he(null)}},ln=()=>{oe(!1),he(null)},vs=ee=>new Date(ee).toLocaleDateString();return i?e.jsx(n,{sx:{p:1,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(ie,{})}):l?e.jsx(n,{sx:{p:1},children:e.jsx(ae,{severity:"error",children:"Failed to load projects. Please try again."})}):e.jsxs(n,{sx:{px:1,pb:1,pt:0},children:[e.jsx(r,{variant:"h6",fontWeight:600,children:"Project Management"}),e.jsxs(wt,{open:C,onClose:ln,"aria-labelledby":"delete-project-dialog-title","aria-describedby":"delete-project-dialog-description",children:[e.jsx(It,{id:"delete-project-dialog-title",children:"Confirm Delete Project"}),e.jsx(Pt,{children:e.jsxs(r,{id:"delete-project-dialog-description",children:['Are you sure you want to delete the project "',Z?.name||Z?.project_name,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:ln,color:"primary",children:"Cancel"}),e.jsx(H,{onClick:Ki,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(wt,{open:_e,onClose:rn,"aria-labelledby":"delete-system-dialog-title","aria-describedby":"delete-system-dialog-description",children:[e.jsx(It,{id:"delete-system-dialog-title",children:"Confirm Delete System"}),e.jsx(Pt,{children:e.jsxs(r,{id:"delete-system-dialog-description",children:['Are you sure you want to delete the system "',A?.name,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:rn,color:"primary",children:"Cancel"}),e.jsx(H,{onClick:Li,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(wt,{open:I,onClose:nn,"aria-labelledby":"delete-environment-dialog-title","aria-describedby":"delete-environment-dialog-description",children:[e.jsx(It,{id:"delete-environment-dialog-title",children:"Confirm Delete Environment"}),e.jsx(Pt,{children:e.jsxs(r,{id:"delete-environment-dialog-description",children:['Are you sure you want to delete the environment "',se?.name,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:nn,color:"primary",children:"Cancel"}),e.jsx(H,{onClick:Gi,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:3,children:e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Projects Overview"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage and select projects for data migration"})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:Os,disabled:!m,children:"Edit Project"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:kt,children:"Add Project"})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(me,{elevation:2,children:[e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Project Name"}),e.jsx(x,{children:"Description"}),e.jsx(x,{children:"Account"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Start Date"}),e.jsx(x,{children:"End Date"}),e.jsx(x,{children:"Client"}),e.jsx(x,{children:"Actions"}),e.jsx(x,{children:"Delete"})]})}),e.jsx(Ye,{children:Gt.map(ee=>e.jsxs(pe,{onClick:()=>Vt(ee),selected:m?.id===ee.id,sx:{backgroundColor:m?.id===ee.id?"action.selected":"inherit","&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&.Mui-selected":{backgroundColor:"action.selected"}},children:[e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{fontWeight:m?.id===ee.id?"bold":"normal",children:ee.name||ee.project_name}),ee.id===c&&e.jsx(X,{label:"Workspace",size:"small",color:"primary",variant:"outlined"})]})}),e.jsx(x,{children:e.jsx(je,{title:ee.description||"No description",children:e.jsx(r,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:ee.description||"No description"})})}),e.jsx(x,{children:ee.account_name}),e.jsx(x,{children:e.jsx(X,{label:ee.status,size:"small",color:ee.status==="Active"?"success":ee.status==="InProgress"?"warning":"default",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:ee.project_type==="file migration"?"FILE MIGRATION":ee.project_type,size:"small",color:"secondary",variant:"outlined"})}),e.jsx(x,{children:ee.start_date?vs(ee.start_date):"N/A"}),e.jsx(x,{children:ee.end_date?vs(ee.end_date):"N/A"}),e.jsx(x,{children:ee.client}),e.jsx(x,{children:e.jsx(H,{variant:"outlined",size:"small",onClick:rt=>{rt.stopPropagation(),fe(ee)},disabled:ee.id===t?.id,children:ee.id===t?.id?"Active":"Select"})}),e.jsx(x,{children:e.jsx(H,{variant:"outlined",size:"small",color:"error",onClick:rt=>{rt.stopPropagation(),Yi(ee)},children:"Delete"})})]},ee.id))})]})}),a.length===0&&e.jsx(pe,{children:e.jsxs(x,{colSpan:10,align:"center",children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"No projects found"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:'Click "Add Project" to create your first project'})]})}),a.length>0&&e.jsxs(n,{sx:{p:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderTop:"1px solid",borderColor:"divider"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",children:"Rows per page:"}),e.jsx(Ae,{size:"small",sx:{minWidth:80},children:e.jsxs(We,{value:Y.toString(),onChange:St,displayEmpty:!0,children:[e.jsx(re,{value:3,children:"3"}),e.jsx(re,{value:5,children:"5"}),e.jsx(re,{value:10,children:"10"}),e.jsx(re,{value:20,children:"20"})]})})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[ve*Y+1,"-",Math.min((ve+1)*Y,a.length)," of ",a.length]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{title:"First Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:jt,disabled:ve===0,size:"small",children:e.jsx(Nn,{})})})}),e.jsx(je,{title:"Previous Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:da,disabled:ve===0,size:"small",children:e.jsx(Gn,{})})})}),e.jsx(je,{title:"Next Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:ua,disabled:ve>=Math.ceil(a.length/Y)-1,size:"small",children:e.jsx(Vn,{})})})}),e.jsx(je,{title:"Last Page",children:e.jsx("span",{children:e.jsx(ne,{onClick:ha,disabled:ve>=Math.ceil(a.length/Y)-1,size:"small",children:e.jsx(Hn,{})})})})]})]})]})}),q&&e.jsxs(j,{item:!0,xs:12,children:[e.jsx(De,{elevation:3,sx:{mt:1},children:e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Systems for: ",m?.name||m?.project_name]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage systems for the selected project"})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:Ht,disabled:!V,children:"Edit System"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:yt,children:"Add System"})]})]})}),e.jsx(me,{elevation:2,sx:{mt:1},children:e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"System Name"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Owner"}),e.jsx(x,{children:"Created Date"}),e.jsx(x,{children:"Modified Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:bs?e.jsx(pe,{children:e.jsxs(x,{colSpan:6,align:"center",children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading systems..."})]})}):Tt&&"status"in Tt&&Tt.status!==404?e.jsx(pe,{children:e.jsx(x,{colSpan:6,align:"center",children:e.jsx(r,{variant:"body2",color:"error",children:"Failed to load systems"})})}):Bt.length===0||Tt&&"status"in Tt&&Tt.status===404?e.jsx(pe,{children:e.jsx(x,{colSpan:6,align:"center",children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No systems found for this project"})})}):Bt.map(ee=>e.jsxs(pe,{onClick:()=>gt(ee),selected:V?.id===ee.id,sx:{backgroundColor:V?.id===ee.id?"action.selected":"inherit","&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&.Mui-selected":{backgroundColor:"action.selected"}},children:[e.jsx(x,{children:e.jsx(r,{fontWeight:V?.id===ee.id?"bold":"normal",children:ee.name})}),e.jsx(x,{children:e.jsx(X,{label:ee.type,size:"small",color:ee.type==="source"?"primary":"secondary",variant:"outlined"})}),e.jsx(x,{children:ee.owner_username}),e.jsx(x,{children:ee.created_date?vs(ee.created_date):"N/A"}),e.jsx(x,{children:ee.modified_date?vs(ee.modified_date):"N/A"}),e.jsx(x,{children:e.jsx(H,{variant:"outlined",size:"small",color:"error",onClick:rt=>{rt.stopPropagation(),Mi(ee)},children:"Delete"})})]},ee.id))})]})})})]}),q&&e.jsxs(j,{item:!0,xs:12,children:[e.jsx(De,{elevation:3,sx:{mt:1},children:e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Environments for: ",m?.name||m?.project_name]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage environments for the selected project"})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:Ui,disabled:!b,children:"Edit Environment"}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:qi,children:"Add Environment"})]})]})}),e.jsx(me,{elevation:2,sx:{mt:1},children:e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Environment Name"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Production"}),e.jsx(x,{children:"Owner"}),e.jsx(x,{children:"Created Date"}),e.jsx(x,{children:"Modified Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:Ue?e.jsx(pe,{children:e.jsxs(x,{colSpan:7,align:"center",children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading environments..."})]})}):we&&"status"in we&&we.status!==404?e.jsx(pe,{children:e.jsx(x,{colSpan:7,align:"center",children:e.jsx(r,{variant:"body2",color:"error",children:"Failed to load environments"})})}):xe.length===0||we&&"status"in we&&we.status===404?e.jsx(pe,{children:e.jsx(x,{colSpan:7,align:"center",children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No environments found for this project"})})}):xe.map(ee=>e.jsxs(pe,{onClick:()=>$i(ee),selected:b?.id===ee.id,sx:{backgroundColor:b?.id===ee.id?"action.selected":"inherit","&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&.Mui-selected":{backgroundColor:"action.selected"}},children:[e.jsx(x,{children:e.jsx(r,{fontWeight:b?.id===ee.id?"bold":"normal",children:ee.name})}),e.jsx(x,{children:e.jsx(X,{label:ee.type,size:"small",color:ee.type==="prod"?"error":ee.type==="dev"?"primary":ee.type==="qa"?"secondary":"default",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:ee.is_prod?"Yes":"No",size:"small",color:ee.is_prod?"success":"default",variant:"outlined"})}),e.jsx(x,{children:ee.owner_name}),e.jsx(x,{children:ee.created_date?vs(ee.created_date):"N/A"}),e.jsx(x,{children:ee.modified_date?vs(ee.modified_date):"N/A"}),e.jsx(x,{children:e.jsx(H,{variant:"outlined",size:"small",color:"error",onClick:rt=>{rt.stopPropagation(),Ni(ee)},children:"Delete"})})]},ee.id))})]})})})]}),q&&e.jsxs(j,{item:!0,xs:12,children:[e.jsx(De,{elevation:3,sx:{mt:1},children:e.jsxs(Ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Users for: ",m?.name||m?.project_name]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Manage users for the selected project"})]}),e.jsx(n,{sx:{display:"flex",gap:2},children:e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:Hi,children:"Add User"})})]})}),e.jsx(me,{elevation:2,sx:{mt:1},children:e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"User Name"}),e.jsx(x,{children:"Role"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Created Date"}),e.jsx(x,{children:"Modified Date"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:es?e.jsx(pe,{children:e.jsxs(x,{colSpan:6,align:"center",children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading users..."})]})}):ut.length===0?e.jsx(pe,{children:e.jsx(x,{colSpan:6,align:"center",children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No users found for this project"})})}):ut.map(ee=>e.jsxs(pe,{onClick:()=>Vi(ee),selected:_?.user_id===ee.user_id,sx:{backgroundColor:_?.user_id===ee.user_id?"action.selected":"inherit","&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&.Mui-selected":{backgroundColor:"action.selected"}},children:[e.jsx(x,{children:e.jsxs(r,{fontWeight:_?.user_id===ee.user_id?"bold":"normal",children:[ee.firstname," ",ee.lastname]})}),e.jsx(x,{children:e.jsx(X,{label:ee.rolename,size:"small",color:ee.rolename==="admin"?"error":ee.rolename==="user"?"primary":"default",variant:"outlined"})}),e.jsx(x,{children:e.jsx(X,{label:ee.active?"Active":"Inactive",size:"small",color:ee.active?"success":"default",variant:"outlined"})}),e.jsx(x,{children:ee.created_date?vs(ee.created_date):"N/A"}),e.jsx(x,{children:ee.modified_date?vs(ee.modified_date):"N/A"}),e.jsx(x,{children:e.jsx(H,{variant:"outlined",size:"small",color:"error",onClick:rt=>{rt.stopPropagation(),Qi(ee.user_id)},children:"Remove"})})]},ee.user_id))})]})})})]})]}),e.jsx(qu,{open:f,project:h,onClose:()=>y(!1),onSave:Ji}),e.jsx(Uu,{open:T,system:P,projectId:q||"",onClose:()=>g(!1),onSave:ts}),e.jsx(Bu,{open:O,environment:R,projectId:q||"",onClose:()=>N(!1),onSave:Bi}),e.jsx(Gu,{open:G,projectId:q||"",existingUsers:ut,onClose:()=>E(!1),onSave:Zi}),e.jsx(dt,{open:Ze.open,autoHideDuration:4e3,onClose:on,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:on,severity:Ze.severity,children:Ze.message})})]})},Hu=({open:t,policy:s,mode:a,onClose:i,onSave:l})=>{const[d,c]=o.useState({policy_name:"",security_class:"",permission:"",mask:"",version:"",is_active:!0}),[u,f]=o.useState({}),[y,h]=o.useState("project"),[p,m]=o.useState(""),[S,T]=o.useState(""),[g,P]=o.useState(""),{projects:$}=ca(),{data:V=[]}=sn(),{data:v=[]}=ks(p,{skip:!p}),{data:q=[]}=Is(S,{skip:!S}),w=[...new Set(V.map(C=>C.security_class).filter(C=>C!=null))],O=[...new Set(V.map(C=>C.permission).filter(C=>C!=null))],N=[...new Set(V.map(C=>C.mask).filter(C=>C!=null))];V.filter(C=>y==="project"?C.project_id===p:C.object_id===g);const R=v,W=q;o.useEffect(()=>{s&&(a==="edit"||a==="update-default")?c({policy_name:s.policy_name||"",security_class:s.security_class||"",permission:s.permission||"",mask:s.mask||"",version:s.version||"",is_active:s.is_active}):a==="create"&&c({policy_name:"",security_class:"",permission:"",mask:"",version:"",is_active:!0})},[s,a,t]);const b=(C,oe)=>{c(Z=>({...Z,[C]:oe})),u[C]&&f(Z=>({...Z,[C]:""}))},F=()=>{const C={};return a==="update-default"?(y==="project"&&!p&&(C.project="Please select a project"),y==="object"&&(!p||!S||!g)&&(C.object="Please select project, source system, and source object")):(d.policy_name.trim()||(C.policy_name="Policy name is required"),d.security_class.trim()||(C.security_class="Security class is required")),f(C),Object.keys(C).length===0},G=()=>{if(F())if(a==="update-default")l({scopeType:y,selectedProject:p,selectedSystem:S,selectedObject:g});else if(a==="create"){const C={policy_name:d.policy_name,security_class:d.security_class,permission:d.permission,mask:d.mask,version:d.version};l(C)}else l(d)},E=()=>{switch(a){case"create":return"Create Security Policy";case"edit":return"Edit Security Policy";case"update-default":return"Update Default Policy";default:return"Security Policy"}},_=600,D=a==="update-default"?e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(Co,{component:"legend",children:"Select Scope"}),e.jsxs(Ts,{value:y,onChange:C=>{h(C.target.value),m(""),T(""),P("")},row:!0,children:[e.jsx(nt,{value:"project",control:e.jsx(ft,{}),label:"Project"}),e.jsx(nt,{value:"object",control:e.jsx(ft,{}),label:"Object"})]})]}),y==="project"&&e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Project"}),e.jsx(We,{value:p,onChange:C=>{m(C.target.value)},label:"Project",children:$.map(C=>e.jsx(re,{value:C.id,children:C.name},C.id))})]})}),y==="object"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Project"}),e.jsx(We,{value:p,onChange:C=>{m(C.target.value),T(""),P("")},label:"Project",children:$.map(C=>e.jsx(re,{value:C.id,children:C.name},C.id))})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Source System"}),e.jsx(We,{value:S,onChange:C=>{T(C.target.value),P("")},label:"Source System",disabled:!p,children:R.map(C=>e.jsx(re,{value:C.id,children:C.name},C.id))})]})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Source Object"}),e.jsx(We,{value:g,onChange:C=>{P(C.target.value)},label:"Source Object",disabled:!S,children:W.map(C=>e.jsx(re,{value:C.object_id,children:C.name},C.object_id))})]})})]}),u.project&&e.jsx(j,{item:!0,xs:12,children:e.jsx(ae,{severity:"error",children:u.project})}),u.object&&e.jsx(j,{item:!0,xs:12,children:e.jsx(ae,{severity:"error",children:u.object})})]}):e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Policy Name",value:d.policy_name,onChange:C=>b("policy_name",C.target.value),fullWidth:!0,required:!0,error:!!u.policy_name,helperText:u.policy_name})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,required:!0,error:!!u.security_class,children:[e.jsx(Me,{children:"Security Class"}),e.jsx(We,{value:d.security_class,onChange:C=>b("security_class",C.target.value),label:"Security Class",children:w.map(C=>e.jsx(re,{value:C,children:C},C))}),u.security_class&&e.jsx(r,{variant:"caption",color:"error",children:u.security_class})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Permission"}),e.jsx(We,{value:d.permission,onChange:C=>b("permission",C.target.value),label:"Permission",children:O.map(C=>e.jsx(re,{value:C,children:C},C))})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Mask"}),e.jsx(We,{value:d.mask,onChange:C=>b("mask",C.target.value),label:"Mask",children:N.map(C=>e.jsx(re,{value:C,children:C},C))})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:"Version",value:d.version,onChange:C=>b("version",C.target.value),fullWidth:!0})}),a==="edit"&&e.jsx(j,{item:!0,xs:12,children:e.jsx(nt,{control:e.jsx(or,{checked:d.is_active||!1,onChange:C=>b("is_active",C.target.checked),color:"primary"}),label:"Active"})})]});return e.jsx(Ut,{open:t,onClose:i,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:C=>C.zIndex.modal},children:e.jsx(me,{sx:{width:_,height:"100vh",margin:0,borderRadius:0,overflow:"auto",boxShadow:24},children:e.jsxs(n,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:E()}),e.jsx(ne,{onClick:i,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:D}),e.jsxs(j,{container:!0,spacing:2,sx:{mt:3},children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(H,{onClick:i,variant:"outlined",fullWidth:!0,children:"Cancel"})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(H,{onClick:G,variant:"contained",startIcon:e.jsx(hs,{}),fullWidth:!0,children:[a==="create"?"Create":a==="update-default"?"Update Default":"Save"," Policy"]})})]})]})})})},Zu=()=>{const[t,s]=o.useState(0),[a,i]=o.useState(0),l=5,{data:d=[],isLoading:c,error:u}=sn(),{data:f,isLoading:y,error:h}=$d(),{data:p,isLoading:m,error:S}=qd(),{data:T=[]}=Kr(),g=f?.message||[],P=p?.message||[],$=N=>new Date(N).toLocaleString(),V=o.useMemo(()=>{const N={};return T.forEach(R=>{N[R.id]=R.username}),N},[T]),v={totalRevealSessions:g.length,activeSessions:g.filter(N=>N.is_active).length,totalPolicyChanges:P.length,disabledPolicies:P.filter(N=>N.new_value?.[0]?.is_active===!1).length,maskChanges:P.filter(N=>N.old_value?.[0]?.mask!==N.new_value?.[0]?.mask).length,lastAuditActivity:P.length>0?$(P[0].datetime):"N/A"},q=o.useMemo(()=>{const N={Public:1,Confidential:2,Restricted:3},R={NONE:1,PARTIAL:2,HASH:3},W=P.filter(G=>G.old_value?.[0]?.is_active===!0&&G.new_value?.[0]?.is_active===!1).length,b=P.filter(G=>{const E=G.old_value?.[0]?.security_class,_=G.new_value?.[0]?.security_class;return E&&_&&N[_]<N[E]}).length,F=P.filter(G=>{const E=G.old_value?.[0]?.mask,_=G.new_value?.[0]?.mask;return E&&_&&R[_]<R[E]}).length;return{disabledPolicies:W,securityDowngrades:b,maskWeakenings:F}},[P]),w=(N,R)=>{if(!N?.length||!R?.length)return"Policy Updated";const W=N[0],b=R[0];return b.is_active===!1?"Policy Disabled":W.mask!==b.mask?"Mask Changed":W.security_class!==b.security_class?"Security Class Changed":"Policy Updated"},O=(N,R)=>{if(!N?.length||!R?.length)return"N/A ‚Üí N/A";const W=N[0].mask||"NONE",b=R[0].mask||"NONE";return`${W} ‚Üí ${b}`};return c||y||m?e.jsx(n,{sx:{px:3,pb:3,pt:0,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(ie,{})}):u||h||S?e.jsx(n,{sx:{px:3,pb:3,pt:0},children:e.jsx(ae,{severity:"error",children:"Failed to load dashboard data. Please try again."})}):e.jsx(n,{sx:{px:1,pb:1,pt:0},children:e.jsx(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsxs(j,{container:!0,spacing:1,children:[e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsx(De,{elevation:2,sx:{height:100},children:e.jsx(Ee,{sx:{py:2,height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(ra,{sx:{fontSize:32,color:"primary.main"}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:v.totalRevealSessions.toLocaleString()}),e.jsxs(r,{variant:"caption",color:"success.main",fontWeight:"bold",children:["Active: ",v.activeSessions]}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",children:"Total reveal attempts"})]})]})})})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsx(De,{elevation:2,sx:{height:100},children:e.jsx(Ee,{sx:{py:2,height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(Pr,{sx:{fontSize:32,color:"info.main"}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:v.totalPolicyChanges.toLocaleString()}),e.jsxs(r,{variant:"caption",color:"error.main",fontWeight:"bold",children:["Disabled: ",v.disabledPolicies]}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",children:"Last audit activity"})]})]})})})}),e.jsx(j,{item:!0,xs:12,sm:4,children:e.jsx(De,{elevation:2,sx:{height:100},children:e.jsx(Ee,{sx:{py:2,height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(na,{sx:{fontSize:32,color:"warning.main"}}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:v.maskChanges.toLocaleString()}),e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",children:"Mask changes detected"})]})]})})})})]})}),(q.disabledPolicies>0||q.securityDowngrades>0||q.maskWeakenings>0)&&e.jsx(j,{item:!0,xs:12,children:e.jsx(ae,{severity:"warning",sx:{backgroundColor:"#fff3cd",color:"#856404",border:"1px solid #ffeaa7","& .MuiAlert-icon":{color:"#856404"}},children:e.jsxs(r,{variant:"body1",fontWeight:"bold",children:["Governance Alert: ",q.disabledPolicies," policies disabled, ",q.securityDowngrades," security class downgrades, ",q.maskWeakenings," masking protections weakened. Immediate review is recommended."]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(me,{elevation:2,sx:{p:2,height:500,display:"flex",flexDirection:"column"},children:[e.jsx(r,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Policy Change History"}),e.jsx(tt,{component:me,elevation:0,sx:{flex:1,overflow:"auto"},children:e.jsxs(Je,{size:"small",stickyHeader:!0,children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Date"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Policy"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Change Type"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Old ‚Üí New"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"User"})]})}),e.jsx(Ye,{children:P.slice(a*l,a*l+l).map(N=>e.jsxs(pe,{children:[e.jsx(x,{sx:{py:1},children:$(N.datetime)}),e.jsx(x,{sx:{py:1},children:N.new_value?.[0]?.policy_name||"N/A"}),e.jsx(x,{sx:{py:1},children:e.jsx(X,{label:w(N.old_value,N.new_value),size:"small",color:"info",variant:"outlined"})}),e.jsx(x,{sx:{py:1},children:O(N.old_value,N.new_value)}),e.jsx(x,{sx:{py:1},children:V[N.user_id]||N.user_id})]},N.id))})]})}),e.jsx(Ss,{component:"div",count:P.length,page:a,onPageChange:(N,R)=>i(R),rowsPerPage:l,rowsPerPageOptions:[5]})]})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsxs(me,{elevation:2,sx:{p:2,height:500,display:"flex",flexDirection:"column"},children:[e.jsx(r,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Reveal Activity"}),e.jsx(tt,{component:me,elevation:0,sx:{flex:1,overflow:"auto"},children:e.jsxs(Je,{size:"small",stickyHeader:!0,children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"User"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Object"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Reveal"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"Created Date"}),e.jsx(x,{sx:{py:1,backgroundColor:"background.paper"},children:"IP Address"})]})}),e.jsx(Ye,{children:g.slice(t*l,t*l+l).map(N=>e.jsxs(pe,{children:[e.jsx(x,{sx:{py:1},children:V[N.user_id]||N.user_id}),e.jsx(x,{sx:{py:1},children:N.object_id}),e.jsx(x,{sx:{py:1},children:e.jsx(X,{label:N.reveal_flag?"YES":"NO",size:"small",color:N.reveal_flag?"error":"success"})}),e.jsx(x,{sx:{py:1},children:$(N.created_date)}),e.jsx(x,{sx:{py:1},children:N.ip})]},N.id))})]})}),e.jsx(Ss,{component:"div",count:g.length,page:t,onPageChange:(N,R)=>s(R),rowsPerPage:l,rowsPerPageOptions:[5]})]})})]})})]})})})},Qu=()=>{const[t,s]=o.useState(0),[a,i]=o.useState(""),[l,d]=o.useState(""),[c,u]=o.useState(""),[f,y]=o.useState(!1),[h,p]=o.useState(null),[m,S]=o.useState(!1),[T,g]=o.useState("create"),[P,$]=o.useState(null),[V,v]=o.useState(null),[q,w]=o.useState({open:!1,message:"",severity:"success"}),{data:O=[],isLoading:N,error:R}=sn(),[W]=Od(),[b]=Wd(),[F]=zd(),[G]=Md(),[E]=Ld();o.useMemo(()=>{const z=O.map(A=>A.tenant_id).filter(Boolean);return[...new Set(z)]},[O]),o.useMemo(()=>{const z=O.map(A=>A.object_id).filter(Boolean);return[...new Set(z)]},[O]),o.useMemo(()=>{const z=O.map(A=>A.project_id).filter(Boolean);return[...new Set(z)]},[O]),o.useMemo(()=>{const z=O.map(A=>A.pii_policy_id).filter(Boolean);return[...new Set(z)]},[O]);const _=o.useMemo(()=>{const z=O.map(A=>A.security_class).filter(A=>A!=null);return[...new Set(z)]},[O]),D=o.useMemo(()=>O.filter(z=>{const A=!a||z.policy_name&&z.policy_name.toLowerCase().includes(a.toLowerCase())||z.security_class&&z.security_class.toLowerCase().includes(a.toLowerCase()),te=!c||z.security_class===c;let I=!0;return l==="object"?I=!!z.object_id:l==="project"?I=!!z.project_id:l==="tenant"&&(I=!z.object_id&&!z.project_id),A&&te&&I}),[O,a,l,c]),C=z=>{p(z),y(!0)},oe=async()=>{if(h)try{await W(h.pii_policy_id).unwrap(),w({open:!0,message:"Policy deleted successfully",severity:"success"})}catch{w({open:!0,message:"Failed to delete policy",severity:"error"})}finally{y(!1),p(null)}},Z=async z=>{try{if(T==="create")await b(z).unwrap(),w({open:!0,message:"Policy created successfully",severity:"success"});else if(T==="edit"&&P)await F({id:P.pii_policy_id,data:z}).unwrap(),w({open:!0,message:"Policy updated successfully",severity:"success"});else if(T==="update-default"){const A=z.scopeType==="project"?{project_id:z.selectedProject}:{object_id:z.selectedObject};await E(A).unwrap(),w({open:!0,message:"Default policy scope updated successfully",severity:"success"})}S(!1)}catch{w({open:!0,message:`Failed to ${T==="create"?"create":T==="edit"?"update":"update default"} policy`,severity:"error"})}},he=z=>z.object_id?e.jsx(X,{label:"Object",size:"small",color:"primary",variant:"outlined"}):z.project_id?e.jsx(X,{label:"Project",size:"small",color:"secondary",variant:"outlined"}):e.jsx(X,{label:"Tenant",size:"small",color:"default",variant:"outlined"}),_e=z=>new Date(z).toLocaleDateString();return N?e.jsx(n,{sx:{px:3,pb:3,pt:0,display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:e.jsx(ie,{})}):R?e.jsx(n,{sx:{px:3,pb:3,pt:0},children:e.jsx(ae,{severity:"error",children:"Failed to load security policies. Please try again."})}):e.jsxs(n,{sx:{px:1,pb:1,pt:0},children:[e.jsx(r,{variant:"h6",fontWeight:600,gutterBottom:!0,children:"Security Policies"}),e.jsxs(Mt,{value:t,onChange:(z,A)=>s(A),sx:{borderBottom:1,borderColor:"divider",mb:1,"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,"&.Mui-selected":{backgroundColor:"#1976d2",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#1565c0"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Dashboard"}),e.jsx(He,{label:"Policies"})]}),t===0&&e.jsx(Zu,{}),t===1&&e.jsx(me,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"4px solid #6366f1"},children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{sx:{py:1,px:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"h6",fontWeight:600,children:"Filters"}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),onClick:()=>{g("create"),$(null),S(!0),v(null)},size:"small",children:"Create Policy"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(ht,{}),onClick:()=>{V?(g("edit"),$(V),S(!0)):w({open:!0,message:"Please select a row to edit",severity:"warning"})},size:"small",children:"Edit Policy"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(rr,{}),onClick:()=>{g("update-default"),$(null),S(!0)},size:"small",children:"Update Default Policy"})]})]}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(ye,{fullWidth:!0,size:"small",placeholder:"Search policies...",value:a,onChange:z=>i(z.target.value),InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(lr,{})})}})}),e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Filter by Scope"}),e.jsxs(We,{value:l,onChange:z=>d(z.target.value),label:"Filter by Scope",children:[e.jsx(re,{value:"",children:"All Scopes"}),e.jsx(re,{value:"object",children:"Object Scope"}),e.jsx(re,{value:"project",children:"Project Scope"}),e.jsx(re,{value:"tenant",children:"Tenant Scope"})]})]})}),e.jsx(j,{item:!0,xs:12,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Filter by Security Class"}),e.jsxs(We,{value:c,onChange:z=>u(z.target.value),label:"Filter by Security Class",children:[e.jsx(re,{value:"",children:"All Security Classes"}),_.map(z=>e.jsx(re,{value:z,children:z},z))]})]})})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{sx:{py:1,px:2},children:[e.jsxs(r,{variant:"h6",fontWeight:600,gutterBottom:!0,children:["Security Policies (",D.length,")"]}),e.jsx(tt,{component:me,elevation:0,sx:{maxHeight:600,overflow:"auto"},children:e.jsxs(Je,{size:"small",stickyHeader:!0,children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Policy Name"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pr,{sx:{color:"primary.main",fontSize:12}}),"Security Class"]})}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(dn,{sx:{color:"success.main",fontSize:12}}),"Permission"]})}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(na,{sx:{color:"warning.main",fontSize:12}}),"Mask"]})}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Ontology Term"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Version"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"PII Policy ID"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Scope"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Status"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Created Date"}),e.jsx(x,{sx:{py:0,backgroundColor:"background.paper"},children:"Actions"})]})}),e.jsx(Ye,{children:D.length===0?e.jsx(pe,{children:e.jsx(x,{colSpan:11,align:"center",sx:{py:0},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No policies found matching the current filters."})})}):D.map(z=>e.jsxs(pe,{onClick:()=>v(z),sx:{cursor:"pointer",backgroundColor:V?.pii_policy_id===z.pii_policy_id?"action.selected":"inherit","&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(x,{sx:{py:0},children:z.policy_name||"N/A"}),e.jsx(x,{sx:{py:0},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pr,{sx:{color:"primary.main",fontSize:12}}),z.security_class||"N/A"]})}),e.jsx(x,{sx:{py:0},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(dn,{sx:{color:"success.main",fontSize:12}}),z.permission||"N/A"]})}),e.jsx(x,{sx:{py:0},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(na,{sx:{color:"warning.main",fontSize:12}}),z.mask||"N/A"]})}),e.jsx(x,{sx:{py:0},children:z.ontology_term||"N/A"}),e.jsx(x,{sx:{py:0},children:z.version||"N/A"}),e.jsx(x,{sx:{py:0},children:z.pii_policy_id}),e.jsx(x,{sx:{py:0},children:he(z)}),e.jsx(x,{sx:{py:0},children:e.jsx(X,{label:z.is_active?"Active":"Inactive",size:"small",color:z.is_active?"success":"default",variant:"outlined"})}),e.jsx(x,{sx:{py:0},children:_e(z.created_date)}),e.jsx(x,{sx:{py:0},children:e.jsx(je,{title:"Delete Policy",children:e.jsx(ne,{size:"small",color:"error",onClick:A=>{A.stopPropagation(),C(z)},children:e.jsx(ds,{})})})})]},z.pii_policy_id))})]})})]})})})]})}),e.jsxs(wt,{open:f,onClose:()=>y(!1),"aria-labelledby":"delete-dialog-title",children:[e.jsx(It,{id:"delete-dialog-title",children:"Confirm Delete Policy"}),e.jsx(Pt,{children:e.jsxs(r,{children:['Are you sure you want to delete the policy "',h?.policy_name||h?.pii_policy_id,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(H,{onClick:oe,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(dt,{open:q.open,autoHideDuration:4e3,onClose:()=>w({...q,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:()=>w({...q,open:!1}),severity:q.severity,children:q.message})}),e.jsx(Hu,{open:m,policy:P,mode:T,onClose:()=>S(!1),onSave:Z})]})},Ci=o.createContext(void 0),os=()=>{const t=o.useContext(Ci);if(!t)throw new Error("useActivity must be used within an ActivityProvider");return t},Ti=({children:t})=>{const{selectedObject:s}=ke(b=>b.migration),{selectedEnvironment:a}=ke(b=>b.app),[i,l]=o.useState(new Map),[d,c]=o.useState(new Map),[u,f]=o.useState(!1),[y,h]=o.useState(!1),[p,m]=o.useState(null),[S]=Ad(),{data:T,isLoading:g,error:P,refetch:$}=Fd({objectId:s?.object_id||""},{skip:!s?.object_id});o.useEffect(()=>{if(T){const b=new Map,F=new Map;T.forEach(G=>{b.set(G.activity,G.is_completed),F.set(G.activity,G.read_only)}),l(b),c(F)}},[T]),o.useEffect(()=>{if(s?.object_id)try{$()}catch{console.warn("Cannot refetch activity status on environment change: query not started yet")}},[a?.id,s?.object_id,$]),o.useEffect(()=>{if(y){const b=setTimeout(()=>{h(!1),m(null)},12e4);return m(b),()=>clearTimeout(b)}},[y]);const V=o.useCallback(b=>{if(s?.object_id)try{$()}catch{console.warn("Cannot refetch activity status: query not started yet")}},[$,s?.object_id]),v=o.useCallback(b=>i.get(b)||!1,[i]),q=o.useCallback(b=>{const F=["prod","qa","uat"];return a?.name&&F.some(E=>a.name.toLowerCase().includes(E))&&!y?!0:d.get(b)||!1},[d,a,y]),w=o.useCallback(async(b,F,G)=>{const E=!G;l(_=>new Map(_.set(b,E)));try{await S({object_id:F,activity:b,flag:E,allow:!1}).unwrap()}catch(_){throw l(D=>new Map(D.set(b,G))),_}},[S]),O=o.useCallback(async(b,F,G)=>{try{await S({object_id:F,activity:b,flag:G,allow:!1}).unwrap();try{$()}catch{console.warn("Cannot refetch activity status after update: query not started yet")}}catch(E){throw E}},[S,$]),N=o.useCallback((b,F)=>{l(G=>new Map(G.set(b,F)))},[]),R=o.useCallback(()=>{u&&h(!0)},[u]),W={activityStatusMap:i,readOnlyFlags:d,getActivityStatus:V,getCompletionStatus:v,getReadOnlyFlag:q,toggleCompletionStatus:w,updateStatusToggleButton:O,setCompletionStatus:N,canReveal:u,isRevealMode:y,activateRevealMode:R,isLoading:g,error:P?"Failed to load activity status":null};return e.jsx(Ci.Provider,{value:W,children:t})},xs=({activity:t,label:s="Mark Completed",disabled:a=!1,showAlert:i=!0,alertMessage:l})=>{const d=!!a,{selectedObject:c}=ke(F=>F.migration),{selectedEnvironment:u}=ke(F=>F.app),{getCompletionStatus:f,getReadOnlyFlag:y,toggleCompletionStatus:h,isRevealMode:p,canReveal:m,activateRevealMode:S}=os(),[T,g]=o.useState(!1),[P,$]=o.useState(!1),V=f(t),v=y(t),q=["prod","qa","uat"],w=u?.name&&q.some(F=>u.name.toLowerCase().includes(F)),O=!!(d||T||w&&!p),N=async()=>{if(c?.object_id){if(w&&!p){m&&$(!0);return}g(!0);try{await h(t,c.object_id,V)}catch(F){console.error("Failed to toggle completion status:",F)}finally{g(!1)}}},R=()=>{$(!1),S()},W=()=>{$(!1)},b=()=>l||(V?`This page is currently read-only due to ${t.toLowerCase()} finalization.`:v?`This page is in view-only mode because ${t.toLowerCase()} is marked as completed.`:"");return e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[i&&(V||v)&&e.jsx(ae,{severity:"warning",sx:{flex:1,minWidth:"300px"},children:b()}),e.jsx(nt,{control:e.jsx(or,{checked:V,onChange:N,disabled:O,color:"success"}),label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(mt,{sx:{color:V?"success.main":"grey.400"}}),e.jsx(r,{variant:"body2",sx:{fontWeight:"medium"},children:s})]})})]}),e.jsxs(wt,{open:P,onClose:W,"aria-labelledby":"permission-dialog-title","aria-describedby":"permission-dialog-description",children:[e.jsx(It,{id:"permission-dialog-title",children:"Environment Restriction Override"}),e.jsx(Pt,{children:e.jsxs(Ir,{id:"permission-dialog-description",children:["This environment (",u?.name,") has restrictions that prevent editing. Would you like to temporarily enable editing mode for 2 minutes?"]})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:W,color:"inherit",children:"Cancel"}),e.jsx(H,{onClick:R,color:"primary",variant:"contained",children:"Enable Editing"})]})]})]})},Ii=()=>{const{selectedObject:t}=ke(k=>k.migration),{selectedProject:s,selectedEnvironment:a}=ke(k=>k.app),{user:i}=ke(k=>k.auth),{getCompletionStatus:l,getReadOnlyFlag:d}=os(),c=d("Relationship")||l("Mapping"),[u,f]=o.useState(""),[y,h]=o.useState([""]),[p,m]=o.useState([{fieldId:"",systemId:"",relatedObjectId:"",relatedFieldId:"",completed:!1}]),[S,T]=o.useState([{fieldId:"",lookupSystemId:"",lookupObjectId:"",lookupJoinFieldId:"",lookupFetchFieldIds:[],completed:!1}]),[g,P]=o.useState({open:!1,message:"",severity:"info"}),$=Ke.useRef(""),V=Ke.useRef(""),v=Ke.useRef([]),q=Ke.useRef(!1),{data:w=[],isLoading:O}=js(t?.object_id||"",{skip:!t?.object_id}),{data:N=[]}=ks(s?.id||"",{skip:!s?.id}),[R]=hi(),{data:W=[]}=Td(t?.object_id||"",{skip:!t?.object_id}),[b]=Id(),[F]=Pd(),G=p.find(k=>k.systemId&&!k.completed)?.systemId||"",{data:E=[]}=Is(G,{skip:!G}),_=p.find(k=>k.relatedObjectId&&!k.completed)?.relatedObjectId||"",{data:D=[]}=js(_,{skip:!_}),C=S.find(k=>k.lookupSystemId&&!k.completed)?.lookupSystemId||"",oe=S.find(k=>k.lookupObjectId&&!k.completed)?.lookupObjectId||"",{data:Z=[]}=Is(C,{skip:!C}),{data:he=[]}=js(oe,{skip:!oe});o.useMemo(()=>w.find(k=>k.is_pk==="true"),[w]),o.useMemo(()=>w.filter(k=>k.is_unique==="true"),[w]),Ke.useEffect(()=>{t?.object_id&&(f(""),h([""]),m([{fieldId:"",systemId:"",relatedObjectId:"",relatedFieldId:"",completed:!1}]),T([{fieldId:"",lookupSystemId:"",lookupObjectId:"",lookupJoinFieldId:"",lookupFetchFieldIds:[],completed:!1}]),P({open:!1,message:"",severity:"info"}),$.current="",V.current="",v.current=[],q.current=!1)},[t?.object_id,a?.id]),Ke.useEffect(()=>{if(w.length>0&&!q.current){const k=w.find(U=>U.is_pk==="true"),Q=w.filter(U=>U.is_unique==="true");if(k&&(f(k.name),$.current=k.name,V.current=k.name),Q.length>0){const U=Q.map(ue=>ue.name);h(U),v.current=U}if(W.length>0){const U=W.map(ue=>({id:ue.id,fieldId:w.find(M=>M.name===ue.source_field)?.field_id||"",lookupSystemId:ue.lookup_system,lookupObjectId:ue.lookup_object,lookupJoinFieldId:w.find(M=>M.name===ue.lookup_join_field)?.field_id||"",lookupFetchFieldIds:ue.lookup_fetch_field.map(M=>w.find(ce=>ce.name===M)?.field_id||"").filter(M=>M!==""),completed:!0,fieldName:ue.source_field,lookupSystemName:N.find(M=>M.id===ue.lookup_system)?.name,lookupObjectName:ue.lookup_object,lookupJoinFieldName:ue.lookup_join_field,lookupFetchFieldNames:ue.lookup_fetch_field}));T(U)}q.current=!0}},[w,W,N]);const _e=()=>{h(k=>[...k,""])},z=k=>{h(Q=>Q.filter((U,ue)=>ue!==k))},A=(k,Q)=>{h(U=>U.map((ue,M)=>M===k?Q:ue))},te=k=>{const Q=y.filter((U,ue)=>ue!==k&&U!=="");return w.filter(U=>!Q.includes(U.name))},I=()=>{m(k=>[...k,{fieldId:"",systemId:"",relatedObjectId:"",relatedFieldId:"",completed:!1}])},J=(k,Q,U)=>{m(ue=>ue.map((M,ce)=>{if(ce===k){const le={...M,[Q]:U};if(Q==="fieldId"){const Se=w.find(ve=>ve.field_id===U);le.fieldName=Se?.label||Se?.name}else if(Q==="systemId"){const Se=N.find(ve=>ve.id===U);le.systemName=Se?.name}else if(Q==="relatedObjectId"){const Se=E.find(ve=>ve.object_id===U);le.relatedObjectName=Se?.name||U}else if(Q==="relatedFieldId"){const Se=D.find(ve=>ve.field_id===U);le.relatedFieldName=Se?.label||Se?.name}return le}return M}))},se=k=>{m(Q=>Q.filter((U,ue)=>ue!==k))},Ie=()=>{T(k=>[...k,{fieldId:"",lookupSystemId:"",lookupObjectId:"",lookupJoinFieldId:"",lookupFetchFieldIds:[],completed:!1}])},Fe=(k,Q,U)=>{T(ue=>ue.map((M,ce)=>{if(ce===k){const le={...M,[Q]:U};if(Q==="fieldId"&&typeof U=="string"){const Se=w.find(ve=>ve.field_id===U);le.fieldName=Se?.label||Se?.name}else if(Q==="lookupSystemId"&&typeof U=="string"){const Se=N.find(ve=>ve.id===U);le.lookupSystemName=Se?.name}else if(Q==="lookupObjectId"&&typeof U=="string"){const Se=Z.find(ve=>ve.object_id===U);le.lookupObjectName=Se?.name}else if(Q==="lookupJoinFieldId"&&typeof U=="string"){const Se=he.find(ve=>ve.field_id===U);le.lookupJoinFieldName=Se?.label||Se?.name}else Q==="lookupFetchFieldIds"&&Array.isArray(U)&&(le.lookupFetchFieldNames=U.map(Se=>{const ve=he.find(B=>B.field_id===Se);return ve?.label||ve?.name||Se}));return le}return M}))},de=k=>{T(Q=>Q.filter((U,ue)=>ue!==k))},qe=async k=>{const Q=S[k];if(!Q.fieldId||!Q.lookupSystemId||!Q.lookupObjectId||!Q.lookupJoinFieldId||Q.lookupFetchFieldIds.length===0){P({open:!0,message:"Please fill all required fields before saving",severity:"warning"});return}try{const U=w.find(le=>le.field_id===Q.fieldId),ue=N.find(le=>le.id===Q.lookupSystemId),M=he.find(le=>le.field_id===Q.lookupJoinFieldId),ce=Q.lookupFetchFieldIds.map(le=>he.find(Se=>Se.field_id===le)).filter(Boolean);if(U&&ue&&M&&ce.length>0){const le={id:Q.id||null,source_field:U.name,source_object:t?.object_id||"",lookup_system:Q.lookupSystemId,lookup_object:Q.lookupObjectId,lookup_join_field:M.name,lookup_fetch_field:ce.map(Se=>Se.name),default_value:"String",tenant_key:i?.tenant_id||"3fa85f64-5717-4562-b3fc-2c963f66afa6",created_by:null,created_date:null,modified_by:null,modified_date:null};console.log("Manual Lookup Save Payload:",le),Q.id?await F(le).unwrap():await b(le).unwrap(),T(Se=>Se.map((ve,B)=>B===k?{...ve,completed:!0}:ve)),P({open:!0,message:`Lookup relation saved successfully for ${U.name}`,severity:"success"})}}catch(U){console.error("Failed to save lookup relation:",U),P({open:!0,message:`Failed to save lookup relation: ${U?.data?.message||U?.message||"Unknown error"}`,severity:"error"})}},Ne=Ke.useRef(null);Ke.useEffect(()=>(Ne.current&&clearTimeout(Ne.current),Ne.current=setTimeout(async()=>{for(const k of p)if(k.fieldId&&k.systemId&&k.relatedObjectId&&k.relatedFieldId&&!k.completed)try{const Q=w.find(M=>M.field_id===k.fieldId),U=N.find(M=>M.id===k.systemId),ue=D.find(M=>M.field_id===k.relatedFieldId);if(Q&&U&&ue){const M={objectId:t?.object_id||"",fieldId:k.fieldId,updates:{field_id:k.fieldId,fk_field:ue.name,fk_object:k.relatedObjectName||k.relatedObjectId,fk_system:U.type,is_fk:"true",is_pk:null,is_unique:null}};console.log("Foreign Key Update Payload:",M),await R(M).unwrap(),m(ce=>ce.map(le=>le.fieldId===k.fieldId?{...le,completed:!0}:le)),P({open:!0,message:`Foreign key relation updated successfully for ${Q.name}`,severity:"success"})}}catch(Q){console.error("Failed to update foreign key metadata:",Q),P({open:!0,message:`Failed to update foreign key relation: ${Q?.data?.message||Q?.message||"Unknown error"}`,severity:"error"})}},1e3),()=>{Ne.current&&clearTimeout(Ne.current)}),[p,t?.object_id]);const Oe=Ke.useRef(null);Ke.useEffect(()=>(Oe.current&&clearTimeout(Oe.current),Oe.current=setTimeout(async()=>{for(const k of S)if(k.fieldId&&k.lookupSystemId&&k.lookupObjectId&&k.lookupJoinFieldId&&k.lookupFetchFieldIds.length>0&&!k.completed)try{const Q=w.find(ce=>ce.field_id===k.fieldId),U=N.find(ce=>ce.id===k.lookupSystemId),ue=he.find(ce=>ce.field_id===k.lookupJoinFieldId),M=k.lookupFetchFieldIds.map(ce=>he.find(le=>le.field_id===ce)).filter(Boolean);if(Q&&U&&ue&&M.length>0){const ce={id:k.id||null,source_field:Q.name,source_object:t?.object_id||"",lookup_system:k.lookupSystemId,lookup_object:k.lookupObjectId,lookup_join_field:ue.name,lookup_fetch_field:M.map(le=>le.name),default_value:"String",tenant_key:i?.tenant_id||"3fa85f64-5717-4562-b3fc-2c963f66afa6",created_by:null,created_date:null,modified_by:null,modified_date:null};console.log("Lookup Relation Update Payload:",ce),k.id?await F(ce).unwrap():await b(ce).unwrap(),T(le=>le.map(Se=>Se.fieldId===k.fieldId?{...Se,completed:!0}:Se)),P({open:!0,message:`Lookup relation updated successfully for ${Q.name}`,severity:"success"})}}catch(Q){console.error("Failed to update lookup relation:",Q),P({open:!0,message:`Failed to update lookup relation: ${Q?.data?.message||Q?.message||"Unknown error"}`,severity:"error"})}},1e3),()=>{Oe.current&&clearTimeout(Oe.current)}),[]);const st=Ke.useRef(null);Ke.useEffect(()=>{if(!(!q.current||u===V.current))return st.current&&clearTimeout(st.current),st.current=setTimeout(async()=>{if(u&&t?.object_id){const k=w.find(Q=>Q.name===u);if(k)try{console.log("Primary Key Update:",{from:V.current,to:u,fieldId:k.field_id}),await R({objectId:t.object_id,fieldId:k.field_id,updates:{field_id:k.field_id,fk_field:null,fk_object:null,fk_system:null,is_fk:null,is_pk:"true",is_unique:null}}).unwrap(),V.current=u,P({open:!0,message:`Primary key updated successfully for ${k.name}`,severity:"success"})}catch(Q){console.error("Failed to update primary key metadata:",Q),P({open:!0,message:`Failed to update primary key: ${Q?.data?.message||Q?.message||"Unknown error"}`,severity:"error"})}}},1e3),()=>{st.current&&clearTimeout(st.current)}},[u,t?.object_id]);const K=Ke.useRef(null);Ke.useEffect(()=>{if(!(!q.current||JSON.stringify(y.sort())===JSON.stringify(v.current.sort())))return K.current&&clearTimeout(K.current),K.current=setTimeout(async()=>{const k=v.current.filter(U=>!y.includes(U));for(const U of k){const ue=w.find(M=>M.name===U);if(ue)try{await R({objectId:t.object_id,fieldId:ue.field_id,updates:{field_id:ue.field_id,is_unique:null}}).unwrap()}catch(M){console.error("Failed to clear unique key metadata:",M)}}const Q=y.filter(U=>!v.current.includes(U));for(const U of Q)if(U&&t?.object_id){const ue=w.find(M=>M.name===U);if(ue)try{await R({objectId:t.object_id,fieldId:ue.field_id,updates:{field_id:ue.field_id,fk_field:null,fk_object:null,fk_system:null,is_fk:null,is_pk:null,is_unique:"true"}}).unwrap(),P({open:!0,message:`Unique key updated successfully for ${ue.name}`,severity:"success"})}catch(M){console.error("Failed to update unique key metadata:",M),P({open:!0,message:`Failed to update unique key: ${M?.data?.message||M?.message||"Unknown error"}`,severity:"error"})}}v.current=[...y]},1e3),()=>{K.current&&clearTimeout(K.current)}},[y,t?.object_id]);const Ce=()=>{P(k=>({...k,open:!1}))};return O?e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Analyze and Define Keys and Relationship"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Loading metadata..."})]}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:"Analyze and Define Keys and Relationship"}),e.jsx(xs,{activity:"Relationship",disabled:l("Mapping")})]}),e.jsxs(me,{elevation:1,sx:{p:3,mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Primary Key"}),e.jsxs(Ae,{fullWidth:!0,sx:{mt:2},children:[e.jsx(Me,{children:"Select Primary Key Field"}),e.jsx(We,{value:u,onChange:k=>f(k.target.value),label:"Select Primary Key Field",children:w.map((k,Q)=>e.jsxs(re,{value:k.name,children:[k.label," (",k.name,") - ",k.datatype]},k.name||k.field_id||`field-${Q}`))})]})]}),e.jsx(it,{sx:{my:3}}),e.jsxs(me,{elevation:1,sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",children:"Unique Key Fields"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Kt,{}),onClick:_e,disabled:y.some(k=>k==="")||c,title:y.some(k=>k==="")?"Complete the current unique key field first":"Add another unique key field",children:"Add Field"})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:y.map((k,Q)=>e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Ae,{fullWidth:!0,children:[e.jsxs(Me,{children:["Select Unique Field ",Q+1]}),e.jsx(We,{value:k,onChange:U=>A(Q,U.target.value),label:`Select Unique Field ${Q+1}`,disabled:!!k&&w.find(U=>U.name===k)?.is_unique==="true",children:te(Q).map((U,ue)=>e.jsxs(re,{value:U.name,children:[U.label," (",U.name,") - ",U.datatype]},U.name||U.field_id||`unique-field-${Q}-${ue}`))})]}),y.length>1&&e.jsx(ne,{color:"error",onClick:()=>z(Q),children:e.jsx(ds,{})})]},Q))})]}),e.jsx(it,{sx:{my:3}}),e.jsxs(me,{elevation:1,sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",children:"Foreign Key Relations"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Kt,{}),onClick:I,disabled:p.some(k=>!k.completed)||c,title:p.some(k=>!k.completed)?"Complete the current foreign key relation first":"Add another foreign key relation",children:"Add Field"})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:p.map((k,Q)=>e.jsxs(n,{sx:{border:"1px solid #e0e0e0",borderRadius:2,p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"bold",children:["Foreign Key Relation ",Q+1]}),p.length>1&&e.jsx(ne,{color:"error",size:"small",onClick:()=>se(Q),children:e.jsx(ds,{})})]}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Foreign Key Field"}),e.jsx(We,{value:k.fieldId,onChange:U=>J(Q,"fieldId",U.target.value),label:"Foreign Key Field",disabled:k.completed,children:w.map((U,ue)=>e.jsxs(re,{value:U.field_id,children:[U.label," (",U.name,")"]},U.field_id||U.name||`field-${ue}`))})]})}),k.fieldId&&e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"System"}),e.jsx(We,{value:k.systemId,onChange:U=>J(Q,"systemId",U.target.value),label:"System",disabled:k.completed,children:N.map(U=>e.jsxs(re,{value:U.id,children:[U.name," (",U.type,")"]},U.id))})]})}),k.fieldId&&k.systemId&&e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",disabled:k.completed,children:[e.jsx(Me,{children:"Related Object"}),e.jsx(We,{value:k.relatedObjectId,onChange:U=>J(Q,"relatedObjectId",U.target.value),label:"Related Object",disabled:k.completed,children:k.completed||k.systemId===G?k.completed?e.jsx(re,{value:k.relatedObjectId,children:k.relatedObjectName||k.relatedObjectId}):E.map(U=>e.jsx(re,{value:U.object_id,children:U.name},U.object_id)):e.jsx(re,{value:"",disabled:!0,children:"Select a system first"})})]})}),k.fieldId&&k.systemId&&k.relatedObjectId&&e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(Ae,{fullWidth:!0,size:"small",disabled:k.completed,children:[e.jsx(Me,{children:"Related Field"}),e.jsx(We,{value:k.relatedFieldId,onChange:U=>J(Q,"relatedFieldId",U.target.value),label:"Related Field",disabled:k.completed,children:k.completed||k.relatedObjectId===_?k.completed?e.jsx(re,{value:k.relatedFieldId,children:k.relatedFieldName||k.relatedFieldId}):D.map((U,ue)=>e.jsxs(re,{value:U.field_id,children:[U.label," (",U.name,")"]},U.field_id||U.name||`related-field-${ue}`)):e.jsx(re,{value:"",disabled:!0,children:"Select a related object first"})})]})})]})]},Q))})]}),e.jsx(it,{sx:{my:3}}),e.jsxs(me,{elevation:1,sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",children:"Lookup Relations"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Kt,{}),onClick:Ie,disabled:S.some(k=>!k.completed)||c,title:S.some(k=>!k.completed)?"Complete the current lookup relation first":"Add another lookup relation",children:"Add Field"})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:S.map((k,Q)=>e.jsxs(n,{sx:{border:"1px solid #e0e0e0",borderRadius:2,p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(r,{variant:"subtitle1",fontWeight:"bold",children:["Lookup Relation ",Q+1,k.completed&&e.jsx(mt,{sx:{ml:1,color:"success.main",fontSize:"1rem"}})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[!k.completed&&e.jsx(ne,{color:"success",size:"small",onClick:()=>qe(Q),title:"Save lookup relation",children:e.jsx(_s,{})}),S.length>1&&e.jsx(ne,{color:"error",size:"small",onClick:()=>de(Q),disabled:k.completed,children:e.jsx(ds,{})})]})]}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Source Field"}),e.jsx(We,{value:k.fieldId,onChange:U=>Fe(Q,"fieldId",U.target.value),label:"Source Field",disabled:k.completed,children:w.map((U,ue)=>e.jsxs(re,{value:U.field_id,children:[U.label," (",U.name,")"]},U.field_id||U.name||`field-${ue}`))})]})}),k.fieldId&&e.jsx(j,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Lookup System"}),e.jsx(We,{value:k.lookupSystemId,onChange:U=>Fe(Q,"lookupSystemId",U.target.value),label:"Lookup System",disabled:k.completed,children:N.map(U=>e.jsxs(re,{value:U.id,children:[U.name," (",U.type,")"]},U.id))})]})}),k.fieldId&&k.lookupSystemId&&e.jsx(j,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",disabled:k.completed,children:[e.jsx(Me,{children:"Lookup Object"}),e.jsx(We,{value:k.lookupObjectId,onChange:U=>Fe(Q,"lookupObjectId",U.target.value),label:"Lookup Object",disabled:k.completed,children:k.completed||k.lookupSystemId===C?k.completed?e.jsx(re,{value:k.lookupObjectId,children:k.lookupObjectName||k.lookupObjectId}):Z.map(U=>e.jsx(re,{value:U.object_id,children:U.name},U.object_id)):e.jsx(re,{value:"",disabled:!0,children:"Select a lookup system first"})})]})}),k.fieldId&&k.lookupSystemId&&k.lookupObjectId&&e.jsx(j,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",disabled:k.completed,children:[e.jsx(Me,{children:"Lookup Join Field"}),e.jsx(We,{value:k.lookupJoinFieldId,onChange:U=>Fe(Q,"lookupJoinFieldId",U.target.value),label:"Lookup Join Field",disabled:k.completed,children:k.completed||k.lookupObjectId===oe?k.completed?e.jsx(re,{value:k.lookupJoinFieldId,children:k.lookupJoinFieldName||k.lookupJoinFieldId}):he.map((U,ue)=>e.jsxs(re,{value:U.field_id,children:[U.label," (",U.name,")"]},U.field_id||U.name||`lookup-field-${ue}`)):e.jsx(re,{value:"",disabled:!0,children:"Select a lookup object first"})})]})}),k.fieldId&&k.lookupSystemId&&k.lookupObjectId&&k.lookupJoinFieldId&&e.jsx(j,{item:!0,xs:12,sm:6,md:2.4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",disabled:k.completed,children:[e.jsx(Me,{children:"Lookup Fetch Fields"}),k.completed?e.jsx(ye,{value:k.lookupFetchFieldNames?.join(", ")||"",label:"Lookup Fetch Fields",disabled:!0,size:"small"}):e.jsx(We,{multiple:!0,value:k.lookupFetchFieldIds,onChange:U=>Fe(Q,"lookupFetchFieldIds",U.target.value),label:"Lookup Fetch Fields",renderValue:U=>U.map(M=>{const ce=he.find(le=>le.field_id===M);return ce?.label||ce?.name||M}).join(", "),children:he.map((U,ue)=>e.jsxs(re,{value:U.field_id,children:[e.jsx(rs,{checked:k.lookupFetchFieldIds.indexOf(U.field_id)>-1,size:"small"}),U.label," (",U.name,")"]},U.field_id||U.name||`lookup-fetch-field-${ue}`))})]})})]})]},Q))})]}),e.jsx(dt,{open:g.open,autoHideDuration:6e3,onClose:Ce,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:Ce,severity:g.severity,sx:{width:"100%"},children:g.message})})]})},Ju=({open:t,onClose:s,allColumns:a,visibleColumns:i,onVisibleColumnsChange:l,objectId:d,refetch:c})=>{const[u,f]=o.useState(new Set),[y,h]=o.useState(!1),[p,m]=o.useState({open:!1,message:"",severity:"success"}),[S]=Cc();o.useEffect(()=>{t&&(c(),f(new Set(i)),h(!1),m({open:!1,message:"",severity:"success"}))},[t,i,c]);const T=w=>{const O=new Set(u);O.has(w)?O.delete(w):O.add(w),f(O)},g=()=>{f(new Set(a))},P=()=>{f(new Set)},$=async()=>{l(u),h(!0);try{if(console.log("objectId type:",typeof d,"value:",JSON.stringify(d)),!d||d.trim()===""){console.error("objectId is missing or empty"),m({open:!0,message:"Object ID is missing. Please select an object first.",severity:"error"}),h(!1);return}const w=a.filter(N=>!u.has(N)),O={object_id:d,columns_to_remove:w,for_migrate:!1};console.log("objectId:",d),console.log("API Payload:",O),await S(O).unwrap(),m({open:!0,message:"Columns updated successfully",severity:"success"}),setTimeout(()=>{s()},1500)}catch{m({open:!0,message:"Failed to update columns",severity:"error"})}finally{h(!1)}},V=()=>{s()},v=()=>{m({...p,open:!1})};return e.jsxs(e.Fragment,{children:[e.jsx(Et,{anchor:"right",open:t,onClose:s,sx:{zIndex:w=>w.zIndex.drawer+3,"& .MuiDrawer-paper":{width:400,boxSizing:"border-box",height:"100vh",top:0,zIndex:w=>w.zIndex.drawer+3}},BackdropProps:{sx:{backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:w=>w.zIndex.drawer+2}},children:e.jsxs(n,{sx:{p:3,display:"flex",flexDirection:"column",height:"100vh",overflow:"auto"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",children:"Filter Columns"}),e.jsx(ne,{onClick:s,disabled:y,children:e.jsx(ct,{})})]}),e.jsx(it,{sx:{mb:3}}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:3},children:[e.jsx(H,{fullWidth:!0,variant:"outlined",size:"small",onClick:g,disabled:y,children:"Select All"}),e.jsx(H,{fullWidth:!0,variant:"outlined",size:"small",onClick:P,disabled:y,children:"Deselect All"})]}),e.jsx(n,{sx:{flexGrow:1,overflow:"auto"},children:e.jsx(To,{children:a.map(w=>e.jsx(nt,{control:e.jsx(rs,{checked:u.has(w),onChange:()=>T(w),disabled:y}),label:w},w))})}),e.jsxs(n,{sx:{display:"flex",gap:1,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(H,{fullWidth:!0,variant:"outlined",onClick:V,disabled:y,children:"Cancel"}),e.jsx(H,{fullWidth:!0,variant:"contained",onClick:$,disabled:y||!d||d.trim()==="",startIcon:y?e.jsx(ie,{size:20}):void 0,children:y?"Saving...":"Save"})]})]})}),e.jsx(dt,{open:p.open,autoHideDuration:4e3,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:v,severity:p.severity,children:p.message})})]})},Yu=({open:t,onClose:s,objectId:a,rowFilters:i,onRowFiltersChange:l})=>{const[d,c]=o.useState(null),[u,f]=o.useState({}),[y,h]=o.useState(""),[p,m]=o.useState(""),[S,T]=o.useState(""),[g,P]=o.useState(""),{data:$,isLoading:V,error:v}=js(a,{skip:!a||!t}),q=$||[];o.useEffect(()=>{t&&(f({...i}),m(""),T(""),P(""))},[t,i]),o.useEffect(()=>{p&&S&&p>S?P("Start date cannot be after end date"):P("")},[p,S]);const w=_=>(D,C)=>{c(C?_:null)},O=(_,D)=>{f(C=>({...C,[_]:D}))},N=()=>{const _={...u};y&&(p||S)&&(_[y]=`${p}-${S}`),l(_),s()},R=Object.keys(u).filter(_=>u[_].trim()!==""),b=q.filter(_=>_.name.toLowerCase().includes("date")||_.name.toLowerCase().includes("time")||_.name.toLowerCase().includes("created")||_.name.toLowerCase().includes("modified")||_.name.toLowerCase().includes("updated")||_.name.toLowerCase().includes("timestamp")||_.datatype?.toLowerCase().includes("date")||_.datatype?.toLowerCase().includes("time")||_.is_date==="true"||_.is_datetime==="true"||_.is_time==="true");b.sort((_,D)=>(_.label||_.name).localeCompare(D.label||D.name));const F=q.map(_=>_.name),G=[{type:"date",title:"Filter by Date",icon:e.jsx(Ns,{}),fields:y?[y]:[]},{type:"numeric",title:"Filter by Numeric Range",icon:e.jsx(Io,{}),fields:F},{type:"value",title:"Filter by Value",icon:e.jsx(ja,{}),fields:F},{type:"reference",title:"Filter by Reference",icon:e.jsx(zr,{}),fields:F}];return e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end",zIndex:_=>_.zIndex.modal,p:0},children:e.jsx(me,{sx:{width:500,height:"100vh",m:0,p:0,borderRadius:0,overflow:"auto",boxShadow:24},children:e.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{bgcolor:"#1565c0",color:"white",p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600},children:"Filter Rows"}),e.jsx(ne,{onClick:s,sx:{color:"white"},children:e.jsx(ct,{})})]}),e.jsxs(n,{sx:{p:2,bgcolor:"#f9f9f9",borderBottom:"1px solid #e0e0e0"},children:[e.jsx(r,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Applied Filters"}),R.length>0?e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:R.map(_=>e.jsx(X,{label:`${_}: ${u[_]}`,onDelete:()=>{f(D=>{const C={...D};return delete C[_],C})},size:"small",sx:{backgroundColor:"grey.200",color:"black"}},_))}):e.jsx(r,{variant:"body2",sx:{color:"grey.600"},children:"No filters applied"})]}),V&&e.jsx(n,{sx:{p:3,textAlign:"center"},children:e.jsx(r,{children:"Loading metadata fields..."})}),v&&e.jsx(n,{sx:{p:3},children:e.jsx(r,{color:"error",children:"Failed to load metadata fields"})}),!V&&!v&&e.jsx(n,{sx:{flexGrow:1,overflow:"auto",p:2,bgcolor:"#fafafa"},children:G.map((_,D)=>e.jsx(De,{sx:{mb:D<G.length-1?2:0,backgroundColor:"grey.100",border:"1px solid",borderColor:"grey.300"},children:e.jsxs(cr,{expanded:d===_.type,onChange:w(_.type),sx:{"&:before":{display:"none"},boxShadow:"none",backgroundColor:"transparent"},children:[e.jsxs(dr,{expandIcon:e.jsx(Xt,{}),sx:{"& .MuiAccordionSummary-content":{alignItems:"center",gap:1},px:2,py:1},children:[_.icon,e.jsx(r,{variant:"h6",sx:{color:"grey.800"},children:_.title})]}),e.jsx(ur,{sx:{px:2,pb:2},children:_.type==="date"?e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Select Date Field"}),e.jsxs(We,{value:y,label:"Select Date Field",onChange:C=>h(C.target.value),children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select a date field"})}),b.map((C,oe)=>e.jsx(re,{value:C.name,children:C.name},C.name||C.field_id||`date-field-${oe}`))]})]})}),y&&e.jsxs(e.Fragment,{children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"Start Date",type:"date",value:p,onChange:C=>m(C.target.value),size:"small",InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white"}}})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"End Date",type:"date",value:S,onChange:C=>T(C.target.value),size:"small",error:!!g,helperText:g,InputLabelProps:{shrink:!0},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white"}}})})]})]}):e.jsx(j,{container:!0,spacing:2,children:_.fields.map(C=>e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{fullWidth:!0,label:`Filter ${C}`,value:u[C]||"",onChange:oe=>O(C,oe.target.value),placeholder:`Enter value to filter ${C}...`,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"white"}}})},C))})})]})},_.type))}),e.jsxs(n,{sx:{display:"flex",gap:1,p:3,borderTop:1,borderColor:"divider"},children:[e.jsx(H,{fullWidth:!0,variant:"outlined",onClick:s,children:"Close"}),e.jsx(H,{fullWidth:!0,variant:"contained",onClick:N,children:"Apply Filters"})]})]})})})},Pi=()=>{const{selectedObject:t}=ke(te=>te.migration),{selectedEnvironment:s}=ke(te=>te.app),{getReadOnlyFlag:a,getCompletionStatus:i,getActivityStatus:l}=os(),[d,c]=o.useState(0),[u,f]=o.useState(10),[y,h]=o.useState(""),p=o.useRef(null),[m,S]=o.useState(null),[T,g]=o.useState(!1),[P,$]=o.useState(!1),[V,v]=o.useState(new Set),[q,w]=o.useState({}),[O,N]=o.useState([]),R=a("Filter")||i("Mapping");i("Mapping");const{data:W,isLoading:b,error:F,isFetching:G,refetch:E}=wc({objectId:t?.object_id||"",environmentId:s?.id,page:d+1,limit:u},{skip:!t?.object_id||!s?.id});o.useEffect(()=>{t?.object_id&&s?.id&&(c(0),h(""),S(null),v(new Set),w({}),N([]),g(!1),$(!1),E())},[t?.object_id,s?.id,E]),o.useEffect(()=>{t?.object_id&&s?.id&&l(t.object_id)},[t?.object_id,s?.id,l]),o.useEffect(()=>{if(m!==null&&p.current){const te=p.current.querySelector(`[data-row-index="${m}"]`);te&&te.scrollIntoView({behavior:"smooth",block:"center"})}},[m]);const _=(te,I)=>{c(I),S(null)},D=te=>{const I=parseInt(te.target.value,10);f(I),c(0),S(null)},C=te=>{const I=te.target.value.toLowerCase();if(h(I),I&&W?.contents){const J=W.contents.findIndex(se=>se&&Object.values(se).some(Ie=>Ie!=null&&Ie.toString().toLowerCase().includes(I)));S(J!==-1?J:null)}else S(null)},oe=()=>{E(),h(""),S(null)},Z=W?.contents||[],he=Ke.useMemo(()=>Z.length>0?Object.keys(Z[0]):[],[Z]),_e=Ke.useMemo(()=>he.filter(te=>V.has(te)),[he,V]);(W?.contents||[]).filter(te=>Object.keys(q).every(I=>{const J=q[I];if(!J)return!0;const se=te[I]?.toString()||"";if(J.includes("-")){const[Ie,Fe]=J.split("-");if(Ie&&Fe)return se>=Ie&&se<=Fe;if(Ie)return se>=Ie;if(Fe)return se<=Fe}return se.toLowerCase().includes(J.toLowerCase())})),o.useEffect(()=>{he.length>0&&V.size===0&&v(new Set(he))},[he,V.size]),o.useEffect(()=>{he.length>0&&O.length===0&&N(he)},[he,O.length]);const A=(te,I)=>{if(!I||te==null)return te?.toString()||"-";const J=te.toString(),se=new RegExp(`(${I})`,"gi");return J.split(se).map((Fe,de)=>se.test(Fe)?e.jsx("span",{style:{backgroundColor:"#fff3cd",fontWeight:"bold"},children:Fe},de):Fe)};return t?b?e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Filtering - ",t.object_name]}),e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})})]}):F?e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Filtering - ",t.object_name]}),e.jsx(ae,{severity:"error",children:"Failed to load filter data. Please try again later."})]}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"center"},gap:2,mb:2},children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Filtering - ",t.object_name]}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(xs,{activity:"Filter",disabled:i("Mapping")}),e.jsx(H,{variant:"outlined",size:"small",onClick:()=>g(!0),disabled:R||!t?.object_id,children:"Filter Columns"}),e.jsx(H,{variant:"outlined",size:"small",onClick:()=>$(!0),disabled:R,children:"Filter Rows"}),e.jsx(ye,{size:"small",placeholder:"Search in data...",value:y,onChange:C,InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(lr,{})})},sx:{minWidth:{xs:"200px",sm:"250px"}}}),e.jsx(je,{title:"Refresh data",children:e.jsx("span",{children:e.jsx(ne,{onClick:oe,disabled:G||R,color:"primary",children:e.jsx(Dt,{})})})})]})]}),e.jsxs(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:["View and search through filtered data for ",t.object_name,". Use the search bar to find specific values - matching text will be highlighted and the row will auto-scroll into view."]}),W&&e.jsxs(n,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(X,{label:`File: ${W.filename}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Total Records: ${W.total_records}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Current Page: ${W.page}`,variant:"outlined",color:"secondary"}),e.jsx(X,{label:`Total Pages: ${W.total_pages}`,variant:"outlined"}),e.jsx(X,{label:`Page Size: ${W.page_size}`,variant:"outlined"}),e.jsx(X,{label:`Showing: ${Z.length} records`,variant:"filled",color:"info"}),y&&e.jsx(X,{label:`Search: "${y}"`,variant:"filled",color:"warning"})]}),e.jsx(tt,{component:me,elevation:2,ref:p,sx:{maxHeight:"60vh",overflow:"auto"},children:e.jsxs(Je,{sx:{minWidth:650,tableLayout:"fixed"},"aria-label":"filter data table",size:"small",children:[e.jsx(Xe,{sx:{position:"sticky",top:0,backgroundColor:"background.paper",zIndex:1},children:e.jsx(pe,{sx:{backgroundColor:"primary.light"},children:_e.map(te=>e.jsx(x,{sx:{color:"white",fontWeight:"bold",whiteSpace:"nowrap"},children:te},te))})}),e.jsx(Ye,{children:Z.map((te,I)=>e.jsx(pe,{"data-row-index":I,sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:"action.hover"},...m===I&&{backgroundColor:"#fff3cd",border:"2px solid #ffc107"}},children:_e.map(J=>e.jsx(x,{sx:{width:"200px",wordWrap:"break-word"},title:te[J]?.toString()||"-",children:A(te[J],y)},J))},I))})]})}),W&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(Ss,{rowsPerPageOptions:[10,25,50,100],component:"div",count:W.total_records,rowsPerPage:u,page:d,onPageChange:_,onRowsPerPageChange:D,labelRowsPerPage:"Rows per page:",labelDisplayedRows:({from:te,to:I,count:J})=>`${te}-${I} of ${J!==-1?J:`more than ${I}`}`})}),G&&e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mt:2},children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading data..."})]}),Z.length===0&&!b&&e.jsx(me,{elevation:1,sx:{p:3,mt:2},children:e.jsx(r,{variant:"body1",textAlign:"center",color:"text.secondary",children:"No filter data found for this object."})}),e.jsx(Ju,{open:T,onClose:()=>g(!1),allColumns:he,visibleColumns:V,onVisibleColumnsChange:v,objectId:t?.object_id||"",refetch:E}),e.jsx(Yu,{open:P,onClose:()=>$(!1),objectId:t?.object_id||"",rowFilters:q,onRowFiltersChange:w})]}):e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Data Filtering"}),e.jsx(ae,{severity:"info",children:"Please select an object to view filter data."})]})},Fr={datatype:{applicable_for_dt:["all"],cleanup_text:"You have changed the Data Type to [New Value]. The system will now validate all values against this format. We have identified [n] records that cannot be converted to [New Value].",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"string",description:"Specifies the data type of the field (e.g.",hidden:!1,id:1,is_required:!0,label:"Data Type",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"datatype",permission:"W",priority:1,tenant_id:null,tooltip:"Data type of the field.",ui_control:"Dropdown",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:["string","boolean","numeric","date","time","datetime"]},max_length:{applicable_for_dt:["all"],cleanup_text:"You have set the Maximum Length to [New Value] characters. All values must now be no longer than this length. We have identified [n] records that exceed this limit.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the maximum allowed length for data in this field.",hidden:!1,id:16,is_required:!1,label:"Maximum Length",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"max_length",permission:"W",priority:1,tenant_id:null,tooltip:"Max data length.",ui_control:"Textbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},min_length:{applicable_for_dt:["all"],cleanup_text:"You have set the Minimum Length to [New Value] characters. All non-empty values must now be at least this long. We have identified [n] records that are shorter than this limit.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the minimum allowed length for the data in this field.",hidden:!1,id:26,is_required:!1,label:"Minimum Length",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"min_length",permission:"W",priority:2,tenant_id:null,tooltip:"Minimum data length.",ui_control:"Textbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},is_fixed_length:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as fixed length. All values must now conform to the detected length of [X] characters. We have identified [n] records that do not match this length.",cleanup_text_alt:"You have unmarked this field as fixed length. The length validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field has a fixed length.",hidden:!1,id:51,is_required:!1,label:"Fixed Length?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_fixed_length",permission:"W",priority:2,tenant_id:null,tooltip:"Fixed length field?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},float_precision:{applicable_for_dt:["numeric"],cleanup_text:"You have set the Float Precision to [New Value] decimal places. During transformation, numeric values will be rounded to this precision. This may result in a loss of data for values with more decimal places.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of decimal places for floating-point numbers.",hidden:!1,id:27,is_required:!1,label:"Float Precision",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"float_precision",permission:"W",priority:2,tenant_id:null,tooltip:"Precision for floats.",ui_control:"Textbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},timezone:{applicable_for_dt:["date","time","datetime"],cleanup_text:"You have set the timezone for this field to [New Value]. All datetime values in this column will now be interpreted or converted based on this timezone during processing and loading.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"UTC",description:"Specifies the timezone used for date and time data.",hidden:!1,id:3,is_required:!1,label:"Timezone",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"timezone",permission:"W",priority:2,tenant_id:null,tooltip:"Select the timezone.",ui_control:"Dropdown",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:["IST","UTC","EST","PST","GMT"]},date_format:{applicable_for_dt:["date","time","datetime"],cleanup_text:"You have specified the Date Format as [New Value]. The system will now use this exact format to parse all date values. We have identified [n] records that do not match this format and will fail validation.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the format of date values in the field.",hidden:!1,id:4,is_required:!1,label:"Date Format",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"date_format",permission:"W",priority:2,tenant_id:null,tooltip:"Date format.",ui_control:"Textbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},duration_unit:{applicable_for_dt:["string"],cleanup_text:"You have set the Duration Unit to [New Value]. The system will now interpret numeric values in this column as [New Value]. For example, a value of '30' will be treated as 30 [New Value].",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Unit of measurement for duration values (e.g.",hidden:!0,id:5,is_required:!1,label:"Duration Unit",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"duration_unit",permission:"W",priority:4,tenant_id:null,tooltip:"Unit of duration.",ui_control:"Textbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:["ss","nn","hh","dd","mm","ww","yy"]},is_timezone:{applicable_for_dt:["date","time","datetime"],cleanup_text:"You have marked this field as a timezone. All values must now match a standard IANA timezone name (e.g., America/New_York). We have identified [n] un-recognized values.",cleanup_text_alt:"You have unmarked this field as a timezone. The validation against a standard list of timezones will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Indicates whether the data includes timezone information.",hidden:!1,id:6,is_required:!1,label:"Timezone Included?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_timezone",permission:"W",priority:2,tenant_id:null,tooltip:"Has timezone info?",ui_control:"Checkbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},is_date:{applicable_for_dt:["date"],cleanup_text:"You have marked this field as a date. The system will now validate that all values can be parsed as a standard date format (e.g., YYYY-MM-DD). We have identified [n] unparsable date values.",cleanup_text_alt:"You have unmarked this field as a date. The date format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field represents a date value (e.g.",hidden:!1,id:13,is_required:!1,label:"Date Value?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_date",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a date?",ui_control:"Checkbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},is_time:{applicable_for_dt:["time"],cleanup_text:"You have marked this field as a time. All values must now conform to a standard time format (e.g., HH:MM:SS). We have identified [n] records with unparsable time values.",cleanup_text_alt:"You have unmarked this field as a time. The time format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field represents a time value (e.g.",hidden:!1,id:14,is_required:!1,label:"Time Value?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_time",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a time?",ui_control:"Checkbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},is_datetime:{applicable_for_dt:["datetime"],cleanup_text:"You have marked this field as a date & time. All values must now conform to a standard datetime format. We have identified [n] records with unparsable datetime values.",cleanup_text_alt:"You have unmarked this field as a date & time. The datetime format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field represents a combined date and time value.",hidden:!1,id:15,is_required:!1,label:"Datetime Value?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_datetime",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a datetime?",ui_control:"Checkbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},is_duration:{applicable_for_dt:["string","numeric"],cleanup_text:"You have marked this field as a duration. The system will now validate that values match a standard duration format (e.g., HH:MM:SS or ISO 8601). We have identified [n] unparsable records.",cleanup_text_alt:"You have unmarked this field as a duration. The duration format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether this field represents a duration or time interval.",hidden:!0,id:48,is_required:!1,label:"Duration Field?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_duration",permission:"W",priority:4,tenant_id:null,tooltip:"Is this a duration field?",ui_control:"Checkbox",ui_section:"Date and Time Management",ui_tab:"General",validation:"{}",values_list:"{}"},currency_code:{applicable_for_dt:["string","numeric"],cleanup_text:"You have set the currency for this field to [New Value]. All currency values will now be formatted and interpreted as [New Value] during processing and validation.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"USD",description:"Specifies the currency code for monetary values.",hidden:!1,id:2,is_required:!1,label:"Currency",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"currency_code",permission:"W",priority:3,tenant_id:null,tooltip:"Currency code.",ui_control:"Dropdown",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:["USD","EUR","INR"]},label:{applicable_for_dt:["all"],cleanup_text:"You have updated the Label. This is an informational change for data governance and does not affect how the data is processed or validated.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"A user-friendly label for the field.",hidden:!1,id:24,is_required:!0,label:"Field Label",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"label",permission:"W",priority:1,tenant_id:null,tooltip:"User-friendly field label.",ui_control:"Textbox",ui_section:"General Information",ui_tab:"General",validation:"{}",values_list:"{}"},description:{applicable_for_dt:["all"],cleanup_text:"You have updated the Description. This is an informational change for data governance and does not affect how the data is processed or validated.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"A detailed description of the field.",hidden:!1,id:25,is_required:!1,label:"Field Description",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"description",permission:"W",priority:3,tenant_id:null,tooltip:"Detailed field description.",ui_control:"TextArea",ui_section:"General Information",ui_tab:"General",validation:"{}",values_list:"{}"},permission:{applicable_for_dt:["all"],cleanup_text:"You have changed the Permission level to [New Value]. This will alter who can view the raw data and how it is masked for non-privileged users.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Permissions associated with this field.",hidden:!0,id:22,is_required:!1,label:"Permissions",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"permission",permission:"W",priority:2,tenant_id:null,tooltip:"Field permissions.",ui_control:"Dropdown",ui_section:"General Information",ui_tab:"General",validation:"{}",values_list:["Public","Internal","Confidential","Restricted"]},owner:{applicable_for_dt:["all"],cleanup_text:"You have changed the designated Owner of this field to [New Value]. This is an informational change for data governance and does not affect data processing.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"The owner of this field.",hidden:!0,id:23,is_required:!1,label:"Field Owner",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"owner",permission:"W",priority:2,tenant_id:null,tooltip:"Owner of this field.",ui_control:"Dropdown",ui_section:"General Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_required:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as required. This means the field cannot be null or empty. We have identified [n] empty records.",cleanup_text_alt:"You have unmarked this field as required. The field will now be allowed to contain null or empty values.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field is required to have a value.",hidden:!1,id:39,is_required:!1,label:"Required?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_required",permission:"W",priority:2,tenant_id:null,tooltip:"Is this field required?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},is_unique:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as unique. All values in this column must be distinct. We have identified [n] duplicate values.",cleanup_text_alt:"You have unmarked this field as unique. The uniqueness constraint will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the values in this field must be unique.",hidden:!1,id:40,is_required:!1,label:"Unique?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_unique",permission:"W",priority:2,tenant_id:null,tooltip:"Must be unique?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},text_case:{applicable_for_dt:["string"],cleanup_text:"You have set the Text Case to [New Value]. A transformation rule will be applied to convert all values in this column to [New Value] during the cleanup step.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the capitalization style of the text data.",hidden:!1,id:35,is_required:!1,label:"Text Case",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"text_case",permission:"W",priority:2,tenant_id:null,tooltip:"Capitalization Style",ui_control:"Dropdown",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:["upper","lower","sentence","title"]},security_class:{applicable_for_dt:["all"],cleanup_text:"You have changed the Security Class to [New Value]. This classification will be used to enforce security and compliance policies on this field.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"The security classification of this field.",hidden:!0,id:36,is_required:!1,label:"Security Class",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"security_class",permission:"W",priority:2,tenant_id:null,tooltip:"Security classification.",ui_control:"Dropdown",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:["Public","Internal Business","Confidential Business","PII","Sensitive PII","PHI"]},data_format:{applicable_for_dt:["all"],cleanup_text:"You have defined a custom Data Format rule. All values will now be validated against this pattern: [New Value]. We have identified [n] records that do not match this custom format.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Format of the data in this field",hidden:!1,id:37,is_required:!1,label:"Data Format",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_format",permission:"W",priority:3,tenant_id:null,tooltip:"Data format.",ui_control:"Textbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},mask:{applicable_for_dt:["all"],cleanup_text:"You have changed the Masking rule to [New Value]. This rule will be applied to the data for non-privileged users during export or display. Please ensure this format is appropriate for the data in this column.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"A mask applied to this field (e.g.",hidden:!0,id:38,is_required:!1,label:"Mask",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"mask",permission:"W",priority:2,tenant_id:null,tooltip:"Field mask.",ui_control:"Dropdown",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:["None","Full","Mask Last 4","Mask First 4","Redact Email","Hash (SHA-256)"]},is_encoded:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as encoded. The system will now validate that all values are a valid Base64 encoded string. We have identified [n] records that could not be decoded.",cleanup_text_alt:"You have unmarked this field as encoded. The Base64 format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field's values are encoded.",hidden:!1,id:50,is_required:!1,label:"Encoded?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_encoded",permission:"W",priority:3,tenant_id:null,tooltip:"Is this field encoded?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},is_case_sensitive:{applicable_for_dt:["string"],cleanup_text:"You have made this field case-sensitive. Uniqueness checks and joins will now treat 'Value' and 'value' as distinct. This may affect duplicate counts and relationship mapping.",cleanup_text_alt:"You have made this field case-insensitive. Uniqueness checks and joins will now treat 'Value' and 'value' as the same.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether case matters when comparing values in the field.",hidden:!1,id:92,is_required:!1,label:"Case-Sensitive?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_case_sensitive",permission:"W",priority:2,tenant_id:null,tooltip:"Is case important?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},is_html:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as containing HTML. The system will now check for valid HTML markup. We have identified [n] records that appear to contain unclosed or invalid tags.",cleanup_text_alt:"You have unmarked this field as containing HTML. The content will be treated as plain text, and any HTML markup will not be validated.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains HTML-formatted data.",hidden:!1,id:93,is_required:!1,label:"HTML Content?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_html",permission:"W",priority:3,tenant_id:null,tooltip:"Contains HTML?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},is_text:{applicable_for_dt:["string"],cleanup_text:"This field will now be treated as general text. Any more specific validations (like number or date formats) that were previously applied will be removed.",cleanup_text_alt:"You have unmarked this field as general text. You should now apply a more specific validation rule (e.g., mark it as an integer, date, etc.).",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!0,description:"Specifies whether the field is a general text field.",hidden:!1,id:94,is_required:!1,label:"Text Field?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_text",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a text field?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},is_picklist:{applicable_for_dt:["string","numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether this field is a picklist field.",hidden:!1,id:73,is_required:!1,label:"Picklist?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_picklist",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a picklist?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},is_float:{applicable_for_dt:["numeric"],cleanup_text:"You have marked this field as a float (decimal number). All values must now be numeric. We have identified [n] records that contain non-numeric text.",cleanup_text_alt:"You have unmarked this field as a float. The validation for numeric values will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains floating-point numbers.",hidden:!1,id:81,is_required:!1,label:"Floating-Point Number?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_float",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a float?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},is_integer:{applicable_for_dt:["numeric"],cleanup_text:"You have marked this field as an integer. All values must now be whole numbers. We have identified [n] records that contain decimals or non-numeric text.",cleanup_text_alt:"You have unmarked this field as an integer. The validation for whole numbers will be removed, and the field may be treated as text or a float.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains integer values.",hidden:!1,id:82,is_required:!1,label:"Integer?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_integer",permission:"W",priority:2,tenant_id:null,tooltip:"Is this an integer?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},max_value:{applicable_for_dt:["numeric","date","time","datetime"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the maximum allowed value for numeric fields.",hidden:!1,id:7,is_required:!1,label:"Maximum Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"max_value",permission:"R",priority:3,tenant_id:null,tooltip:"Maximum allowed value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},min_value:{applicable_for_dt:["numeric","date","time","datetime"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the minimum allowed value for numeric fields.",hidden:!1,id:8,is_required:!1,label:"Minimum Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"min_value",permission:"R",priority:3,tenant_id:null,tooltip:"Minimum allowed value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},average_value:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the average value of the data in the field.",hidden:!1,id:9,is_required:!1,label:"Average Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"average_value",permission:"R",priority:3,tenant_id:null,tooltip:"Average data value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},standard_deviation:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the standard deviation of the data in the field.",hidden:!1,id:10,is_required:!1,label:"Standard Deviation",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"standard_deviation",permission:"R",priority:3,tenant_id:null,tooltip:"Standard deviation.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},mean_value:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the mean value of the data in the field.",hidden:!1,id:11,is_required:!1,label:"Mean Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"mean_value",permission:"R",priority:3,tenant_id:null,tooltip:"Mean data value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},mode_value:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the mode value of the data in the field.",hidden:!1,id:12,is_required:!1,label:"Mode Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"mode_value",permission:"R",priority:3,tenant_id:null,tooltip:"Mode data value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},median_value:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the median value of the data in the field.",hidden:!1,id:67,is_required:!1,label:"Median Value",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"median_value",permission:"R",priority:3,tenant_id:null,tooltip:"Median data value.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},type:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"The data type of the source data.",hidden:!0,id:17,is_required:!1,label:"Original Data Type",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"type",permission:"R",priority:3,tenant_id:null,tooltip:"Original Data Type",ui_control:"Dropdown",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},field_id:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"A unique identifier for this field.",hidden:!1,id:18,is_required:!0,label:"Field ID",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"field_id",permission:"R",priority:1,tenant_id:null,tooltip:"Unique field identifier.",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},object_id:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"A unique identifier for the object this field belongs to.",hidden:!1,id:19,is_required:!0,label:"Object ID",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"object_id",permission:"R",priority:1,tenant_id:null,tooltip:"Unique object identifier.",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},system_id:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"A unique identifier for the system this field belongs to.",hidden:!1,id:20,is_required:!0,label:"System ID",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"system_id",permission:"R",priority:1,tenant_id:null,tooltip:"Unique system identifier.",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},name:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"The name of the field.",hidden:!1,id:21,is_required:!0,label:"Field Name",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"name",permission:"R",priority:1,tenant_id:null,tooltip:"Name of the field.",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},text_encoding:{applicable_for_dt:["string"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the character encoding used for text data.",hidden:!1,id:52,is_required:!1,label:"Text Encoding",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"text_encoding",permission:"R",priority:3,tenant_id:null,tooltip:"Text encoding.",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:["UTF-8","ASCII","ISO-8859-1"]},entity:{applicable_for_dt:["string"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the entity or object this field is associated with.",hidden:!1,id:90,is_required:!1,label:"Entity",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"entity",permission:"R",priority:3,tenant_id:null,tooltip:"Associated Entity",ui_control:"Textbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},is_noun:{applicable_for_dt:["string"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains noun data.",hidden:!1,id:91,is_required:!1,label:"Noun?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_noun",permission:"R",priority:3,tenant_id:null,tooltip:"Is this a noun?",ui_control:"Checkbox",ui_section:"Identification & Encoding",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_count:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"The total number of data entries in this field.",hidden:!1,id:28,is_required:!1,label:"Data Count",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_count",permission:"R",priority:1,tenant_id:null,tooltip:"Total data entries.",ui_control:"Textbox",ui_section:"Data Count & Uniqueness",ui_tab:"Analytical",validation:"{}",values_list:"{}"},null_count:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"The number of null or missing values in this field.",hidden:!1,id:29,is_required:!1,label:"Null Count",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"null_count",permission:"R",priority:1,tenant_id:null,tooltip:"Number of null values.",ui_control:"Textbox",ui_section:"Data Count & Uniqueness",ui_tab:"Analytical",validation:"{}",values_list:"{}"},unique_values_count:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"The number of unique values in this field.",hidden:!1,id:62,is_required:!1,label:"Unique Values Count",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"unique_values_count",permission:"R",priority:3,tenant_id:null,tooltip:"Number of unique values.",ui_control:"Textbox",ui_section:"Data Count & Uniqueness",ui_tab:"Analytical",validation:"{}",values_list:"{}"},outliers:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"List of outliers detected in the data.",hidden:!1,id:61,is_required:!1,label:"Outliers",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"outliers",permission:"R",priority:4,tenant_id:null,tooltip:"Detected outliers.",ui_control:"Textbox",ui_section:"Data Count & Uniqueness",ui_tab:"Analytical",validation:"{}",values_list:"{}"},fk_system:{applicable_for_dt:["all"],cleanup_text:"You have changed the Foreign Key's System to [New Value]. The system will now validate referential integrity against this new target system. We have identified [n] records that do not have a matching reference in the new target.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"The system the foreign key refers to.",hidden:!1,id:30,is_required:!1,label:"Foreign Key System",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"fk_system",permission:"W",priority:2,tenant_id:null,tooltip:"Foreign key system.",ui_control:"Dropdown",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},fk_object:{applicable_for_dt:["all"],cleanup_text:"You have changed the Foreign Key's Object to [New Value]. The system will now validate referential integrity against this new target object. We have identified [n] records that do not have a matching reference in the new target.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"The object the foreign key refers to.",hidden:!1,id:31,is_required:!1,label:"Foreign Key Object",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"fk_object",permission:"W",priority:2,tenant_id:null,tooltip:"Foreign key object.",ui_control:"Dropdown",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},fk_field:{applicable_for_dt:["all"],cleanup_text:"You have changed the Foreign Key's Field to [New Value]. The system will now validate referential integrity against this new target field. We have identified [n] records that do not have a matching reference in the new target.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Id",default_value:"",description:"The field the foreign key refers to.",hidden:!1,id:32,is_required:!1,label:"Foreign Key Field",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"fk_field",permission:"W",priority:2,tenant_id:null,tooltip:"Foreign key field.",ui_control:"Dropdown",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},is_fk:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as a Foreign Key. All values must now exist in the corresponding key field of the referenced object. We have identified [n] records that have no matching reference.",cleanup_text_alt:"You have unmarked this field as a Foreign Key. The referential integrity check will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field is a foreign key.",hidden:!1,id:33,is_required:!1,label:"Foreign Key?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_fk",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a foreign key?",ui_control:"Checkbox",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},is_pk:{applicable_for_dt:["all"],cleanup_text:"You have marked this field as a Primary Key. All values must now be unique and not null. We have identified [n] records that are either duplicates or empty.",cleanup_text_alt:"You have unmarked this field as a Primary Key. The uniqueness and non-null constraints will no longer be enforced.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field is a primary key.",hidden:!1,id:34,is_required:!1,label:"Primary Key?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_pk",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a primary key?",ui_control:"Checkbox",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},externalid:{applicable_for_dt:["string","numeric"],cleanup_text:"You have marked this field as an External ID. This enforces a unique constraint and allows it to be used for record upserts. We have identified [n] duplicate values.",cleanup_text_alt:"You have unmarked this field as an External ID. The uniqueness constraint will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:"",description:"Is this a externalid?",hidden:!0,id:49,is_required:!1,label:"ExternalId?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"externalid",permission:"W",priority:3,tenant_id:null,tooltip:"Is this a externalid?",ui_control:"Checkbox",ui_section:"Identification and Key Relationships",ui_tab:"General",validation:"{}",values_list:"{}"},is_address_line:{applicable_for_dt:["string"],cleanup_text:"You have classified this field as [New Value]. This will be used by the address validation and standardization agent to properly process the full address.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains address line data.",hidden:!1,id:53,is_required:!1,label:"Address Line?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_address_line",permission:"W",priority:2,tenant_id:null,tooltip:"Is this an address line?",ui_control:"Dropdown",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:["true","false"]},is_email:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as an email. This means all values should follow a standard email format (e.g., name@domain.com). We have identified [n] records that do not match this pattern.",cleanup_text_alt:"You have unmarked this field as an email. The email format validation will be removed, and values will be treated as plain text.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains email address data.",hidden:!1,id:54,is_required:!1,label:"Email Address?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_email",permission:"W",priority:2,tenant_id:null,tooltip:"Is this an email address?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_link:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as a web link (URL). This requires values to be a valid URL format (e.g., http://...). We have identified [n] records that do not conform to this structure.",cleanup_text_alt:"You have unmarked this field as a web link (URL). URL format validation will no longer be applied.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains URL link data.",hidden:!1,id:55,is_required:!1,label:"URL Link?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_link",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a URL?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_country:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as a country. All values must now match a recognized country name or standard code (e.g., 'United States', 'US'). We have identified [n] un-recognized values.",cleanup_text_alt:"You have unmarked this field as a country. The validation against a standard list of countries will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains country data.",hidden:!1,id:56,is_required:!1,label:"Country?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_country",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a country?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_state:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as a state/province. Values must now match a recognized state within the associated country. We have identified [n] un-recognized values.",cleanup_text_alt:"You have unmarked this field as a state/province. The validation against a standard list of states will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains state data.",hidden:!1,id:57,is_required:!1,label:"State?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_state",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a state?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_phone:{applicable_for_dt:["string","numeric"],cleanup_text:"You have marked this field as a phone number. The system will now validate that all values match a recognizable phone number pattern. We have identified [n] records that do not conform.",cleanup_text_alt:"You have unmarked this field as a phone number. The phone number pattern validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains phone number data.",hidden:!1,id:64,is_required:!1,label:"Phone Number?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_phone",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a phone number?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_pincode:{applicable_for_dt:["string","numeric"],cleanup_text:"You have marked this field as a postal/zip code. Values must now conform to the valid format for the associated country. We have identified [n] records with invalid formats.",cleanup_text_alt:"You have unmarked this field as a postal/zip code. The postal code format validation will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains postal code data.",hidden:!1,id:66,is_required:!1,label:"Postal Code?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_pincode",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a postal code?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},is_city:{applicable_for_dt:["string"],cleanup_text:"You have marked this field as a city. The system will now check if values are recognized cities within the associated state/country. We have identified [n] un-recognized values.",cleanup_text_alt:"You have unmarked this field as a city. The validation against a standard list of cities will be removed.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field contains city data.",hidden:!1,id:88,is_required:!1,label:"City?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_city",permission:"W",priority:2,tenant_id:null,tooltip:"Is this a city?",ui_control:"Checkbox",ui_section:"Geographical and Contact Information",ui_tab:"General",validation:"{}",values_list:"{}"},field_source:{applicable_for_dt:["all"],cleanup_text:"You have changed the source of this field to [New Value]. This indicates the field is not present in the original file but will be generated during a later step. Ensure the logic to create this field is correctly defined.",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"The source of this field (e.g. Database",hidden:!1,id:59,is_required:!1,label:"Field Source",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"field_source",permission:"W",priority:3,tenant_id:null,tooltip:"Source of the field data.",ui_control:"Dropdown",ui_section:"Data Source and Migration",ui_tab:"General",validation:"{}",values_list:"{}"},for_migrate:{applicable_for_dt:["all"],cleanup_text:"This field is now marked for migration and will be included in the data loading process.",cleanup_text_alt:"This field will now be excluded from the migration process and will not be loaded into the target system.",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!0,description:"Specifies whether the field should be included in data migration processes.",hidden:!1,id:60,is_required:!1,label:"Include in Migration?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"for_migrate",permission:"W",priority:2,tenant_id:null,tooltip:"Include in data migration?",ui_control:"Checkbox",ui_section:"Data Source and Migration",ui_tab:"General",validation:"{}",values_list:"{}"},picklist_values:{applicable_for_dt:["string","numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"A comma-separated list of possible values for a picklist.",hidden:!1,id:47,is_required:!1,label:"Picklist Values",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"picklist_values",permission:"R",priority:1,tenant_id:null,tooltip:"Picklist options.",ui_control:"Textbox",ui_section:"Picklist & Selection",ui_tab:"Analytical",validation:"{}",values_list:"{}"},is_multi_picklist:{applicable_for_dt:["string","numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field allows multiple selections from a predefined list.",hidden:!1,id:65,is_required:!1,label:"Multi-select Picklist?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_multi_picklist",permission:"R",priority:3,tenant_id:null,tooltip:"Multiple selections allowed?",ui_control:"Checkbox",ui_section:"Picklist & Selection",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_trend:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the overall trend of the data (e.g.",hidden:!1,id:83,is_required:!1,label:"Data Trend",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_trend",permission:"R",priority:3,tenant_id:null,tooltip:"Overall data trend.",ui_control:"Textbox",ui_section:"Data Trends & Distribution",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_distribution:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the distribution of the data (e.g.",hidden:!1,id:84,is_required:!1,label:"Data Distribution",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_distribution",permission:"R",priority:3,tenant_id:null,tooltip:"Data distribution.",ui_control:"Textbox",ui_section:"Data Trends & Distribution",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_trend_direction:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"String",default_value:"",description:"Specifies the direction of the data trend (e.g.",hidden:!1,id:85,is_required:!1,label:"Trend Direction",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_trend_direction",permission:"R",priority:3,tenant_id:null,tooltip:"Direction of data trend.",ui_control:"Textbox",ui_section:"Data Trends & Distribution",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_quality:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Float",default_value:"",description:"Percentage representing the quality of data in this field.",hidden:!0,id:87,is_required:!1,label:"Data Quality (%)",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_quality",permission:"R",priority:1,tenant_id:null,tooltip:"Data quality percentage.",ui_control:"Textbox",ui_section:"Data Trends & Distribution",ui_tab:"Analytical",validation:"{}",values_list:"{}"},data_density:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Float",default_value:"",description:"Percentage representing the density of data in this field.",hidden:!0,id:76,is_required:!1,label:"Data Density (%)",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"data_density",permission:"R",priority:1,tenant_id:null,tooltip:"Data density percentage.",ui_control:"Textbox",ui_section:"Data Trends & Distribution",ui_tab:"Analytical",validation:"{}",values_list:"{}"},lt_zero_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values less than zero.",hidden:!1,id:68,is_required:!1,label:"Values < 0",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"lt_zero_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values less than zero.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},gt_zero_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values greater than zero.",hidden:!1,id:69,is_required:!1,label:"Values > 0",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"gt_zero_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values greater than zero.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},eq_zero_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values equal to zero.",hidden:!1,id:70,is_required:!1,label:"Values = 0",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"eq_zero_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values equal to zero.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},lt_mean_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values less than the mean.",hidden:!1,id:74,is_required:!1,label:"Values < Mean",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"lt_mean_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values less than the mean.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},gt_mean_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values greater than the mean.",hidden:!1,id:75,is_required:!1,label:"Values > Mean",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"gt_mean_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values greater than the mean.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},eq_mean_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values equal to the mean.",hidden:!1,id:77,is_required:!1,label:"Values = Mean",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"eq_mean_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values equal to the mean.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},lt_median_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values less than the median.",hidden:!1,id:78,is_required:!1,label:"Values < Median",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"lt_median_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values less than the median.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},gt_median_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values greater than the median.",hidden:!1,id:79,is_required:!1,label:"Values > Median",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"gt_median_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values greater than the median.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},eq_median_count:{applicable_for_dt:["numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Integer",default_value:"",description:"Specifies the number of values equal to the median.",hidden:!1,id:80,is_required:!1,label:"Values = Median",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"eq_median_count",permission:"R",priority:3,tenant_id:null,tooltip:"Count of values equal to the median.",ui_control:"Textbox",ui_section:"Data Properties & Characteristics",ui_tab:"Analytical",validation:"{}",values_list:"{}"},is_null:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:!1,description:"Specifies whether the field can have a null value.",hidden:!1,id:58,is_required:!1,label:"Allow Null?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"is_null",permission:"W",priority:3,tenant_id:null,tooltip:"Can this be null?",ui_control:"Checkbox",ui_section:"Validation and Formatting",ui_tab:"General",validation:"{}",values_list:"{}"},nullable:{applicable_for_dt:["all"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:"",description:"Specifies whether the field can accept NULL values.",hidden:!0,id:86,is_required:!1,label:"Nullable?",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"nullable",permission:"W",priority:3,tenant_id:null,tooltip:"Can this field be null?",ui_control:"Checkbox",ui_section:"Data Type and Structure",ui_tab:"General",validation:"{}",values_list:"{}"},autoNumber:{applicable_for_dt:["string","numeric"],cleanup_text:"",cleanup_text_alt:"",created_by:null,created_date:"2025-02-02T10:42:06.669Z",data_type:"Boolean",default_value:"",description:"Is this a autoNumber",hidden:!0,id:63,is_required:!1,label:"AutoNumber",modified_by:null,modified_date:"2025-02-02T10:42:06.669Z",name:"autoNumber",permission:"R",priority:3,tenant_id:null,tooltip:"Is this a autoNumber",ui_control:"Checkbox",ui_section:"Data Count & Uniqueness",ui_tab:"Analytical",validation:"{}",values_list:"{}"}},kn=(t,s="string")=>{const a=new Set;return Object.values(Fr).forEach(i=>{i.ui_tab===t&&!i.hidden&&(t==="General"?i.permission==="W":i.permission==="R")&&(i.applicable_for_dt.includes("all")||i.applicable_for_dt.includes(s))&&a.add(i.ui_section)}),Array.from(a).sort()},wn=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`metadata-tabpanel-${a}`,"aria-labelledby":`metadata-tab-${a}`,...i,children:s===a&&e.jsx(n,{children:t})}),Cn={datatype:["string","boolean","numeric","date","time","datetime","timestamp","text","decimal","float","double","varchar","char","json","array","object","Imported","mixed"],text_case:["upper","lower","sentence","title","mixed"],timezone:["IST","UTC","EST","PST","GMT","Imported"],currency_code:["USD","EUR","INR","Imported"],field_source:["Database","File","API","Imported","mixed"],permission:["Public","Internal","Confidential","Restricted","Imported"],security_class:["Public","Internal Business","Confidential Business","PII","Sensitive PII","PHI","Imported"],mask:["None","Full","Mask Last 4","Mask First 4","Redact Email","Hash (SHA-256)","Imported"],duration_unit:["ss","nn","hh","dd","mm","ww","yy","Imported"],text_encoding:["UTF-8","ASCII","ISO-8859-1","Imported"]},Ku={"Data Type and Structure":e.jsx(Ps,{}),"Date and Time Management":e.jsx(Ws,{}),"General Information":e.jsx(Qn,{}),"Identification and Key Relationships":e.jsx(zr,{}),"Validation and Formatting":e.jsx(mt,{}),"Geographical and Contact Information":e.jsx(Ro,{}),"Data Source and Migration":e.jsx(Po,{})},Xu=({open:t,onClose:s,field:a,onSave:i,isLoading:l=!1})=>{const[d,c]=o.useState(0),[u,f]=o.useState({}),[y,h]=o.useState({}),[p,m]=o.useState({}),[S,T]=o.useState(null),[g,P]=o.useState({}),[$,V]=o.useState(!1),[v,q]=o.useState("string"),[w,O]=o.useState(null),[N,R]=o.useState(!1),[W,b]=o.useState(""),{selectedProject:F}=ke(K=>K.app),{data:G}=xi(a?.object_id||"",{skip:!a?.object_id}),[E]=pi();o.useEffect(()=>{if(t&&a){const K={},Ce=a.datatype||"string";Object.values(Fr).forEach(k=>{if(!k.hidden){const Q=a[k.name];K[k.name]=Q??(k.default_value!==void 0?k.default_value:"")}}),f(K),h(K),q(Ce),m({}),T(null),P({}),O(null)}},[t,a]);const _=(K,Ce)=>{c(Ce),T(null)},D=(K,Ce)=>Cn[K.name]?Cn[K.name]:Array.isArray(K.values_list)&&K.values_list.length>0?K.values_list:Ce&&!Array.isArray(Ce)?[Ce.toString()]:[],C=K=>Ce=>{const k=Ce.target.value,Q={...u,[K]:k};f(Q),y[K]!==k?P(U=>({...U,[K]:k})):P(U=>{const ue={...U};return delete ue[K],ue}),p[K]&&m(U=>({...U,[K]:""})),K==="datatype"&&O(k)},oe=(K,Ce)=>{const k=["length","precision","scale","max_length","min_length","float_precision"],Q={...Ce},U={...g};k.forEach(ue=>{Q[ue]!==void 0&&(Q[ue]="",delete U[ue])}),f(Q),P(U)},Z=K=>Ce=>{const k=Ce.target.checked,Q={...u,[K]:k};f(Q),y[K]!==k?P(U=>({...U,[K]:k})):P(U=>{const ue={...U};return delete ue[K],ue})},he=K=>{T(K)},_e=K=>{f(Ce=>({...Ce,[K]:y[K]})),P(Ce=>{const k={...Ce};return delete k[K],k}),T(null),m(Ce=>{const k={...Ce};return delete k[K],k}),K==="datatype"&&O(null)},z=(K,Ce,k)=>{if(k.is_required&&!Ce&&Ce!==!1&&Ce!==0)return`${k.label} is required`;if((k.data_type==="Integer"||k.data_type==="Float")&&Ce&&Ce!==""){if(isNaN(Number(Ce)))return`${k.label} must be a valid number`;const Q=Number(Ce);if((k.name==="min_length"||k.name==="min_value")&&Q<0)return`${k.label} must be greater than or equal to 0`;if(k.name==="max_length"&&u.min_length){const U=Number(u.min_length);if(Q<U)return`${k.label} must be greater than or equal to Minimum Length`}}return""},A=(K,Ce)=>{const k=u[K],Q=z(K,k,Ce);if(Q){m(ue=>({...ue,[K]:Q}));return}K==="datatype"&&w&&(oe(k,u),q(k),O(null));const U={[K]:k};i({...a,...u},U),T(null),V(!0),h(ue=>({...ue,[K]:k})),P(ue=>{const M={...ue};return delete M[K],M})},te=async K=>{try{await E({mappingId:K.id,updates:{ontology_term_status:"true",ontological_term_description_status:"true"}}).unwrap()}catch(Ce){console.error("Failed to accept ontology:",Ce)}},I=K=>{R(!0)},J=async K=>{try{await E({mappingId:K.id,updates:{ontology_term_status:"false",ontological_term_description_status:"false",ontology_term_user_feedback:W}}).unwrap(),R(!1),b("")}catch(Ce){console.error("Failed to submit feedback:",Ce)}},se=()=>{R(!1),b("")},Ie=(K,Ce)=>{const k=w||v;return Object.values(Fr).filter(Q=>Q.ui_section===K&&Q.ui_tab===Ce&&!Q.hidden&&(Q.applicable_for_dt.includes("all")||Q.applicable_for_dt.includes(k))).sort((Q,U)=>(Q.priority||999)-(U.priority||999))},Fe=K=>{const Ce=u[K.name]!==void 0?u[K.name]:K.default_value||"",k=p[K.name];g[K.name];const Q=S===K.name,U=K.permission==="W"&&(Q||d===1);switch(w&&K.name!=="datatype"&&!K.applicable_for_dt.includes("all")&&K.applicable_for_dt.includes(w),K.ui_control){case"Dropdown":const ue=D(K,Ce),M=Ce&&Ce!=="",ce=ue.includes(Ce);return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,py:1.5,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:"180px"},children:e.jsxs(r,{variant:"body2",sx:{fontWeight:500},children:[K.label,K.tooltip&&e.jsx(je,{title:K.tooltip,children:e.jsx(gs,{sx:{fontSize:16,ml:.5,color:"text.secondary",verticalAlign:"middle"}})})]})}),e.jsx(Ae,{size:"small",error:!!k,disabled:!U,sx:{minWidth:250,flexGrow:1},children:e.jsxs(We,{value:Ce,onChange:C(K.name),displayEmpty:!0,sx:{bgcolor:"background.paper"},children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select an option"})}),M&&!ce&&e.jsxs(re,{value:Ce,children:[Ce," (Current)"]},Ce),ue.map(le=>e.jsx(re,{value:le,children:le},le))]})}),K.permission==="W"&&d===0&&e.jsx(e.Fragment,{children:Q?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"small",onClick:()=>A(K.name,K),sx:{color:"#4caf50"},disabled:l,children:l?e.jsx(ie,{size:20}):e.jsx(_s,{fontSize:"small"})}),e.jsx(ne,{size:"small",onClick:()=>_e(K.name),sx:{color:"#f44336"},disabled:l,children:e.jsx(Bs,{fontSize:"small"})})]}):e.jsx(ne,{size:"small",onClick:()=>he(K.name),sx:{color:"#1976d2"},children:e.jsx(ht,{fontSize:"small"})})})]});case"Checkbox":return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,py:1.5,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:"180px"},children:e.jsxs(r,{variant:"body2",sx:{fontWeight:500},children:[K.label,K.tooltip&&e.jsx(je,{title:K.tooltip,children:e.jsx(gs,{sx:{fontSize:16,ml:.5,color:"text.secondary",verticalAlign:"middle"}})})]})}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsx("input",{type:"checkbox",checked:!!Ce,onChange:le=>Z(K.name)({target:{checked:le.target.checked}}),disabled:!U,className:"metadata-checkbox",title:K.label,placeholder:K.label}),e.jsx(r,{variant:"body2",sx:{ml:1},children:Ce?K.name:""})]}),K.permission==="W"&&d===0&&e.jsx(e.Fragment,{children:Q?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"small",onClick:()=>A(K.name,K),sx:{color:"#4caf50"},disabled:l,children:l?e.jsx(ie,{size:20}):e.jsx(_s,{fontSize:"small"})}),e.jsx(ne,{size:"small",onClick:()=>_e(K.name),sx:{color:"#f44336"},disabled:l,children:e.jsx(Bs,{fontSize:"small"})})]}):e.jsx(ne,{size:"small",onClick:()=>he(K.name),sx:{color:"#1976d2"},children:e.jsx(ht,{fontSize:"small"})})})]});case"TextArea":return e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1,py:1.5,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:"180px",mt:1},children:e.jsxs(r,{variant:"body2",sx:{fontWeight:500},children:[K.label,K.tooltip&&e.jsx(je,{title:K.tooltip,children:e.jsx(gs,{sx:{fontSize:16,ml:.5,color:"text.secondary",verticalAlign:"middle"}})})]})}),e.jsx(ye,{size:"small",value:Ce,onChange:C(K.name),error:!!k,helperText:k,disabled:!U,multiline:!0,rows:3,sx:{minWidth:250,flexGrow:1,bgcolor:"background.paper"}}),K.permission==="W"&&d===0&&e.jsx(e.Fragment,{children:Q?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"small",onClick:()=>A(K.name,K),sx:{color:"#4caf50",mt:1},disabled:l,children:l?e.jsx(ie,{size:20}):e.jsx(_s,{fontSize:"small"})}),e.jsx(ne,{size:"small",onClick:()=>_e(K.name),sx:{color:"#f44336",mt:1},disabled:l,children:e.jsx(Bs,{fontSize:"small"})})]}):e.jsx(ne,{size:"small",onClick:()=>he(K.name),sx:{color:"#1976d2",mt:1},children:e.jsx(ht,{fontSize:"small"})})})]});case"Textbox":default:return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,py:1.5,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:"180px"},children:e.jsxs(r,{variant:"body2",sx:{fontWeight:500},children:[K.label,K.tooltip&&e.jsx(je,{title:K.tooltip,children:e.jsx(gs,{sx:{fontSize:16,ml:.5,color:"text.secondary",verticalAlign:"middle"}})})]})}),e.jsx(ye,{size:"small",value:Ce,onChange:C(K.name),error:!!k,helperText:k,disabled:!U,type:K.data_type==="Integer"||K.data_type==="Float"?"number":"text",sx:{minWidth:250,flexGrow:1,bgcolor:"background.paper"}}),K.permission==="W"&&d===0&&e.jsx(e.Fragment,{children:Q?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"small",onClick:()=>A(K.name,K),sx:{color:"#4caf50"},disabled:l,children:l?e.jsx(ie,{size:20}):e.jsx(_s,{fontSize:"small"})}),e.jsx(ne,{size:"small",onClick:()=>_e(K.name),sx:{color:"#f44336"},disabled:l,children:e.jsx(Bs,{fontSize:"small"})})]}):e.jsx(ne,{size:"small",onClick:()=>he(K.name),sx:{color:"#1976d2"},children:e.jsx(ht,{fontSize:"small"})})})]})}},de=(K,Ce)=>{const k=Ie(K,Ce);return k.length===0?null:e.jsxs(n,{sx:{border:"1px solid #e0e0e0",mb:2,bgcolor:"white"},children:[e.jsx(n,{sx:{bgcolor:"#f5f5f5",p:2,borderBottom:"1px solid #e0e0e0"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[Ku[K]||e.jsx(Qn,{}),e.jsx(r,{variant:"body1",sx:{fontWeight:600},children:K})]})}),e.jsx(n,{sx:{p:2},children:k.map(Q=>e.jsx(n,{children:Fe(Q)},Q.name))})]},K)};if(!a)return null;const qe=G?.find(K=>K.original_field_name===a.name),Ne=kn("General",v),Oe=kn("Analytical",v);return Object.keys(g).length>0,e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:750,height:"100vh",margin:0,borderRadius:0,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{bgcolor:"#1565c0",color:"white",p:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:600},children:["Edit Metadata for column - ",a.name]}),e.jsx(ne,{onClick:s,disabled:l,sx:{color:"white"},children:e.jsx(ct,{})})]}),qe&&e.jsxs(n,{sx:{p:2,bgcolor:"#f9f9f9",borderBottom:"1px solid #e0e0e0"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Zn,{sx:{color:"#1976d2",fontSize:20}}),e.jsx(r,{variant:"body2",sx:{fontWeight:600},children:"AI Ontology Suggestion"})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[qe.ontology_term_status==="true"&&e.jsx(X,{label:"AI description accepted successfully",size:"small",sx:{bgcolor:"#4caf50",color:"white",fontWeight:500}}),!N&&qe.ontology_term_status!=="true"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"contained",size:"small",onClick:()=>te(qe),sx:{bgcolor:"#4caf50","&:hover":{bgcolor:"#388e3c"}},children:"Accept"}),e.jsx(H,{variant:"outlined",size:"small",onClick:()=>I(),sx:{color:"#f44336",borderColor:"#f44336"},children:"Reject"})]}),N&&e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"contained",size:"small",onClick:()=>J(qe),disabled:!W.trim(),sx:{bgcolor:"#4caf50","&:hover":{bgcolor:"#388e3c"}},children:"Submit Feedback"}),e.jsx(H,{variant:"outlined",size:"small",onClick:se,sx:{color:"#f44336",borderColor:"#f44336"},children:"Cancel"})]})]})]}),N?e.jsxs(n,{children:[e.jsx(r,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"Please provide feedback for rejecting this ontology suggestion:"})}),e.jsx(ye,{fullWidth:!0,multiline:!0,rows:3,value:W,onChange:K=>b(K.target.value),placeholder:"Explain why you rejected this suggestion...",sx:{mb:1}})]}):e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Ontology Term:"})," ",qe.ontology_term]}),e.jsx(n,{sx:{bgcolor:"#fff9c4",p:1,borderRadius:1,mb:1},children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Ontology Description:"})," ",qe.ontological_term_description]})})]})]}),e.jsx(r,{variant:"body2",sx:{p:2,bgcolor:"white",borderBottom:"1px solid #e0e0e0"},children:"Use this window to view and modify the metadata associated with the selected data column."}),e.jsx(n,{sx:{borderBottom:"1px solid #e0e0e0",bgcolor:"white"},children:e.jsxs(Mt,{value:d,onChange:_,TabIndicatorProps:{style:{backgroundColor:"#1565c0",height:3}},children:[e.jsx(He,{label:"General",sx:{fontWeight:600,color:d===0?"#1565c0":"text.primary","&.Mui-selected":{color:"#1565c0"}}}),e.jsx(He,{label:"Analytical",sx:{fontWeight:600,color:d===1?"#1565c0":"text.primary","&.Mui-selected":{color:"#1565c0"}}})]})}),e.jsxs(n,{sx:{flexGrow:1,overflow:"auto",bgcolor:"#fafafa"},children:[e.jsx(wn,{value:d,index:0,children:e.jsx(n,{sx:{p:2},children:Ne.map(K=>de(K,"General"))})}),e.jsx(wn,{value:d,index:1,children:e.jsx(n,{sx:{p:2},children:Oe.map(K=>de(K,"Analytical"))})})]})]})}),e.jsx(dt,{open:$,autoHideDuration:3e3,onClose:()=>V(!1),message:"Field metadata updated successfully!"})]})},Tn=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`metadata-tabpanel-${a}`,"aria-labelledby":`metadata-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{p:0},children:t})}),Ri=()=>{const{selectedObject:t}=ke(we=>we.migration),{selectedProject:s,selectedEnvironment:a}=ke(we=>we.app),{getCompletionStatus:i,getReadOnlyFlag:l,getActivityStatus:d}=os(),c=l("Metadata")||i("Mapping"),[u,f]=o.useState(0),[y,h]=o.useState(""),[p,m]=o.useState(0),[S,T]=o.useState(5),[g,P]=o.useState("all"),[$,V]=o.useState(null),[v,q]=o.useState(!1),[w,O]=o.useState(!1),[N,R]=o.useState(!1),[W,b]=o.useState(null),[F,G]=o.useState(null),[E,_]=o.useState(!1),[D,C]=o.useState({}),[oe,Z]=o.useState(null),[he,_e]=o.useState(""),[z,A]=o.useState(!1),[te,{isLoading:I}]=hi(),[J]=pi(),{data:se,isLoading:Ie,error:Fe}=hr({sourceObjectId:t?.object_id||"",projectId:s?.id||"",environmentId:a?.id||""},{skip:!t?.object_id||!s?.id||!a?.id}),{data:de,isLoading:qe,error:Ne,refetch:Oe}=yn({objectId:t?.object_id||"",environmentId:a?.id,page:p+1,page_size:S},{skip:!t?.object_id||!a?.id}),{data:st,isLoading:K,error:Ce,refetch:k}=yn({objectId:se?.id||"",environmentId:a?.id,page:p+1,page_size:S},{skip:!se?.id||!a?.id}),{data:Q,isLoading:U,error:ue}=xi(t?.object_id||"",{skip:!t?.object_id}),M=Ke.useMemo(()=>Q?.some(we=>we.confidence_score>=.95&&D[we.original_field_name]!=="accepted")||!1,[Q,D]),ce=de?.records||[],le=st?.records||[];o.useEffect(()=>{t?.object_id&&a?.id&&(f(0),h(""),m(0),P("all"),V(null),q(!1),O(!1),R(!1),b(null),G(null),C({}),Z(null),_e(""),A(!1),t?.object_id&&a?.id&&Oe(),se?.id&&a?.id&&k())},[t?.object_id,a?.id,Oe,k,se?.id]),o.useEffect(()=>{t?.object_id&&a?.id&&d(t.object_id)},[t?.object_id,a?.id,d]),o.useEffect(()=>{A(!1)},[t?.object_id]),o.useEffect(()=>{s?.id&&a?.id&&t?.object_id},[s?.id,a?.id,t?.object_id]);const Se=(we,Le)=>{f(Le),m(0),G(null)},ve=(we,Le)=>{m(Le)},B=we=>{T(parseInt(we.target.value,10)),m(0)},Y=we=>{V(we),q(!0)},ge=we=>{G(we.id),b(we),R(!0)},Ze=async(we,Le)=>{try{if(!t?.object_id||!W){console.error("Missing object ID or editing field");return}console.log("Saving field data:",{fieldData:we,modifiedFields:Le}),await te({objectId:t.object_id,fieldId:W.field_id.toString(),updates:Le}).unwrap(),_(!0),u===0?await Oe():await k(),R(!1),b(null),G(null)}catch(Ve){console.error("Failed to save field metadata:",Ve)}},ze=()=>{O(!0)},ut=async(we,Le)=>{try{await J({mappingId:Le.id,updates:{ontology_term_status:"true",ontological_term_description_status:"true"}}).unwrap(),C(Ve=>({...Ve,[we]:"accepted"}))}catch(Ve){console.error("Failed to accept ontology:",Ve)}},es=we=>{C(Ve=>({...Ve,[we]:"rejected"})),Z(we);const Le=Q?.find(Ve=>Ve.original_field_name===we);_e(Le?.ontology_term||"")},lt=async(we,Le)=>{try{await J({mappingId:Le.id,updates:{ontology_term:he,ontology_term_status:"true",ontological_term_description_status:"true"}}).unwrap(),C(Ve=>({...Ve,[we]:"user_override"})),Z(null),_e("")}catch(Ve){console.error("Failed to update ontology:",Ve)}},Bt=async()=>{const we=Q?.filter(Le=>Le.confidence_score>=.95&&D[Le.original_field_name]!=="accepted")||[];for(const Le of we)try{await J({mappingId:Le.id,updates:{ontology_term_status:"true",ontological_term_description_status:"true"}}).unwrap(),C(Ve=>({...Ve,[Le.original_field_name]:"accepted"}))}catch(Ve){console.error("Failed to accept high confidence ontology:",Ve)}A(!0)},Tt=o.useMemo(()=>(u===0?ce:le).filter(Le=>g==="all"||g==="primary_key"&&Le.is_pk==="true"||g==="foreign_key"&&Le.is_fk==="true"||g==="required"&&Le.is_required==="true"||g==="unique"&&Le.is_unique==="true"||g==="for_migration"&&Le.for_migrate==="true"),[ce,le,u,g]),Lt=o.useCallback((we,Le)=>{if(!Le||!we)return we;const Ve=we.toString().split(new RegExp(`(${Le})`,"gi"));return e.jsx("span",{children:Ve.map((_t,Nt)=>_t?_t.toLowerCase()===Le.toLowerCase()?e.jsx("mark",{style:{backgroundColor:"#ffeb3b",padding:"0 2px"},children:_t},`highlight-${Nt}-${_t.slice(0,10)}`):e.jsx("span",{children:_t},`text-${Nt}-${_t.slice(0,10)}`):null)})},[]),xe=u===0?de:st,Ue=({metadata:we,isLoading:Le,error:Ve,searchTerm:_t,highlightText:Nt,totalCount:Ft,page:Te,rowsPerPage:$e,onPageChange:at,onRowsPerPageChange:L,onViewDetails:Pe,onEditField:be,selectedRowId:Re})=>{const ot={Public:{color:"#4caf50",icon:fe=>e.jsx(Ha,{fontSize:"small",sx:{color:fe}}),tooltip:"Public - Openly accessible data"},"Internal Business":{color:"#2196f3",icon:fe=>e.jsx(Oo,{fontSize:"small",sx:{color:fe}}),tooltip:"Internal Business - Company internal use only"},"Confidential Business":{color:"#ff9800",icon:fe=>e.jsx(un,{fontSize:"small",sx:{color:fe}}),tooltip:"Confidential Business - Restricted company data"},PII:{color:"#9c27b0",icon:fe=>e.jsx(zo,{fontSize:"small",sx:{color:fe}}),tooltip:"PII - Personally Identifiable Information"},"Sensitive PII":{color:"#f44336",icon:fe=>e.jsx(Wo,{fontSize:"small",sx:{color:fe}}),tooltip:"Sensitive PII - Highly sensitive personal data"},PHI:{color:"#ff5722",icon:fe=>e.jsx(Ao,{fontSize:"small",sx:{color:fe}}),tooltip:"PHI - Protected Health Information"}},St={None:{color:"#4caf50",icon:fe=>e.jsx(ra,{fontSize:"small",sx:{color:fe}}),tooltip:"None - No masking applied"},Full:{color:"#f44336",icon:fe=>e.jsx(na,{fontSize:"small",sx:{color:fe}}),tooltip:"Full - Complete data masking"},"Mask Last 4":{color:"#2196f3",icon:fe=>e.jsx(hn,{fontSize:"small",sx:{color:fe}}),tooltip:"Mask Last 4 - Hide last 4 characters"},"Mask First 4":{color:"#2196f3",icon:fe=>e.jsx(hn,{fontSize:"small",sx:{color:fe}}),tooltip:"Mask First 4 - Hide first 4 characters"},"Redact Email":{color:"#9c27b0",icon:fe=>e.jsx(Rr,{fontSize:"small",sx:{color:fe}}),tooltip:"Redact Email - Hide email content"},"Hash (SHA-256)":{color:"#ff9800",icon:fe=>e.jsx(Mo,{fontSize:"small",sx:{color:fe}}),tooltip:"Hash (SHA-256) - Cryptographic hashing"}},Gt={Public:{color:"#4caf50",icon:fe=>e.jsx(Ha,{fontSize:"small",sx:{color:fe}}),tooltip:"Public - Accessible to everyone"},Internal:{color:"#2196f3",icon:fe=>e.jsx(qn,{fontSize:"small",sx:{color:fe}}),tooltip:"Internal - Company employees only"},Confidential:{color:"#ff9800",icon:fe=>e.jsx(un,{fontSize:"small",sx:{color:fe}}),tooltip:"Confidential - Restricted access required"},Restricted:{color:"#f44336",icon:fe=>e.jsx(Lo,{fontSize:"small",sx:{color:fe}}),tooltip:"Restricted - Highly controlled access"}},jt=(fe,Vt)=>{if(!Vt||Vt==="No data"||Vt==="null")return e.jsx(je,{title:`No ${fe.replace("_"," ")} assigned`,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Eo,{sx:{fontSize:16,color:"grey.500"}}),e.jsx(r,{variant:"body2",color:"text.secondary",children:fe==="security_class"?"Unclassified":fe==="mask"?"No Mask":"Not Set"})]})});const kt=Vt.split(",").map(gt=>gt.trim()).filter(gt=>gt),Os=fe==="security_class"?ot:fe==="mask"?St:Gt;return e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:kt.map((gt,yt)=>{if(!gt)return null;const Ht=Os[gt]||{color:"grey.500",icon:ts=>e.jsx(Fo,{fontSize:"small",sx:{color:ts}}),tooltip:`Unknown ${fe}: ${gt}`};return e.jsx(je,{title:Ht.tooltip,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[Ht.icon(Ht.color),e.jsx(r,{variant:"body2",sx:{color:Ht.color,fontWeight:500},children:gt})]})},`${fe}-${gt}-${yt}`)})})},da=Ke.useMemo(()=>{if(we.length===0)return[];const fe=new Set;return we.forEach(Vt=>{Object.keys(Vt).forEach(kt=>{kt&&kt.trim()&&fe.add(kt)})}),Array.from(fe).sort()},[we]),ua=Ke.useMemo(()=>[{key:"ai_suggested",label:"AI Agent Suggested Field Name",minWidth:"200px"},{key:"actions",label:"Actions",width:"120px"},{key:"name",label:"Field Name",minWidth:"200px"},{key:"datatype",label:"Data Type",width:"120px"},{key:"max_length",label:"Max Length",width:"80px"},...da.filter(fe=>!["name","datatype","max_length"].includes(fe)).map(fe=>({key:fe,label:fe,minWidth:"150px"}))],[da]),ha=Ke.useMemo(()=>ua.filter(fe=>_t===""||fe.label.toLowerCase().includes(_t.toLowerCase())),[ua,_t]);return Le?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200,children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading metadata..."})]}):Ve?e.jsxs(ae,{severity:"error",children:["Failed to load metadata. Please try again.",e.jsx("br",{}),"Error: ",Ve?.data?.message||Ve?.status||"Unknown error"]}):we.length===0?e.jsx(ae,{severity:"info",children:"No metadata fields found."}):e.jsxs(me,{elevation:1,sx:{width:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsx(n,{sx:{maxHeight:"60vh",overflowY:"auto",overflowX:"hidden",width:"100%",flex:1,display:"flex",flexDirection:"column"},children:e.jsx(n,{sx:{overflowX:"auto",overflowY:"hidden",width:"100%",flex:1,minWidth:0},children:e.jsxs(Je,{sx:{tableLayout:"auto",width:"max-content",minWidth:"100%"},size:"small",children:[e.jsx(Xe,{children:e.jsx(pe,{children:ha.map((fe,Vt)=>e.jsx(x,{sx:{fontWeight:"bold",...fe.width?{width:fe.width}:{minWidth:fe.minWidth}},children:fe.key==="ai_suggested"?e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:Nt(fe.label,_t)}),!z&&M&&e.jsx(je,{title:"Accept All High-Confidence Suggestions",children:e.jsx(ne,{size:"small",onClick:Bt,sx:{ml:1,color:"#4caf50"},children:e.jsx(Zn,{})})})]}):Nt(fe.label,_t)},fe.key||`col-${Vt}`))})}),e.jsx(Ye,{children:we.map((fe,Vt)=>e.jsx(pe,{onClick:()=>{c||(G(fe.id),b(fe),R(!0))},sx:{cursor:c?"default":"pointer",backgroundColor:Re===fe.id?"action.selected":"inherit","&:hover":{backgroundColor:Re===fe.id?"action.selected":c?"inherit":"action.hover"},"&:last-child td, &:last-child th":{border:0}},children:ha.map((kt,Os)=>{const gt=`${fe.id||Vt}-${kt.key||Os}`;if(kt.key==="actions")return e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",gap:.5},children:[e.jsx(je,{title:"View all field details",children:e.jsx(ne,{size:"small",onClick:yt=>{yt.stopPropagation(),Pe(fe)},color:"primary",children:e.jsx(ra,{fontSize:"small"})})}),e.jsx(je,{title:"Edit field metadata",children:e.jsx(ne,{size:"small",onClick:yt=>{yt.stopPropagation(),be(fe)},color:"secondary",disabled:c,children:e.jsx(ht,{fontSize:"small"})})})]})},gt);if(kt.key==="name")return e.jsx(x,{sx:{fontWeight:"medium"},children:fe.name},gt);if(kt.key==="datatype")return e.jsx(x,{children:e.jsx(X,{label:fe.datatype,size:"small",variant:"outlined",color:fe.datatype==="string"?"primary":fe.datatype==="number"?"secondary":fe.datatype==="boolean"?"success":"default"})},gt);if(kt.key==="max_length")return e.jsx(x,{children:fe.max_length||"-"},gt);if(kt.key==="ai_suggested"){const yt=Q?.find(ts=>ts.original_field_name===fe.name),Ht=D[fe.name]||(yt?.ontology_term_status==="true"?"accepted":"pending");return yt?oe===fe.name?e.jsx(x,{onClick:ts=>ts.stopPropagation(),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{size:"small",value:he,onChange:ts=>_e(ts.target.value),sx:{minWidth:150}}),e.jsx(ne,{size:"small",onClick:()=>lt(fe.name,yt),color:"primary",children:e.jsx(_s,{})}),e.jsx(ne,{size:"small",onClick:()=>{Z(null),_e("")},color:"secondary",children:e.jsx(ct,{})})]})},gt):e.jsx(x,{onClick:ts=>ts.stopPropagation(),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[Ht==="pending"&&e.jsx(n,{sx:{backgroundColor:"#fff9c4",padding:"4px 8px",borderRadius:1,border:"1px dashed #fbc02d"},children:e.jsx(r,{variant:"body2",sx:{textDecoration:"underline",textDecorationStyle:"dashed"},children:yt.ontology_term})}),Ht==="accepted"&&e.jsx(r,{variant:"body2",children:yt.ontology_term}),Ht==="user_override"&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"body2",children:yt.ontology_term}),e.jsx(Mr,{fontSize:"small"})]}),e.jsx(je,{title:yt.ontological_term_description,children:e.jsx(gs,{fontSize:"small",sx:{cursor:"pointer"}})}),Ht==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"small",onClick:()=>ut(fe.name,yt),color:"success",children:e.jsx(_s,{})}),e.jsx(ne,{size:"small",onClick:()=>es(fe.name),color:"error",children:e.jsx(ct,{})})]}),(Ht==="accepted"||Ht==="user_override")&&e.jsx(ne,{size:"small",onClick:()=>{Z(fe.name),_e(yt.ontology_term)},color:"primary",children:e.jsx(ht,{})})]})},gt):e.jsx(x,{children:"-"},gt)}else{const yt=["security_class","mask","permission"].includes(kt.key);return e.jsx(x,{children:yt?jt(kt.key,fe[kt.key]?.toString()||""):fe[kt.key]?.toString()||"-"},gt)}})},fe.id||`field-${Vt}`))})]})})}),e.jsx(Ss,{rowsPerPageOptions:[5],component:"div",count:Ft,rowsPerPage:$e,page:Te,onPageChange:at,onRowsPerPageChange:L,sx:{borderTop:1,borderColor:"divider",flexShrink:0}})]})};return t?e.jsxs(n,{sx:{width:"100%",overflowX:"hidden"},children:[e.jsx(dt,{open:E,autoHideDuration:3e3,onClose:()=>_(!1),message:"Field metadata updated successfully!"}),e.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"flex-start",md:"flex-start"},mb:2,gap:2,width:"100%",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"},children:[e.jsxs(n,{sx:{flex:"1 1 auto",minWidth:0,width:{xs:"100%",md:"auto"},maxWidth:"100%"},children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",sx:{wordBreak:"break-word"},children:"Metadata Management"}),e.jsxs(r,{variant:"body1",color:"text.secondary",paragraph:!0,sx:{wordBreak:"break-word"},children:["View and manage metadata for ",t?.object_name]})]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center",flexShrink:0,flexWrap:"wrap",width:{xs:"100%",md:"auto"},maxWidth:{xs:"100%",md:"400px"},justifyContent:{xs:"flex-start",md:"flex-end"}},children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1,flexWrap:"wrap",maxWidth:"100%"},children:e.jsx(xs,{activity:"Metadata",disabled:i("Mapping")})}),e.jsx(je,{title:"View raw API data",children:e.jsx(ne,{onClick:ze,color:"primary",sx:{border:1,borderColor:"primary.main",flexShrink:0},children:e.jsx(Do,{})})})]})]}),e.jsx(n,{sx:{mb:3,width:"100%",maxWidth:"100%",boxSizing:"border-box",overflow:"hidden"},children:e.jsxs(j,{container:!0,spacing:2,sx:{width:"100%",margin:0},children:[e.jsx(j,{item:!0,xs:12,md:6,sx:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:e.jsx(De,{variant:"outlined",sx:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,color:"primary",children:"Source System"}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Object:"})," ",t.object_name]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"System:"})," ",t.system_name]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Type:"})," Source"]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Fields:"})," ",de?.total_records||0]}),qe&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"caption",children:"Loading source metadata..."})]})]})})}),e.jsx(j,{item:!0,xs:12,md:6,sx:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:e.jsx(De,{variant:"outlined",sx:{width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,color:"secondary",children:"Target System"}),Ie?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"body2",children:"Loading target mapping..."})]}):Fe?e.jsx(r,{variant:"body2",color:"error",children:"No mapped target object found"}):se?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Object:"})," ",se.name]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"System:"})," Target System"]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Type:"})," Target"]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Fields:"})," ",st?.total_records||0]}),K&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"caption",children:"Loading target metadata..."})]})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"No target mapping configured"})]})})})]})}),e.jsx(me,{elevation:1,sx:{mb:2,width:"100%",maxWidth:"100%",overflow:"hidden"},children:e.jsxs(Mt,{value:u,onChange:Se,variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Source Metadata",sx:{fontWeight:u===0?"bold":"normal",fontSize:"0.9rem"}}),e.jsx(He,{label:"Target Metadata",disabled:!se,sx:{fontWeight:u===1?"bold":"normal",fontSize:"0.9rem"}})]})}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap",width:"100%",maxWidth:"100%",boxSizing:"border-box"},children:[e.jsx(ye,{placeholder:"Search column headers...",value:y,onChange:we=>{h(we.target.value),m(0)},InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(lr,{})})},sx:{minWidth:300,flexGrow:1,maxWidth:"100%"},size:"small"}),u===1&&e.jsxs(Ae,{size:"small",sx:{minWidth:150},children:[e.jsx(Me,{children:"Filter Fields"}),e.jsxs(We,{value:g,label:"Filter Fields",onChange:we=>P(we.target.value),startAdornment:e.jsx(Jn,{fontSize:"small",sx:{mr:1,color:"text.secondary"}}),children:[e.jsx(re,{value:"all",children:"All Fields"}),e.jsx(re,{value:"primary_key",children:"Primary Keys"}),e.jsx(re,{value:"foreign_key",children:"Foreign Keys"}),e.jsx(re,{value:"required",children:"Required Fields"}),e.jsx(re,{value:"unique",children:"Unique Fields"}),e.jsx(re,{value:"for_migration",children:"For Migration"})]})]})]}),e.jsx(Tn,{value:u,index:0,children:e.jsx(Ue,{metadata:Tt,isLoading:qe,error:Ne,searchTerm:y,highlightText:Lt,totalCount:de?.total_records||0,page:p,rowsPerPage:S,onPageChange:ve,onRowsPerPageChange:B,onViewDetails:Y,onEditField:ge,selectedRowId:F})}),e.jsx(Tn,{value:u,index:1,children:se?e.jsx(Ue,{metadata:Tt,isLoading:K,error:Ce,searchTerm:y,highlightText:Lt,totalCount:st?.total_records||0,page:p,rowsPerPage:S,onPageChange:ve,onRowsPerPageChange:B,onViewDetails:Y,onEditField:ge,selectedRowId:F}):e.jsx(ae,{severity:"info",children:"No target object mapping found for this source object."})}),e.jsx(Xu,{open:N,onClose:()=>{R(!1),b(null),G(null)},field:W,onSave:Ze,isLoading:I}),e.jsxs(wt,{open:v,onClose:()=>q(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(It,{children:["Field Details: ",$?.name]}),e.jsx(Pt,{children:$&&e.jsx(n,{sx:{mt:2},children:e.jsx(j,{container:!0,spacing:2,children:Object.entries($).map(([we,Le])=>e.jsxs(j,{item:!0,xs:12,sm:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",display:"block",children:we}),e.jsx(r,{variant:"body2",sx:{wordBreak:"break-all",backgroundColor:"grey.50",p:1,borderRadius:1,mt:.5},children:Le!=null?Le.toString():"null"})]},we))})})}),e.jsx(Rt,{children:e.jsx(H,{onClick:()=>q(!1),children:"Close"})})]}),e.jsxs(wt,{open:w,onClose:()=>O(!1),maxWidth:"lg",fullWidth:!0,children:[e.jsxs(It,{children:["Raw API Data - ",u===0?"Source":"Target"," Metadata",e.jsxs(r,{variant:"caption",display:"block",color:"text.secondary",children:["Total Fields: ",xe?.total_records||0]})]}),e.jsx(Pt,{children:e.jsx(n,{sx:{mt:2},children:e.jsxs(cr,{defaultExpanded:!0,children:[e.jsx(dr,{expandIcon:e.jsx(Xt,{}),children:e.jsx(r,{variant:"h6",children:"Complete API Response"})}),e.jsx(ur,{children:e.jsx("pre",{style:{backgroundColor:"#f5f5f5",padding:"16px",borderRadius:"4px",overflow:"auto",maxHeight:"400px",fontSize:"12px"},children:JSON.stringify(xe?.records||[],null,2)})})]})})}),e.jsx(Rt,{children:e.jsx(H,{onClick:()=>O(!1),children:"Close"})})]})]}):e.jsx(ae,{severity:"info",children:"Please select an object to view metadata."})},Ar=(t,s)=>{const a=[];for(const i of s)switch(i.rule){case"not_null":i.value==="true"&&!t&&t!==0&&t!==!1&&a.push(i.message);break;case"min":if(t!=null&&t!==""){const l=Number(t);(isNaN(l)||l<Number(i.value))&&a.push(i.message)}break;case"max_length":t&&t.length>Number(i.value)&&a.push(i.message);break;case"regex":t&&i.pattern&&(new RegExp(i.pattern).test(t)||a.push(i.message));break;case"in":t&&Array.isArray(i.value)&&!i.value.includes(t)&&a.push(i.message);break}return{isValid:a.length===0,errors:a}},eh=(t,s)=>{const a={};return s.forEach(i=>{if(!i.optional||t[i.attribute]){const l=Ar(t[i.attribute],i.validation);l.isValid||(a[i.attribute]=l.errors)}}),a},wr=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`fix-issue-tabpanel-${a}`,"aria-labelledby":`fix-issue-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{py:2},children:t})}),Di=({open:t,onClose:s,field:a,objectId:i,onTaskStarted:l,taskMap:d})=>{const{selectedProject:c,selectedEnvironment:u}=ke(B=>B.app),[f,y]=o.useState(0),[h,p]=o.useState(1),[m,S]=o.useState(null),[T,g]=o.useState({}),[P,$]=o.useState({}),[V,v]=o.useState(new Set),[q,w]=o.useState({open:!1,message:"",severity:"success"}),O=10,[N,{isLoading:R,error:W}]=hc(),{data:b=[],isLoading:F,error:G}=js(i,{skip:!t}),{data:E,isLoading:_}=hr({sourceObjectId:i,projectId:c?.project_id||"",environmentId:u?.id||""},{skip:!t||!c?.project_id||!u?.id}),{data:D=[],isLoading:C}=js(E?.id||"",{skip:!t||!E?.id}),{data:oe,isLoading:Z,error:he,isFetching:_e}=dc({objectId:i,changeLogId:a.change_log_id,page:h,pageSize:O},{skip:!t||!a.change_log_id}),{data:z=[],isLoading:A,error:te}=uc({changeLogId:a.change_log_id},{skip:!t||!a.change_log_id}),I=o.useMemo(()=>{const B=b.map(Y=>Y.name).filter(Boolean).sort();return console.log("Source field names computed:",B),B},[b]),J=o.useMemo(()=>{const B=D.map(Y=>Y.name).filter(Boolean).sort();return console.log("Target field names computed:",B),B},[D]);o.useEffect(()=>{t&&console.log("üîç FixIssueSlideIn DEBUG:",{field:a.field_name,objectId:i,sourceMetadataCount:b.length,sourceFieldNames:I,targetMetadataCount:D.length,targetFieldNames:J,cleanupFunctionsCount:z.length})},[t,a,i,b,D,z,I,J]);const se=B=>{if(console.log("üéØ Getting field options for parameter:",{attribute:B.attribute,values:B.values,uiComponent:B.ui_component}),B.attribute==="column_name"||B.attribute.includes("column_name")||B.attribute.includes("field_name"))return console.log("‚ö° FORCING source field names for column parameter:",I),I;if(B.values&&B.values.length>0){const Y=[];B.values.forEach(Ze=>{typeof Ze=="string"&&(Ze.includes("CUR_SRC_OBJECT_MDT")||Ze.includes("CUR_SRC_FIELD_MDT")?(console.log("üîç Detected source pattern, resolving:",Ze),Y.push(...I)):Ze.includes("CUR_TGT_OBJECT_MDT")||Ze.includes("CUR_TGT_FIELD_MDT")?(console.log("üîç Detected target pattern, resolving:",Ze),Y.push(...J)):Y.push(Ze))});const ge=[...new Set(Y)];return console.log("‚úÖ Final field options:",ge),ge}return console.log("‚ùå No values defined for parameter:",B.attribute),[]},Ie=B=>{if(console.log("üîß Getting default value for:",{attribute:B.attribute,default:B.default,defaultType:B.default_type}),B.attribute==="column_name"&&B.default_type==="dynamic"){if(console.log("‚ö° Handling dynamic default for column_name"),I.length>0){const ge=I.find(Ze=>Ze.toLowerCase()===a.field_name?.toLowerCase())||I[0]||"";return console.log("üéØ Selected column default:",ge),ge}return""}if(B.default_type==="dynamic"){if(B.default&&typeof B.default=="string"&&B.default.startsWith("[")&&B.default.endsWith("]")){const Y=Fe(B.default);return Y.length>0?Y[0]:""}return""}return B.default||""},Fe=B=>{switch(console.log("üîÑ Resolving dynamic pattern:",B),B){case"[CUR_SRC_FIELD_MDT].name":case"[CUR_SRC_OBJECT_MDT].name":return I;case"[CUR_TGT_FIELD_MDT].name":case"[CUR_TGT_OBJECT_MDT].name":return J;default:return B.includes("CUR_SRC")?I:B.includes("CUR_TGT")?J:(console.warn("‚ùå Unknown dynamic pattern:",B),[])}},de=(B,Y)=>{y(Y)},qe=(B,Y)=>{p(Y)},Ne=B=>{console.log("üéØ Function selected:",B["JSON Configuration"].title),S(B);const Y={};B["JSON Configuration"].configuration.forEach(ge=>{const Ze=Ie(ge);console.log(`üìù Setting default for ${ge.attribute}:`,Ze),Y[ge.attribute]=Ze}),g(Y),$({}),v(new Set)},Oe=B=>Y=>{const ge=Y.target.value,Ze={...T,[B.attribute]:ge};g(Ze);const ze=Ar(ge,B.validation);$(ut=>({...ut,[B.attribute]:ze.errors})),v(ut=>new Set(ut).add(B.attribute))},st=B=>()=>{v(ge=>new Set(ge).add(B.attribute));const Y=Ar(T[B.attribute],B.validation);$(ge=>({...ge,[B.attribute]:Y.errors}))},K=()=>{if(f===1&&m){const B=eh(T,m["JSON Configuration"].configuration);$(B);const Y=new Set(m["JSON Configuration"].configuration.map(ge=>ge.attribute));return v(Y),Object.keys(B).length===0}return!0},Ce=()=>{K()&&y(f+1)},k=()=>{y(f-1)},Q=async()=>{if(m&&K())try{console.log("üöÄ Applying fix:",{function:m.cleanup_function_name,params:T,changeLogId:a.change_log_id});const B=d[a.change_log_id];if(B){w({open:!0,message:`Cleanup task already in progress! Task ID: ${B}`,severity:"warning"});return}const Y={change_log_id:a.change_log_id,cleanup_fun_id:m.cleanup_fun_id,function_name:m.cleanup_function_name,object_id:i,params:T,sequence:0,tab_name:"cleanup",validation_fun_id:null};console.log("üì§ Sending payload:",Y);const ge=await N(Y).unwrap();console.log("‚úÖ Fix applied successfully:",ge),ge.task_id&&(l(a.change_log_id,ge.task_id),w({open:!0,message:`Cleanup task started successfully! Task ID: ${ge.task_id}`,severity:"success"})),setTimeout(()=>{s()},2e3)}catch(B){if(console.error("‚ùå Failed to apply fix:",B),B.status===409||B?.data?.status===409){const Y=B.data?.message||"This cleanup operation is already in progress",ge=B.data?.task_id;w({open:!0,message:Y,severity:"warning"}),ge&&l(a.change_log_id,ge)}else w({open:!0,message:B.data?.message||"Failed to apply fix. Please try again.",severity:"error"})}};o.useEffect(()=>{t&&(p(1),y(0),S(null),g({}),$({}),v(new Set))},[t,a]);const U=()=>a.metadata_attribute?{is_fixed_length:`The field '${a.field_name}' is being changed from variable length to fixed length. This may affect data storage and validation.`,is_required:`The field '${a.field_name}' is changing its requirement status.`,is_unique:`The field '${a.field_name}' is changing its uniqueness constraint.`,max_length:`The field '${a.field_name}' has a length constraint modification.`,data_format:`The field '${a.field_name}' has a data format change.`}[a.metadata_attribute]||`Metadata attribute '${a.metadata_attribute}' is being modified for field '${a.field_name}'.`:"No specific metadata issue identified. General cleanup required.",ue=B=>f>B?"completed":f===B?"current":"pending";o.useEffect(()=>{m&&Object.keys(P).length>0&&(console.log("üîç Form Errors:",P),console.log("üîç Form Data:",T))},[P,T,m]);const M=(B,Y)=>{const ge=ue(B);return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",...ge==="completed"&&{backgroundColor:"success.main",color:"white"},...ge==="current"&&{backgroundColor:"primary.main",color:"white"},...ge==="pending"&&{backgroundColor:"grey.300",color:"grey.600"}},children:ge==="completed"?e.jsx(mt,{fontSize:"small"}):B+1}),e.jsx(r,{variant:"body2",sx:{fontWeight:ge==="current"?"bold":"normal",color:ge==="pending"?"text.secondary":"text.primary"},children:Y})]})},ce=B=>{const Y=T[B.attribute]||"",ge=P[B.attribute]||[],ze=V.has(B.attribute)&&ge.length>0,ut=se(B);if(console.log("üé® Rendering parameter control:",{param:B.attribute,value:Y,fieldOptionsCount:ut.length,fieldOptions:ut,hasErrors:ze,uiComponent:B.ui_component}),B.values?.some(lt=>lt.includes("CUR_SRC"))&&F||B.values?.some(lt=>lt.includes("CUR_TGT"))&&C)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ie,{size:20}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Loading field options..."})]});if(G&&B.values?.some(lt=>lt.includes("CUR_SRC")))return e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to load source field options. Please try again."});if(B.values?.some(lt=>lt.includes("CUR_SRC"))&&ut.length===0)return e.jsx(ae,{severity:"warning",sx:{mb:2},children:"No source field names available. Please check if the object has metadata."});switch(B.ui_component){case"dropdown":return e.jsxs(Ae,{fullWidth:!0,size:"small",error:ze,sx:{mb:2},children:[e.jsx(Me,{children:B.label}),e.jsxs(We,{value:Y,onChange:Oe(B),onBlur:st(B),label:B.label,disabled:ut.length===0,children:[e.jsx(re,{value:"",children:e.jsxs("em",{children:["Select ",B.label]})}),ut.map(lt=>e.jsx(re,{value:lt,children:lt},lt))]}),ze&&e.jsx(Ds,{children:ge[0]}),B.hint&&!ze&&e.jsx(Ds,{children:B.hint}),ut.length===0&&e.jsx(Ds,{error:!0,children:"No field options available. Check object metadata."})]});case"textbox":return e.jsx(ye,{fullWidth:!0,size:"small",label:B.label,value:Y,onChange:Oe(B),onBlur:st(B),error:ze,helperText:ze?ge[0]:B.hint,placeholder:B.placeholder,sx:{mb:2}});case"checkbox":return e.jsx(nt,{control:e.jsx(rs,{checked:!!Y,onChange:Oe(B),onBlur:st(B)}),label:B.label,sx:{mb:2}});default:return e.jsx(ye,{fullWidth:!0,size:"small",label:B.label,value:Y,onChange:Oe(B),onBlur:st(B),error:ze,helperText:ze?ge[0]:B.hint,placeholder:B.placeholder,sx:{mb:2}})}},le=B=>{const Y=m?.cleanup_fun_id===B.cleanup_fun_id;return e.jsx(De,{elevation:Y?4:1,sx:{mb:2,cursor:"pointer",border:Y?2:1,borderColor:Y?"primary.main":"grey.300","&:hover":{borderColor:"primary.light"}},onClick:()=>Ne(B),children:e.jsxs(Ee,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1},children:[e.jsx(r,{variant:"h6",component:"h3",children:B["JSON Configuration"].title}),Y&&e.jsx(mt,{color:"primary"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:B["JSON Configuration"].description}),e.jsx(r,{variant:"caption",color:"text.secondary",children:B["JSON Configuration"].helptext}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(X,{label:`Function: ${B.cleanup_function_name}`,size:"small",variant:"outlined"}),e.jsx(X,{label:`Affects: ${B.affected_rows} rows`,size:"small",color:"primary"})]})]})})},Se=()=>{if(Z||_e)return e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})});if(he)return e.jsx(ae,{severity:"error",children:"Failed to load affected records. Please try again later."});if(!oe?.data||oe.data.length===0)return e.jsx(ae,{severity:"info",children:"No affected records found for this issue."});const B=oe.data,Y=Object.keys(B[0]||{});return e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Showing ",B.length," of ",oe.total_records," affected records"]}),e.jsx(X,{label:`Page ${h} of ${oe.total_pages}`,size:"small",variant:"outlined"})]}),e.jsx(tt,{component:me,elevation:1,sx:{maxHeight:400},children:e.jsxs(Je,{stickyHeader:!0,size:"small",children:[e.jsx(Xe,{children:e.jsx(pe,{children:Y.map(ge=>e.jsx(x,{sx:{fontWeight:"bold",backgroundColor:"grey.100"},children:ge},ge))})}),e.jsx(Ye,{children:B.map((ge,Ze)=>e.jsx(pe,{sx:{"&:nth-of-type(odd)":{backgroundColor:"action.hover"},"&:hover":{backgroundColor:"action.selected"}},children:Y.map(ze=>e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:String(ge[ze]),children:String(ge[ze])})},ze))},Ze))})]})}),oe.total_pages>1&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx($o,{count:oe.total_pages,page:h,onChange:qe,color:"primary",size:"small"})})]})};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:900,height:"100vh",margin:0,borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{p:3,borderBottom:1,borderColor:"divider",backgroundColor:"primary.main",color:"white"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",gutterBottom:!0,children:"Fix Data Issue"}),e.jsxs(r,{variant:"body1",children:["Field: ",e.jsx("strong",{children:a.field_name})]}),a.metadata_attribute&&e.jsxs(r,{variant:"body2",children:["Attribute: ",e.jsx("strong",{children:a.metadata_attribute})]})]}),e.jsx(ne,{onClick:s,sx:{color:"white"},children:e.jsx(ct,{})})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[M(0,"Review Issue"),e.jsx(n,{sx:{flex:1,height:2,backgroundColor:"grey.300",mx:1}},"divider-1"),M(1,"Select Fix"),e.jsx(n,{sx:{flex:1,height:2,backgroundColor:"grey.300",mx:1}},"divider-2"),M(2,"Preview & Apply")]})]}),e.jsxs(n,{sx:{flexGrow:1,p:3,overflow:"auto"},children:[e.jsxs(Mt,{value:f,onChange:de,sx:{mb:3},children:[e.jsx(He,{label:"Review Issue"}),e.jsx(He,{label:"Select Fix",disabled:f<1}),e.jsx(He,{label:"Preview & Apply",disabled:f<2})]}),e.jsxs(wr,{value:f,index:0,children:[e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(is,{color:"warning"}),"Problem Description"]}),e.jsx(r,{variant:"body2",paragraph:!0,children:U()}),e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Affected Rows"}),e.jsx(r,{variant:"body2",fontWeight:"bold",children:a.affected_rows})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Change Type"}),e.jsx(r,{variant:"body2",fontWeight:"bold",children:a.metadata_attribute||"General Cleanup"})]}),a.old_value&&e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Current Value"}),e.jsx(r,{variant:"body2",fontFamily:"monospace",children:a.old_value})]}),a.new_value&&e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Proposed Value"}),e.jsx(r,{variant:"body2",fontFamily:"monospace",children:a.new_value})]})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Sample Affected Records"}),Se()]})})})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:e.jsx(H,{variant:"contained",onClick:Ce,endIcon:e.jsx(Gs,{}),disabled:A,children:A?e.jsx(ie,{size:20}):"Continue to Select Fix"})})]}),e.jsxs(wr,{value:f,index:1,children:[A?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})}):te?e.jsx(ae,{severity:"error",children:"Failed to load cleanup functions. Please try again later."}):z.length===0?e.jsx(ae,{severity:"info",children:"No cleanup functions available for this issue."}):e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Choose Fix for Your Issue"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Select a cleanup function and configure its parameters to fix the data quality issue."}),z.map(B=>le(B))]}),m&&e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gs,{color:"primary"}),"Configure ",m["JSON Configuration"].title]}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:m["JSON Configuration"].helptext}),e.jsx(n,{sx:{mt:2},children:m["JSON Configuration"].configuration.map(B=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsxs(r,{variant:"subtitle2",children:[B.label,!B.optional&&" *"]}),e.jsx(je,{title:B.tool_tip,children:e.jsx(gs,{fontSize:"small",color:"action"})})]}),ce(B)]},B.attribute))})]})})})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(H,{variant:"outlined",onClick:k,children:"Back to Review"}),e.jsx(H,{variant:"contained",onClick:Ce,endIcon:e.jsx(Za,{}),disabled:!m||Object.keys(P).some(B=>P[B].length>0),children:"Preview & Apply"})]})]}),e.jsxs(wr,{value:f,index:2,children:[m&&e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Za,{color:"primary"}),"Preview Fix Application"]}),e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Selected Function"}),e.jsx(r,{variant:"body1",fontWeight:"bold",children:m["JSON Configuration"].title})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Affected Records"}),e.jsx(r,{variant:"body1",fontWeight:"bold",color:"error.main",children:m.affected_rows})]})]}),e.jsxs(cr,{sx:{mt:2},children:[e.jsx(dr,{expandIcon:e.jsx(Xt,{}),children:e.jsx(r,{variant:"subtitle2",children:"Configuration Parameters"})}),e.jsx(ur,{children:e.jsx(Je,{size:"small",children:e.jsx(Ye,{children:m["JSON Configuration"].configuration.map(B=>e.jsxs(pe,{children:[e.jsx(x,{sx:{fontWeight:"bold",width:"30%"},children:B.label}),e.jsx(x,{children:T[B.attribute]||"(Not set)"})]},B.attribute))})})})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(ae,{severity:"warning",children:["This action will modify ",m.affected_rows," records. Please review the configuration before applying."]})})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(H,{variant:"outlined",onClick:k,children:"Back to Fix Selection"}),e.jsx(H,{variant:"contained",color:"success",startIcon:e.jsx(mt,{}),onClick:Q,disabled:Object.keys(P).some(B=>P[B].length>0)||R,children:R?e.jsx(ie,{size:20,sx:{mr:1}}):`Apply Fix to ${m?.affected_rows||0} Records`})]})]})]})]})}),e.jsx(dt,{open:q.open,autoHideDuration:6e3,onClose:()=>w({...q,open:!1}),message:q.message})]})},th=({open:t,onClose:s,objectId:a,objectName:i})=>{const[l,d]=o.useState(new Set),[c,u]=o.useState(!1),[f,y]=o.useState(null),[h,p]=o.useState(null),[m,S]=o.useState(!1),[T,g]=o.useState(new Set),[P,$]=o.useState({}),[V,v]=o.useState(new Set),[q,w]=o.useState({open:!1,rule:null}),[O,N]=o.useState({open:!1,message:"",severity:"success"}),{data:R=[],isLoading:W,error:b}=Sc({objectId:a},{skip:!t||!a}),[F]=en(),[G]=tn(),[E]=gi(),_=I=>{switch(I){case"APPLIED":return"#4caf50";case"SUCCESS":return"#4caf50";case"PENDING":return"#ff9800";case"FAILURE":case"ERROR":case"FAILED":return"#f44336";default:return"#9e9e9e"}},D=I=>new Date(I).toLocaleString(),C=I=>{const J=new Set(l);J.has(I)?J.delete(I):J.add(I),d(J)},oe=async()=>{if(R.length!==0)try{u(!0);const I=R.map(se=>se.rule_id.toString()),J=await F({object_id:a,rule_ids:I}).unwrap();console.log("Apply all rules started:",J),y(J.task_id),Z(J.task_id)}catch(I){console.error("Failed to apply all rules:",I),u(!1),N({open:!0,message:"Failed to start applying all rules. Please try again.",severity:"error"})}},Z=async I=>{try{const J=await G({taskId:I}).unwrap();if(console.log("Task status:",J),J.status==="SUCCESS"||J.status==="FAILURE"||J.status==="ERROR"){u(!1),y(null),p(J),S(!0);const se=J.result?.results?.some(Ie=>Ie.status==="error");if(J.status==="SUCCESS"&&!se)N({open:!0,message:"All rules applied successfully!",severity:"success"});else if(se){const Ie=J.result?.results?.filter(Fe=>Fe.status==="error").length||0;N({open:!0,message:`Failed to apply ${Ie} rule${Ie!==1?"s":""}. Check results for details.`,severity:"error"})}else N({open:!0,message:`Failed to apply rules: ${J.error||"Unknown error"}`,severity:"error"})}else setTimeout(()=>Z(I),2e3)}catch(J){console.error("Failed to get task status:",J),u(!1),y(null),N({open:!0,message:"Failed to check task status. Please try again.",severity:"error"})}},he=I=>{console.log("Edit rule:",I)},_e=async I=>{try{g(se=>new Set(se).add(I.rule_id));const J=await F({object_id:a,rule_ids:[I.rule_id.toString()]}).unwrap();console.log("Reapply rule started:",J),z(I.rule_id,J.task_id)}catch(J){console.error("Failed to reapply rule:",J),g(se=>{const Ie=new Set(se);return Ie.delete(I.rule_id),Ie})}},z=async(I,J)=>{try{const se=await G({taskId:J}).unwrap();if(console.log("Reapply status:",se),se.status==="SUCCESS"||se.status==="FAILURE"||se.status==="ERROR"){g(Fe=>{const de=new Set(Fe);return de.delete(I),de}),$(Fe=>({...Fe,[I]:se}));const Ie=se.result?.results?.find(Fe=>Fe.rule_id===I);console.log("Individual rule result lookup:",{ruleId:I,ruleResult:Ie,allResults:se.result?.results}),Ie?Ie.status==="error"?(console.log("Found error in individual rule result"),N({open:!0,message:`Rule ${I} reapply failed: ${Ie.message||"Unknown error"}`,severity:"error"})):N({open:!0,message:`Rule ${I} reapplied successfully`,severity:"success"}):se.status==="SUCCESS"?(console.log("Overall success, no individual result found"),N({open:!0,message:`Rule ${I} reapplied successfully`,severity:"success"})):(console.log("Overall failure"),N({open:!0,message:`Failed to reapply rule ${I}: ${se.error||"Unknown error"}`,severity:"error"}))}else setTimeout(()=>z(I,J),2e3)}catch(se){console.error("Failed to get reapply status:",se),g(Ie=>{const Fe=new Set(Ie);return Fe.delete(I),Fe}),N({open:!0,message:`Failed to check reapply status for rule ${I}. Please try again.`,severity:"error"})}},A=async()=>{const I=q.rule;if(I){w({open:!1,rule:null});try{v(J=>new Set(J).add(I.rule_id)),await E({ruleId:I.rule_id}).unwrap(),N({open:!0,message:`Rule ${I.rule_id} deleted successfully!`,severity:"success"})}catch(J){console.error("Failed to delete rule:",J),N({open:!0,message:`Failed to delete rule ${I.rule_id}. Please try again.`,severity:"error"})}finally{v(J=>{const se=new Set(J);return se.delete(I.rule_id),se})}}},te=()=>{w({open:!1,rule:null})};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:"700px",height:"100vh",margin:0,borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",backgroundColor:"grey.50"},children:[e.jsxs(n,{sx:{py:1.5,px:2,borderBottom:1,borderColor:"divider",backgroundColor:"#4c1d95",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ir,{sx:{fontSize:20}}),e.jsxs(r,{variant:"h6",component:"h2",fontWeight:"bold",sx:{fontSize:"1rem"},children:["Cleanup Rule Timeline - ",i]})]}),e.jsx(ne,{onClick:s,sx:{color:"white",p:.5},size:"small",children:e.jsx(ct,{sx:{fontSize:20}})})]}),e.jsxs(n,{sx:{py:1,px:2,backgroundColor:"#4c1d95",borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"body2",sx:{color:"grey.700",fontWeight:"medium"},children:"List of Cleanup Rules"}),e.jsx(H,{variant:"contained",size:"small",onClick:oe,disabled:c||R.length===0,startIcon:c?e.jsx(ie,{size:16}):null,sx:{backgroundColor:"white",color:"#4c1d95","&:hover":{backgroundColor:"grey.100"},"&.Mui-disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:c?"Applying...":"Apply All Rules"})]}),e.jsx(n,{sx:{flexGrow:1,p:3,overflow:"auto"},children:W?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading cleanup rules..."})]}):b?e.jsx(ae,{severity:"error",children:"Failed to load cleanup rules. Please try again later."}):R.length===0?e.jsx(ae,{severity:"info",children:"No cleanup rules found for this object."}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:"Rule Execution History"}),e.jsxs(r,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Showing ",R.length," cleanup rule",R.length!==1?"s":""," executed on ",i]})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:R.map((I,J)=>{const se=l.has(I.rule_id),Ie=I.parameter?.column_name||"N/A";return e.jsx(De,{elevation:2,sx:{border:`2px solid ${_(I.status)}`,backgroundColor:"grey.100"},children:e.jsxs(Ee,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:[J+1,". ",I.cleanup_function]}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(X,{label:`Field: ${Ie}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}}),e.jsx(X,{label:`ID: ${I.rule_id}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}}),e.jsx(X,{label:`Field: ${I.parameter?.column_name||"N/A"}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}})]})]}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(je,{title:"Edit Rule",children:e.jsx(ne,{size:"small",onClick:()=>he(I),sx:{color:"primary.main"},children:e.jsx(ht,{fontSize:"small"})})}),e.jsx(je,{title:"Reapply Rule",children:e.jsx(ne,{size:"small",onClick:()=>_e(I),disabled:T.has(I.rule_id),sx:{color:"success.main"},children:T.has(I.rule_id)?e.jsx(ie,{size:16}):e.jsx(Zr,{fontSize:"small"})})}),e.jsx(je,{title:"Delete Rule",children:e.jsx(ne,{size:"small",onClick:()=>w({open:!0,rule:I}),disabled:V.has(I.rule_id),sx:{color:"error.main"},children:V.has(I.rule_id)?e.jsx(ie,{size:16}):e.jsx(ds,{fontSize:"small"})})}),e.jsx(je,{title:se?"Collapse":"Expand",children:e.jsx(ne,{size:"small",onClick:()=>C(I.rule_id),children:se?e.jsx(nr,{}):e.jsx(Xt,{})})})]})]}),e.jsx(as,{in:se,children:e.jsxs(n,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Field Name"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:Ie})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Applied At"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:I.applied_at?D(I.applied_at):"Not applied"})]})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Status"}),e.jsx(X,{label:I.status,size:"small",sx:{backgroundColor:_(I.status),color:"white",fontWeight:"bold"}})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Rule Definition"}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:I.parameter&&Object.entries(I.parameter).map(([Fe,de])=>e.jsx(X,{label:`${Fe}: ${de}`,size:"small",sx:{backgroundColor:_(I.status),color:"white"}},Fe))})]}),I.last_error&&e.jsx(n,{sx:{mt:2},children:e.jsx(ae,{severity:"error",sx:{py:1},children:e.jsx(r,{variant:"body2",children:I.last_error})})})]})})]})},I.rule_id)})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Rules: ${R.length}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Applied: ${R.filter(I=>I.status==="APPLIED").length}`,variant:"outlined",sx:{backgroundColor:"#4caf50",color:"white"}}),e.jsx(X,{label:`Pending: ${R.filter(I=>I.status==="PENDING").length}`,variant:"outlined",sx:{backgroundColor:"#ff9800",color:"white"}}),e.jsx(X,{label:`Failed: ${R.filter(I=>["FAILURE","ERROR","FAILED"].includes(I.status)).length}`,variant:"outlined",sx:{backgroundColor:"#f44336",color:"white"}})]})]})})]})}),e.jsx(Ut,{open:m,onClose:()=>S(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(me,{sx:{p:3,maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Apply All Rules Results"}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(r,{variant:"subtitle1",color:"primary",children:["Overall Status: ",h.status]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Task ID: ",h.task_id]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Progress: ",h.progress,"%"]})]}),h.result&&h.result.results&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Individual Rule Results:"}),h.result.results.map((I,J)=>e.jsx(De,{sx:{mb:1,border:`1px solid ${I.status==="error"?"#f44336":"#4caf50"}`},children:e.jsxs(Ee,{sx:{py:1,px:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",fontWeight:"bold",children:["Rule ID: ",I.rule_id]}),e.jsx(X,{label:I.status,size:"small",color:I.status==="error"?"error":"success"})]}),I.message&&e.jsx(r,{variant:"body2",color:"error",sx:{mt:1,fontSize:"0.75rem"},children:I.message}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Progress: ",I.overall_progress,"%"]})]})},J))]}),h.error&&e.jsx(ae,{severity:"error",sx:{mb:2},children:h.error})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:e.jsx(H,{onClick:()=>S(!1),children:"Close"})})]})}),e.jsxs(wt,{open:q.open,onClose:te,maxWidth:"sm",fullWidth:!0,children:[e.jsx(It,{children:"Confirm Delete"}),e.jsx(Pt,{children:e.jsxs(r,{children:['Are you sure you want to delete the rule "',q.rule?.cleanup_function,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:te,color:"inherit",children:"No"}),e.jsx(H,{onClick:A,color:"error",variant:"contained",children:"Yes, Delete"})]})]}),e.jsx(dt,{open:O.open,autoHideDuration:6e3,onClose:()=>N({...O,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(ae,{onClose:()=>N({...O,open:!1}),severity:O.severity,sx:{width:"100%"},children:O.message})})]})},sh=({taskId:t,changeLogId:s,onRefresh:a})=>{const[i,{data:l,isLoading:d,error:c}]=xc();o.useEffect(()=>{t&&i({taskId:t})},[t,i]);const u=()=>{t&&(i({taskId:t}),a(t))};if(!t)return e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(ys,{}),label:"Pending Fix",color:"warning",variant:"filled",size:"small"})});if(d)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"body2",children:"Checking..."})]});if(c)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{label:"Status Error",color:"error",variant:"filled",size:"small"}),e.jsx(je,{title:"Retry status check",children:e.jsx(ne,{size:"small",onClick:u,color:"error",children:e.jsx(Dt,{fontSize:"small"})})})]});const y=(h=>{switch(h){case"PENDING":case"QUEUED":return{color:"warning",label:"Queued",icon:e.jsx(Dt,{})};case"SUCCESS":return{color:"success",label:"Completed",icon:e.jsx(mt,{})};case"FAILURE":case"ERROR":return{color:"error",label:"Failed",icon:e.jsx(ys,{})};case"PROGRESS":return{color:"info",label:"In Progress",icon:e.jsx(ie,{size:16})};default:return{color:"default",label:h,icon:null}}})(l?.status||"UNKNOWN");return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{title:`Stage: ${l?.stage||"Unknown"} | Progress: ${l?.progress||0}%`,children:e.jsx(X,{label:y.label,color:y.color,variant:"filled",size:"small",sx:{minWidth:"100px"}})}),e.jsx(je,{title:"Refresh status",children:e.jsx(ne,{size:"small",onClick:u,color:"primary",disabled:d,children:e.jsx(Dt,{fontSize:"small"})})})]})},Ei=()=>{const{selectedObject:t}=ke(D=>D.migration),{selectedEnvironment:s}=ke(D=>D.app),{getReadOnlyFlag:a,getCompletionStatus:i,getActivityStatus:l}=os(),d=a("Cleanup"),[c,u]=o.useState(null),[f,y]=o.useState(!1),[h,p]=o.useState(!1),[m,S]=o.useState({}),[T,g]=o.useState(new Set),{data:P,isLoading:$,error:V,isFetching:v,refetch:q}=cc({objectId:t?.object_id||"",environmentId:s?.id},{skip:!t?.object_id||!s?.id});o.useEffect(()=>{t?.object_id&&s?.id&&(u(null),y(!1),p(!1),S({}),g(new Set),q())},[t?.object_id,s?.id,q]),o.useEffect(()=>{t?.object_id&&s?.id&&l(t.object_id)},[t?.object_id,s?.id,l]);const w=(D,C)=>{S(oe=>({...oe,[D]:C}))},O=D=>{g(C=>new Set(C).add(D))},N=D=>{u(D),y(!0)},R=()=>{y(!1),u(null)},W=D=>{console.log(`Running cleanup for field: ${D}`),alert(`Run cleanup for ${D}`)},b=()=>{p(!0)},F=()=>{p(!1)},G=D=>{const C=m[D.change_log_id];return C?e.jsx(sh,{taskId:C,changeLogId:D.change_log_id,onRefresh:O}):D.change_log_id?e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(ys,{}),label:"Pending Fix",color:"warning",variant:"filled",size:"small"})}):e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(mt,{}),label:"No Issues",color:"success",variant:"outlined",size:"small"})})},E=D=>(m[D.change_log_id],D.change_log_id?e.jsx(je,{title:`Fix metadata issue for ${D.field_name}`,children:e.jsx(H,{variant:"contained",color:"warning",size:"small",startIcon:e.jsx(ys,{}),onClick:()=>N(D),disabled:d,sx:{minWidth:"120px"},children:"Fix Issue"})}):e.jsx(je,{title:`Run cleanup for ${D.field_name}`,children:e.jsx(H,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(Qa,{}),onClick:()=>W(D.field_name),sx:{minWidth:"120px"},children:"Cleanup"})}));if(!t)return e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Data Cleanup"}),e.jsx(ae,{severity:"info",children:"Please select an object to view cleanup data."})]});if($||v)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Cleanup - ",t.object_name]}),e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})})]});if(V)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Cleanup - ",t.object_name]}),e.jsx(ae,{severity:"error",children:"Failed to load cleanup data. Please try again later."})]});const _=P?.changelog||[];return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Cleanup - ",t.object_name]}),e.jsxs(r,{variant:"body1",color:"text.secondary",children:["Review and fix data quality issues for ",t.object_name,". Fields with pending fixes require attention before migration."]})]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(xs,{activity:"Cleanup",disabled:!1}),e.jsx(je,{title:"View cleanup rules",children:e.jsx(H,{variant:"outlined",color:"primary",startIcon:e.jsx(Qr,{}),onClick:b,disabled:d,sx:{minWidth:"140px"},children:"Rule List"})}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:()=>q(),disabled:v||d,children:"Refresh"})]})]}),_.length===0?e.jsx(me,{elevation:1,sx:{p:3,mt:2},children:e.jsx(r,{variant:"body1",textAlign:"center",color:"text.secondary",children:"No cleanup data found for this object."})}):e.jsx(tt,{component:me,elevation:2,children:e.jsxs(Je,{sx:{minWidth:650},"aria-label":"cleanup data table",children:[e.jsx(Xe,{children:e.jsxs(pe,{sx:{backgroundColor:"primary.light"},children:[e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Field Name"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Target Field"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Metadata Attribute"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Affected Rows"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Old Value"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"New Value"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Status"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Action"})]})}),e.jsx(Ye,{children:_.map((D,C)=>e.jsxs(pe,{sx:{"&:last-child td, &:last-child th":{border:0},backgroundColor:D.change_log_id?"warning.light":"transparent","&:hover":{backgroundColor:D.change_log_id?"warning.light":"action.hover"}},children:[e.jsx(x,{component:"th",scope:"row",sx:{fontWeight:"medium"},children:D.field_name}),e.jsx(x,{children:D.target_field_name||"-"}),e.jsx(x,{children:D.metadata_attribute||"-"}),e.jsx(x,{children:e.jsx(X,{label:D.affected_rows,color:D.affected_rows>0?"error":"default",variant:D.affected_rows>0?"filled":"outlined",size:"small"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:"grey.100",p:.5,borderRadius:1,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.old_value||"-"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:"grey.100",p:.5,borderRadius:1,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:D.new_value||"-"})}),e.jsx(x,{children:G(D)}),e.jsx(x,{children:E(D)})]},C))})]})}),_.length>0&&e.jsxs(n,{sx:{mt:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Fields: ${_.length}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Pending Fixes: ${_.filter(D=>D.change_log_id).length}`,variant:"filled",color:"warning"}),e.jsx(X,{label:`Active Tasks: ${Object.keys(m).length}`,variant:"filled",color:"info"}),e.jsx(X,{label:`Affected Rows: ${_.reduce((D,C)=>D+C.affected_rows,0)}`,variant:"outlined",color:"error"}),e.jsx(X,{label:`Manual Refreshes: ${T.size}`,variant:"outlined",color:"secondary"})]}),c&&t&&e.jsx(Di,{open:f,onClose:R,field:c,objectId:t.object_id,onTaskStarted:w,taskMap:m}),t&&e.jsx(th,{open:h,onClose:F,objectId:t.object_id,objectName:t.object_name})]})},Fi=()=>{xt();const{selectedObject:t}=ke(M=>M.migration),{selectedProject:s,selectedEnvironment:a}=ke(M=>M.app),{getReadOnlyFlag:i,getCompletionStatus:l,getActivityStatus:d,updateStatusToggleButton:c}=os(),u=i("Mapping")||l("Mapping"),[f,y]=o.useState(""),[h,p]=o.useState(""),[m,S]=o.useState(""),[T,g]=o.useState([]),[P,$]=o.useState(null),[V,v]=o.useState([]),[q,w]=o.useState([]),[O,N]=o.useState(!1),[R,W]=o.useState(!1),[b,F]=o.useState(""),[G,E]=o.useState(0),[_,D]=o.useState({open:!1,message:"",severity:"info"}),{data:C=[]}=ks(s?.id||"",{skip:!s?.id}),oe=C.filter(M=>M.type!=="source"),{data:Z=[],isLoading:he,error:_e,isFetching:z,refetch:A}=gc({sourceObjectId:t?.object_id||"",environmentId:a?.id},{skip:!t?.object_id||!a?.id});o.useEffect(()=>{t?.object_id&&a?.id&&(y(""),p(""),S(""),g([]),$(null),v([]),w([]),N(!1),W(!1),F(""),E(0),D({open:!1,message:"",severity:"info"}),A())},[t?.object_id,a?.id,A]),o.useEffect(()=>{t?.object_id&&a?.id&&d(t.object_id)},[t?.object_id,a?.id,d]);const{data:te,isLoading:I}=hr({sourceObjectId:t?.object_id||"",projectId:s?.id||"",environmentId:a?.id||""},{skip:!t?.object_id||!s?.id||!a?.id}),{data:J=[]}=Is(te?.system||f,{skip:!te?.system&&!f}),{data:se}=js(h||te?.id||"",{skip:!h&&!te?.id});Ke.useEffect(()=>{te?.system?y(te.system):oe.length>0&&y(oe[0].id)},[te,oe]),Ke.useEffect(()=>{te?.id?p(te.id):J.length>0&&!h&&p("")},[te,J,h]),Ke.useEffect(()=>{if(Z.length>0){const M=Z.map(ce=>({id:ce.id,sourceField:ce.source_label,targetField:ce.target_name,sourceType:ce.source_datatype,targetType:ce.target_datatype,sampleValue:ce.sample_value,isMapped:!0,sourceIsRequired:ce.source_is_required==="true",targetIsRequired:ce.target_is_required==="true",sourceIsPicklist:ce.source_is_picklist==="true",targetIsPicklist:ce.target_is_picklist==="true",sourceIsPk:ce.source_is_pk==="true",targetIsPk:ce.target_is_pk==="true",sourceIsFk:ce.source_is_fk==="true",targetIsFk:ce.target_is_fk==="true",sourceDatatype:ce.source_datatype,targetDatatype:ce.target_datatype,sourceIsDate:ce.source_is_date==="true",targetIsDate:ce.target_is_date==="true",sourceIsDatetime:ce.source_is_datetime==="true",targetIsDatetime:ce.target_is_datetime==="true",sourceTimezone:ce.source_timezone||"",targetTimezone:ce.target_timezone||"",sourceIsInteger:ce.source_is_integer==="true",targetIsInteger:ce.target_is_integer==="true",sourceIsFloat:ce.source_is_float==="true",targetIsFloat:ce.target_is_float==="true",sourceIsText:ce.source_is_text==="true",targetIsText:ce.target_is_text==="true",source_column:ce.source_column_id,target_column:ce.target_column_id}));g(M)}},[Z]),Ke.useEffect(()=>{if(se&&se.length>0){const M=se.map(ce=>ce.name||ce.label).filter(Boolean).sort();v(M)}},[se]);const Ie=async(M,ce,le)=>{if(!M||!ce||!le)return D({open:!0,message:"Missing required IDs for fetching target columns",severity:"error"}),[];N(!0);try{const Se=`https://api-dev.datamatter.tech/migration/v1/target/field/list/?source_object_id=${M}&target_object_id=${ce}&source_column=${le}`,ve=await fetch(Se,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"}});if(ve.ok)return(await ve.json()).filter((ge,Ze,ze)=>ge.name&&ge.name.trim()!==""&&ze.findIndex(ut=>ut.name===ge.name)===Ze);throw new Error("Failed to fetch target columns")}catch(Se){return console.error("Error fetching target columns:",Se),D({open:!0,message:"Failed to fetch target columns",severity:"error"}),[]}finally{N(!1)}};o.useEffect(()=>{let M;const ce=async()=>{if(Date.now()-G>6e4){W(!1),F(""),D({open:!0,message:"AI mapping timed out after 1 minute. Please try again.",severity:"error"});return}try{const Se=await fetch(`https://api-dev.datamatter.tech/mapper/agent/v2/mappings/jobs/${b}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"}});if(Se.ok){const ve=await Se.json();ve.status==="SUCCESS"||ve.status==="COMPLETED"?(W(!1),F(""),D({open:!0,message:"AI mapping completed successfully!",severity:"success"}),A(),t?.object_id&&d(t.object_id)):(ve.status==="FAILED"||ve.status==="ERROR")&&(W(!1),F(""),D({open:!0,message:`AI mapping failed: ${ve.details||"Unknown error"}`,severity:"error"}))}else throw new Error("Failed to fetch job status")}catch(Se){console.error("Error checking job status:",Se),W(!1),F(""),D({open:!0,message:"Error checking mapping status",severity:"error"})}};return R&&b&&(M=window.setInterval(ce,2e3)),()=>{M&&window.clearInterval(M)}},[R,b,G,A]);const Fe=async()=>{if(!t?.object_id||!h){D({open:!0,message:"Please select both source and target objects",severity:"error"});return}W(!0),E(Date.now());try{const M={source_object_id:t.object_id,target_object_id:h},ce=await fetch("https://api-dev.datamatter.tech/mapper/agent/v2/mappings/queue",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"},body:JSON.stringify(M)});if(ce.ok){const le=await ce.json();F(le.task_id),D({open:!0,message:"AI mapping started successfully!",severity:"info"}),t?.object_id&&c("Mapping",t.object_id,!0)}else throw new Error("Failed to start AI mapping")}catch(M){console.error("Error starting AI mapping:",M),W(!1),F(""),D({open:!0,message:"Failed to start AI mapping",severity:"error"})}},de=async()=>{if(!t?.object_id){D({open:!0,message:"No source object selected for download",severity:"error"});return}try{const M=await fetch(`https://api-dev.datamatter.tech/migration/v1/field/mapping/export/?source_object_id=${t.object_id}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"}});if(M.ok){const ce=await M.blob(),le=window.URL.createObjectURL(ce),Se=document.createElement("a");Se.href=le;const ve=M.headers.get("content-disposition");let B="field_mapping.csv";if(ve){const Y=ve.match(/filename="?(.+)"?/);Y&&Y[1]&&(B=Y[1])}Se.download=B,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),window.URL.revokeObjectURL(le),D({open:!0,message:"Field mappings downloaded successfully!",severity:"success"})}else throw new Error("Failed to download mappings")}catch(M){console.error("Error downloading mappings:",M),D({open:!0,message:"Failed to download field mappings",severity:"error"})}},qe=()=>{const M=JSON.stringify(Z,null,2),ce=new Blob([M],{type:"application/json"}),le=URL.createObjectURL(ce),Se=document.createElement("a");Se.href=le,Se.download=`mappings-${t?.object_name||"object"}.json`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se),URL.revokeObjectURL(le),D({open:!0,message:"JSON mappings downloaded successfully!",severity:"success"})},Ne=async M=>{if(!t?.object_id||!h||!M.source_column){D({open:!0,message:"Missing required information for editing mapping",severity:"error"});return}const ce=await Ie(t.object_id,h,M.source_column);ce.length>0?($({id:M.id,targetField:M.targetField,targetType:M.targetType,sourceColumnId:M.source_column,targetColumnId:M.target_column||""}),w(ce)):D({open:!0,message:"No target columns available for this mapping",severity:"warning"})},Oe=async()=>{if(!P){D({open:!0,message:"No changes to save",severity:"warning"});return}const M=T.find(le=>le.id===P.id);if(!M){D({open:!0,message:"Original mapping not found",severity:"error"});return}if(M.targetField===P.targetField&&M.target_column===P.targetColumnId){$(null),w([]),D({open:!0,message:"You did not modify the mapping",severity:"info"});return}const ce=[{source_column:P.sourceColumnId,target_column:P.targetColumnId,source_object_id:t?.object_id||"",target_object_id:h||te?.id||"",project:s?.id||"",environment:a?.id||""}];try{const le=await fetch("https://api-dev.datamatter.tech/migration/v1/field/mapping/",{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")||""}`,"Content-Type":"application/json"},body:JSON.stringify(ce)});if(le.ok){const Se=await le.text(),ve=q.find(B=>B.target_column===P.targetColumnId);g(B=>B.map(Y=>Y.id===P.id?{...Y,targetField:P.targetField,targetType:P.targetType,target_column:P.targetColumnId,targetIsRequired:ve?.is_required==="true",targetIsText:ve?.is_text==="true",targetIsPk:ve?.is_pk==="true",targetIsFk:ve?.is_fk==="true",targetIsDate:ve?.is_date==="true",targetIsDatetime:ve?.is_datetime==="true",targetIsInteger:ve?.is_integer==="true",targetIsFloat:ve?.is_float==="true",targetIsPicklist:ve?.is_picklist==="true",targetDatatype:ve?.datatype||""}:Y)),$(null),w([]),A(),D({open:!0,message:Se||"Mapping Updated Successfully",severity:"success"})}else{const Se=await le.text();throw new Error(Se||"Failed to update mapping")}}catch(le){console.error("Error updating mapping:",le),D({open:!0,message:`Failed to update mapping: ${le instanceof Error?le.message:"Unknown error"}`,severity:"error"})}},st=()=>{$(null),w([])},K=M=>{if(P){const ce=q.find(le=>le.name===M.target.value);$(le=>le?{...le,targetField:M.target.value,targetType:ce?.datatype||"",targetColumnId:ce?.target_column||""}:null)}},Ce=M=>{p(M.target.value)},k=()=>{D(M=>({...M,open:!1}))},Q=M=>M.sourceIsPicklist!==M.targetIsPicklist||M.sourceIsDate!==M.targetIsDate||M.sourceIsDatetime!==M.targetIsDatetime,U=T.filter(M=>M.sourceField.toLowerCase().includes(m.toLowerCase())||M.targetField.toLowerCase().includes(m.toLowerCase())),ue=oe.find(M=>M.id===f);return J.find(M=>M.object_id===h),t?e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:3},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Field Mapping - ",t.object_name]}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Align source fields with the target fields based on entity mappings"}),te&&e.jsxs(r,{variant:"body2",color:"primary.main",sx:{mt:.5},children:["Entity Mapped to: ",te.name," (",ue?.name||"Target System",")"]})]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(xs,{activity:"Mapping",disabled:!1}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:()=>A(),disabled:z||R,children:"Refresh"})]})]}),e.jsx(De,{elevation:2,sx:{mb:3},children:e.jsxs(Ee,{children:[e.jsxs(j,{container:!0,spacing:2,alignItems:"flex-end",children:[e.jsx(j,{item:!0,xs:12,md:4,children:e.jsxs(Ae,{fullWidth:!0,size:"small",children:[e.jsx(Me,{children:"Target Object"}),e.jsxs(We,{value:h,label:"Target Object",onChange:Ce,displayEmpty:!0,disabled:R,children:[e.jsx(re,{value:"",children:e.jsx("em",{children:"Select target object"})}),J.map(M=>e.jsx(re,{value:M.object_id,children:M.name},M.object_id))]})]})}),e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(ye,{fullWidth:!0,size:"small",label:"Search fields...",value:m,onChange:M=>S(M.target.value),placeholder:"Search source or target fields...",disabled:R})}),e.jsx(j,{item:!0,xs:12,md:2,children:e.jsx(je,{title:R?"Mapping in progress...":"Map with AI",children:e.jsx("span",{children:e.jsx(ne,{onClick:Fe,disabled:!h||R,color:"primary",size:"large",children:R?e.jsx(ie,{size:24}):e.jsx(Qa,{})})})})}),e.jsx(j,{item:!0,xs:12,md:1,children:e.jsx(je,{title:"Download CSV",children:e.jsx("span",{children:e.jsx(ne,{onClick:de,disabled:Z.length===0||R,color:"primary",children:e.jsx(Ja,{})})})})}),e.jsx(j,{item:!0,xs:12,md:1,children:e.jsx(je,{title:"Download JSON",children:e.jsx("span",{children:e.jsx(ne,{onClick:qe,disabled:Z.length===0||R,color:"primary",children:e.jsx(Ja,{})})})})})]}),R&&e.jsxs(n,{sx:{mt:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"AI mapping in progress..."})]})]})}),he||z?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ie,{})}):_e?e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to load mapping data. Please try again."}):Z.length===0?e.jsxs(me,{elevation:1,sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Field Mappings Found"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"No field mappings have been configured for this object yet."}),e.jsx(H,{variant:"contained",startIcon:R?e.jsx(ie,{size:16}):e.jsx(Qa,{}),onClick:Fe,disabled:!h||R,children:R?"Mapping in Progress...":"Generate Mappings with AI"})]}):e.jsxs(n,{children:[e.jsx(me,{elevation:1,sx:{mb:1},children:e.jsxs(n,{sx:{display:"flex",p:1.5,backgroundColor:"grey.100",alignItems:"center"},children:[e.jsx(n,{sx:{width:"18%"},children:e.jsx(r,{variant:"subtitle2",fontWeight:"bold",color:"text.secondary",children:"Sample Data"})}),e.jsx(n,{sx:{width:"25%",display:"flex",justifyContent:"center"}}),e.jsx(n,{sx:{width:"25%"},children:e.jsx(r,{variant:"subtitle2",fontWeight:"bold",color:"text.secondary",children:"Source"})}),e.jsx(n,{sx:{width:"25%",display:"flex",justifyContent:"center"}}),e.jsx(n,{sx:{width:"25%"},children:e.jsx(r,{variant:"subtitle2",fontWeight:"bold",color:"text.secondary",children:"Target"})}),e.jsx(n,{sx:{width:"12%",textAlign:"center"},children:e.jsx(r,{variant:"subtitle2",fontWeight:"bold",color:"text.secondary",children:"Picklist"})}),e.jsx(n,{sx:{width:"12%",textAlign:"center"},children:e.jsx(r,{variant:"subtitle2",fontWeight:"bold",color:"text.secondary",children:"Actions"})})]})}),e.jsx(n,{children:U.map((M,ce)=>{const le=P?.id===M.id,Se=Q(M);return e.jsx(me,{elevation:0,sx:{mb:.5,border:"1px solid",borderColor:"divider",backgroundColor:Se?"#fff3e0":ce%2===0?"white":"grey.50","&:hover":{boxShadow:1}},children:e.jsxs(n,{sx:{display:"flex",p:1,alignItems:"center"},children:[e.jsxs(n,{sx:{width:"18%",display:"flex",alignItems:"center",gap:.5},children:[e.jsx(qo,{sx:{color:"grey.400",fontSize:16,flexShrink:0}}),e.jsx(je,{title:M.sampleValue||"No sample data",arrow:!0,children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",fontSize:"0.7rem",color:"text.secondary",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:M.sampleValue||"-"})})]}),e.jsx(n,{sx:{width:"25%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(xn,{sx:{color:"primary.main",fontSize:18}})}),e.jsxs(n,{sx:{width:"25%",display:"flex",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",minWidth:0,flex:1,gap:.5},children:[Se&&e.jsx(je,{title:"Type mismatch detected",children:e.jsx(ys,{sx:{color:"warning.main",fontSize:16,flexShrink:0}})}),e.jsx(je,{title:M.sourceField,arrow:!0,placement:"top",children:e.jsx(r,{variant:"body2",fontWeight:"medium",noWrap:!0,sx:{overflow:"hidden",textOverflow:"ellipsis",flex:1},children:M.sourceField})})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.3,flexShrink:0,ml:.5},children:[e.jsx(je,{title:M.sourceIsText?"Text":"Not text",children:e.jsx(ja,{sx:{fontSize:14,color:M.sourceIsText?"primary.main":"grey.300"}})}),e.jsx(je,{title:M.sourceTimezone||"No timezone",children:e.jsx(Ha,{sx:{fontSize:14,color:M.sourceTimezone?"info.main":"grey.300"}})}),e.jsx(je,{title:M.sourceIsDate||M.sourceIsDatetime?"Date field":"Not a date",children:e.jsx(As,{sx:{fontSize:14,color:M.sourceIsDate||M.sourceIsDatetime?"success.main":"grey.300"}})}),e.jsx(je,{title:M.sourceIsPk?"Primary Key":M.sourceIsFk?"Foreign Key":"No key",children:e.jsx(xr,{sx:{fontSize:14,color:M.sourceIsPk?"primary.main":M.sourceIsFk?"secondary.main":"grey.300"}})}),e.jsx(je,{title:M.sourceIsRequired?"Required":"Optional",children:e.jsx(pr,{sx:{fontSize:14,color:M.sourceIsRequired?"error.main":"grey.300"}})})]})]}),e.jsx(n,{sx:{width:"25%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(xn,{sx:{color:"primary.main",fontSize:18}})}),e.jsx(n,{sx:{width:"25%",display:"flex",alignItems:"center"},children:le?e.jsx(n,{sx:{display:"flex",alignItems:"center",width:"100%",gap:.5},children:e.jsx(Ae,{size:"small",sx:{flex:1},children:O?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5,p:.5},children:[e.jsx(ie,{size:14}),e.jsx(r,{variant:"caption",color:"text.secondary",children:"Loading..."})]}):e.jsxs(We,{value:P.targetField,onChange:K,displayEmpty:!0,size:"small",fullWidth:!0,children:[e.jsx(re,{value:"",disabled:!0,children:"Select target field"}),q.map(ve=>e.jsx(re,{value:ve.name,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",width:"100%",gap:.5},children:[e.jsx(r,{variant:"body2",sx:{flex:1},children:ve.name}),e.jsxs(n,{sx:{display:"flex",gap:.2},children:[ve.is_text==="true"&&e.jsx(ja,{sx:{fontSize:12,color:"primary.main"}}),ve.is_required==="true"&&e.jsx(pr,{sx:{fontSize:12,color:"error.main"}}),ve.is_pk==="true"&&e.jsx(xr,{sx:{fontSize:12,color:"primary.main"}}),ve.is_picklist==="true"&&e.jsx(ya,{sx:{fontSize:12,color:"warning.main"}})]})]})},ve.target_column))]})})}):e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:0,flex:1,gap:.5},children:e.jsx(je,{title:M.targetField,arrow:!0,placement:"top",children:e.jsx(r,{variant:"body2",fontWeight:"medium",noWrap:!0,sx:{opacity:M.isMapped?1:.5,overflow:"hidden",textOverflow:"ellipsis",flex:1},children:M.targetField})})}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.3,flexShrink:0,ml:.5},children:[e.jsx(je,{title:M.targetIsText?"Text":"Not text",children:e.jsx(ja,{sx:{fontSize:14,color:M.targetIsText?"primary.main":"grey.300"}})}),e.jsx(je,{title:M.targetTimezone||"No timezone",children:e.jsx(Ha,{sx:{fontSize:14,color:M.targetTimezone?"info.main":"grey.300"}})}),e.jsx(je,{title:M.targetIsDate||M.targetIsDatetime?"Date field":"Not a date",children:e.jsx(As,{sx:{fontSize:14,color:M.targetIsDate||M.targetIsDatetime?"success.main":"grey.300"}})}),e.jsx(je,{title:M.targetIsPk?"Primary Key":M.targetIsFk?"Foreign Key":"No key",children:e.jsx(xr,{sx:{fontSize:14,color:M.targetIsPk?"primary.main":M.targetIsFk?"secondary.main":"grey.300"}})}),e.jsx(je,{title:M.targetIsRequired?"Required":"Optional",children:e.jsx(pr,{sx:{fontSize:14,color:M.targetIsRequired?"error.main":"grey.300"}})})]})]})}),e.jsx(n,{sx:{width:"12%",display:"flex",justifyContent:"center",alignItems:"center"},children:le?e.jsx(je,{title:M.targetIsPicklist?"Picklist field":"Not a picklist",children:e.jsx(ya,{sx:{fontSize:16,color:M.targetIsPicklist?"warning.main":"grey.300"}})}):e.jsx(je,{title:M.targetIsPicklist?"Picklist field":"Not a picklist",children:e.jsx(ya,{sx:{fontSize:16,color:M.targetIsPicklist?"warning.main":"grey.300"}})})}),e.jsx(n,{sx:{width:"12%",display:"flex",justifyContent:"center",alignItems:"center"},children:le?e.jsxs(n,{sx:{display:"flex",gap:.3},children:[e.jsx(je,{title:"Save",children:e.jsx(ne,{size:"small",onClick:Oe,color:"primary",disabled:O,sx:{p:.3},children:e.jsx(hs,{sx:{fontSize:16}})})}),e.jsx(je,{title:"Cancel",children:e.jsx(ne,{size:"small",onClick:st,disabled:O,sx:{p:.3},children:e.jsx(Bs,{sx:{fontSize:16}})})})]}):e.jsx(je,{title:"Edit mapping",children:e.jsx("span",{children:e.jsx(ne,{size:"small",onClick:()=>Ne(M),disabled:!M.isMapped||R||u,sx:{p:.3},children:e.jsx(ht,{sx:{fontSize:16}})})})})})]})},M.id)})})]}),Z.length>0&&e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(me,{elevation:1,sx:{p:2,minWidth:"120px"},children:[e.jsx(r,{variant:"h6",color:"primary.main",textAlign:"center",children:T.filter(M=>M.isMapped).length}),e.jsx(r,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Mapped Fields"})]}),e.jsxs(me,{elevation:1,sx:{p:2,minWidth:"120px"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",textAlign:"center",children:T.filter(M=>!M.isMapped).length}),e.jsx(r,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Unmapped Fields"})]}),e.jsxs(me,{elevation:1,sx:{p:2,minWidth:"120px"},children:[e.jsx(r,{variant:"h6",color:"warning.main",textAlign:"center",children:T.filter(M=>Q(M)).length}),e.jsx(r,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Type Warnings"})]}),e.jsxs(me,{elevation:1,sx:{p:2,minWidth:"120px"},children:[e.jsx(r,{variant:"h6",color:"text.primary",textAlign:"center",children:T.length}),e.jsx(r,{variant:"body2",color:"text.secondary",textAlign:"center",children:"Total Fields"})]})]}),e.jsx(dt,{open:_.open,autoHideDuration:6e3,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(ae,{onClose:k,severity:_.severity,sx:{width:"100%"},children:_.message})})]}):e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Field Mapping"}),e.jsx(ae,{severity:"info",children:"Please select an object to view field mappings."})]})},ah=({open:t,onClose:s,objectId:a,objectName:i})=>{const[l,d]=o.useState(new Set),[c,u]=o.useState(!1),[f,y]=o.useState(null),[h,p]=o.useState(null),[m,S]=o.useState(!1),[T,g]=o.useState(new Set),[P,$]=o.useState({}),[V,v]=o.useState(new Set),[q,w]=o.useState({open:!1,rule:null}),[O,N]=o.useState({open:!1,message:"",severity:"success"}),{data:R=[],isLoading:W,error:b}=kc({objectId:a},{skip:!t||!a}),[F]=en(),[G]=tn(),[E]=gi(),_=I=>{switch(I){case"APPLIED":return"#4caf50";case"SUCCESS":return"#4caf50";case"PENDING":return"#ff9800";case"FAILURE":case"ERROR":case"FAILED":return"#f44336";default:return"#9e9e9e"}},D=I=>new Date(I).toLocaleString(),C=I=>{const J=new Set(l);J.has(I)?J.delete(I):J.add(I),d(J)},oe=async()=>{if(R.length!==0)try{u(!0);const I=R.map(se=>se.rule_id.toString()),J=await F({object_id:a,rule_ids:I}).unwrap();console.log("Apply all rules started:",J),y(J.task_id),Z(J.task_id)}catch(I){console.error("Failed to apply all rules:",I),u(!1),N({open:!0,message:"Failed to start applying all rules. Please try again.",severity:"error"})}},Z=async I=>{try{const J=await G({taskId:I}).unwrap();if(console.log("Task status:",J),J.status==="SUCCESS"||J.status==="FAILURE"||J.status==="ERROR"){u(!1),y(null),p(J),S(!0);const se=J.result?.results?.some(Ie=>Ie.status==="error");if(J.status==="SUCCESS"&&!se)N({open:!0,message:"All rules applied successfully!",severity:"success"});else if(se){const Ie=J.result?.results?.filter(Fe=>Fe.status==="error").length||0;N({open:!0,message:`Failed to apply ${Ie} rule${Ie!==1?"s":""}. Check results for details.`,severity:"error"})}else N({open:!0,message:`Failed to apply rules: ${J.error||"Unknown error"}`,severity:"error"})}else setTimeout(()=>Z(I),2e3)}catch(J){console.error("Failed to get task status:",J),u(!1),y(null),N({open:!0,message:"Failed to check task status. Please try again.",severity:"error"})}},he=I=>{console.log("Edit rule:",I)},_e=async I=>{try{g(se=>new Set(se).add(I.rule_id));const J=await F({object_id:a,rule_ids:[I.rule_id.toString()]}).unwrap();console.log("Reapply rule started:",J),z(I.rule_id,J.task_id)}catch(J){console.error("Failed to reapply rule:",J),g(se=>{const Ie=new Set(se);return Ie.delete(I.rule_id),Ie})}},z=async(I,J)=>{try{const se=await G({taskId:J}).unwrap();if(console.log("Reapply status:",se),se.status==="SUCCESS"||se.status==="FAILURE"||se.status==="ERROR"){g(Fe=>{const de=new Set(Fe);return de.delete(I),de}),$(Fe=>({...Fe,[I]:se}));const Ie=se.result?.results?.find(Fe=>Fe.rule_id===I);console.log("Individual rule result lookup:",{ruleId:I,ruleResult:Ie,allResults:se.result?.results}),Ie?Ie.status==="error"?(console.log("Found error in individual rule result"),N({open:!0,message:`Rule ${I} reapply failed: ${Ie.message||"Unknown error"}`,severity:"error"})):N({open:!0,message:`Rule ${I} reapplied successfully`,severity:"success"}):se.status==="SUCCESS"?(console.log("Overall success, no individual result found"),N({open:!0,message:`Rule ${I} reapplied successfully`,severity:"success"})):(console.log("Overall failure"),N({open:!0,message:`Failed to reapply rule ${I}: ${se.error||"Unknown error"}`,severity:"error"}))}else setTimeout(()=>z(I,J),2e3)}catch(se){console.error("Failed to get reapply status:",se),g(Ie=>{const Fe=new Set(Ie);return Fe.delete(I),Fe}),N({open:!0,message:`Failed to check reapply status for rule ${I}. Please try again.`,severity:"error"})}},A=async()=>{const I=q.rule;if(I){w({open:!1,rule:null});try{v(J=>new Set(J).add(I.rule_id)),await E({ruleId:I.rule_id}).unwrap(),N({open:!0,message:`Rule ${I.rule_id} deleted successfully!`,severity:"success"})}catch(J){console.error("Failed to delete rule:",J),N({open:!0,message:`Failed to delete rule ${I.rule_id}. Please try again.`,severity:"error"})}finally{v(J=>{const se=new Set(J);return se.delete(I.rule_id),se})}}},te=()=>{w({open:!1,rule:null})};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:"700px",height:"100vh",margin:0,borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",backgroundColor:"grey.50"},children:[e.jsxs(n,{sx:{py:1.5,px:2,borderBottom:1,borderColor:"divider",backgroundColor:"#4c1d95",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ir,{sx:{fontSize:20}}),e.jsxs(r,{variant:"h6",component:"h2",fontWeight:"bold",sx:{fontSize:"1rem"},children:["Validate Rule Timeline - ",i]})]}),e.jsx(ne,{onClick:s,sx:{color:"white",p:.5},size:"small",children:e.jsx(ct,{sx:{fontSize:20}})})]}),e.jsxs(n,{sx:{py:1,px:2,backgroundColor:"#4c1d95",borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"body2",sx:{color:"grey.700",fontWeight:"medium"},children:"List of Validate Rules"}),e.jsx(H,{variant:"contained",size:"small",onClick:oe,disabled:c||R.length===0,startIcon:c?e.jsx(ie,{size:16}):null,sx:{backgroundColor:"white",color:"#4c1d95","&:hover":{backgroundColor:"grey.100"},"&.Mui-disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:c?"Applying...":"Apply All Rules"})]}),e.jsx(n,{sx:{flexGrow:1,p:3,overflow:"auto"},children:W?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading validate rules..."})]}):b?e.jsx(ae,{severity:"error",children:"Failed to load validate rules. Please try again later."}):R.length===0?e.jsx(ae,{severity:"info",children:"No validate rules found for this object."}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:"Rule Execution History"}),e.jsxs(r,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Showing ",R.length," validate rule",R.length!==1?"s":""," executed on ",i]})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:R.map((I,J)=>{const se=l.has(I.rule_id),Ie=I.parameter?.column_name||"N/A";return e.jsx(De,{elevation:2,sx:{border:`2px solid ${_(I.status)}`,backgroundColor:"grey.100"},children:e.jsxs(Ee,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:[J+1,". ",I.cleanup_function]}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(X,{label:`Field: ${Ie}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}}),e.jsx(X,{label:`ID: ${I.rule_id}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}}),e.jsx(X,{label:`Field: ${I.parameter?.column_name||"N/A"}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}})]})]}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(je,{title:"Edit Rule",children:e.jsx(ne,{size:"small",onClick:()=>he(I),sx:{color:"primary.main"},children:e.jsx(ht,{fontSize:"small"})})}),e.jsx(je,{title:"Reapply Rule",children:e.jsx(ne,{size:"small",onClick:()=>_e(I),disabled:T.has(I.rule_id),sx:{color:"success.main"},children:T.has(I.rule_id)?e.jsx(ie,{size:16}):e.jsx(Zr,{fontSize:"small"})})}),e.jsx(je,{title:"Delete Rule",children:e.jsx(ne,{size:"small",onClick:()=>w({open:!0,rule:I}),disabled:V.has(I.rule_id),sx:{color:"error.main"},children:V.has(I.rule_id)?e.jsx(ie,{size:16}):e.jsx(ds,{fontSize:"small"})})}),e.jsx(je,{title:se?"Collapse":"Expand",children:e.jsx(ne,{size:"small",onClick:()=>C(I.rule_id),children:se?e.jsx(nr,{}):e.jsx(Xt,{})})})]})]}),e.jsx(as,{in:se,children:e.jsxs(n,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Field Name"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:Ie})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Applied At"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:I.applied_at?D(I.applied_at):"Not applied"})]})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Status"}),e.jsx(X,{label:I.status,size:"small",sx:{backgroundColor:_(I.status),color:"white",fontWeight:"bold"}})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Rule Definition"}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:I.parameter&&Object.entries(I.parameter).map(([Fe,de])=>e.jsx(X,{label:`${Fe}: ${de}`,size:"small",sx:{backgroundColor:_(I.status),color:"white"}},Fe))})]}),I.last_error&&e.jsx(n,{sx:{mt:2},children:e.jsx(ae,{severity:"error",sx:{py:1},children:e.jsx(r,{variant:"body2",children:I.last_error})})})]})})]})},I.rule_id)})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Rules: ${R.length}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Applied: ${R.filter(I=>I.status==="APPLIED").length}`,variant:"outlined",sx:{backgroundColor:"#4caf50",color:"white"}}),e.jsx(X,{label:`Pending: ${R.filter(I=>I.status==="PENDING").length}`,variant:"outlined",sx:{backgroundColor:"#ff9800",color:"white"}}),e.jsx(X,{label:`Failed: ${R.filter(I=>["FAILURE","ERROR","FAILED"].includes(I.status)).length}`,variant:"outlined",sx:{backgroundColor:"#f44336",color:"white"}})]})]})})]})}),e.jsx(Ut,{open:m,onClose:()=>S(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(me,{sx:{p:3,maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Apply All Rules Results"}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(r,{variant:"subtitle1",color:"primary",children:["Overall Status: ",h.status]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Task ID: ",h.task_id]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Progress: ",h.progress,"%"]})]}),h.result&&h.result.results&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Individual Rule Results:"}),h.result.results.map((I,J)=>e.jsx(De,{sx:{mb:1,border:`1px solid ${I.status==="error"?"#f44336":"#4caf50"}`},children:e.jsxs(Ee,{sx:{py:1,px:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",fontWeight:"bold",children:["Rule ID: ",I.rule_id]}),e.jsx(X,{label:I.status,size:"small",color:I.status==="error"?"error":"success"})]}),I.message&&e.jsx(r,{variant:"body2",color:"error",sx:{mt:1,fontSize:"0.75rem"},children:I.message}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Progress: ",I.overall_progress,"%"]})]})},J))]}),h.error&&e.jsx(ae,{severity:"error",sx:{mb:2},children:h.error})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:e.jsx(H,{onClick:()=>S(!1),children:"Close"})})]})}),e.jsxs(wt,{open:q.open,onClose:te,maxWidth:"sm",fullWidth:!0,children:[e.jsx(It,{children:"Confirm Delete"}),e.jsx(Pt,{children:e.jsxs(r,{children:['Are you sure you want to delete the rule "',q.rule?.cleanup_function,'"? This action cannot be undone.']})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:te,color:"inherit",children:"No"}),e.jsx(H,{onClick:A,color:"error",variant:"contained",children:"Yes, Delete"})]})]}),e.jsx(dt,{open:O.open,autoHideDuration:6e3,onClose:()=>N({...O,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(ae,{onClose:()=>N({...O,open:!1}),severity:O.severity,sx:{width:"100%"},children:O.message})})]})},rh=({taskId:t,changeLogId:s,onRefresh:a})=>{const[i,{data:l,isLoading:d,error:c}]=mc();o.useEffect(()=>{t&&i({taskId:t})},[t,i]);const u=()=>{t&&(i({taskId:t}),a(t))};if(!t)return e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(ys,{}),label:"Pending Fix",color:"warning",variant:"filled",size:"small"})});if(d)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:16}),e.jsx(r,{variant:"body2",children:"Checking..."})]});if(c)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{label:"Status Error",color:"error",variant:"filled",size:"small"}),e.jsx(je,{title:"Retry status check",children:e.jsx(ne,{size:"small",onClick:u,color:"error",children:e.jsx(Dt,{fontSize:"small"})})})]});const y=(h=>{switch(h){case"PENDING":case"QUEUED":return{color:"warning",label:"Queued",icon:e.jsx(Dt,{})};case"SUCCESS":return{color:"success",label:"Completed",icon:e.jsx(mt,{})};case"FAILURE":case"ERROR":return{color:"error",label:"Failed",icon:e.jsx(ys,{})};case"PROGRESS":return{color:"info",label:"In Progress",icon:e.jsx(ie,{size:16})};default:return{color:"default",label:h,icon:null}}})(l?.status||"UNKNOWN");return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{title:`Stage: ${l?.stage||"Unknown"} | Progress: ${l?.progress||0}%`,children:e.jsx(X,{label:y.label,color:y.color,variant:"filled",size:"small",sx:{minWidth:"100px"}})}),e.jsx(je,{title:"Refresh status",children:e.jsx(ne,{size:"small",onClick:u,color:"primary",disabled:d,children:e.jsx(Dt,{fontSize:"small"})})})]})},Ai=()=>{const{selectedObject:t}=ke(E=>E.migration),{selectedEnvironment:s}=ke(E=>E.app),{getReadOnlyFlag:a,getActivityStatus:i}=os(),[l,d]=o.useState(null),[c,u]=o.useState(!1),[f,y]=o.useState(!1),[h,p]=o.useState({}),[m,S]=o.useState(new Set),{data:T,isLoading:g,error:P,isFetching:$,refetch:V}=pc({objectId:t?.object_id||"",environmentId:s?.id},{skip:!t?.object_id||!s?.id});o.useEffect(()=>{t?.object_id&&s?.id&&(d(null),u(!1),p({}),S(new Set),V())},[t?.object_id,s?.id,V]),o.useEffect(()=>{t?.object_id&&s?.id&&i(t.object_id)},[t?.object_id,s?.id,i]);const v=(E,_)=>{p(D=>({...D,[E]:_}))},q=E=>{S(_=>new Set(_).add(E))},w=E=>{d(E),u(!0)},O=()=>{u(!1),d(null)},N=E=>{console.log(`Running validate for field: ${E}`),alert(`Run validate for ${E}`)},R=()=>{y(!0)},W=()=>{y(!1)},b=E=>{const _=h[E.change_log_id];return _?e.jsx(rh,{taskId:_,changeLogId:E.change_log_id,onRefresh:q}):E.change_log_id?e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(ys,{}),label:"Pending Fix",color:"warning",variant:"filled",size:"small"})}):e.jsx(n,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(X,{icon:e.jsx(mt,{}),label:"No Issues",color:"success",variant:"outlined",size:"small"})})},F=E=>(h[E.change_log_id],E.change_log_id?e.jsx(je,{title:`Fix validation issue for ${E.field_name}`,children:e.jsx(H,{variant:"contained",color:"warning",size:"small",startIcon:e.jsx(ys,{}),onClick:()=>w(E),sx:{minWidth:"120px"},children:"Fix Issue"})}):e.jsx(je,{title:`Run validation for ${E.field_name}`,children:e.jsx(H,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(Qa,{}),onClick:()=>N(E.field_name),sx:{minWidth:"120px"},children:"Validate"})}));if(!t)return e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Data Validation"}),e.jsx(ae,{severity:"info",children:"Please select an object to view validation data."})]});if(g||$)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Validation - ",t.object_name]}),e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})})]});if(P)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Validation - ",t.object_name]}),e.jsx(ae,{severity:"error",children:"Failed to load validation data. Please try again later."})]});const G=T?.changelog||[];return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Validation - ",t.object_name]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(xs,{activity:"Validate",disabled:!1}),e.jsx(je,{title:"View validate rules",children:e.jsx(H,{variant:"outlined",color:"primary",startIcon:e.jsx(Qr,{}),onClick:R,sx:{minWidth:"140px"},children:"Rule List"})}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:()=>V(),disabled:$||a("Validate"),children:"Refresh"})]})]}),e.jsxs(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:["Review and fix data validation issues for ",t.object_name,". Fields with pending fixes require attention before migration."]}),G.length===0?e.jsx(me,{elevation:1,sx:{p:3,mt:2},children:e.jsx(r,{variant:"body1",textAlign:"center",color:"text.secondary",children:"No validation data found for this object."})}):e.jsx(tt,{component:me,elevation:2,children:e.jsxs(Je,{sx:{minWidth:650},"aria-label":"validate data table",children:[e.jsx(Xe,{children:e.jsxs(pe,{sx:{backgroundColor:"primary.light"},children:[e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Field Name"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Target Field"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Metadata Attribute"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Affected Rows"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Old Value"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"New Value"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Status"}),e.jsx(x,{sx:{color:"white",fontWeight:"bold"},children:"Action"})]})}),e.jsx(Ye,{children:G.map((E,_)=>e.jsxs(pe,{sx:{"&:last-child td, &:last-child th":{border:0},backgroundColor:E.change_log_id?"warning.light":"transparent","&:hover":{backgroundColor:E.change_log_id?"warning.light":"action.hover"}},children:[e.jsx(x,{component:"th",scope:"row",sx:{fontWeight:"medium"},children:E.field_name}),e.jsx(x,{children:E.target_field_name||"-"}),e.jsx(x,{children:E.metadata_attribute||"-"}),e.jsx(x,{children:e.jsx(X,{label:E.affected_rows,color:E.affected_rows>0?"error":"default",variant:E.affected_rows>0?"filled":"outlined",size:"small"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:"grey.100",p:.5,borderRadius:1,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:E.old_value||"-"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:"grey.100",p:.5,borderRadius:1,maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:E.new_value||"-"})}),e.jsx(x,{children:b(E)}),e.jsx(x,{children:F(E)})]},_))})]})}),G.length>0&&e.jsxs(n,{sx:{mt:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Fields: ${G.length}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Pending Fixes: ${G.filter(E=>E.change_log_id).length}`,variant:"filled",color:"warning"}),e.jsx(X,{label:`Active Tasks: ${Object.keys(h).length}`,variant:"filled",color:"info"}),e.jsx(X,{label:`Affected Rows: ${G.reduce((E,_)=>E+_.affected_rows,0)}`,variant:"outlined",color:"error"}),e.jsx(X,{label:`Manual Refreshes: ${m.size}`,variant:"outlined",color:"secondary"})]}),l&&t&&e.jsx(Di,{open:c,onClose:O,field:l,objectId:t.object_id,onTaskStarted:v,taskMap:h}),t&&e.jsx(ah,{open:f,onClose:W,objectId:t.object_id,objectName:t.object_name})]})},nh=({open:t,onClose:s,row:a})=>{if(!a)return null;const i=a.status==="Completed"?"success":a.status==="Failed"?"error":"warning";return e.jsx(Et,{anchor:"right",open:t,onClose:s,children:e.jsxs(n,{sx:{width:400,p:3},children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(r,{variant:"h6",children:"Load Details"}),e.jsx(ne,{onClick:s,children:e.jsx(An,{})})]}),e.jsx(it,{sx:{mb:2}}),e.jsx(r,{fontWeight:"bold",children:"ID"}),e.jsx(r,{mb:2,children:a.id}),e.jsx(r,{fontWeight:"bold",children:"Job ID"}),e.jsx(r,{mb:2,children:a.job_id}),e.jsx(r,{fontWeight:"bold",children:"Status"}),e.jsx(X,{label:a.status,color:i,sx:{mb:2}}),e.jsx(r,{fontWeight:"bold",children:"Operation"}),e.jsx(r,{mb:2,children:a.operation}),e.jsx(r,{fontWeight:"bold",children:"Record Count"}),e.jsx(r,{mb:2,children:a.record_ct}),e.jsx(r,{fontWeight:"bold",children:"Success / Failed"}),e.jsxs(r,{mb:2,children:[a.success_ct," / ",a.failed_ct]}),e.jsx(r,{fontWeight:"bold",children:"Duration"}),e.jsx(r,{mb:2,children:a.duration}),e.jsx(r,{fontWeight:"bold",children:"Start"}),e.jsx(r,{mb:2,children:a.start_dt}),e.jsx(r,{fontWeight:"bold",children:"End"}),e.jsx(r,{mb:2,children:a.end_dt}),e.jsx(r,{fontWeight:"bold",children:"Files"}),e.jsxs(r,{children:["Success: ",a.success_file]}),e.jsxs(r,{children:["Error: ",a.error_file]}),e.jsxs(r,{mb:2,children:["Unprocessed: ",a.unprocessed_file]}),e.jsx(it,{sx:{my:2}}),e.jsx(r,{fontWeight:"bold",children:"Full Raw JSON"}),e.jsx("pre",{style:{fontSize:12,whiteSpace:"pre-wrap"},children:JSON.stringify(a,null,2)})]})})},ih=()=>{const[t,{isLoading:s}]=zc(),[a]=Oc(),[i,l]=o.useState(null),[d,c]=o.useState(null),[u,f]=o.useState(!1),[y,h]=o.useState({open:!1,message:"",color:"info"}),p=o.useRef(null),m=d&&["SUCCESS","FAILED","COMPLETED"].includes(d.status);o.useEffect(()=>()=>{p.current&&clearInterval(p.current)},[]);const S=(V,v)=>{h({open:!0,message:V,color:v})},T=()=>{h(V=>({...V,open:!1}))},g=V=>{l(V),p.current&&clearInterval(p.current),p.current=window.setInterval(async()=>{try{const v=await a(V).unwrap();c(v),["SUCCESS","FAILED","COMPLETED"].includes(v.status)&&(p.current&&clearInterval(p.current),f(!1),v.status==="SUCCESS"||v.status==="COMPLETED"?S("Backup completed successfully!","success"):S(`Backup failed: ${v.message||"Unknown error"}`,"error"))}catch(v){console.error("Error checking backup status:",v),S("Error checking backup status","error"),f(!1),p.current&&clearInterval(p.current)}},1e3)};return{backupJobId:i,backupStatus:d,isButtonDisabled:u,isCreatingBackup:s,isBackupCompleted:m,snackbar:y,createBackup:async V=>{if(!V){S("No object selected for backup","error");return}try{f(!0),c(null),S("Starting backup process...","info");const v=await t({objectId:V}).unwrap();if(v.backup_job_id)S("Backup started successfully!","success"),g(v.backup_job_id);else throw new Error("No backup job ID received");return v}catch(v){console.error("Failed to create backup:",v),f(!1);const q=v?.data?.message||v?.message||"Failed to create backup";throw S(q,"error"),v}},resetBackupState:()=>{l(null),c(null),f(!1),p.current&&clearInterval(p.current)},closeSnackbar:T,isLoading:s||i&&!m,showStatusIndicator:i&&!m}},Wi=()=>{const{selectedObject:t}=ke(A=>A.migration),{selectedProject:s,selectedEnvironment:a}=ke(A=>A.app),{getReadOnlyFlag:i,getActivityStatus:l}=os(),d=t?.object_id,c=s?.id,{data:u=[],refetch:f,isLoading:y,error:h}=Tc({objectId:d,projectId:c,environmentId:a?.id},{skip:!d||!c||!a?.id});o.useEffect(()=>{d&&c&&a?.id&&(R(null),b(null),G(!1),O({open:!1,message:"",color:"success"}),f())},[d,c,a?.id,f]),o.useEffect(()=>{d&&a?.id&&l(d)},[d,a?.id,l]);const[p,{isLoading:m}]=Ic(),[S,{isLoading:T}]=Pc(),{createBackup:g,backupStatus:P,isButtonDisabled:$,isLoading:V,showStatusIndicator:v,isBackupCompleted:q}=ih(),[w,O]=o.useState({open:!1,message:"",color:"success"}),[N,R]=o.useState(null),[W,b]=o.useState(null),[F,G]=o.useState(!1);o.useEffect(()=>{const A=u.some(te=>te.status==="Created");G(A)},[u]);const E=async()=>{if(!d){O({open:!0,message:"No object selected",color:"error"});return}try{await p(d).unwrap(),O({open:!0,message:"Load file generated successfully!",color:"success"}),f()}catch{O({open:!0,message:"Failed to generate load file",color:"error"})}},_=async()=>{if(!d){O({open:!0,message:"No object selected for backup",color:"error"});return}try{await g(d)}catch{}},D=async()=>{if(!W){O({open:!0,message:"Please select a row with 'Created' status to load data",color:"error"});return}if(!d){O({open:!0,message:"No object selected",color:"error"});return}try{await S({iterationId:W,sourceObjectId:d,operation:"insert"}).unwrap(),O({open:!0,message:"Data loaded successfully!",color:"success"}),f(),b(null)}catch{O({open:!0,message:"Failed to load data",color:"error"})}},C=(A,te)=>{te==="Created"?b(A===W?null:A):O({open:!0,message:"Only rows with 'Created' status can be selected",color:"warning"})},oe=A=>A==="Completed"?"success":A==="Failed"?"error":"warning",Z=()=>{if(!P)return"info";const A=P.status.toUpperCase();return A==="SUCCESS"||A==="COMPLETED"?"success":A==="FAILED"?"error":A==="RUNNING"?"warning":"info"},he=()=>{if(!P)return null;const A=P.status.toUpperCase();return A==="SUCCESS"||A==="COMPLETED"?e.jsx(Vo,{sx:{fontSize:18,color:"success.main"}}):A==="FAILED"?e.jsx(Ho,{sx:{fontSize:18,color:"error.main"}}):null},_e=m||!d||F,z=T||!W;return y?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(ie,{})}):h?e.jsx(ae,{severity:"error",sx:{mt:2},children:"Failed to load load iteration data."}):t?e.jsxs(n,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:"Import the cleaned and transformed data into the target system"}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(H,{variant:"contained",color:"primary",size:"small",sx:{mr:1},children:"Connect"}),e.jsx(xs,{activity:"Load",disabled:!1})]})]}),e.jsx(r,{variant:"h6",sx:{mt:3},children:"Load Data to Target System"}),e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},alignItems:"center",children:[e.jsx(j,{item:!0,children:e.jsx(H,{variant:"contained",startIcon:m?e.jsx(ie,{size:16,color:"inherit"}):e.jsx(Uo,{}),onClick:E,disabled:_e,title:F?"Cannot generate load file while 'Created' status exists in table":"Generate load file",children:"Generate Load File"})}),e.jsx(j,{item:!0,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{variant:"contained",startIcon:e.jsx(Bo,{}),onClick:_,disabled:$||!d,sx:{opacity:$||!d?.8:1},children:"Backup Target"}),(V||v)&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:18,thickness:5}),P&&e.jsx(r,{variant:"body2",color:Z(),sx:{fontSize:"0.75rem"},children:P.status})]}),q&&P&&e.jsxs(e.Fragment,{children:[he(),e.jsx(r,{variant:"body2",color:Z(),sx:{fontSize:"0.75rem"},children:P.status})]})]})}),e.jsx(j,{item:!0,children:e.jsx(H,{variant:"contained",startIcon:T?e.jsx(ie,{size:16,color:"inherit"}):e.jsx(No,{}),onClick:D,disabled:z,title:W?"Load data to target":"Please select a row with 'Created' status",children:"Load Data"})}),e.jsx(j,{item:!0,children:e.jsx(ne,{onClick:()=>f(),disabled:!d||!c,children:e.jsx(Go,{})})})]}),F&&e.jsx(ae,{severity:"info",sx:{mt:1,mb:1},children:'"Generate Load File" button is disabled because there are rows with "Created" status in the table. Please complete the load process or clear existing created entries to generate new load files.'}),e.jsx(me,{sx:{mt:3,p:2},children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{padding:"checkbox",children:"Select"}),e.jsx(x,{children:"ID"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Records"}),e.jsx(x,{children:"Success"}),e.jsx(x,{children:"Failed"}),e.jsx(x,{children:"Start"}),e.jsx(x,{children:"End"})]})}),e.jsx(Ye,{children:u.map(A=>e.jsxs(pe,{hover:!0,onClick:()=>R(A),sx:{cursor:"pointer"},children:[e.jsx(x,{padding:"checkbox",onClick:te=>te.stopPropagation(),children:e.jsx(rs,{checked:W===A.id,onChange:()=>C(A.id,A.status),disabled:A.status!=="Created",color:"primary"})}),e.jsx(x,{children:A.id}),e.jsx(x,{children:e.jsx(X,{label:A.status,color:oe(A.status),size:"small"})}),e.jsx(x,{children:A.record_ct}),e.jsx(x,{children:A.success_ct}),e.jsx(x,{children:A.failed_ct}),e.jsx(x,{children:A.start_dt}),e.jsx(x,{children:A.end_dt})]},A.id))})]})}),u.length===0&&e.jsx(ae,{severity:"info",sx:{mt:2},children:"No load iterations found for this object."}),W&&e.jsxs(ae,{severity:"success",sx:{mt:2},children:["Selected iteration: ",W," - Ready to load data"]}),e.jsx(nh,{open:!!N,onClose:()=>R(null),row:N}),e.jsx(dt,{open:w.open,autoHideDuration:3e3,onClose:()=>O({...w,open:!1}),message:w.message,ContentProps:{sx:{backgroundColor:w.color==="success"?"#2e7d32":w.color==="error"?"#d32f2f":"#ed6c02"}}})]}):e.jsx(ae,{severity:"info",children:"Please select an object to view load data."})},zi=()=>{const{selectedObject:t}=ke(xe=>xe.migration),{getReadOnlyFlag:s,getActivityStatus:a}=os(),i=t?.object_id,[l,d]=o.useState(0),[c,u]=o.useState(10),[f,y]=o.useState(""),[h,p]=o.useState(null),[m,S]=o.useState(0),[T,g]=o.useState(50),[P,$]=o.useState(null),[V,v]=o.useState(!1),[q,w]=o.useState({}),[O,N]=o.useState(!1),[R,W]=o.useState(!1),[b,F]=o.useState(!1),[G,E]=o.useState(null),[_,D]=o.useState(""),[C,oe]=o.useState(""),[Z,he]=o.useState({open:!1,message:"",severity:"success"}),{data:_e,isLoading:z,error:A,refetch:te}=Yc({objectId:i,page:l+1,pageSize:c},{skip:!i});o.useEffect(()=>{i&&(d(0),te())},[i,te]),o.useEffect(()=>{i&&a(i)},[i,a]);const[I]=Kc(),[J]=ed(),[se]=td(),[Ie]=sd(),[Fe]=ad(),[de]=rd(),[qe]=nd(),{data:Ne,isLoading:Oe,error:st}=Xc({summaryId:h||"",objectId:i||"",page:m+1,pageSize:T},{skip:!h||!i}),K=(xe,Ue)=>{d(Ue)},Ce=xe=>{u(parseInt(xe.target.value,10)),d(0)},k=(xe,Ue)=>{S(Ue)},Q=xe=>{g(parseInt(xe.target.value,10)),S(0)},U=(xe,Ue)=>{$(xe),w({...Ue}),v(!0)},ue=()=>{v(!1),$(null),w({})},M=async()=>{if(!h||!i||P===null)return;if(Object.values(q).some(Ue=>Ue==null||String(Ue).trim()==="")){he({open:!0,message:"All fields are required",severity:"error"});return}try{await J({summaryId:h,objectId:i,recordData:q}).unwrap(),he({open:!0,message:"Data record updated successfully!",severity:"success"}),ue()}catch{he({open:!0,message:"Failed to update data record",severity:"error"})}},ce=(xe,Ue)=>{w(we=>({...we,[xe]:Ue}))},le=async()=>{if(i){N(!0);try{await se(i).unwrap(),he({open:!0,message:"Email sent successfully to all error records!",severity:"success"})}catch{he({open:!0,message:"Failed to send emails",severity:"error"})}finally{N(!1)}}},Se=async()=>{if(i){W(!0);try{await Ie(i).unwrap(),he({open:!0,message:"Load file generated successfully!",severity:"success"})}catch{he({open:!0,message:"Failed to generate load file",severity:"error"})}finally{W(!1)}}},ve=xe=>{},B=xe=>{p(xe.id),y(xe.id),S(0)},Y=(xe,Ue)=>{y(f===Ue?"":Ue)},ge=xe=>f===xe,Ze=xe=>{E(xe),D(xe.comment||""),oe(xe.Fix||""),F(!0)},ze=async()=>{if(G)try{await I({id:G.id,comment:_,Fix:C}).unwrap(),he({open:!0,message:"Error record updated successfully!",severity:"success"}),F(!1),te()}catch{he({open:!0,message:"Failed to update error record",severity:"error"})}},ut=async(xe,Ue)=>{if(i)try{await de({errorTrackerId:xe.id,iterationId:xe.iteration_reference,objectId:i}).unwrap(),he({open:!0,message:`Error ${Ue?"unignored":"ignored"} successfully!`,severity:"success"}),te()}catch{he({open:!0,message:"Failed to update ignore status",severity:"error"})}},es=async xe=>{if(i)try{await Fe({errorId:xe.id,objectId:i}).unwrap(),he({open:!0,message:"Email sent successfully!",severity:"success"})}catch{he({open:!0,message:"Failed to send email",severity:"error"})}},lt=async xe=>{if(i)try{const Ue=await qe({errorId:xe.id,objectId:i,iterationId:xe.iteration_reference}).unwrap(),we=new Blob([JSON.stringify(Ue,null,2)],{type:"application/json"}),Le=URL.createObjectURL(we),Ve=document.createElement("a");Ve.href=Le,Ve.download=`error-${xe.id}.csv`,document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),URL.revokeObjectURL(Le),he({open:!0,message:"Error CSV downloaded successfully!",severity:"success"})}catch{he({open:!0,message:"Failed to download error CSV",severity:"error"})}},Bt=()=>{he({...Z,open:!1})},bs=_e?.records?.length||0,Tt=!1,Lt=!1;return t?e.jsxs(n,{children:[e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:"Resolve issues that you get during migration process"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(xs,{activity:"Error Handling",disabled:!1}),e.jsx(H,{variant:"outlined",startIcon:O?e.jsx(ie,{size:20}):e.jsx(Rr,{}),onClick:le,disabled:O||!i||s("Error Handling"),children:O?"Sending...":"Email All"}),e.jsx(H,{variant:"contained",onClick:Se,disabled:R||!i||s("Error Handling"),startIcon:R?e.jsx(ie,{size:20}):null,children:R?"Generating...":"Load All"}),e.jsx(ne,{onClick:()=>te(),disabled:!i||s("Error Handling"),children:e.jsx(Dt,{})})]})]}),e.jsxs(me,{elevation:2,sx:{width:"100%",overflow:"hidden"},children:[e.jsx(tt,{sx:{maxHeight:600},children:e.jsxs(Je,{stickyHeader:!0,"aria-label":"error table",children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{padding:"checkbox",children:e.jsx(rs,{indeterminate:Lt,checked:Tt,onChange:ve})}),e.jsx(x,{children:"Error Message"}),e.jsx(x,{children:"Count"}),e.jsx(x,{children:"Comment"}),e.jsx(x,{children:"Fix"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Ignored"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:z?e.jsx(pe,{children:e.jsxs(x,{colSpan:8,align:"center",sx:{py:3},children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading error data..."})]})}):A?e.jsx(pe,{children:e.jsx(x,{colSpan:8,align:"center",sx:{py:3},children:e.jsx(ae,{severity:"error",children:"Failed to load error data."})})}):bs===0?e.jsx(pe,{children:e.jsx(x,{colSpan:8,align:"center",sx:{py:3},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No error records found."})})}):_e?.records?.map(xe=>{const Ue=ge(xe.id);return e.jsxs(pe,{hover:!0,onClick:()=>B(xe),role:"checkbox","aria-checked":Ue,tabIndex:-1,selected:Ue,sx:{cursor:"pointer"},children:[e.jsx(x,{padding:"checkbox",children:e.jsx(rs,{checked:Ue,onClick:we=>Y(we,xe.id)})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:xe.error,children:xe.error})}),e.jsx(x,{children:e.jsx(X,{label:xe.Count,size:"small",color:"primary",variant:"outlined"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:xe.comment,children:xe.comment||"No comment"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:xe.Fix,children:xe.Fix||"No fix"})}),e.jsx(x,{children:e.jsx(X,{label:xe.status,color:xe.status==="failed"?"error":"default",size:"small"})}),e.jsx(x,{children:e.jsx(or,{checked:xe.is_ignored,onChange:()=>ut(xe,xe.is_ignored),onClick:we=>we.stopPropagation(),color:"warning"})}),e.jsx(x,{children:e.jsxs(n,{display:"flex",gap:1,onClick:we=>we.stopPropagation(),children:[e.jsx(ne,{size:"small",onClick:()=>Ze(xe),color:"primary",children:e.jsx(ht,{})}),e.jsx(ne,{size:"small",onClick:()=>es(xe),color:"info",children:e.jsx(Rr,{})}),e.jsx(ne,{size:"small",onClick:()=>lt(xe),color:"success",children:e.jsx(Ja,{})})]})})]},xe.id)})})]})}),_e&&e.jsx(Ss,{rowsPerPageOptions:[5,10,25,50],component:"div",count:_e.total_records,rowsPerPage:c,page:l,onPageChange:K,onRowsPerPageChange:Ce})]}),h&&e.jsxs(n,{mt:4,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Error Records for Selected Error"}),e.jsxs(me,{elevation:2,sx:{width:"100%",overflow:"hidden"},children:[e.jsx(tt,{sx:{maxHeight:600},children:e.jsxs(Je,{stickyHeader:!0,"aria-label":"data records table",children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{padding:"checkbox",children:"Select"}),Ne?.records&&Ne.records.length>0&&Object.keys(Ne.records[0]).map(xe=>e.jsx(x,{children:xe},xe))]})}),e.jsx(Ye,{children:Oe?e.jsx(pe,{children:e.jsxs(x,{colSpan:11,align:"center",sx:{py:3},children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{mt:1},children:"Loading data records..."})]})}):st?e.jsx(pe,{children:e.jsx(x,{colSpan:11,align:"center",sx:{py:3},children:e.jsx(ae,{severity:"error",children:"Failed to load data records."})})}):Ne?.records&&Ne.records.length>0?Ne.records.map((xe,Ue)=>e.jsxs(pe,{children:[e.jsx(x,{padding:"checkbox",children:e.jsx(rs,{checked:P===Ue,onChange:()=>U(Ue,xe)})}),Object.values(xe).map((we,Le)=>e.jsx(x,{children:e.jsx(r,{variant:"body2",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis"},children:String(we)})},Le))]},Ue)):e.jsx(pe,{children:e.jsx(x,{colSpan:11,align:"center",sx:{py:3},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No data records found."})})})})]})}),Ne&&e.jsx(Ss,{rowsPerPageOptions:[10,25,50,100],component:"div",count:Ne.total_records,rowsPerPage:T,page:m,onPageChange:k,onRowsPerPageChange:Q})]})]}),e.jsxs(wt,{open:b,onClose:()=>F(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(It,{children:"Edit Error Record"}),e.jsx(Pt,{children:e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Error Message:"}),e.jsx(me,{variant:"outlined",sx:{p:2,backgroundColor:"grey.50"},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:G?.error})})]}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Comment",fullWidth:!0,multiline:!0,rows:3,value:_,onChange:xe=>D(xe.target.value),variant:"outlined",placeholder:"Add your comments here..."})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(ye,{label:"Fix",fullWidth:!0,multiline:!0,rows:3,value:C,onChange:xe=>oe(xe.target.value),variant:"outlined",placeholder:"Describe the fix here..."})})]})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(H,{onClick:ze,variant:"contained",disabled:!_&&!C,children:"Save Changes"})]})]}),e.jsxs(wt,{open:V,onClose:ue,maxWidth:"md",fullWidth:!0,children:[e.jsx(It,{children:"Edit Data Record"}),e.jsx(Pt,{children:e.jsx(j,{container:!0,spacing:2,sx:{mt:1},children:Ne?.records&&P!==null&&Object.keys(Ne.records[P]).map(xe=>e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{label:xe,fullWidth:!0,value:q[xe]||"",onChange:Ue=>ce(xe,Ue.target.value),variant:"outlined",required:!0,error:!q[xe]||String(q[xe]).trim()==="",helperText:!q[xe]||String(q[xe]).trim()===""?"This field is required":""})},xe))})}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:ue,children:"Cancel"}),e.jsx(H,{onClick:M,variant:"contained",disabled:Object.values(q).some(xe=>xe==null||String(xe).trim()===""),children:"Update Record"})]})]}),e.jsx(dt,{open:Z.open,autoHideDuration:4e3,onClose:Bt,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ae,{onClose:Bt,severity:Z.severity,variant:"filled",children:Z.message})})]}):e.jsx(ae,{severity:"info",children:"Please select an object to view error details."})},oh=({open:t,onClose:s,pipelineId:a,pipelineName:i})=>{const{data:l,isLoading:d,error:c,refetch:u}=vd(a,{skip:!t||!a}),[f,y]=o.useState(new Set),h=l?.slice().sort((S,T)=>S.order-T.order)||[];o.useEffect(()=>{if(!l)return;if(l.filter(T=>T.status==="running"||T.status==="created").length>0){const T=setInterval(()=>{u()},3e3);return()=>clearInterval(T)}},[l,u]);const p=S=>{switch(S){case"completed":return"success";case"error":return"error";case"running":return"primary";case"created":return"warning";default:return"default"}},m=S=>new Date(S).toLocaleString();return e.jsx(Et,{anchor:"right",open:t,onClose:s,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:600},p:0}},children:e.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(ar,{position:"static",sx:{bgcolor:"primary.main"},children:e.jsxs(ns,{children:[e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(r,{variant:"h6",children:"Pipeline Steps"}),e.jsx(r,{variant:"body2",sx:{opacity:.8},children:i})]}),e.jsx(ne,{color:"inherit",onClick:s,children:e.jsx(ct,{})})]})}),e.jsx(n,{sx:{flex:1,overflow:"auto",p:3},children:d?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ie,{size:48}),e.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading steps..."})]}):c?e.jsx(ae,{severity:"error",sx:{mb:3},children:"Failed to load pipeline steps. Please try again."}):h.length===0?e.jsx(n,{sx:{textAlign:"center",py:8},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"No steps found for this pipeline"})}):e.jsx(Zt,{spacing:2,children:h.map((S,T)=>e.jsx(De,{sx:{borderRadius:2},children:e.jsx(Ee,{sx:{p:3},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:60},children:[e.jsx(n,{sx:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:S.status==="completed"?"success.main":S.status==="error"?"error.main":S.status==="running"?"primary.main":"warning.main",color:"white",mb:1},children:S.status==="running"?e.jsx(ie,{size:20,color:"inherit"}):e.jsx(r,{variant:"body2",sx:{fontWeight:"bold"},children:T+1})}),T<h.length-1&&e.jsx(n,{sx:{width:2,height:40,bgcolor:S.status==="completed"?"success.main":"grey.300"}})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:S.name}),e.jsx(X,{label:S.status.toUpperCase(),size:"small",color:p(S.status),variant:S.status==="completed"?"filled":"outlined"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:S.description}),e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[e.jsx(X,{label:`Type: ${S.step_type}`,size:"small",variant:"outlined"}),e.jsx(X,{label:`Task: ${S.config.task}`,size:"small",variant:"outlined"})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Created: ",m(S.created_at)]}),S.status==="error"&&S.error_message&&e.jsx(r,{variant:"caption",color:"error.main",children:S.error_message})]}),S.results&&e.jsxs(n,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"caption",sx:{fontWeight:"bold"},children:"Results:"}),e.jsx(r,{variant:"body2",sx:{mt:1},children:JSON.stringify(S.results,null,2)})]})]})]})})},S.id))})})]})})},lh=({open:t,onClose:s,executionId:a,executionName:i})=>{const{data:l,isLoading:d,error:c}=wd(a,{skip:!t||!a}),u=l?.slice().sort((h,p)=>h.order-p.order)||[],f=h=>{switch(h.toLowerCase()){case"completed":case"success":return"success";case"failed":case"error":return"error";case"running":return"primary";case"pending":case"created":return"warning";default:return"default"}},y=h=>new Date(h).toLocaleString();return e.jsx(Et,{anchor:"right",open:t,onClose:s,sx:{"& .MuiDrawer-paper":{width:{xs:"100%",sm:600},p:0}},children:e.jsxs(n,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(ar,{position:"static",sx:{bgcolor:"primary.main"},children:e.jsxs(ns,{children:[e.jsx(r,{variant:"h6",sx:{flexGrow:1},children:"Execution Steps"}),e.jsx(ne,{color:"inherit",onClick:s,children:e.jsx(ct,{})})]})}),e.jsxs(n,{sx:{flex:1,overflow:"auto",p:3},children:[e.jsx(r,{variant:"h6",sx:{mb:3,fontWeight:"bold"},children:i}),d?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ie,{size:48}),e.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading execution steps..."})]}):c?e.jsx(ae,{severity:"error",sx:{mb:3},children:"Failed to load execution steps. Please try again."}):u.length===0?e.jsx(n,{sx:{textAlign:"center",py:8},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"No steps found for this execution"})}):e.jsx(Zt,{spacing:2,children:u.map((h,p)=>e.jsx(De,{sx:{borderRadius:2},children:e.jsx(Ee,{sx:{p:3},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsxs(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:60},children:[e.jsx(n,{sx:{width:40,height:40,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:h.status==="completed"||h.status==="success"?"success.main":h.status==="failed"||h.status==="error"?"error.main":h.status==="running"?"primary.main":"warning.main",color:"white",mb:1},children:h.status==="running"?e.jsx(ie,{size:20,color:"inherit"}):e.jsx(r,{variant:"body2",sx:{fontWeight:"bold"},children:p+1})}),p<u.length-1&&e.jsx(n,{sx:{width:2,height:40,bgcolor:h.status==="completed"||h.status==="success"?"success.main":"grey.300"}})]}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:h.step_name}),e.jsx(X,{label:h.status.toUpperCase(),size:"small",color:f(h.status),variant:h.status==="completed"||h.status==="success"?"filled":"outlined"})]}),e.jsxs(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Type: ",h.step_type]}),e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:[e.jsx(X,{label:`Started: ${y(h.started_at)}`,size:"small",variant:"outlined"}),h.completed_at&&e.jsx(X,{label:`Completed: ${y(h.completed_at)}`,size:"small",variant:"outlined"})]}),(h.status==="failed"||h.status==="error")&&h.error_message&&e.jsx(ae,{severity:"error",sx:{mb:2,py:1},children:e.jsx(r,{variant:"body2",children:h.error_message})}),h.results&&e.jsxs(n,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[e.jsx(r,{variant:"caption",sx:{fontWeight:"bold"},children:"Results:"}),e.jsx(r,{variant:"body2",sx:{mt:1},children:JSON.stringify(h.results,null,2)})]})]})]})})},h.id))})]})]})})},ch=()=>{xt();const{selectedObject:t,migrationName:s}=ke(A=>A.migration),{selectedProject:a,selectedEnvironment:i,selectedSystem:l}=ke(A=>A.app),[d,c]=o.useState(0),[u,f]=o.useState(null),[y,h]=o.useState(!1),[p,m]=o.useState(null),[S,T]=o.useState(!1),[g,P]=o.useState(null),{data:$=[],isLoading:V,error:v,refetch:q}=bd({object_id:t?.object_id||"",environment_id:i?.id||""},{skip:!t?.object_id||!i?.id}),[w,{isLoading:O}]=_d(),[N,{isLoading:R}]=Sd(),[W,{isLoading:b}]=Cd(),{data:F=[],isLoading:G,refetch:E}=kd({pipeline_id:u?.id||"",environment_id:i?.id||""},{skip:!u?.id||d!==1||!i?.id}),{data:_}=pd({source_object_id:t?.object_id||"",project:a?.id||"",environment:i?.id||""},{skip:!t?.object_id||!a?.id||!i?.id}),{data:D=[]}=oa(a?.id||"",{skip:!a?.id});o.useEffect(()=>{u?.id&&i?.id&&d===1&&E()},[u?.id,i?.id,d,E]);const C=(A,te)=>{c(te)},oe=async()=>{if(!(!t?.object_id||!a?.id||!i?.id||!l?.id||!_))try{await w({object_id:t.object_id,project_id:a.id,environment_id:i.id,target_object_id:_?.id||_?.target_object_id||_||"",name:`${t.object_name}_Pipeline`,description:"Generated Pipeline"}).unwrap(),q()}catch(A){console.error("Failed to generate pipeline:",A)}},Z=async A=>{if(i?.id){P(A);try{await N({pipelineId:A,environmentId:i.id}).unwrap(),q(),d===1&&u?.id===A&&E()}catch(te){console.error("Failed to run pipeline:",te)}finally{P(null)}}},he=async A=>{const te=D.find(I=>I.type.toLowerCase()==="qa"||I.name.toLowerCase().includes("qa"));if(!te){console.error("QA environment not found");return}try{await W({pipelineId:A,promotion_note:"Promoted to QA",to_env:te.id}).unwrap(),q()}catch(I){console.error("Failed to promote pipeline:",I)}},_e=A=>{f(A),h(!0)},z=A=>new Date(A).toLocaleDateString();return e.jsxs(n,{children:[e.jsx(r,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"Define Pipelines"}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(Mt,{value:d,onChange:C,sx:{"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Pipeline"}),e.jsx(He,{label:"Execution History"})]})}),d===0&&e.jsxs(n,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mb:3},children:[e.jsx(H,{variant:"contained",onClick:oe,disabled:O||!t?.object_id||!_,startIcon:O?e.jsx(ie,{size:20}):null,children:O?"Generating...":"Generate Pipeline"}),e.jsx(H,{variant:"outlined",onClick:()=>{const A=$.find(te=>te.is_active);A&&he(A.id)},disabled:b||!$.some(A=>A.is_active),startIcon:b?e.jsx(ie,{size:20}):null,children:b?"Promoting...":"Promote to QA"})]}),d===0&&e.jsxs(me,{elevation:2,sx:{p:3},children:[v&&e.jsx(ae,{severity:"error",sx:{mb:3},children:"Failed to load pipelines. Please try again."}),V?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ie,{size:48}),e.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading pipelines..."})]}):$.length===0?e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"No pipelines found"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Generate a pipeline to get started with your migration workflow."})]}):e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Name"}),e.jsx(x,{children:"Active"}),e.jsx(x,{children:"Version"}),e.jsx(x,{children:"Created"}),e.jsx(x,{children:"Modified"}),e.jsx(x,{align:"center",children:"Action"})]})}),e.jsx(Ye,{children:$.map(A=>e.jsxs(pe,{hover:!0,sx:{cursor:"pointer"},onClick:()=>_e(A),children:[e.jsxs(x,{children:[e.jsx(r,{variant:"body2",sx:{fontWeight:"medium"},children:A.name}),e.jsx(r,{variant:"caption",color:"text.secondary",children:A.description})]}),e.jsx(x,{children:e.jsx(X,{label:A.is_active?"ACTIVE":"INACTIVE",size:"small",color:A.is_active?"success":"default",variant:"outlined"})}),e.jsx(x,{children:e.jsxs(r,{variant:"body2",children:["v",A.version_number]})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:z(A.created_at)})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:z(A.modified_at)})}),e.jsx(x,{align:"center",children:A.is_active&&e.jsx(ne,{onClick:te=>{te.stopPropagation(),Z(A.id)},disabled:g===A.id||A.status==="running",color:"primary",size:"small",children:g===A.id?e.jsx(ie,{size:20}):e.jsx(ia,{})})})]},A.id))})]})})]}),d===1&&e.jsx(me,{elevation:2,sx:{p:3},children:u?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"h6",sx:{mb:3,fontWeight:"bold"},children:["Execution History - ",u.name]}),G?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ie,{size:48}),e.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading executions..."})]}):F.length===0?e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"No executions found"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Run the pipeline to see execution history."})]}):e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Started"}),e.jsx(x,{children:"Completed"}),e.jsx(x,{children:"Duration"}),e.jsx(x,{children:"Error"})]})}),e.jsx(Ye,{children:F.map(A=>e.jsxs(pe,{hover:!0,sx:{cursor:"pointer"},onClick:()=>{m(A),T(!0)},children:[e.jsx(x,{children:e.jsx(X,{label:A.status.toUpperCase(),size:"small",color:A.status==="completed"?"success":A.status==="failed"?"error":A.status==="running"?"primary":"warning",variant:"outlined"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:z(A.started_at)})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:A.completed_at?z(A.completed_at):"N/A"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:A.completed_at?`${Math.round((new Date(A.completed_at).getTime()-new Date(A.started_at).getTime())/1e3)}s`:"N/A"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",color:"error.main",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:A.error_message||"N/A"})})]},A.id))})]})})]}):e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"Select a Pipeline"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Go to the Pipeline tab and select a pipeline to view its execution history."})]})}),e.jsx(oh,{open:y,onClose:()=>h(!1),pipelineId:u?.id||"",pipelineName:u?.name||""}),e.jsx(lh,{open:S,onClose:()=>T(!1),executionId:p?.id||"",executionName:`Execution ${p?.id?.slice(-8)||""}`})]})},Cr=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`transform-tabpanel-${a}`,"aria-labelledby":`transform-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{py:2},children:t})}),dh=({open:t,onClose:s,objectId:a,objectName:i,onTaskStarted:l,taskMap:d})=>{const{selectedProject:c,selectedEnvironment:u}=ke(L=>L.app),[f,y]=o.useState(0),[h,p]=o.useState(null),[m,S]=o.useState(null),[T,g]=o.useState({}),[P,$]=o.useState({}),[V,v]=o.useState(new Set),[q,w]=o.useState(1),[O,N]=o.useState(10),[R,W]=o.useState(null),[b,F]=o.useState(null),[G,E]=o.useState(null),[_,D]=o.useState(!1),[C,oe]=o.useState(0),[Z,he]=o.useState(""),[_e,z]=o.useState({open:!1,message:"",severity:"success"}),{data:A,isLoading:te,error:I,isFetching:J,refetch:se}=mi({objectId:a,page:q,pageSize:O},{skip:!t||!a}),{data:Ie=[],isLoading:Fe,error:de}=fc(void 0,{skip:!t}),{data:qe=[],isLoading:Ne,error:Oe}=js(a,{skip:!t}),{data:st,isLoading:K}=hr({sourceObjectId:a,projectId:c?.project_id||"",environmentId:u?.id||""},{skip:!t||!c?.project_id||!u?.id}),{data:Ce=[],isLoading:k}=js(st?.id||"",{skip:!t||!st?.id}),{data:Q,isLoading:U,error:ue}=jc(h?.function_name||"",{skip:!t||!h?.function_name}),[M,{isLoading:ce}]=yc(),{data:le,error:Se,isFetching:ve}=bc({taskId:G},{skip:!G||!_,pollingInterval:_?2e3:0}),B=Array.isArray(Q)?Q[0]:Q,Y=o.useMemo(()=>{const L=qe.map(Pe=>Pe.name).filter(Boolean).sort();return console.log("Source field names computed:",L),L},[qe]),ge=o.useMemo(()=>{const L=Ce.map(Pe=>Pe.name).filter(Boolean).sort();return console.log("Target field names computed:",L),L},[Ce]);o.useEffect(()=>{le&&_&&(console.log("üîÑ Task status update:",le),oe(le.progress||0),he(le.stage||""),["SUCCESS","COMPLETE","FAILURE","ERROR"].includes(le.status)&&(D(!1),le.status==="SUCCESS"||le.status==="COMPLETE"?(z({open:!0,message:`Transformation "${h?.title}" completed successfully!`,severity:"success"}),setTimeout(()=>{se()},1e3),setTimeout(()=>{Le()},3e3)):z({open:!0,message:`Transformation failed: ${le.error||"Unknown error"}`,severity:"error"})))},[le,_,h,se]),o.useEffect(()=>{let L;return _&&(L=setTimeout(()=>{_&&(D(!1),z({open:!0,message:"Transformation timeout after 1 minute. Please check task status manually.",severity:"warning"}))},6e4)),()=>{L&&clearTimeout(L)}},[_]),o.useEffect(()=>{t&&console.log("üîç TransformSlideIn DEBUG:",{objectId:a,objectName:i,sourceMetadataCount:qe.length,sourceFieldNames:Y,targetMetadataCount:Ce.length,targetFieldNames:ge,functionConfigResponse:Q,functionConfig:B,selectedFunction:h})},[t,a,i,qe,Ce,Y,ge,Q,B,h]),o.useEffect(()=>{if(B){console.log("Function config processed:",B),S(B),F(null);const L={},Pe=B["JSON Configuration"]?.configuration;Pe&&Array.isArray(Pe)?(Pe.forEach(be=>{const Re=ut(be);console.log(`üìù Setting default for ${be.attribute}:`,Re),L[be.attribute]=Re}),console.log("Initialized form data:",L)):console.warn("Configuration not found or not an array:",Pe),g(L),$({}),v(new Set)}},[B]),o.useEffect(()=>{h&&B&&!U&&(console.log("Expanding card for:",h.function_name),W(h.function_name))},[h,B,U]);const Ze=L=>{switch(console.log("üîÑ Resolving dynamic pattern:",L),L){case"[CUR_SRC_FIELD_MDT].name":case"[CUR_SRC_OBJECT_MDT].name":return Y;case"[CUR_TGT_FIELD_MDT].name":case"[CUR_TGT_OBJECT_MDT].name":return ge;default:return L.includes("CUR_SRC")?Y:L.includes("CUR_TGT")?ge:(console.warn("‚ùå Unknown dynamic pattern:",L),[])}},ze=L=>{if(console.log("üéØ Getting field options for parameter:",{attribute:L.attribute,values:L.values,uiComponent:L.ui_component}),L.attribute==="column_name"||L.attribute.includes("column_name")||L.attribute.includes("field_name")||L.attribute.includes("source_field"))return console.log("‚ö° FORCING source field names for column parameter:",Y),Y;if(L.values&&L.values.length>0){const Pe=[];L.values.forEach(Re=>{typeof Re=="string"&&(Re.includes("CUR_SRC_OBJECT_MDT")||Re.includes("CUR_SRC_FIELD_MDT")?(console.log("üîç Detected source pattern, resolving:",Re),Pe.push(...Y)):Re.includes("CUR_TGT_OBJECT_MDT")||Re.includes("CUR_TGT_FIELD_MDT")?(console.log("üîç Detected target pattern, resolving:",Re),Pe.push(...ge)):Pe.push(Re))});const be=[...new Set(Pe)];return console.log("‚úÖ Final field options:",be),be}return console.log("‚ùå No values defined for parameter:",L.attribute),[]},ut=L=>{if(console.log("üîß Getting default value for:",{attribute:L.attribute,default:L.default,defaultType:L.default_type}),(L.attribute==="source_field"||L.attribute.includes("field"))&&L.default_type==="dynamic"){if(console.log("‚ö° Handling dynamic default for source_field"),Y.length>0){const Pe=Y[0]||"";return console.log("üéØ Selected source field default:",Pe),Pe}return""}if(L.default_type==="dynamic"){if(L.default&&typeof L.default=="string"&&L.default.startsWith("[")&&L.default.endsWith("]")){const Pe=Ze(L.default);return Pe.length>0?Pe[0]:""}return""}return L.default||""},es=(L,Pe)=>{const be=[];return!Pe||Pe.length===0?{isValid:!0,errors:[]}:(console.log("üîç Validating field:",{value:L,validations:Pe}),Pe.forEach(Re=>{switch(Re.rule){case"not_null":!L&&L!==!1&&L!==0&&(console.log("‚ùå Not null validation failed"),be.push(Re.message));break;case"regex":L&&Re.pattern&&(new RegExp(Re.pattern).test(L)||(console.log("‚ùå Regex validation failed:",{value:L,pattern:Re.pattern}),be.push(Re.message)));break;case"min_length":L&&Re.value&&L.length<parseInt(Re.value)&&(console.log("‚ùå Min length validation failed:",{value:L,minLength:Re.value}),be.push(Re.message));break;case"max_length":L&&Re.value&&L.length>parseInt(Re.value)&&(console.log("‚ùå Max length validation failed:",{value:L,maxLength:Re.value}),be.push(Re.message));break;case"min_value":L!=null&&Re.value&&parseFloat(L)<parseFloat(Re.value)&&(console.log("‚ùå Min value validation failed:",{value:L,minValue:Re.value}),be.push(Re.message));break;case"max_value":L!=null&&Re.value&&parseFloat(L)>parseFloat(Re.value)&&(console.log("‚ùå Max value validation failed:",{value:L,maxValue:Re.value}),be.push(Re.message));break;case"email":L&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(L)&&(console.log("‚ùå Email validation failed"),be.push(Re.message));break;case"url":L&&!/^https?:\/\/.+\..+/.test(L)&&(console.log("‚ùå URL validation failed"),be.push(Re.message));break;case"API":console.log("‚ö†Ô∏è API validation skipped (would call):",Re.api);break;default:console.warn("‚ùì Unknown validation rule:",Re.rule);break}}),console.log("‚úÖ Validation result:",{isValid:be.length===0,errors:be}),{isValid:be.length===0,errors:be})},lt=()=>{if(!m||!m["JSON Configuration"]?.configuration)return{isValid:!1,errors:{}};const L={};let Pe=!0;return console.log("üîç Starting form validation for function:",m["JSON Configuration"].title),m["JSON Configuration"].configuration.forEach(be=>{const Re=T[be.attribute];if(console.log(`üîç Validating parameter: ${be.attribute} =`,Re),!be.optional||Re&&be.validation&&be.validation.length>0){const ot=es(Re,be.validation||[]);ot.isValid||(L[be.attribute]=ot.errors,Pe=!1,console.log(`‚ùå Validation failed for ${be.attribute}:`,ot.errors))}}),console.log("üìä Final validation result:",{isValid:Pe,errors:L}),{isValid:Pe,errors:L}},Bt=()=>{if(f===1&&h){const L=lt();$(L.errors);const Pe=new Set(m?.["JSON Configuration"]?.configuration?.map(be=>be.attribute)||[]);return v(Pe),L.isValid||z({open:!0,message:"Please fix validation errors before proceeding.",severity:"error"}),L.isValid}return!0},bs=(L,Pe)=>{y(Pe)},Tt=()=>{Bt()&&y(f+1)},Lt=()=>{y(f-1)},xe=L=>{console.log("Card header clicked for:",L.function_name,"Current expanded:",R),R===L.function_name?(W(null),F(null)):(W(L.function_name),h?.function_name!==L.function_name&&(p(L),F(L.function_name)))},Ue=L=>Pe=>{const be=L.ui_component==="checkbox"?Pe.target.checked:Pe.target.value,Re={...T,[L.attribute]:be};g(Re);const ot=es(be,L.validation||[]);$(St=>({...St,[L.attribute]:ot.errors})),v(St=>new Set(St).add(L.attribute))},we=L=>()=>{v(be=>new Set(be).add(L.attribute));const Pe=es(T[L.attribute],L.validation||[]);$(be=>({...be,[L.attribute]:Pe.errors}))},Le=()=>{y(0),p(null),S(null),g({}),$({}),v(new Set),W(null),F(null),E(null),D(!1),oe(0),he(""),s()},Ve=async()=>{const L=lt();if(!L.isValid){$(L.errors);const Pe=new Set(m?.["JSON Configuration"]?.configuration?.map(be=>be.attribute)||[]);v(Pe),z({open:!0,message:"Please fix validation errors before executing transformation.",severity:"error"});return}try{D(!0),oe(0),he("Starting transformation...");const Pe={object_id:a,function_name:h.function_name,params:T};console.log("üöÄ Sending transform request:",Pe);const be=await M(Pe).unwrap();console.log("‚úÖ Transform task created:",be),E(be.task_id),l(a,be.task_id),z({open:!0,message:`Transformation "${h?.title}" started successfully! Task ID: ${be.task_id}`,severity:"success"})}catch(Pe){if(console.error("‚ùå Failed to start transformation:",Pe),D(!1),Pe.status===409){const be=Pe.data?.task_id;z({open:!0,message:Pe.data?.message||"This transformation is already in progress.",severity:"warning"}),be&&(E(be),D(!0),l(a,be))}else z({open:!0,message:Pe.data?.message||"Failed to start transformation. Please try again.",severity:"error"})}},_t=L=>f>L?"completed":f===L?"current":"pending",Nt=(L,Pe)=>{const be=_t(L);return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",...be==="completed"&&{backgroundColor:"success.main",color:"white"},...be==="current"&&{backgroundColor:"primary.main",color:"white"},...be==="pending"&&{backgroundColor:"grey.300",color:"grey.600"}},children:be==="completed"?e.jsx(mt,{fontSize:"small"}):L+1}),e.jsx(r,{variant:"body2",sx:{fontWeight:be==="current"?"bold":"normal",color:be==="pending"?"text.secondary":"text.primary"},children:Pe})]})},Ft=L=>{const Pe=T[L.attribute]||"",be=P[L.attribute]||[],ot=V.has(L.attribute)&&be.length>0,St=ze(L);if(L.values?.some(jt=>typeof jt=="string"&&jt.includes("CUR_SRC"))&&Ne||L.values?.some(jt=>typeof jt=="string"&&jt.includes("CUR_TGT"))&&k)return e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(ie,{size:20}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Loading field options..."})]});if(Oe&&L.values?.some(jt=>typeof jt=="string"&&jt.includes("CUR_SRC")))return e.jsx(ae,{severity:"error",sx:{mb:2},children:"Failed to load source field options. Please try again."});if(L.values?.some(jt=>typeof jt=="string"&&jt.includes("CUR_SRC"))&&St.length===0)return e.jsx(ae,{severity:"warning",sx:{mb:2},children:"No source field names available. Please check if the object has metadata."});switch(L.ui_component){case"dropdown":return e.jsxs(Ae,{fullWidth:!0,size:"small",error:ot,sx:{mb:2},children:[e.jsx(Me,{children:L.label}),e.jsxs(We,{value:Pe,onChange:Ue(L),onBlur:we(L),label:L.label,disabled:St.length===0,children:[e.jsx(re,{value:"",children:e.jsxs("em",{children:["Select ",L.label]})}),St.map(jt=>e.jsx(re,{value:jt,children:jt},jt))]}),ot&&e.jsx(Ds,{children:be.join(", ")}),L.hint&&!ot&&e.jsx(Ds,{children:L.hint}),St.length===0&&e.jsx(Ds,{error:!0,children:"No field options available. Check object metadata."})]});case"textbox":return e.jsx(ye,{fullWidth:!0,size:"small",label:L.label,value:Pe,onChange:Ue(L),onBlur:we(L),error:ot,helperText:ot?be.join(", "):L.hint,placeholder:L.placeholder,sx:{mb:2}});case"checkbox":return e.jsx(nt,{control:e.jsx(rs,{checked:!!Pe,onChange:Ue(L),onBlur:we(L)}),label:L.label,sx:{mb:2}});default:return e.jsx(ye,{fullWidth:!0,size:"small",label:L.label,value:Pe,onChange:Ue(L),onBlur:we(L),error:ot,helperText:ot?be.join(", "):L.hint,placeholder:L.placeholder,sx:{mb:2}})}},Te=L=>{const Pe=h?.function_name===L.function_name,be=R===L.function_name,Re=b===L.function_name||U&&h?.function_name===L.function_name,ot=m&&m["JSON Configuration"]&&Array.isArray(m["JSON Configuration"].configuration),St=Object.keys(P).some(Gt=>P[Gt].length>0);return e.jsx(De,{elevation:Pe?4:1,sx:{mb:2,border:Pe?2:1,borderColor:Pe?St?"error.main":"primary.main":"grey.300"},children:e.jsxs(Ee,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:1,cursor:Re?"default":"pointer","&:hover":{backgroundColor:Re?"transparent":"action.hover"},borderRadius:1,p:1,ml:-1,mr:-1,mt:-1},onClick:()=>!Re&&xe(L),children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(r,{variant:"h6",component:"h3",children:L.title}),St&&e.jsx(je,{title:"This function has validation errors",children:e.jsx(is,{color:"error",fontSize:"small"})}),Re&&e.jsx(ie,{size:16})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[Pe&&!Re&&e.jsx(mt,{color:St?"error":"primary"}),e.jsx(Xt,{sx:{transform:be?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})]})]}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:L.description}),e.jsx(r,{variant:"caption",color:"text.secondary",children:L.helptext}),e.jsxs(n,{sx:{mt:1},children:[e.jsx(X,{label:`Function: ${L.function_name}`,size:"small",variant:"outlined"}),St&&e.jsx(X,{label:"Validation Errors",size:"small",color:"error",sx:{ml:1}})]}),be&&e.jsx(n,{sx:{mt:3,pt:2,borderTop:1,borderColor:"divider"},children:Re?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3},children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading configuration..."})]}):ot?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gs,{color:"primary"}),"Configure ",m["JSON Configuration"].title]}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:m["JSON Configuration"].helptext}),St&&e.jsx(ae,{severity:"error",sx:{mb:2},children:"Please fix the validation errors below before proceeding."}),e.jsx(n,{sx:{mt:2},children:m["JSON Configuration"].configuration.map(Gt=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsxs(r,{variant:"subtitle2",children:[Gt.label,!Gt.optional&&" *"]}),Gt.tool_tip&&e.jsx(je,{title:Gt.tool_tip,children:e.jsx(gs,{fontSize:"small",color:"action"})})]}),Ft(Gt)]},Gt.attribute))})]}):ue?e.jsx(ae,{severity:"error",sx:{mt:2},children:"Failed to load function configuration. Please try again."}):e.jsx(ae,{severity:"warning",sx:{mt:2},children:"No configuration available for this function."})})]})})},$e=()=>{const L=A?.data||[],Pe=L.length>0?Object.keys(L[0]):[];return te||J?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading data..."})]}):I?e.jsx(ae,{severity:"error",children:"Failed to load transformation data. Please try again later."}):L.length===0?e.jsx(ae,{severity:"info",children:"No transformation data found for this object."}):e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Showing ",L.length," of ",A?.total_records||0," records"]}),e.jsx(X,{label:`Page ${q} of ${A?.total_pages||1}`,size:"small",variant:"outlined"})]}),e.jsx(tt,{component:me,elevation:1,sx:{maxHeight:400},children:e.jsxs(Je,{stickyHeader:!0,size:"small",children:[e.jsx(Xe,{children:e.jsx(pe,{sx:{backgroundColor:"primary.light"},children:Pe.map(be=>e.jsx(x,{sx:{color:"white",fontWeight:"bold",whiteSpace:"nowrap"},children:be},be))})}),e.jsx(Ye,{children:L.map((be,Re)=>e.jsx(pe,{sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:"action.hover"}},children:Pe.map(ot=>e.jsx(x,{sx:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:be[ot]?.toString(),children:be[ot]?.toString()||"-"},ot))},Re))})]})}),A&&A.total_pages>1&&e.jsx(Ss,{rowsPerPageOptions:[10,25,50,100],component:"div",count:A.total_records,rowsPerPage:O,page:q-1,onPageChange:(be,Re)=>w(Re+1),onRowsPerPageChange:be=>{const Re=parseInt(be.target.value,10);N(Re),w(1)},sx:{mt:2},labelRowsPerPage:"Rows per page:",labelDisplayedRows:({from:be,to:Re,count:ot})=>`${be}-${Re} of ${ot!==-1?ot:`more than ${Re}`}`})]})};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:_?void 0:Le,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:900,height:"100vh",margin:0,borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(n,{sx:{p:3,borderBottom:1,borderColor:"divider",backgroundColor:"primary.main",color:"white"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h5",component:"h2",fontWeight:"bold",gutterBottom:!0,children:"Data Transformation"}),e.jsxs(r,{variant:"body1",children:["Object: ",e.jsx("strong",{children:i})]}),e.jsx(r,{variant:"body2",children:"Apply transformation rules to modify data structure and values"})]}),e.jsx(ne,{onClick:_?void 0:Le,sx:{color:"white"},disabled:_,children:e.jsx(ct,{})})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Nt(0,"Review Data"),e.jsx(n,{sx:{flex:1,height:2,backgroundColor:"grey.300",mx:1}}),Nt(1,"Select Transformation"),e.jsx(n,{sx:{flex:1,height:2,backgroundColor:"grey.300",mx:1}}),Nt(2,"Preview & Execute")]})]}),e.jsxs(n,{sx:{flexGrow:1,p:3,overflow:"auto"},children:[e.jsxs(Mt,{value:f,onChange:bs,sx:{mb:3},children:[e.jsx(He,{label:"Review Data"}),e.jsx(He,{label:"Select Transformation",disabled:f<1||_}),e.jsx(He,{label:"Preview & Execute",disabled:f<2||_})]}),e.jsxs(Cr,{value:f,index:0,children:[e.jsx(j,{container:!0,spacing:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(is,{color:"warning"}),"Data Preview"]}),e.jsxs(r,{variant:"body2",paragraph:!0,children:["Review the current data for ",e.jsx("strong",{children:i})," before applying transformations. This shows the same data as displayed in the main transformation table."]}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:2,flexWrap:"wrap",mb:2},children:[e.jsx(X,{label:`Total Records: ${A?.total_records||0}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Current Page: ${q}`,variant:"outlined",color:"secondary"}),e.jsx(X,{label:`Total Pages: ${A?.total_pages||1}`,variant:"outlined"}),e.jsx(X,{label:`Page Size: ${O}`,variant:"outlined"})]}),$e()]})})})}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mt:3},children:e.jsx(H,{variant:"contained",onClick:Tt,endIcon:e.jsx(Gs,{}),disabled:_,children:"Continue to Select Transformation"})})]}),e.jsxs(Cr,{value:f,index:1,children:[Fe?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading transformation functions..."})]}):de?e.jsx(ae,{severity:"error",children:"Failed to load transformation functions. Please try again later."}):Ie.length===0?e.jsx(ae,{severity:"info",children:"No transformation functions available."}):e.jsx(j,{container:!0,spacing:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gs,{color:"primary"}),"Available Transformations"]}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose a transformation function to apply to your data. Each function performs specific data modifications."}),Ie.map(L=>Te(L))]})})})}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(H,{variant:"outlined",onClick:Lt,disabled:_,children:"Back to Review Data"}),e.jsx(H,{variant:"contained",onClick:Tt,endIcon:e.jsx(Za,{}),disabled:!h||!m||Object.keys(P).some(L=>P[L].length>0)||_,children:"Preview & Execute"})]})]}),e.jsxs(Cr,{value:f,index:2,children:[h&&m&&m["JSON Configuration"]&&e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{elevation:2,children:e.jsxs(Ee,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Za,{color:"primary"}),"Transformation Summary"]}),Object.keys(P).some(L=>P[L].length>0)&&e.jsx(ae,{severity:"error",sx:{mb:2},children:"Please fix the validation errors before executing the transformation."}),_&&e.jsx(ae,{severity:"info",sx:{mb:2},children:e.jsxs(n,{sx:{width:"100%"},children:[e.jsxs(r,{variant:"body2",gutterBottom:!0,children:["Transformation in progress: ",Z," (",C,"%)"]}),e.jsx(ms,{variant:"determinate",value:C,sx:{mt:1}}),G&&e.jsxs(r,{variant:"caption",display:"block",sx:{mt:1},children:["Task ID: ",G]})]})}),e.jsxs(j,{container:!0,spacing:2,sx:{mt:1},children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Selected Function"}),e.jsx(r,{variant:"body1",fontWeight:"bold",children:h.title})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Object"}),e.jsx(r,{variant:"body1",fontWeight:"bold",children:i})]})]}),e.jsxs(cr,{sx:{mt:2},children:[e.jsx(dr,{expandIcon:e.jsx(Xt,{}),children:e.jsx(r,{variant:"subtitle2",children:"Configuration Parameters"})}),e.jsx(ur,{children:e.jsx(Je,{size:"small",children:e.jsx(Ye,{children:m["JSON Configuration"].configuration?.map(L=>e.jsxs(pe,{children:[e.jsxs(x,{sx:{fontWeight:"bold",width:"30%"},children:[L.label,!L.optional&&" *"]}),e.jsxs(x,{children:[T[L.attribute]?.toString()||"(Not set)",P[L.attribute]&&P[L.attribute].length>0&&e.jsx(n,{sx:{mt:.5},children:e.jsx(ae,{severity:"error",sx:{py:0,fontSize:"0.75rem"},children:P[L.attribute].join(", ")})})]})]},L.attribute))})})})]}),e.jsxs(n,{sx:{mt:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Data Preview"}),e.jsx(r,{variant:"body2",color:"text.secondary",paragraph:!0,children:"This is how your data currently looks. The transformation will be applied to this data."}),$e()]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(ae,{severity:"warning",children:["This transformation will modify data in the ",e.jsx("strong",{children:i})," object. Review the configuration before executing."]})})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mt:3},children:[e.jsx(H,{variant:"outlined",onClick:Lt,disabled:_,children:"Back to Configuration"}),e.jsx(H,{variant:"contained",color:"success",startIcon:_?e.jsx(ie,{size:20,color:"inherit"}):e.jsx(ia,{}),onClick:Ve,disabled:Object.keys(P).some(L=>P[L].length>0)||_,children:_?`Transforming... (${C}%)`:"Execute Transformation"})]})]})]})]})}),e.jsx(dt,{open:_e.open,autoHideDuration:6e3,onClose:()=>z({..._e,open:!1}),message:_e.message})]})},uh=({open:t,onClose:s,objectId:a,objectName:i})=>{const[l,d]=o.useState(new Set),[c,u]=o.useState(!1),[f,y]=o.useState(null),[h,p]=o.useState(null),[m,S]=o.useState(!1),[T,g]=o.useState(new Set),[P,$]=o.useState({}),[V,v]=o.useState(new Set),[q,w]=o.useState({open:!1,message:"",severity:"success"}),{data:O=[],isLoading:N,error:R}=vc({objectId:a},{skip:!t||!a}),[W]=en(),[b]=tn(),[F]=_c(),G=z=>{switch(z){case"APPLIED":return"#4caf50";case"SUCCESS":return"#4caf50";case"PENDING":return"#ff9800";case"FAILURE":case"ERROR":return"#f44336";default:return"#9e9e9e"}},E=z=>new Date(z).toLocaleString(),_=z=>{const A=new Set(l);A.has(z)?A.delete(z):A.add(z),d(A)},D=async()=>{if(O.length!==0)try{u(!0);const z=O.map(te=>te.rule_id.toString()),A=await W({object_id:a,rule_ids:z}).unwrap();console.log("Apply all rules started:",A),y(A.task_id),C(A.task_id)}catch(z){console.error("Failed to apply all rules:",z),u(!1),w({open:!0,message:"Failed to start applying all rules. Please try again.",severity:"error"})}},C=async z=>{try{const A=await b({taskId:z}).unwrap();if(console.log("Task status:",A),A.status==="SUCCESS"||A.status==="FAILURE"||A.status==="ERROR"){u(!1),y(null),p(A),S(!0);const te=A.result?.results?.some(I=>I.status==="error");if(A.status==="SUCCESS"&&!te)w({open:!0,message:"All rules applied successfully!",severity:"success"});else if(te){const I=A.result?.results?.filter(J=>J.status==="error").length||0;w({open:!0,message:`Failed to apply ${I} rule${I!==1?"s":""}. Check results for details.`,severity:"error"})}else w({open:!0,message:`Failed to apply rules: ${A.error||"Unknown error"}`,severity:"error"})}else setTimeout(()=>C(z),2e3)}catch(A){console.error("Failed to get task status:",A),u(!1),y(null),w({open:!0,message:"Failed to check task status. Please try again.",severity:"error"})}},oe=z=>{console.log("Edit rule:",z)},Z=async z=>{try{g(te=>new Set(te).add(z.rule_id));const A=await W({object_id:a,rule_ids:[z.rule_id.toString()]}).unwrap();console.log("Reapply rule started:",A),he(z.rule_id,A.task_id)}catch(A){console.error("Failed to reapply rule:",A),g(te=>{const I=new Set(te);return I.delete(z.rule_id),I})}},he=async(z,A)=>{try{const te=await b({taskId:A}).unwrap();if(console.log("Reapply status:",te),te.status==="SUCCESS"||te.status==="FAILURE"||te.status==="ERROR"){g(J=>{const se=new Set(J);return se.delete(z),se}),$(J=>({...J,[z]:te}));const I=te.result?.results?.find(J=>Number(J.rule_id)===z);console.log("Individual rule result lookup:",{ruleId:z,ruleResult:I,allResults:te.result?.results}),I?I.status==="error"?(console.log("Found error in individual rule result"),w({open:!0,message:`Rule ${z} reapply failed: ${I.message||"Unknown error"}`,severity:"error"})):w({open:!0,message:`Rule ${z} reapplied successfully`,severity:"success"}):te.status==="SUCCESS"?(console.log("Overall success, no individual result found"),w({open:!0,message:`Rule ${z} reapplied successfully`,severity:"success"})):(console.log("Overall failure"),w({open:!0,message:`Failed to reapply rule ${z}: ${te.error||"Unknown error"}`,severity:"error"}))}else setTimeout(()=>he(z,A),2e3)}catch(te){console.error("Failed to get reapply status:",te),g(I=>{const J=new Set(I);return J.delete(z),J}),w({open:!0,message:`Failed to check reapply status for rule ${z}. Please try again.`,severity:"error"})}},_e=async z=>{try{v(A=>new Set(A).add(z.rule_id)),await F({ruleId:z.rule_id}).unwrap(),w({open:!0,message:`Rule ${z.rule_id} deleted successfully!`,severity:"success"})}catch(A){console.error("Failed to delete rule:",A),w({open:!0,message:`Failed to delete rule ${z.rule_id}. Please try again.`,severity:"error"})}finally{v(A=>{const te=new Set(A);return te.delete(z.rule_id),te})}};return e.jsxs(e.Fragment,{children:[e.jsx(Ut,{open:t,onClose:s,sx:{display:"flex",alignItems:"flex-start",justifyContent:"flex-end"},children:e.jsxs(me,{sx:{width:"700px",height:"100vh",margin:0,borderRadius:0,overflow:"auto",display:"flex",flexDirection:"column",backgroundColor:"grey.50"},children:[e.jsxs(n,{sx:{py:1.5,px:2,borderBottom:1,borderColor:"divider",backgroundColor:"#4c1d95",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ir,{sx:{fontSize:20}}),e.jsxs(r,{variant:"h6",component:"h2",fontWeight:"bold",sx:{fontSize:"1rem"},children:["Transform Rule Timeline - ",i]})]}),e.jsx(ne,{onClick:s,sx:{color:"white",p:.5},size:"small",children:e.jsx(ct,{sx:{fontSize:20}})})]}),e.jsxs(n,{sx:{py:1,px:2,backgroundColor:"#4c1d95",borderBottom:1,borderColor:"divider",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"body2",sx:{color:"grey.700",fontWeight:"medium"},children:"List of Transform Rules"}),e.jsx(H,{variant:"contained",size:"small",onClick:D,disabled:c||O.length===0,startIcon:c?e.jsx(ie,{size:16}):null,sx:{backgroundColor:"white",color:"#4c1d95","&:hover":{backgroundColor:"grey.100"},"&.Mui-disabled":{backgroundColor:"grey.300",color:"grey.500"}},children:c?"Applying...":"Apply All Rules"})]}),e.jsx(n,{sx:{flexGrow:1,p:3,overflow:"auto"},children:N?e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:[e.jsx(ie,{}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading transform rules..."})]}):R?e.jsx(ae,{severity:"error",children:"Failed to load transform rules. Please try again later."}):O.length===0?e.jsx(ae,{severity:"info",children:"No transform rules found for this object."}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.875rem"},children:"Rule Execution History"}),e.jsxs(r,{variant:"caption",color:"text.secondary",sx:{fontSize:"0.75rem"},children:["Showing ",O.length," transform rule",O.length!==1?"s":""," executed on ",i]})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:O.map((z,A)=>{const te=l.has(z.rule_id),I=z.params?.source_field||"N/A";return e.jsx(De,{elevation:2,sx:{border:`2px solid ${G(z.status)}`,backgroundColor:"grey.100"},children:e.jsxs(Ee,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:"bold",color:"primary.main"},children:[A+1,". ",z.function_name]}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(X,{label:`Field: ${I}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}}),e.jsx(X,{label:`ID: ${z.rule_id}`,size:"small",sx:{backgroundColor:"#f5f5dc",border:"none"}})]})]}),e.jsxs(n,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsx(je,{title:"Edit Rule",children:e.jsx(ne,{size:"small",onClick:()=>oe(z),sx:{color:"primary.main"},children:e.jsx(ht,{fontSize:"small"})})}),e.jsx(je,{title:"Reapply Rule",children:e.jsx(ne,{size:"small",onClick:()=>Z(z),disabled:T.has(z.rule_id),sx:{color:"success.main"},children:T.has(z.rule_id)?e.jsx(ie,{size:16}):e.jsx(Zr,{fontSize:"small"})})}),e.jsx(je,{title:"Delete Rule",children:e.jsx(ne,{size:"small",onClick:()=>_e(z),disabled:V.has(z.rule_id),sx:{color:"error.main"},children:V.has(z.rule_id)?e.jsx(ie,{size:16}):e.jsx(ds,{fontSize:"small"})})}),e.jsx(je,{title:te?"Collapse":"Expand",children:e.jsx(ne,{size:"small",onClick:()=>_(z.rule_id),children:te?e.jsx(nr,{}):e.jsx(Xt,{})})})]})]}),e.jsx(as,{in:te,children:e.jsxs(n,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsxs(j,{container:!0,spacing:2,children:[e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Field Name"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:I})]}),e.jsxs(j,{item:!0,xs:6,children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",children:"Applied At"}),e.jsx(r,{variant:"body1",fontWeight:"medium",children:E(z.applied_at)})]})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Status"}),e.jsx(X,{label:z.status,size:"small",sx:{backgroundColor:G(z.status),color:"white",fontWeight:"bold"}})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Rule Definition"}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:z.params&&Object.entries(z.params).map(([J,se])=>e.jsx(X,{label:`${J}: ${se}`,size:"small",sx:{backgroundColor:G(z.status),color:"white"}},J))})]}),z.last_error&&e.jsx(n,{sx:{mt:2},children:e.jsx(ae,{severity:"error",sx:{py:1},children:e.jsx(r,{variant:"body2",children:z.last_error})})})]})})]})},z.rule_id)})}),e.jsxs(n,{sx:{mt:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Rules: ${O.length}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Applied: ${O.filter(z=>z.status==="APPLIED").length}`,variant:"outlined",sx:{backgroundColor:"#4caf50",color:"white"}}),e.jsx(X,{label:`Pending: ${O.filter(z=>z.status==="PENDING").length}`,variant:"outlined",sx:{backgroundColor:"#ff9800",color:"white"}}),e.jsx(X,{label:`Failed: ${O.filter(z=>["FAILURE","ERROR"].includes(z.status)).length}`,variant:"outlined",sx:{backgroundColor:"#f44336",color:"white"}})]})]})})]})}),e.jsx(Ut,{open:m,onClose:()=>S(!1),sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(me,{sx:{p:3,maxWidth:600,maxHeight:"80vh",overflow:"auto"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Apply All Rules Results"}),h&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(r,{variant:"subtitle1",color:"primary",children:["Overall Status: ",h.status]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Task ID: ",h.task_id]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Progress: ",h.progress,"%"]})]}),h.result&&h.result.results&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Individual Rule Results:"}),h.result.results.map((z,A)=>e.jsx(De,{sx:{mb:1,border:`1px solid ${z.status==="error"?"#f44336":"#4caf50"}`},children:e.jsxs(Ee,{sx:{py:1,px:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",fontWeight:"bold",children:["Rule ID: ",z.rule_id]}),e.jsx(X,{label:z.status,size:"small",color:z.status==="error"?"error":"success"})]}),z.message&&e.jsx(r,{variant:"body2",color:"error",sx:{mt:1,fontSize:"0.75rem"},children:z.message}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Progress: ",z.overall_progress,"%"]})]})},A))]}),h.error&&e.jsx(ae,{severity:"error",sx:{mb:2},children:h.error})]}),e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:e.jsx(H,{onClick:()=>S(!1),children:"Close"})})]})}),e.jsx(dt,{open:q.open,autoHideDuration:6e3,onClose:()=>w({...q,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:e.jsx(ae,{onClose:()=>w({...q,open:!1}),severity:q.severity,sx:{width:"100%"},children:q.message})})]})},Oi=()=>{const{selectedObject:t}=ke(E=>E.migration),{selectedEnvironment:s}=ke(E=>E.app),{getReadOnlyFlag:a,getActivityStatus:i}=os(),[l,d]=o.useState(0),[c,u]=o.useState(10),[f,y]=o.useState(!1),[h,p]=o.useState(!1),[m,S]=o.useState({}),{data:T,isLoading:g,error:P,isFetching:$,refetch:V}=mi({objectId:t?.object_id||"",environmentId:s?.id,page:l+1,pageSize:c},{skip:!t?.object_id||!s?.id});o.useEffect(()=>{t?.object_id&&s?.id&&(d(0),u(10),y(!1),S({}),V())},[t?.object_id,s?.id,V]),o.useEffect(()=>{t?.object_id&&s?.id&&i(t.object_id)},[t?.object_id,s?.id,i]);const v=(E,_)=>{d(_)},q=E=>{const _=parseInt(E.target.value,10);u(_),d(0)},w=()=>{y(!0)},O=()=>{p(!0)},N=()=>{V()},R=()=>{y(!1)},W=()=>{p(!1)},b=(E,_)=>{S(D=>({...D,[E]:_}))};if(!t)return e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Data Transformation"}),e.jsx(ae,{severity:"info",children:"Please select an object to view transformation data."})]});if(g)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Transformation - ",t.object_name]}),e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:e.jsx(ie,{})})]});if(P)return e.jsxs(n,{children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Transformation - ",t.object_name]}),e.jsx(ae,{severity:"error",children:"Failed to load transformation data. Please try again later."})]});const F=T?.data||[],G=F.length>0?Object.keys(F[0]):[];return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:["Data Transformation - ",t.object_name]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(xs,{activity:"Transform",disabled:!1}),e.jsx(je,{title:"View transformation rules",children:e.jsx(H,{variant:"outlined",color:"primary",startIcon:e.jsx(Qr,{}),onClick:O,disabled:a("Transform"),sx:{minWidth:"140px"},children:"Rule List"})}),e.jsx(je,{title:"Execute data transformation",children:e.jsx(H,{variant:"contained",color:"primary",startIcon:e.jsx(ia,{}),onClick:w,disabled:a("Transform"),sx:{minWidth:"140px"},children:"Transform"})}),e.jsx(je,{title:"Refresh data",children:e.jsx(ne,{onClick:N,disabled:$||a("Transform"),color:"primary",children:e.jsx(Dt,{})})})]})]}),e.jsxs(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:["Define and execute data transformation rules for ",t.object_name,". Preview the data below before applying transformations."]}),T&&e.jsxs(n,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(X,{label:`Total Records: ${T.total_records}`,variant:"outlined",color:"primary"}),e.jsx(X,{label:`Current Page: ${T.page}`,variant:"outlined",color:"secondary"}),e.jsx(X,{label:`Total Pages: ${T.total_pages}`,variant:"outlined"}),e.jsx(X,{label:`Page Size: ${c}`,variant:"outlined"}),e.jsx(X,{label:`Showing: ${F.length} records`,variant:"filled",color:"info"})]}),e.jsx(tt,{component:me,elevation:2,children:e.jsxs(Je,{sx:{minWidth:650},"aria-label":"transformation data table",size:"small",children:[e.jsx(Xe,{children:e.jsx(pe,{sx:{backgroundColor:"primary.light"},children:G.map(E=>e.jsx(x,{sx:{color:"white",fontWeight:"bold",whiteSpace:"nowrap"},children:E},E))})}),e.jsx(Ye,{children:F.map((E,_)=>e.jsx(pe,{sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:"action.hover"}},children:G.map(D=>e.jsx(x,{sx:{maxWidth:"200px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:E[D]?.toString(),children:E[D]?.toString()||"-"},D))},_))})]})}),T&&e.jsx(Ss,{rowsPerPageOptions:[10,25,50,100],component:"div",count:T.total_records,rowsPerPage:c,page:l,onPageChange:v,onRowsPerPageChange:q,sx:{mt:2},labelRowsPerPage:"Rows per page:",labelDisplayedRows:({from:E,to:_,count:D})=>`${E}-${_} of ${D!==-1?D:`more than ${_}`}`}),$&&e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",sx:{mt:2},children:[e.jsx(ie,{size:24}),e.jsx(r,{variant:"body2",sx:{ml:2},children:"Loading data..."})]}),F.length===0&&!g&&e.jsx(me,{elevation:1,sx:{p:3,mt:2},children:e.jsx(r,{variant:"body1",textAlign:"center",color:"text.secondary",children:"No transformation data found for this object."})}),t&&e.jsx(dh,{open:f,onClose:R,objectId:t.object_id,objectName:t.object_name,onTaskStarted:b,taskMap:m}),t&&e.jsx(uh,{open:h,onClose:W,objectId:t.object_id,objectName:t.object_name})]})},In=({open:t,onClose:s,onImport:a,isImporting:i,currentStatus:l="idle"})=>{const[d,c]=o.useState(null),[u,f]=o.useState("new"),y=o.useCallback(T=>{T.length>0&&c(T[0])},[]),h=async()=>{if(d)try{await a(d,u),l==="completed"&&(c(null),f("new"))}catch(T){console.error("Error during import:",T)}},{getRootProps:p,getInputProps:m,isDragActive:S}=Zo({onDrop:y,accept:{"text/csv":[".csv"],"application/vnd.ms-excel":[".xls",".xlsx"]},maxFiles:1,disabled:i});return e.jsxs(wt,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,sx:{zIndex:9999},children:[e.jsx(It,{children:e.jsxs(n,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h6",children:"Import ODF File"}),e.jsx(ne,{onClick:s,size:"small",disabled:i,children:e.jsx(ct,{})})]})}),e.jsxs(Pt,{children:[e.jsxs(n,{mb:3,children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Please select the file you want to import"}),e.jsxs(me,{...p(),variant:"outlined",sx:{p:4,border:"2px dashed",borderColor:"divider",textAlign:"center",cursor:i?"not-allowed":"pointer",backgroundColor:S?"action.hover":"background.paper",opacity:i?.7:1,"&:hover":{backgroundColor:i?"background.paper":"action.hover"}},children:[e.jsx("input",{...m(),disabled:i}),e.jsx(Jr,{color:"action",fontSize:"large"}),e.jsx(r,{children:S?"Drop the file here":d?d.name:"Drag & drop a file here, or click to select"}),e.jsx(r,{variant:"caption",color:"textSecondary",children:"Supported formats: .csv, .xls, .xlsx"})]})]}),e.jsxs(n,{mb:3,children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Import Options"}),e.jsxs(Ts,{value:u,onChange:T=>f(T.target.value),children:[e.jsx(nt,{value:"new",control:e.jsx(ft,{}),label:"New file - A fresh previous file data will be discarded",disabled:i}),e.jsx(nt,{value:"part",control:e.jsx(ft,{}),label:"Part file - Part data is added to existing data set",disabled:i}),e.jsx(nt,{value:"correction",control:e.jsx(ft,{}),label:"Correction file - Corrected data file for failed records",disabled:i})]})]})]}),e.jsxs(Rt,{children:[e.jsx(H,{onClick:s,disabled:i,children:"Cancel"}),e.jsx(H,{onClick:h,color:"primary",variant:"contained",disabled:!d||i,startIcon:i?e.jsx(ie,{size:20}):null,children:i?"Uploading...":"Upload"})]})]})},hh=2e3,Pn=30,Rn=()=>{const t=xt(),[s,a]=o.useState(!1),[i,l]=o.useState(!1),[d,c]=o.useState("idle"),[u,f]=o.useState(null),[y,h]=o.useState(null),[p,m]=o.useState(0),[S,T]=o.useState(""),[g,P]=o.useState(!1),$=o.useRef(!1),V=o.useRef(!1),{selectedObject:v}=ke(Te=>Te.migration),{selectedProject:q,selectedEnvironment:w,selectedSystem:O}=ke(Te=>Te.app),{getCompletionStatus:N,getActivityStatus:R}=os(),{data:W,isLoading:b,error:F,refetch:G}=id({id:v?.object_id||"",objectId:v?.object_id||"",environment:w?.id||""},{skip:!v?.object_id}),{data:E=[]}=ks(q?.id||"",{skip:!q?.id}),[_]=od(),[D]=ld(),{data:C}=cd(y||"",{skip:!y||!g,pollingInterval:g?hh:0}),[oe]=dd(),[Z]=ud(),[he]=hd(),[_e]=xd(),[z]=md(),[A]=fd(),[te]=gd(),[I]=jd(),[J]=yd(),[se,Ie]=o.useState(null),[Fe,de]=o.useState(null),[qe,Ne]=o.useState(null),[Oe,st]=o.useState([]),[K,Ce]=o.useState(null),[k,Q]=o.useState(null),[U,ue]=o.useState(!1),[M,ce]=o.useState(null),[le,Se]=o.useState(""),[ve,B]=o.useState(""),[Y,ge]=o.useState(null),[Ze,ze]=o.useState(null),[ut,es]=o.useState(!1);o.useEffect(()=>{W&&v?.object_id&&!i&&(Bt(),lt())},[W,v?.object_id,i,w?.id]),o.useEffect(()=>{C&&g&&xe(C)},[C]),o.useEffect(()=>{se?.picklist_values&&se.picklist_values.length>0&&!S&&T(se.picklist_values[0]),se?.picklist_values&&se.picklist_values.length>0&&!ve&&B(se.picklist_values[0]),se?.dates&&se.dates.length>0&&!le&&Se(se.dates[0][1])},[se,S,ve,le]),o.useEffect(()=>{S&&v?.object_id&&bs(S)},[S,v?.object_id,w?.id]),o.useEffect(()=>{le&&v?.object_id&&Tt(le)},[le,v?.object_id,w?.id]),o.useEffect(()=>{ve&&v?.object_id&&Lt(ve)},[ve,v?.object_id,w?.id]),o.useEffect(()=>{v?.object_id&&w?.id&&(V.current=!1,$.current=!1,q?.id&&z({source_object_id:v.object_id,project:q.id,environment:w.id}).unwrap().catch(Te=>{console.error("Error loading entity mapped data:",Te)}))},[w?.id,v?.object_id,q?.id,G,t]),o.useEffect(()=>{v?.object_id&&R(v.object_id)},[v?.object_id,R]);const lt=async()=>{if(!(!v?.object_id||!W))try{const[Te,$e,at]=await Promise.allSettled([A(v.object_id).unwrap(),I({object_id:v.object_id}).unwrap(),Z({object_id:v.object_id,refresh:!1}).unwrap()]);Te.status==="fulfilled"&&Ie(Te.value),$e.status==="fulfilled"&&Ne($e.value),at.status==="fulfilled"&&ce(at.value)}catch(Te){console.error("Error loading chart data:",Te)}},Bt=async()=>{if(!(!v?.object_id||!W))try{const[Te,$e,at]=await Promise.allSettled([oe(v.object_id).unwrap(),he({object_id:v.object_id,refresh:!1}).unwrap(),_e({object_id:v.object_id,refresh:!1}).unwrap()]);Te.status==="fulfilled"&&st(Array.isArray(Te.value)?Te.value:[]),$e.status==="fulfilled"&&Ce($e.value),at.status==="fulfilled"&&Q(at.value)}catch(Te){console.error("Error loading completion data:",Te)}},bs=async Te=>{if(v?.object_id)try{const $e=await te({object_id:v.object_id,picklist_field:Te}).unwrap();de($e)}catch($e){console.error("Error loading picklist distribution:",$e)}},Tt=async Te=>{if(v?.object_id)try{const $e=await J({object_id:v.object_id,field_id:Te,file_name:`${v.object_id}.csv`}).unwrap();ge($e)}catch($e){console.error("Error loading date distribution:",$e)}},Lt=async Te=>{if(v?.object_id)try{const $e=await te({object_id:v.object_id,picklist_field:Te}).unwrap();ze($e)}catch($e){console.error("Error loading picklist chart data:",$e)}},xe=async Te=>{v?.object_id&&(m($e=>$e+1),Te.status==="completed"||Te.status==="success"?(P(!1),$.current=!1,await Ue(),c("completed"),l(!1)):Te.status==="failed"?(P(!1),$.current=!1,f(Te.message||"Metadata extraction failed"),c("error"),l(!1)):p>=Pn&&(P(!1),$.current=!1,f("Processing timed out. Please check back later."),c("error"),l(!1)))},Ue=async()=>{if(!(!v?.object_id||V.current)){V.current=!0;try{c("processing"),await G();const $e=(await Promise.allSettled([oe(v.object_id).unwrap(),Z({object_id:v.object_id,refresh:!1}).unwrap(),he({object_id:v.object_id,refresh:!1}).unwrap(),_e({object_id:v.object_id,refresh:!1}).unwrap(),z({source_object_id:v.object_id,project:q?.id||"",environment:w?.id||""}).unwrap(),lt()]))[4];if($e.status==="rejected"){const at=$e.reason;if(at?.data?.detail?.includes("environment not found")||at?.message?.includes("environment not found")||at?.error?.includes("environment not found")){f("Selected environment not found. Please select a different environment."),c("error");return}}await Bt()}catch(Te){console.error("Error loading data after extraction:",Te)}finally{V.current=!1}}},we=async(Te,$e)=>{if(v?.object_id){l(!0),c("uploading"),f(null),m(0),h(null),P(!1),$.current=!1,V.current=!1;try{if(!w?.id||!q?.id||!O?.id)throw new Error("Please select an environment, project, and system");const at=new FormData;at.append("system",O.id),at.append("object",v.object_id),at.append("file_type","main"),at.append("is_deleted","false"),at.append("file",Te),c("uploading");const L=await _(at).unwrap();if(L.status!=="success")throw new Error(L.message||"File upload failed");c("extracting");const Pe=await D({objectId:v.object_id,environment_id:w.id,file_name:`${v.object_id}.csv`,object_id:v.object_id,object_name:v.object_name||"Account_40",project:q.id}).unwrap();h(Pe.task_id),c("processing"),P(!0),$.current=!0}catch(at){let L=at instanceof Error?at.message:"An unknown error occurred during file import";(L.includes("environment not found")||at?.data?.detail?.includes("environment not found")||at?.error?.includes("environment not found"))&&(L="Selected environment not found. Please select a different environment."),console.error("Error during file import:",L),f(L),c("error"),l(!1),P(!1)}finally{a(!1)}}},Le=Te=>E.find(at=>at.id===Te)?.name||Te,Ve=()=>W?.system?Le(W.system):"N/A",_t=()=>E.find($e=>$e.type==="target")?.name||"N/A",Nt=()=>{a(!0)},Ft=({label:Te,value:$e})=>e.jsxs(n,{sx:{mb:3},children:[e.jsx(r,{variant:"caption",color:"text.secondary",sx:{fontWeight:"bold",textTransform:"uppercase"},children:Te}),e.jsx(r,{variant:"body2",sx:{fontWeight:"medium"},children:$e})]});if(b)return e.jsx(n,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(ie,{size:48,sx:{mb:2,color:"primary.main"}}),e.jsx(r,{variant:"h6",color:"text.secondary",sx:{fontWeight:"medium"},children:"Loading data..."})]})});if(!W){const Te=F&&(JSON.stringify(F).includes("File not found in S3")||F?.detail?.includes("File not found in S3")||F?.error?.detail?.includes("File not found in S3")||F?.data?.detail?.includes("File not found in S3")||F?.message?.includes("File not found in S3")),$e=!!F;return e.jsxs(n,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)",display:"flex",alignItems:"center",justifyContent:"center",p:3},children:[e.jsxs(n,{sx:{textAlign:"center",maxWidth:400},children:[e.jsx(is,{sx:{fontSize:64,color:"warning.main",mb:2}}),e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"text.primary",mb:2},children:Te?"File Not Found in S3":$e?"Error Loading File":"No ODF file data available"}),Te&&e.jsx(ae,{severity:"warning",sx:{mb:3},children:"The file could not be found in S3 storage. Please import a new file to continue."}),$e&&!Te&&e.jsx(ae,{severity:"error",sx:{mb:3},children:"An error occurred while loading the file. Please try importing a new file."}),e.jsx(H,{variant:"contained",size:"large",onClick:()=>a(!0),disabled:i,startIcon:i?e.jsx(ie,{size:20}):e.jsx(Qo,{}),sx:{px:4,py:1.5,fontSize:"1rem",fontWeight:"bold",boxShadow:3,"&:hover":{boxShadow:6}},children:i?"Importing...":"Import File"})]}),e.jsx(In,{open:s,onClose:()=>a(!1),onImport:we,isImporting:i,currentStatus:d})]})}return e.jsxs(n,{sx:{p:3},children:[e.jsx(n,{sx:{mb:4},children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",color:"text.primary"},children:"Source Data Summary"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:3},children:[e.jsx(xs,{activity:"Extract",disabled:N("Mapping")}),e.jsx("button",{onClick:Nt,disabled:i,style:{padding:"12px 32px",fontSize:"1rem",fontWeight:"bold",backgroundColor:i?"#ccc":"#1976d2",color:"white",border:"none",borderRadius:"4px",cursor:i?"not-allowed":"pointer",boxShadow:"0 3px 5px rgba(0,0,0,0.2)"},children:i?"Importing...":"Import File"})]})]})}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,lg:4,children:e.jsxs(Zt,{spacing:3,children:[e.jsx(De,{sx:{borderRadius:2,boxShadow:2},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[e.jsx(Ps,{sx:{color:"primary.main"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Object Information"})]}),e.jsxs(Zt,{spacing:2,children:[e.jsx(Ft,{label:"Source Object",value:v?.object_name||v?.object_id||"N/A"}),e.jsx(Ft,{label:"Object Owner",value:W.created_by}),e.jsx(Ft,{label:"Supplied By",value:W.created_by}),e.jsx(Ft,{label:"Supplied On",value:new Date(W.created_date).toLocaleDateString()}),e.jsx(Ft,{label:"Source System",value:Ve()}),e.jsx(Ft,{label:"Target System",value:_t()}),e.jsx(Ft,{label:"Environment",value:w?`${w.name} (${w.id})`:"N/A"}),e.jsx(Ft,{label:"Last Updated By",value:W.modified_by}),e.jsx(Ft,{label:"Last Updated",value:new Date(W.modified_date).toLocaleDateString()})]})]})}),e.jsx(De,{sx:{borderRadius:2,background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%)",color:"white",boxShadow:4},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[e.jsx(ya,{sx:{color:"white"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Data Overview"})]}),e.jsxs(j,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(j,{item:!0,xs:6,children:e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",borderRadius:2,p:2,textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",mb:.5},children:W.record_count}),e.jsx(r,{variant:"body2",sx:{fontWeight:"bold",opacity:.9},children:"Rows"})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",borderRadius:2,p:2,textAlign:"center"},children:[e.jsx(r,{variant:"h4",sx:{fontWeight:"bold",mb:.5},children:W.fields_count}),e.jsx(r,{variant:"body2",sx:{fontWeight:"bold",opacity:.9},children:"Columns"})]})})]}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:6,children:e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",borderRadius:2,p:2},children:[e.jsx(r,{variant:"caption",sx:{fontWeight:"bold",opacity:.9},children:"Data Density"}),e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:K?.data_density_percentage?`${K.data_density_percentage}%`:"N/A"}),e.jsx(ms,{variant:"determinate",value:K?.data_density_percentage||0,sx:{height:8,borderRadius:4,bgcolor:"rgba(255, 255, 255, 0.3)","& .MuiLinearProgress-bar":{bgcolor:"#10b981",borderRadius:4}}})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(n,{sx:{bgcolor:"rgba(255, 255, 255, 0.2)",backdropFilter:"blur(10px)",borderRadius:2,p:2},children:[e.jsx(r,{variant:"caption",sx:{fontWeight:"bold",opacity:.9},children:"Data Quality"}),e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:k?.data_quality_percentage?`${k.data_quality_percentage}%`:"N/A"}),e.jsx(ms,{variant:"determinate",value:k?.data_quality_percentage||0,sx:{height:8,borderRadius:4,bgcolor:"rgba(255, 255, 255, 0.3)","& .MuiLinearProgress-bar":{bgcolor:"#10b981",borderRadius:4}}})]})})]})]})})]})}),e.jsx(j,{item:!0,xs:12,lg:8,children:e.jsxs(Zt,{spacing:3,children:[e.jsx(De,{sx:{borderRadius:2,boxShadow:2},children:e.jsxs(Ee,{sx:{p:2},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Yr,{sx:{color:"primary.main"}}),e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Status Chart"})]}),e.jsx(ne,{onClick:()=>Bt(),size:"small",children:e.jsx(Dt,{})})]}),Array.isArray(Oe)&&Oe.length>0?e.jsx(n,{sx:{maxHeight:350,overflow:"auto",pr:1},children:e.jsx(Zt,{spacing:1,children:Oe.map((Te,$e)=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:.5},children:[e.jsx(r,{variant:"body2",sx:{fontWeight:"bold"},children:Te.activity}),e.jsx(X,{label:`${Te.completion}%`,size:"small",color:Te.completion===100?"success":"default",variant:Te.completion===100?"filled":"outlined"})]}),e.jsx(ms,{variant:"determinate",value:Te.completion,sx:{height:8,borderRadius:4,bgcolor:"#f3f4f6","& .MuiLinearProgress-bar":{bgcolor:Te.completion===100?"#10b981":"#6b7280",borderRadius:4}}})]},$e))})}):e.jsx(r,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No completion data available"})]})}),M&&e.jsx(De,{sx:{borderRadius:2,boxShadow:2},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Field Density Chart"}),e.jsx(ne,{size:"small",title:"Shows data completeness for each field",children:e.jsx(gs,{})})]}),e.jsx(n,{sx:{maxHeight:450,overflow:"auto",pr:1},children:e.jsx(Zt,{spacing:2,children:M.column_density_summary.map((Te,$e)=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",sx:{fontWeight:"bold"},children:Te.field_name}),e.jsxs(r,{variant:"caption",sx:{fontWeight:"bold",color:"text.secondary"},children:[Te.data_count_percentage,"% Data / ",Te.null_count_percentage,"% Null"]})]}),e.jsx(ms,{variant:"determinate",value:Te.data_count_percentage,sx:{height:10,borderRadius:5,bgcolor:"#f3f4f6","& .MuiLinearProgress-bar":{bgcolor:"#3b82f6",borderRadius:5}}})]},$e))})})]})})]})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,boxShadow:2,height:"100%"},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:3},children:"Data Distribution by Date"}),se?.dates&&se.dates.length>0&&e.jsxs(Ae,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Me,{children:"Select Date Field"}),e.jsx(We,{value:le,label:"Select Date Field",onChange:Te=>Se(Te.target.value),children:se.dates.map(([Te,$e])=>e.jsx(re,{value:$e,children:Te},$e))})]}),Y?.values&&Y.values.length>0?e.jsx(ws,{width:"100%",height:300,children:e.jsxs(Jo,{data:Y.values,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorDate",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(Ya,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ka,{dataKey:"data",stroke:"#6b7280",style:{fontSize:12,fontWeight:600}}),e.jsx(Xa,{stroke:"#6b7280",style:{fontSize:12,fontWeight:600}}),e.jsx(Cs,{contentStyle:{borderRadius:8,border:"1px solid #e5e7eb",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(Yo,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:3,fillOpacity:1,fill:"url(#colorDate)"})]})}):e.jsx(r,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No date distribution data available"})]})})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,boxShadow:2,height:"100%"},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:"bold",mb:3},children:"Data Distribution by Picklist"}),se?.picklist_values&&se.picklist_values.length>0&&e.jsxs(Ae,{fullWidth:!0,sx:{mb:3},children:[e.jsx(Me,{children:"Select Picklist Field"}),e.jsx(We,{value:ve,label:"Select Picklist Field",onChange:Te=>B(Te.target.value),children:se.picklist_values.map(Te=>e.jsx(re,{value:Te,children:Te},Te))})]}),Ze?.picklist_values&&Ze.picklist_values.length>0?e.jsx(ws,{width:"100%",height:300,children:e.jsxs(Yn,{data:Ze.picklist_values,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorBar",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#10b981",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#10b981",stopOpacity:.4})]})}),e.jsx(Ya,{strokeDasharray:"3 3",stroke:"#e5e7eb"}),e.jsx(Ka,{dataKey:"value",stroke:"#6b7280",angle:-15,textAnchor:"end",height:80,style:{fontSize:11,fontWeight:600}}),e.jsx(Xa,{stroke:"#6b7280",style:{fontSize:12,fontWeight:600}}),e.jsx(Cs,{contentStyle:{borderRadius:8,border:"1px solid #e5e7eb",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"}}),e.jsx(Kn,{dataKey:"count",fill:"url(#colorBar)",radius:[8,8,0,0]})]})}):e.jsx(r,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No picklist distribution data available"})]})})}),(d!=="idle"||u)&&e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{sx:{borderRadius:2,boxShadow:2},children:e.jsxs(Ee,{sx:{p:3},children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(r,{variant:"h6",sx:{fontWeight:"bold",mb:1},children:["Import Status:"," ",e.jsx(r,{component:"span",sx:{color:d==="completed"?"success.main":d==="error"?"error.main":"primary.main",fontWeight:"bold"},children:d.toUpperCase()})]}),y&&e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Task ID: ",y]})]}),u&&e.jsx(ae,{severity:"error",sx:{mb:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(is,{}),e.jsx(r,{variant:"body2",children:u})]})}),d==="processing"&&e.jsx(ae,{severity:"info",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{size:20}),e.jsxs(r,{variant:"body2",children:["Processing... (Attempt ",p,"/",Pn,")"]})]})}),d==="completed"&&e.jsx(ae,{severity:"success",children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(mt,{}),e.jsx(r,{variant:"body2",children:"File imported and processed successfully!"})]})})]})})})]}),e.jsx(In,{open:s,onClose:()=>a(!1),onImport:we,isImporting:i,currentStatus:d})]})},xh={summary:"Summary",relationship:"Relationship",filter:"Filter",metadata:"Metadata",cleanup:"Cleanup",transform:"Transform",mapping:"Mapping",validate:"Validate",load:"Load",error:"Error",workflows:"Workflows"},ph=({objectId:t,isRevealActive:s})=>{const a=xt(),i=Ct(),{tabName:l}=Xn(),{activeTab:d,selectedObject:c}=ke(h=>h.migration),u=l||d,f=(h,p)=>{a(ui(p)),i(`/migration/${t}/${p}`)},y=()=>{if(!c)return null;const h=`${u}-${s}`;switch(u){case"summary":return e.jsx(Rn,{},h);case"relationship":return e.jsx(Ii,{},h);case"filter":return e.jsx(Pi,{},h);case"metadata":return e.jsx(Ri,{},h);case"cleanup":return e.jsx(Ei,{},h);case"transform":return e.jsx(Oi,{},h);case"mapping":return e.jsx(Fi,{},h);case"validate":return e.jsx(Ai,{},h);case"load":return e.jsx(Wi,{},h);case"error":return e.jsx(zi,{},h);case"workflows":return e.jsx(ch,{},h);default:return e.jsx(Rn,{},h)}};return e.jsxs(me,{elevation:2,sx:{p:0,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(Mt,{value:u,onChange:f,variant:"fullWidth",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider",mb:1,"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:Object.entries(xh).map(([h,p])=>e.jsx(He,{label:p,value:h,sx:{textTransform:"none",fontSize:"0.75rem",fontWeight:u===h?"bold":"normal"}},h))}),e.jsx(n,{sx:{pt:.25,backgroundColor:"#0b378aff",flex:1,borderRadius:"8px 8px 0 0"},children:e.jsx(n,{sx:{backgroundColor:"white",flex:1,p:1},children:y()})})]})},Tr=()=>{const t=xt(),s=Ct();us();const{objectId:a,tabName:i}=Xn(),{selectedObject:l,migrationName:d,activeTab:c}=ke(w=>w.migration),{activeMenu:u}=ke(w=>w.app),[f,y]=o.useState({}),[h,p]=o.useState(!1),m=l?.object_id&&f[l.object_id]||!1,{data:S,error:T,refetch:g}=Qd(l?.object_id||"",{skip:!l?.object_id}),[P]=Jd(),[$]=Yd();o.useEffect(()=>{u!=="entities"&&t(zt("entities"))},[u,t]),o.useEffect(()=>{i&&["summary","relationship","filter","metadata","cleanup","transform","mapping","validate","load","error","workflows"].includes(i)?t(ui(i)):a&&!i&&s(`/migration/${a}/${c&&c!=="summary"?c:"summary"}`,{replace:!0})},[i,a,c,t,s]),o.useEffect(()=>{if(a&&(!l||l.object_id!==a)){const w=localStorage.getItem("migration_objects");if(w)try{const R=JSON.parse(w).find(W=>W.object_id===a);if(R){t(di(R));return}}catch(N){console.error("Failed to parse migration objects from localStorage:",N)}console.warn("Object not found in localStorage, attempting to load from API...");const O=setTimeout(()=>{console.warn("Object not found, redirecting to entities"),s("/entities")},1e3);return()=>clearTimeout(O)}},[a,l,t,s]),o.useEffect(()=>{l?.object_id&&(y(w=>({...w,[l.object_id]:!1})),g())},[l?.object_id,g]),o.useEffect(()=>{l?.object_id&&(T?y(w=>({...w,[l.object_id]:!1})):S?.message?y(w=>({...w,[l.object_id]:S.message.reveal_flag})):y(w=>({...w,[l.object_id]:!1})))},[S,T,l?.object_id]);const V=async w=>{try{p(!0),await P({latest_entry:!0,object_id:w,reason:"Policy management",reveal_flag:!0}).unwrap(),g()}catch(O){console.error("Error creating reveal:",O)}finally{p(!1)}},v=async w=>{try{p(!0),await $({objectId:w,data:{is_active:!0,latest_entry:!1,reveal_flag:!1}}).unwrap(),y(O=>({...O,[w]:!1})),g()}catch(O){console.error("Error updating reveal:",O)}finally{p(!1)}},q=async()=>{l?.object_id&&(m?await v(l.object_id):await V(l.object_id))};return a?!l||l.object_id!==a?e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(ns,{}),e.jsx(pn,{maxWidth:"xl",sx:{mt:0,mb:0},children:e.jsxs(me,{elevation:2,sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"Loading Object..."}),e.jsxs(r,{variant:"body1",color:"text.secondary",children:["Loading migration configuration for object: ",a]})]})})]}):e.jsxs(n,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsxs(r,{variant:"h4",component:"h1",fontWeight:"bold",children:["Migration - ",l.object_name]}),e.jsx(ne,{color:"primary",title:"File",size:"small",children:e.jsx(Ko,{})}),e.jsx(ne,{onClick:q,disabled:h,color:m?"error":"primary",title:m?"Turn off reveal mode":"Turn on reveal mode",size:"small",children:h?e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},children:e.jsx(ie,{size:16})}):m?e.jsx(ra,{}):e.jsx(na,{})})]}),m&&e.jsx(ae,{severity:"error",sx:{mb:3,fontWeight:"bold"},children:"Reveal Mode Active"}),e.jsx(Ti,{children:e.jsx(ph,{objectId:a,isRevealActive:m})})]}):e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(ns,{}),e.jsx(pn,{maxWidth:"xl",sx:{mt:2,mb:4},children:e.jsxs(me,{elevation:2,sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h4",component:"h1",gutterBottom:!0,children:"No Object Selected"}),e.jsx(r,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Please select an object from the sidebar to start migration configuration."}),e.jsx(H,{variant:"contained",onClick:()=>s("/entities"),size:"large",children:"Go to Entities"})]})})]})},Dn=()=>{const{selectedProject:t}=ke(p=>p.app),[s,a]=o.useState({totalFiles:0,processedFiles:0,failedFiles:0,totalSize:"0 MB",processingTime:"0 mins",successRate:0}),[i,l]=o.useState([{id:1,action:"File uploaded",file:"customer_data.csv",timestamp:"2 minutes ago",status:"success"},{id:2,action:"Processing started",file:"product_catalog.xlsx",timestamp:"5 minutes ago",status:"processing"},{id:3,action:"Validation failed",file:"inventory.json",timestamp:"10 minutes ago",status:"error"}]),[d,c]=o.useState([{name:"CSV",value:45,color:"#8884d8"},{name:"Excel",value:30,color:"#82ca9d"},{name:"JSON",value:15,color:"#ffc658"},{name:"XML",value:10,color:"#ff7300"}]),[u,f]=o.useState([{name:"Upload",completed:100,total:100},{name:"Analysis",completed:85,total:100},{name:"Transform",completed:60,total:100},{name:"Validate",completed:30,total:100},{name:"Load",completed:0,total:100}]);o.useEffect(()=>{a({totalFiles:156,processedFiles:142,failedFiles:8,totalSize:"2.4 GB",processingTime:"45 mins",successRate:91})},[]);const y=p=>{switch(p){case"success":return e.jsx(mt,{sx:{color:"success.main"}});case"processing":return e.jsx(Ws,{sx:{color:"primary.main"}});case"error":return e.jsx(is,{sx:{color:"error.main"}});default:return e.jsx(Ws,{sx:{color:"grey.500"}})}},h=p=>{switch(p){case"success":return"success";case"processing":return"primary";case"error":return"error";default:return"default"}};return e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(r,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"File Migration Dashboard"}),e.jsxs(r,{variant:"body1",color:"text.secondary",children:["Monitor and manage your file migration processes for ",t?.name]})]}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:"primary.main",mx:"auto",mb:2},children:e.jsx(Xo,{})}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"primary",children:s.totalFiles}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Total Files"})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:"success.main",mx:"auto",mb:2},children:e.jsx(mt,{})}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"success.main",children:s.processedFiles}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Processed"})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:"error.main",mx:"auto",mb:2},children:e.jsx(is,{})}),e.jsx(r,{variant:"h4",fontWeight:"bold",color:"error.main",children:s.failedFiles}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Failed"})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:"warning.main",mx:"auto",mb:2},children:e.jsx(Yr,{})}),e.jsxs(r,{variant:"h4",fontWeight:"bold",color:"warning.main",children:[s.successRate,"%"]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Success Rate"})]})})})]}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"File Types Distribution"}),e.jsx(n,{sx:{height:300,mt:2},children:e.jsx(ws,{width:"100%",height:"100%",children:e.jsxs(Gr,{children:[e.jsx(Vr,{data:d,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:d.map((p,m)=>e.jsx(Hr,{fill:p.color},`cell-${m}`))}),e.jsx(Cs,{})]})})})]})})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Processing Pipeline Progress"}),e.jsx(Zt,{spacing:2,sx:{mt:2},children:u.map((p,m)=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:p.name}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:[p.completed,"%"]})]}),e.jsx(ms,{variant:"determinate",value:p.completed,sx:{height:8,borderRadius:4,bgcolor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:4}}})]},m))})]})})})]}),e.jsx(j,{container:!0,spacing:3,children:e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{sx:{borderRadius:2},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Recent Activity"}),e.jsx(Zt,{spacing:2,sx:{mt:2},children:i.map(p=>e.jsxs(n,{sx:{display:"flex",alignItems:"center",p:2,borderRadius:1,bgcolor:"grey.50"},children:[e.jsx(n,{sx:{mr:2},children:y(p.status)}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:p.action}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:[p.file," ‚Ä¢ ",p.timestamp]})]}),e.jsx(X,{label:p.status.toUpperCase(),size:"small",color:h(p.status),variant:"outlined"})]},p.id))})]})})})}),e.jsxs(n,{sx:{mt:4,textAlign:"center"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(Zt,{direction:"row",spacing:2,justifyContent:"center",flexWrap:"wrap",children:[e.jsx(H,{variant:"contained",startIcon:e.jsx(Jr,{}),size:"large",sx:{minWidth:150},children:"Upload Files"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(On,{}),size:"large",sx:{minWidth:150},children:"Start Analysis"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Lr,{}),size:"large",sx:{minWidth:150},children:"Transform Data"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Ps,{}),size:"large",sx:{minWidth:150},children:"Load to Storage"})]})]})]})},mh=()=>{const{selectedProject:t}=ke(g=>g.app),[s,a]=o.useState([]),[i,l]=o.useState(!1),[d,c]=o.useState(null),[u,f]=o.useState(!1);o.useEffect(()=>{y()},[t]);const y=async()=>{l(!0);try{a([{id:"exec-001",workflowName:"Customer Data Migration",status:"completed",startTime:"2025-12-03T08:00:00Z",endTime:"2025-12-03T08:45:00Z",duration:"45m 0s",filesProcessed:150,totalFiles:150,steps:[{id:"step-001",name:"File Upload",status:"completed",startTime:"2025-12-03T08:00:00Z",endTime:"2025-12-03T08:05:00Z",duration:"5m 0s"},{id:"step-002",name:"Data Analysis",status:"completed",startTime:"2025-12-03T08:05:00Z",endTime:"2025-12-03T08:15:00Z",duration:"10m 0s"},{id:"step-003",name:"Data Transformation",status:"completed",startTime:"2025-12-03T08:15:00Z",endTime:"2025-12-03T08:35:00Z",duration:"20m 0s"},{id:"step-004",name:"Data Validation",status:"completed",startTime:"2025-12-03T08:35:00Z",endTime:"2025-12-03T08:40:00Z",duration:"5m 0s"},{id:"step-005",name:"Data Loading",status:"completed",startTime:"2025-12-03T08:40:00Z",endTime:"2025-12-03T08:45:00Z",duration:"5m 0s"}]},{id:"exec-002",workflowName:"Product Catalog Update",status:"running",startTime:"2025-12-03T09:00:00Z",filesProcessed:75,totalFiles:100,steps:[{id:"step-006",name:"File Upload",status:"completed",startTime:"2025-12-03T09:00:00Z",endTime:"2025-12-03T09:02:00Z",duration:"2m 0s"},{id:"step-007",name:"Data Analysis",status:"running",startTime:"2025-12-03T09:02:00Z"}]},{id:"exec-003",workflowName:"Inventory Sync",status:"failed",startTime:"2025-12-03T07:30:00Z",endTime:"2025-12-03T07:45:00Z",duration:"15m 0s",filesProcessed:25,totalFiles:50,errors:["Validation failed: Invalid data format in row 150"],steps:[{id:"step-008",name:"File Upload",status:"completed",startTime:"2025-12-03T07:30:00Z",endTime:"2025-12-03T07:32:00Z",duration:"2m 0s"},{id:"step-009",name:"Data Validation",status:"failed",startTime:"2025-12-03T07:32:00Z",endTime:"2025-12-03T07:45:00Z",duration:"13m 0s",message:"Validation failed: Invalid data format in row 150"}]}])}catch(g){console.error("Failed to load executions:",g)}finally{l(!1)}},h=g=>{switch(g){case"completed":return e.jsx(mt,{sx:{color:"success.main"}});case"running":return e.jsx(el,{sx:{color:"primary.main"}});case"failed":return e.jsx(is,{sx:{color:"error.main"}});case"pending":return e.jsx(Ws,{sx:{color:"warning.main"}});default:return e.jsx(Ws,{sx:{color:"grey.500"}})}},p=g=>{switch(g){case"completed":return"success";case"running":return"primary";case"failed":return"error";case"pending":return"warning";default:return"default"}},m=g=>new Date(g).toLocaleString(),S=g=>{c(g),f(!0)},T=()=>{f(!1),c(null)};return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",children:"Workflows History"}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:y,disabled:i,children:"Refresh"})]}),i?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ie,{size:48}),e.jsx(r,{variant:"h6",sx:{ml:2},children:"Loading workflow executions..."})]}):s.length===0?e.jsxs(me,{sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",children:"No workflow executions found"}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Workflow executions will appear here once you run file migration processes."})]}):e.jsx(tt,{component:me,sx:{borderRadius:2},children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Workflow Name"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Start Time"}),e.jsx(x,{children:"Duration"}),e.jsx(x,{children:"Progress"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:s.map(g=>e.jsxs(pe,{hover:!0,children:[e.jsx(x,{children:e.jsx(r,{variant:"body2",fontWeight:"medium",children:g.workflowName})}),e.jsx(x,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[h(g.status),e.jsx(X,{label:g.status.toUpperCase(),size:"small",color:p(g.status),variant:"outlined"})]})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:m(g.startTime)})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:g.duration||"In progress"})}),e.jsx(x,{children:e.jsxs(r,{variant:"body2",children:[g.filesProcessed,"/",g.totalFiles," files"]})}),e.jsx(x,{children:e.jsxs(Zt,{direction:"row",spacing:1,children:[e.jsx(ne,{size:"small",onClick:()=>S(g),title:"View Details",children:e.jsx(ra,{})}),g.status==="failed"&&e.jsx(ne,{size:"small",color:"primary",title:"Retry",children:e.jsx(ia,{})})]})})]},g.id))})]})}),e.jsxs(wt,{open:u,onClose:T,maxWidth:"md",fullWidth:!0,children:[e.jsxs(It,{children:["Execution Details: ",d?.workflowName]}),e.jsx(Pt,{children:d&&e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Overview"}),e.jsxs(Zt,{spacing:1,children:[e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(X,{label:d.status.toUpperCase(),size:"small",color:p(d.status),variant:"outlined"})]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Started:"})," ",m(d.startTime)]}),d.endTime&&e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Completed:"})," ",m(d.endTime)]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Duration:"})," ",d.duration||"In progress"]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Files Processed:"})," ",d.filesProcessed,"/",d.totalFiles]})]})]}),d.errors&&d.errors.length>0&&e.jsxs(ae,{severity:"error",sx:{mb:3},children:[e.jsx(r,{variant:"body2",fontWeight:"bold",children:"Errors:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"20px"},children:d.errors.map((g,P)=>e.jsx("li",{children:e.jsx(r,{variant:"body2",children:g})},P))})]}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Steps"}),e.jsx(Zt,{spacing:2,children:d.steps.map((g,P)=>e.jsx(me,{sx:{p:2,borderRadius:1},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(n,{sx:{width:32,height:32,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:g.status==="completed"?"success.main":g.status==="failed"?"error.main":g.status==="running"?"primary.main":"warning.main",color:"white",mb:1},children:g.status==="running"?e.jsx(ie,{size:16,color:"inherit"}):e.jsx(r,{variant:"caption",fontWeight:"bold",children:P+1})})}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(r,{variant:"body2",fontWeight:"medium",children:g.name}),e.jsxs(r,{variant:"caption",color:"text.secondary",children:["Started: ",m(g.startTime),g.endTime&&` ‚Ä¢ Completed: ${m(g.endTime)}`,g.duration&&` ‚Ä¢ Duration: ${g.duration}`]}),g.message&&e.jsx(r,{variant:"caption",color:"error.main",sx:{display:"block",mt:.5},children:g.message})]}),e.jsx(X,{label:g.status.toUpperCase(),size:"small",color:p(g.status),variant:"outlined"})]})},g.id))})]})}),e.jsx(Rt,{children:e.jsx(H,{onClick:T,children:"Close"})})]})]})},ma=[{key:"dashboard",label:"Dashboard",icon:e.jsx(zn,{}),path:"/file-migration/upload"},{key:"relationship",label:"Relationship",icon:e.jsx(al,{}),path:"/file-migration/relationship"},{key:"filter",label:"Filter",icon:e.jsx(Jn,{}),path:"/file-migration/filter"},{key:"metadata",label:"Metadata",icon:e.jsx(Bn,{}),path:"/file-migration/metadata"},{key:"cleanup",label:"Cleanup",icon:e.jsx(rl,{}),path:"/file-migration/cleanup"},{key:"transform",label:"Transform",icon:e.jsx(Lr,{}),path:"/file-migration/transform"},{key:"mapping",label:"Mapping",icon:e.jsx(nl,{}),path:"/file-migration/mapping"},{key:"validate",label:"Validate",icon:e.jsx(mt,{}),path:"/file-migration/validate"},{key:"load",label:"Load",icon:e.jsx(Jr,{}),path:"/file-migration/load"},{key:"error",label:"Error",icon:e.jsx(is,{}),path:"/file-migration/error"},{key:"workflows",label:"Workflows History",icon:e.jsx(ei,{}),path:"/file-migration/workflows"}],ss=()=>{const t=tl();sl(t.breakpoints.down("md"));const s=xt(),a=Ct(),i=us(),{selectedProject:l,currentView:d}=ke(m=>m.app),c=()=>{const m=i.pathname,S=ma.find(T=>T.path===m);return S?ma.indexOf(S):0},[u,f]=o.useState(c());o.useEffect(()=>{f(c())},[i.pathname]),o.useEffect(()=>{s(zt("file upload"))},[s]);const y=()=>{d==="application"?(a("/account"),s(oi())):(s(tr()),a("/file-migration/upload"))},h=(m,S)=>{f(S),a(ma[S].path)},p=()=>{switch(i.pathname){case"/file-migration/upload":return e.jsx(Dn,{});case"/file-migration/relationship":return e.jsx(Ii,{});case"/file-migration/filter":return e.jsx(Pi,{});case"/file-migration/metadata":return e.jsx(Ri,{});case"/file-migration/cleanup":return e.jsx(Ei,{});case"/file-migration/transform":return e.jsx(Oi,{});case"/file-migration/mapping":return e.jsx(Fi,{});case"/file-migration/validate":return e.jsx(Ai,{});case"/file-migration/load":return e.jsx(Wi,{});case"/file-migration/error":return e.jsx(zi,{});case"/file-migration/workflows":return e.jsx(mh,{});default:return e.jsx(Dn,{})}};return e.jsxs(n,{sx:{display:"flex",flexDirection:"column",height:"100vh"},children:[e.jsx(ar,{position:"fixed",sx:{zIndex:t.zIndex.drawer+1},children:e.jsxs(ns,{children:[e.jsx(r,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1},children:"File Migration App - Dashboard"}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(yi,{}),e.jsx(bi,{}),e.jsx(ne,{color:"inherit","aria-label":"settings",onClick:y,sx:{backgroundColor:d==="settings"?"rgba(255, 255, 255, 0.2)":"transparent","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(Or,{color:"secondary",variant:d==="settings"?"dot":"standard",children:e.jsx(rr,{})})})]})]})}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",bgcolor:"background.paper",position:"sticky",top:64,zIndex:t.zIndex.appBar-1},children:e.jsx(Mt,{value:u,onChange:h,variant:"scrollable",scrollButtons:"auto",sx:{minHeight:48,"& .MuiTab-root":{minHeight:48,textTransform:"none",fontSize:"0.875rem",fontWeight:500,minWidth:120,px:2,borderRadius:"8px 8px 0 0",marginRight:1,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:ma.map((m,S)=>e.jsx(He,{icon:m.icon,iconPosition:"start",label:m.label,sx:{"&:hover":{bgcolor:"action.hover"}}},m.key))})}),e.jsx(n,{component:"main",sx:{flexGrow:1,bgcolor:"background.default",p:3,overflow:"auto"},children:e.jsx(n,{sx:{mt:16},children:e.jsx(me,{elevation:0,sx:{minHeight:"100%",p:3,borderRadius:2},children:e.jsx(Ti,{children:p()})})})})]})},gh=()=>{const{selectedProject:t}=ke(p=>p.app),{data:s,isLoading:a,error:i}=Mc(),{data:l}=Lc({page:1,limit:5}),{data:d}=$c({limit:5}),c=p=>p?new Date(p).toLocaleString():"N/A",u=p=>p>0?"success.main":p<0?"error.main":"text.secondary",f=p=>p>0?e.jsx(Yr,{sx:{color:"success.main"}}):p<0?e.jsx(is,{sx:{color:"error.main"}}):null;if(a)return e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:e.jsx(ms,{sx:{width:"50%"}})});if(i)return e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(r,{variant:"h6",color:"error",children:"Error loading backup statistics"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Please try again later"})]});if(!s)return e.jsx(n,{sx:{textAlign:"center",py:8},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"No backup statistics available"})});const y=[{name:"Success",value:s.success_rate,color:"#00C49F"},{name:"Failure",value:s.fail_rate,color:"#FF8042"}],h=s.data_growth.map(p=>({month:new Date(p.month).toLocaleDateString("en-US",{month:"short",year:"numeric"}),gb:p.gb}));return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"Salesforce Prod Dashboard"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Overview of your backup operation for this project"})]}),e.jsx(H,{variant:"contained",startIcon:e.jsx(Kt,{}),size:"large",sx:{minWidth:150},children:"+ New Backup"})]}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2,opacity:s.objects.total===0?.5:1,filter:s.objects.total===0?"grayscale(100%)":"none"},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:s.objects.total===0?"grey.400":"primary.main",mx:"auto",mb:2},children:e.jsx(Ps,{})}),e.jsx(r,{variant:"h4",fontWeight:"bold",sx:{color:s.objects.total===0?"text.disabled":"primary.main"},children:s.objects.total}),e.jsx(r,{variant:"body2",sx:{color:s.objects.total===0?"text.disabled":"text.secondary"},gutterBottom:!0,children:"Objects Monitored"}),s.objects.total>0&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[f(s.objects.change),e.jsxs(r,{variant:"caption",sx:{color:u(s.objects.change)},children:[s.objects.change>0?"+":"",s.objects.change]})]})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2,opacity:s.backups.total===0?.5:1,filter:s.backups.total===0?"grayscale(100%)":"none"},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:s.backups.total===0?"grey.400":"success.main",mx:"auto",mb:2},children:e.jsx(sr,{})}),e.jsx(r,{variant:"h4",fontWeight:"bold",sx:{color:s.backups.total===0?"text.disabled":"success.main"},children:s.backups.total}),e.jsx(r,{variant:"body2",sx:{color:s.backups.total===0?"text.disabled":"text.secondary"},gutterBottom:!0,children:"Backups"}),s.backups.total>0&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[f(s.backups.change),e.jsxs(r,{variant:"caption",sx:{color:u(s.backups.change)},children:[s.backups.change>0?"+":"",s.backups.change]})]})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2,opacity:!s.last_backup||!s.last_backup.start_date?.5:1,filter:!s.last_backup||!s.last_backup.start_date?"grayscale(100%)":"none"},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:!s.last_backup||!s.last_backup.start_date?"grey.400":"info.main",mx:"auto",mb:2},children:e.jsx(il,{})}),e.jsx(r,{variant:"body2",sx:{color:!s.last_backup||!s.last_backup.start_date?"text.disabled":"text.secondary"},gutterBottom:!0,children:"Last Backup"}),e.jsx(r,{variant:"body2",fontWeight:"medium",sx:{color:!s.last_backup||!s.last_backup.start_date?"text.disabled":"text.primary"},children:s.last_backup?.schedule_type||"N/A"}),e.jsx(r,{variant:"caption",sx:{color:!s.last_backup||!s.last_backup.start_date?"text.disabled":"text.secondary"},children:c(s.last_backup?.start_date||null)})]})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(De,{sx:{borderRadius:2,opacity:s.next_scheduled?1:.5,filter:s.next_scheduled?"none":"grayscale(100%)"},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(cs,{sx:{bgcolor:s.next_scheduled?"warning.main":"grey.400",mx:"auto",mb:2},children:e.jsx(Ws,{})}),e.jsx(r,{variant:"body2",sx:{color:s.next_scheduled?"text.secondary":"text.disabled"},gutterBottom:!0,children:"Next Scheduled"}),e.jsx(r,{variant:"body2",fontWeight:"medium",sx:{color:s.next_scheduled?"text.primary":"text.disabled"},children:s.next_scheduled?c(s.next_scheduled):"Not Scheduled"})]})})})]}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%",opacity:s.data_growth.length===0?.5:1,filter:s.data_growth.length===0?"grayscale(100%)":"none"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",sx:{color:s.data_growth.length===0?"text.disabled":"text.primary"},children:"Data Growth (GB)"}),e.jsx(n,{sx:{height:300,mt:2},children:s.data_growth.length>0?e.jsx(ws,{width:"100%",height:"100%",children:e.jsxs(ol,{data:h,children:[e.jsx(Ya,{strokeDasharray:"3 3"}),e.jsx(Ka,{dataKey:"month"}),e.jsx(Xa,{}),e.jsx(Cs,{formatter:p=>[p.toFixed(6),"GB"]}),e.jsx(ll,{type:"monotone",dataKey:"gb",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"}})]})}):e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"text.disabled"},children:e.jsx(r,{variant:"body2",children:"No data available"})})})]})})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%",opacity:s.success_rate===0&&s.fail_rate===0?.5:1,filter:s.success_rate===0&&s.fail_rate===0?"grayscale(100%)":"none"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",sx:{color:s.success_rate===0&&s.fail_rate===0?"text.disabled":"text.primary"},children:"Backup Success Rate"}),e.jsx(n,{sx:{height:300,mt:2},children:s.success_rate>0||s.fail_rate>0?e.jsx(ws,{width:"100%",height:"100%",children:e.jsxs(Gr,{children:[e.jsx(Vr,{data:y,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:y.map((p,m)=>e.jsx(Hr,{fill:p.color},`cell-${m}`))}),e.jsx(Cs,{formatter:p=>[`${p}%`,"Rate"]})]})}):e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"text.disabled"},children:e.jsx(r,{variant:"body2",children:"No backup data available"})})}),(s.success_rate>0||s.fail_rate>0)&&e.jsxs(n,{sx:{display:"flex",justifyContent:"center",gap:3,mt:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:12,height:12,bgcolor:"#00C49F",borderRadius:"50%"}}),e.jsxs(r,{variant:"body2",children:["Success (",s.success_rate,"%)"]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:12,height:12,bgcolor:"#FF8042",borderRadius:"50%"}}),e.jsxs(r,{variant:"body2",children:["Failure (",s.fail_rate,"%)"]})]})]})]})})})]}),e.jsxs(j,{container:!0,spacing:3,sx:{mt:2},children:[e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Recent Backup Activity"}),l?.activity&&l.activity.length>0?e.jsx(tt,{children:e.jsxs(Je,{size:"small",children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{sx:{fontWeight:"bold"},children:"Object"}),e.jsx(x,{sx:{fontWeight:"bold"},align:"right",children:"Records"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Start Time"}),e.jsx(x,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(x,{sx:{fontWeight:"bold"},align:"right",children:"Size"})]})}),e.jsx(Ye,{children:l.activity.map((p,m)=>e.jsxs(pe,{children:[e.jsx(x,{children:p.object_name}),e.jsx(x,{align:"right",children:p.records?.toLocaleString()||"N/A"}),e.jsx(x,{children:new Date(p.start_time).toLocaleString()}),e.jsx(x,{children:e.jsx(X,{label:p.status,size:"small",color:p.status==="success"?"success":"error",variant:"outlined"})}),e.jsx(x,{align:"right",children:p.size})]},m))})]})}):e.jsx(r,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:4},children:"No recent activity available"})]})})}),e.jsx(j,{item:!0,xs:12,md:6,children:e.jsx(De,{sx:{borderRadius:2,height:"100%"},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,fontWeight:"bold",children:"Top Objects by Records"}),d?.objects&&d.objects.length>0?e.jsx(n,{sx:{height:300,mt:2},children:e.jsx(ws,{width:"100%",height:"100%",children:e.jsxs(Yn,{data:d.objects,layout:"horizontal",margin:{top:20,right:30,left:60,bottom:5},children:[e.jsx(Ya,{strokeDasharray:"3 3"}),e.jsx(Ka,{type:"number"}),e.jsx(Xa,{dataKey:"object_name",type:"category",width:80}),e.jsx(Cs,{formatter:p=>[p.toLocaleString(),"Records"]}),e.jsx(Kn,{dataKey:"total_records",fill:"#8884d8"})]})})}):e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",height:300,color:"text.disabled"},children:e.jsx(r,{variant:"body2",children:"No data available"})})]})})})]})]})},fh=()=>e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Backup Object Selection"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Select and configure objects for backup operations"}),e.jsx(wi,{})]}),jh=()=>{xt();const{selectedObject:t}=ke(Z=>Z.migration),[s,a]=o.useState(null),[i,l]=o.useState("full"),[d,c]=o.useState("date"),[u,f]=o.useState(""),[y,h]=o.useState(""),[p,m]=o.useState(""),[S,T]=o.useState(""),[g,P]=o.useState(""),[$,V]=o.useState(""),[v,q]=o.useState(""),[w,O]=o.useState(""),[N,R]=o.useState(""),[W,b]=o.useState("");o.useEffect(()=>{const Z=localStorage.getItem("selectedBackupObject");if(Z)try{const _e=JSON.parse(Z);a(_e)}catch(_e){console.error("Failed to parse selected backup object:",_e)}const he=localStorage.getItem("backupTypeConfiguration");if(he)try{const _e=JSON.parse(he);l(_e.backupType||"full"),c(_e.conditionalType||"date"),_e.dateBackup&&(f(_e.dateBackup.startDate||""),h(_e.dateBackup.endDate||""),m(_e.dateBackup.selectedDateField||"")),_e.numericBackup&&(T(_e.numericBackup.startRange||""),P(_e.numericBackup.endRange||""),V(_e.numericBackup.selectedNumericField||"")),_e.valueBackup&&(q(_e.valueBackup.selectedPicklistField||""),O(_e.valueBackup.selectedPicklistValue||"")),_e.incrementalBackup&&(R(_e.incrementalBackup.incrementalCompareField||""),b(_e.incrementalBackup.incrementalStartDate||""))}catch(_e){console.error("Failed to parse backup configuration:",_e)}},[]);const{data:F,isLoading:G}=Wl(s?.object_id||"",{skip:!s?.object_id}),{data:E}=zl({objectId:s?.object_id||"",fieldId:v},{skip:!s?.object_id||!v});console.log("BackupType - metadataFields:",F),console.log("BackupType - loadingMetadata:",G),o.useEffect(()=>{if(s){const Z={selectedObject:s,backupType:i,conditionalType:d,dateBackup:{startDate:u,endDate:y,selectedDateField:p},numericBackup:{startRange:S,endRange:g,selectedNumericField:$},valueBackup:{selectedPicklistField:v,selectedPicklistValue:w},incrementalBackup:{incrementalCompareField:N,incrementalStartDate:W},timestamp:new Date().toISOString()};localStorage.setItem("backupTypeConfiguration",JSON.stringify(Z))}},[s,i,d,u,y,p,S,g,$,v,w,N,W]);const _=()=>{const Z={selectedObject:s,backupType:i,conditionalType:d,dateBackup:{startDate:u,endDate:y,selectedDateField:p},numericBackup:{startRange:S,endRange:g,selectedNumericField:$},valueBackup:{selectedPicklistField:v,selectedPicklistValue:w},incrementalBackup:{incrementalCompareField:N,incrementalStartDate:W},timestamp:new Date().toISOString()};localStorage.setItem("backupTypeConfiguration",JSON.stringify(Z)),console.log("Backup configuration saved:",Z)},D=F?.filter(Z=>Z.is_datetime==="true"||Z.is_date==="true").map(Z=>({name:Z.name,field_id:Z.field_id}))||[],C=F?.filter(Z=>Z.is_integer==="true"||Z.is_float==="true").map(Z=>({name:Z.name,field_id:Z.field_id}))||[],oe=F?.filter(Z=>Z.is_picklist==="true").map(Z=>({name:Z.name,field_id:Z.field_id}))||[];return console.log("Filtered fields:",{dateFields:D,numericFields:C,picklistFields:oe}),e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Backup Type Configuration"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"Configure the type of backup operations for your data"}),s?e.jsxs(r,{variant:"body2",color:"primary",sx:{mb:3},children:["Using metadata from object: ",e.jsx("strong",{children:s.name})]}):e.jsx(ae,{severity:"info",sx:{mb:3},children:'Please select an object in the "Object Selection" tab first to configure backup types.'}),s?e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Backup Types"}),e.jsxs(Ts,{value:i,onChange:Z=>l(Z.target.value),children:[e.jsx(nt,{value:"full",control:e.jsx(ft,{}),label:"Full - All Data"}),e.jsx(nt,{value:"conditional",control:e.jsx(ft,{}),label:"Conditional Backup"}),e.jsx(nt,{value:"incremental",control:e.jsx(ft,{}),label:"Incremental Backup"})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(as,{in:i==="conditional",children:e.jsx(De,{children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Conditional Backup Options"}),e.jsxs(Ts,{value:d,onChange:Z=>c(Z.target.value),children:[e.jsx(nt,{value:"date",control:e.jsx(ft,{}),label:"Backup by Date"}),e.jsx(nt,{value:"numeric",control:e.jsx(ft,{}),label:"Backup by Numeric Range"}),e.jsx(nt,{value:"value",control:e.jsx(ft,{}),label:"Backup by Value"})]}),e.jsx(as,{in:d==="date",children:e.jsx(De,{sx:{mt:2,ml:3},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Date Range Configuration"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"Start Date",type:"date",value:u,onChange:Z=>f(Z.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(Ns,{sx:{mr:1,color:"action.active"}})}})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"End Date",type:"date",value:y,onChange:Z=>h(Z.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(Ns,{sx:{mr:1,color:"action.active"}})}})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Select Date Field"}),e.jsx(We,{value:p,onChange:Z=>m(Z.target.value),label:"Select Date Field",disabled:G,children:D.length>0?D.map((Z,he)=>e.jsx(re,{value:Z.field_id,children:Z.name},Z.field_id||Z.name||`backup-field-${he}`)):e.jsx(re,{disabled:!0,children:"No date fields available"})})]})})]})]})})}),e.jsx(as,{in:d==="numeric",children:e.jsx(De,{sx:{mt:2,ml:3},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Numeric Range Configuration"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Select Numeric Field"}),e.jsx(We,{value:$,onChange:Z=>V(Z.target.value),label:"Select Numeric Field",disabled:G,children:C.length>0?C.map(Z=>e.jsx(re,{value:Z.field_id,children:Z.name},Z.field_id)):e.jsx(re,{disabled:!0,children:"No numeric fields available"})})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"Start Range",type:"number",value:S,onChange:Z=>T(Z.target.value)})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"End Range",type:"number",value:g,onChange:Z=>P(Z.target.value)})})]})]})})}),e.jsx(as,{in:d==="value",children:e.jsx(De,{sx:{mt:2,ml:3},children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Value Configuration"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Select Picklist Field"}),e.jsx(We,{value:v,onChange:Z=>q(Z.target.value),label:"Select Picklist Field",disabled:G,children:oe.length>0?oe.map(Z=>e.jsx(re,{value:Z.field_id,children:Z.name},Z.field_id)):e.jsx(re,{disabled:!0,children:"No picklist fields available"})})]})}),v&&e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Select Value"}),e.jsx(We,{value:w,onChange:Z=>O(Z.target.value),label:"Select Value",children:E?.picklist_values&&E.picklist_values.length>0?E.picklist_values.map((Z,he)=>e.jsx(re,{value:Z,children:Z},he)):e.jsx(re,{disabled:!0,children:"No values available"})})]})})]})]})})})]})})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(as,{in:i==="incremental",children:e.jsx(De,{children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Incremental Backup Configuration"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Compare Using"}),e.jsx(We,{value:N,onChange:Z=>R(Z.target.value),label:"Compare Using",disabled:G,children:D.length>0?D.map(Z=>e.jsx(re,{value:Z.field_id,children:Z.name},Z.field_id)):e.jsx(re,{disabled:!0,children:"No date fields available"})})]})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"Start Date",type:"date",value:W,onChange:Z=>b(Z.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(Ns,{sx:{mr:1,color:"action.active"}})}})})]})]})})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(n,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(H,{variant:"contained",color:"primary",onClick:_,size:"large",children:"Save Configuration"})})})]}):null]})},yh=()=>{const[t,s]=o.useState("manual"),[a,i]=o.useState("daily"),[l,d]=o.useState(""),[c,u]=o.useState(""),[f,y]=o.useState("30"),[h,p]=o.useState("no_end"),[m,S]=o.useState(""),[T,g]=o.useState(""),[P,$]=o.useState(""),[V,v]=o.useState([]),[q,w]=o.useState("1"),[O,N]=o.useState("1"),[R,W]=o.useState(!1),[b,F]=o.useState(null),[G,E]=o.useState(null),[_,D]=o.useState({open:!1,message:"",severity:"info"}),[C,oe]=o.useState(null),[Z,he]=o.useState(null),[_e,z]=o.useState([]),[A]=qc(),{data:te,error:I}=Uc(b||"",{skip:!b||["success","job complete","failed"].includes(G||""),pollingInterval:2e3});o.useEffect(()=>{const de=localStorage.getItem("backupScheduleConfiguration");if(de)try{const Oe=JSON.parse(de);s(Oe.scheduleType||"manual"),i(Oe.schedulePattern||"daily"),d(Oe.scheduleStart||""),u(Oe.scheduleEnd||""),y(Oe.scheduleDuration||"30"),p(Oe.rangeType||"no_end"),S(Oe.rangeStart||""),g(Oe.rangeEnd||""),$(Oe.rangeEndDate||""),v(Oe.selectedDays||[]),w(Oe.selectedMonthDay||"1"),N(Oe.selectedMonth||"1")}catch(Oe){console.error("Failed to parse schedule configuration:",Oe)}const qe=localStorage.getItem("backupTypeConfiguration");if(qe)try{const Oe=JSON.parse(qe);oe(Oe),he(Oe.selectedObject)}catch(Oe){console.error("Failed to parse backup type configuration:",Oe)}const Ne=localStorage.getItem("selectedCompoundFields");if(Ne)try{const Oe=JSON.parse(Ne);z(Oe)}catch(Oe){console.error("Failed to parse compound fields:",Oe)}},[]),o.useEffect(()=>{I?(console.error("Backup process API error:",I),D({open:!0,message:"Backup process encountered an error. Please try again.",severity:"error"}),W(!1),F(null),E("error")):te&&(E(te.status),te.status==="success"||te.status==="job complete"?(D({open:!0,message:"Backup completed successfully!",severity:"success"}),W(!1),F(null)):te.status==="failed"?(D({open:!0,message:`Backup failed: ${te.message||"Unknown error"}`,severity:"error"}),W(!1),F(null)):D({open:!0,message:`Backup ${te.status}...`,severity:"info"}))},[te,I]),o.useEffect(()=>{const de={scheduleType:t,schedulePattern:a,scheduleStart:l,scheduleEnd:c,scheduleDuration:f,rangeType:h,rangeStart:m,rangeEnd:T,rangeEndDate:P,selectedDays:V,selectedMonthDay:q,selectedMonth:O,timestamp:new Date().toISOString()};localStorage.setItem("backupScheduleConfiguration",JSON.stringify(de))},[t,a,l,c,f,h,m,T,P,V,q,O]);const J=de=>{v(qe=>qe.includes(de)?qe.filter(Ne=>Ne!==de):[...qe,de])},se=async()=>{if(!Z||!C){D({open:!0,message:"Please configure backup type and select an object first.",severity:"error"});return}W(!0),D({open:!0,message:"Starting backup process...",severity:"info"});try{if(_e.length===0)throw new Error("Please select compound fields for backup in the Object Selection tab.");const de=_e.join(","),qe=C.backupType==="full"?"Full Backup":C.backupType==="conditional"?"Conditional Backup":"Incremental Backup",Ne=t==="manual"?"Manual/Immediate":"Scheduled",Oe=await A({object_id:Z.object_id,Select:de,backup_type:qe,backup_model:{backup_type:qe,object_id:Z.object_id},schedule_info:{schedule_type:Ne}}).unwrap();F(Oe.summary_id),D({open:!0,message:"Backup plan created. Monitoring progress...",severity:"info"})}catch(de){console.error("Backup failed:",de),D({open:!0,message:`Backup failed: ${de?.data?.message||de.message||"Unknown error"}`,severity:"error"}),W(!1)}},Ie=()=>{W(!1),F(null),E(null),D({open:!0,message:"Backup cancelled.",severity:"info"})},Fe=de=>{switch(de){case"daily":return"Run backup every day at the specified time";case"weekly":return"Run backup on selected days of the week";case"monthly":return"Run backup on a specific day of the month";case"yearly":return"Run backup on a specific date each year";default:return""}};return e.jsxs(n,{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Backup Schedule Configuration"}),e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Configure how and when your backups should run"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{item:!0,xs:12,children:e.jsx(De,{children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Schedule Type"}),e.jsxs(Ts,{value:t,onChange:de=>s(de.target.value),children:[e.jsx(nt,{value:"manual",control:e.jsx(ft,{}),label:"Manual/Immediate - Run backup manually or immediately"}),e.jsx(nt,{value:"scheduled",control:e.jsx(ft,{}),label:"Scheduled - Set up automated backup schedules"})]})]})})}),e.jsx(j,{item:!0,xs:12,children:e.jsx(as,{in:t==="scheduled",children:e.jsx(De,{children:e.jsxs(Ee,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Schedule Configuration"}),e.jsxs(j,{container:!0,spacing:3,children:[e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Schedule Duration"}),e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"Start Time",type:"time",value:l,onChange:de=>d(de.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(j,{item:!0,xs:12,sm:6,children:e.jsx(ye,{fullWidth:!0,label:"End Time",type:"time",value:c,onChange:de=>u(de.target.value),InputLabelProps:{shrink:!0}})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Duration"}),e.jsxs(We,{value:f,onChange:de=>y(de.target.value),label:"Duration",children:[e.jsx(re,{value:"15",children:"15 minutes"}),e.jsx(re,{value:"30",children:"30 minutes"}),e.jsx(re,{value:"45",children:"45 minutes"}),e.jsx(re,{value:"60",children:"1 hour"})]})]})})]})]}),e.jsxs(j,{item:!0,xs:12,md:6,children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Schedule Pattern"}),e.jsxs(Ts,{value:a,onChange:de=>i(de.target.value),children:[e.jsx(nt,{value:"daily",control:e.jsx(ft,{}),label:"Daily"}),e.jsx(nt,{value:"weekly",control:e.jsx(ft,{}),label:"Weekly"}),e.jsx(nt,{value:"monthly",control:e.jsx(ft,{}),label:"Monthly"}),e.jsx(nt,{value:"yearly",control:e.jsx(ft,{}),label:"Yearly"})]}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mt:1,fontStyle:"italic"},children:Fe(a)}),a==="weekly"&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(r,{variant:"body2",gutterBottom:!0,children:"Select days:"}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(de=>e.jsx(H,{variant:V.includes(de)?"contained":"outlined",size:"small",onClick:()=>J(de),children:de},de))})]}),a==="monthly"&&e.jsx(n,{sx:{mt:2},children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Day of Month"}),e.jsx(We,{value:q,onChange:de=>w(de.target.value),label:"Day of Month",children:Array.from({length:31},(de,qe)=>qe+1).map(de=>e.jsx(re,{value:de.toString(),children:de},de))})]})}),a==="yearly"&&e.jsx(n,{sx:{mt:2},children:e.jsxs(j,{container:!0,spacing:2,children:[e.jsx(j,{item:!0,xs:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Month"}),e.jsx(We,{value:O,onChange:de=>N(de.target.value),label:"Month",children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((de,qe)=>e.jsx(re,{value:(qe+1).toString(),children:de},de))})]})}),e.jsx(j,{item:!0,xs:6,children:e.jsxs(Ae,{fullWidth:!0,children:[e.jsx(Me,{children:"Day"}),e.jsx(We,{value:q,onChange:de=>w(de.target.value),label:"Day",children:Array.from({length:31},(de,qe)=>qe+1).map(de=>e.jsx(re,{value:de.toString(),children:de},de))})]})})]})})]}),e.jsxs(j,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,fontWeight:"bold",children:"Schedule Range"}),e.jsxs(Ts,{value:h,onChange:de=>p(de.target.value),children:[e.jsx(nt,{value:"no_end",control:e.jsx(ft,{}),label:"No end date"}),e.jsx(nt,{value:"end_by",control:e.jsx(ft,{}),label:"End by (number of occurrences)"}),e.jsx(nt,{value:"end_date",control:e.jsx(ft,{}),label:"End by specific date"})]}),h==="end_by"&&e.jsxs(n,{sx:{mt:2,display:"flex",gap:2},children:[e.jsx(ye,{label:"Start after",type:"number",value:m,onChange:de=>S(de.target.value),sx:{width:120}}),e.jsx(ye,{label:"End after",type:"number",value:T,onChange:de=>g(de.target.value),sx:{width:120}}),e.jsx(r,{sx:{alignSelf:"center"},children:"occurrences"})]}),h==="end_date"&&e.jsx(n,{sx:{mt:2},children:e.jsx(ye,{fullWidth:!0,label:"End Date",type:"date",value:P,onChange:de=>$(de.target.value),InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(Ns,{sx:{mr:1,color:"action.active"}})},sx:{maxWidth:300}})})]})]})]})})})}),e.jsx(j,{item:!0,xs:12,children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(H,{variant:"outlined",color:"secondary",onClick:Ie,disabled:!R,children:"Cancel"}),e.jsx(H,{variant:"contained",color:"primary",onClick:se,disabled:R||!Z,startIcon:R?e.jsx(ie,{size:20}):null,size:"large",children:R?"Backing Up...":"Backup"})]})}),G&&e.jsx(j,{item:!0,xs:12,children:e.jsxs(ae,{severity:G==="success"||G==="job complete"?"success":G==="failed"?"error":"info",sx:{mt:2},children:["Backup Status: ",G,b&&` (ID: ${b})`]})})]}),e.jsx(dt,{open:_.open,autoHideDuration:6e3,onClose:()=>D(de=>({...de,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ae,{onClose:()=>D(de=>({...de,open:!1})),severity:_.severity,sx:{width:"100%"},children:_.message})})]})},bh=()=>{const{selectedProject:t}=ke(g=>g.app),[s,a]=o.useState(null),[i,l]=o.useState({open:!1,message:"",severity:"info"}),[d,c]=o.useState(null);o.useEffect(()=>{const g=localStorage.getItem("selectedBackupObject");if(g)try{const P=JSON.parse(g);c(P)}catch(P){console.error("Failed to parse selected backup object:",P)}},[]);const{data:u,isLoading:f,error:y,refetch:h}=Bc(d?.object_id||"",{skip:!d?.object_id}),[p]=Nc(),m=g=>{a(s===g?null:g)},S=g=>g.backup_details&&g.backup_details.length>0,T=async g=>{if(!d?.object_id||!g.filename||!g.version){l({open:!0,message:"Missing required information for download.",severity:"error"});return}try{const P=await p({object_id:d.object_id,filename:g.filename,version:g.version.toString()}).unwrap();l({open:!0,message:"Download started successfully.",severity:"success"})}catch(P){console.error("Download failed:",P),l({open:!0,message:`Download failed: ${P?.data?.message||P.message||"Unknown error"}`,severity:"error"})}};return d?f?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:e.jsx(ie,{})}):y?e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(r,{variant:"h6",color:"error",children:"Error loading backup history"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Please try again later"})]}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs("div",{children:[e.jsx(r,{variant:"h5",gutterBottom:!0,fontWeight:"bold",children:"Backup History"}),e.jsxs(r,{variant:"body1",color:"text.secondary",children:["View and manage your backup history for ",d?.name||d?.object_name]})]}),e.jsx(H,{variant:"outlined",startIcon:e.jsx(Dt,{}),onClick:h,children:"Refresh"})]}),e.jsx(tt,{component:me,sx:{borderRadius:2},children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[u?.some(g=>S(g))&&e.jsx(x,{}),e.jsx(x,{children:"Backup ID"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Type"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Size"}),e.jsx(x,{children:"Duration"})]})}),e.jsx(Ye,{children:u&&u.length>0?u.map((g,P)=>e.jsxs(Ke.Fragment,{children:[e.jsxs(pe,{hover:!0,children:[u?.some($=>S($))&&e.jsx(x,{children:S(g)&&e.jsx(ne,{size:"small",onClick:()=>m(g.name),children:s===g.name?e.jsx(cl,{}):e.jsx(dl,{})})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",fontWeight:"medium",children:g.name||"N/A"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:g.created_date?new Date(g.created_date).toLocaleString():"N/A"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:"Full Backup"})}),e.jsx(x,{children:e.jsx(X,{label:"COMPLETED",size:"small",color:"success",variant:"outlined"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:g.total_records?`${g.total_records} records`:"N/A"})}),e.jsx(x,{children:e.jsx(r,{variant:"body2",children:g.time_taken||"N/A"})})]}),S(g)&&e.jsx(pe,{children:e.jsx(x,{colSpan:(u?.some($=>S($))?1:0)+6,sx:{py:0},children:e.jsx(as,{in:s===g.name,timeout:"auto",unmountOnExit:!0,children:e.jsxs(n,{sx:{p:2,bgcolor:"grey.50"},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Backup Details"}),e.jsxs(n,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2},children:[g.name&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Backup Name"}),e.jsx(r,{variant:"body2",children:g.name})]}),g.created_date&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Created Date"}),e.jsx(r,{variant:"body2",children:new Date(g.created_date).toLocaleString()})]}),g.modified_date&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Modified Date"}),e.jsx(r,{variant:"body2",children:new Date(g.modified_date).toLocaleString()})]}),g.chunk_size&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Chunk Size"}),e.jsx(r,{variant:"body2",children:g.chunk_size})]}),g.chunk_count&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Chunk Count"}),e.jsx(r,{variant:"body2",children:g.chunk_count})]}),g.time_taken&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Time Taken"}),e.jsx(r,{variant:"body2",children:g.time_taken})]}),g.total_records&&e.jsxs(n,{children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Total Records"}),e.jsx(r,{variant:"body2",children:g.total_records})]}),g.backup_details&&g.backup_details.length>0&&e.jsxs(n,{sx:{gridColumn:"1 / -1"},children:[e.jsx(r,{variant:"caption",color:"text.secondary",children:"Backup Files"}),g.backup_details.map(($,V)=>e.jsx(n,{sx:{mt:1,p:1,bgcolor:"grey.100",borderRadius:1},children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(n,{children:[e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Filename:"})," ",$.filename]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Version:"})," ",$.version]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Chunk Size:"})," ",$.chunk_size]}),e.jsxs(r,{variant:"body2",children:[e.jsx("strong",{children:"Chunk Count:"})," ",$.chunk_count]})]}),e.jsx(H,{size:"small",startIcon:e.jsx(Ja,{}),onClick:()=>T($),sx:{ml:2,flexShrink:0},children:"Download"})]})},$.filename||$.version||`detail-${V}`))]})]})]})})})})]},g.id||g.backup_id||`backup-${P}`)):e.jsx(pe,{children:e.jsx(x,{colSpan:8,sx:{textAlign:"center",py:4},children:e.jsx(r,{variant:"body2",color:"text.secondary",children:"No backup history available"})})})})]})}),e.jsx(dt,{open:i.open,autoHideDuration:6e3,onClose:()=>l(g=>({...g,open:!1})),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(ae,{onClose:()=>l(g=>({...g,open:!1})),severity:i.severity,sx:{width:"100%"},children:i.message})})]}):e.jsx(n,{sx:{textAlign:"center",py:8},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"Please select an object for backup first."})})},Us=({children:t,value:s,index:a,...i})=>e.jsx("div",{role:"tabpanel",hidden:s!==a,id:`backup-tabpanel-${a}`,"aria-labelledby":`backup-tab-${a}`,...i,children:s===a&&e.jsx(n,{sx:{p:0},children:t})}),vh=()=>{const[t,s]=o.useState(0),{selectedProject:a}=ke(l=>l.app),i=(l,d)=>{s(d)};return e.jsx(n,{sx:{p:2},children:e.jsxs(me,{elevation:2,children:[e.jsxs(Mt,{value:t,onChange:i,"aria-label":"backup tabs",variant:"scrollable",scrollButtons:"auto",sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:120,px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{label:"Backup Dashboard",id:"backup-tab-0","aria-controls":"backup-tabpanel-0"}),e.jsx(He,{label:"Object Selection",id:"backup-tab-1","aria-controls":"backup-tabpanel-1"}),e.jsx(He,{label:"Backup Type",id:"backup-tab-2","aria-controls":"backup-tabpanel-2"}),e.jsx(He,{label:"Backup Schedule",id:"backup-tab-3","aria-controls":"backup-tabpanel-3"}),e.jsx(He,{label:"Backup History",id:"backup-tab-4","aria-controls":"backup-tabpanel-4"})]}),e.jsx(Us,{value:t,index:0,children:e.jsx(gh,{})}),e.jsx(Us,{value:t,index:1,children:e.jsx(fh,{})}),e.jsx(Us,{value:t,index:2,children:e.jsx(jh,{})}),e.jsx(Us,{value:t,index:3,children:e.jsx(yh,{})}),e.jsx(Us,{value:t,index:4,children:e.jsx(bh,{})})]})})},_h=()=>e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Fs,{sx:{fontSize:40,color:"warning.main"}}),e.jsx(r,{variant:"h4",component:"h1",children:"Translation Dashboard"})]}),e.jsxs(me,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Translation Project Overview"}),e.jsx(r,{children:"Welcome to your translation project dashboard. Manage language packs, translation memory, and track progress across different languages."})]})]});function ga(t){const{children:s,value:a,index:i,...l}=t;return e.jsx("div",{role:"tabpanel",hidden:a!==i,id:`translation-tabpanel-${i}`,"aria-labelledby":`translation-tab-${i}`,...l,children:a===i&&e.jsx(n,{sx:{p:3},children:s})})}function fa(t){return{id:`translation-tab-${t}`,"aria-controls":`translation-tabpanel-${t}`}}const Sh=()=>{const[t,s]=o.useState(0),a=(u,f)=>{s(f)},i=[{id:1,sourceText:"Hello world",targetText:"Hola mundo",language:"Spanish",status:"translated"},{id:2,sourceText:"Good morning",targetText:"Buenos d√≠as",language:"Spanish",status:"translated"},{id:3,sourceText:"Thank you",targetText:"Gracias",language:"Spanish",status:"pending"}],l=[{id:1,sourceText:"Welcome",targetText:"",language:"French",status:"in_progress"},{id:2,sourceText:"Goodbye",targetText:"Au revoir",language:"French",status:"review"}],d=[{id:1,sourceText:"Hello",targetText:"Bonjour",language:"French",date:"2024-01-15",translator:"John Doe"},{id:2,sourceText:"Yes",targetText:"Oui",language:"French",date:"2024-01-14",translator:"Jane Smith"}],c=[{id:1,sourceText:"Please",targetText:"S'il vous pla√Æt",language:"French",status:"pending_review"},{id:2,sourceText:"Excuse me",targetText:"Excusez-moi",language:"French",status:"approved"}];return e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Fs,{sx:{fontSize:40,color:"warning.main"}}),e.jsx(r,{variant:"h4",component:"h1",children:"Translations"})]}),e.jsxs(me,{sx:{width:"100%"},children:[e.jsx(n,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Mt,{value:t,onChange:a,"aria-label":"translation tabs",sx:{"& .MuiTab-root":{textTransform:"none",fontSize:"0.875rem",fontWeight:500,minHeight:48,borderRadius:"8px 8px 0 0",marginRight:1,minWidth:"auto",px:2,"&.Mui-selected":{backgroundColor:"#0b378aff",color:"white",fontWeight:600},"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)","&.Mui-selected":{backgroundColor:"#0b378aff"}}},"& .MuiTabs-indicator":{display:"none"}},children:[e.jsx(He,{icon:e.jsx(ul,{}),label:"Source",...fa(0),iconPosition:"start"}),e.jsx(He,{icon:e.jsx(Fs,{}),label:"Workbench",...fa(1),iconPosition:"start"}),e.jsx(He,{icon:e.jsx(ei,{}),label:"History",...fa(2),iconPosition:"start"}),e.jsx(He,{icon:e.jsx(mt,{}),label:"Review",...fa(3),iconPosition:"start"})]})}),e.jsxs(ga,{value:t,index:0,children:[e.jsx(n,{sx:{mb:2},children:e.jsx(ye,{fullWidth:!0,placeholder:"Search source texts...",InputProps:{startAdornment:e.jsx(vt,{position:"start",children:e.jsx(lr,{})})}})}),e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Source Text"}),e.jsx(x,{children:"Target Text"}),e.jsx(x,{children:"Language"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:i.map(u=>e.jsxs(pe,{children:[e.jsx(x,{children:u.sourceText}),e.jsx(x,{children:u.targetText}),e.jsx(x,{children:u.language}),e.jsx(x,{children:e.jsx(X,{label:u.status,color:u.status==="translated"?"success":"warning",size:"small"})}),e.jsx(x,{children:e.jsx(H,{size:"small",variant:"outlined",children:"Edit"})})]},u.id))})]})})]}),e.jsxs(ga,{value:t,index:1,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Translation Workbench"}),e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Source Text"}),e.jsx(x,{children:"Target Text"}),e.jsx(x,{children:"Language"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:l.map(u=>e.jsxs(pe,{children:[e.jsx(x,{children:u.sourceText}),e.jsx(x,{children:e.jsx(ye,{fullWidth:!0,defaultValue:u.targetText,placeholder:"Enter translation...",size:"small"})}),e.jsx(x,{children:u.language}),e.jsx(x,{children:e.jsx(X,{label:u.status.replace("_"," "),color:u.status==="in_progress"?"primary":"secondary",size:"small"})}),e.jsxs(x,{children:[e.jsx(H,{size:"small",variant:"contained",sx:{mr:1},children:"Save"}),e.jsx(H,{size:"small",variant:"outlined",children:"Submit"})]})]},u.id))})]})})]}),e.jsxs(ga,{value:t,index:2,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Translation History"}),e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Source Text"}),e.jsx(x,{children:"Target Text"}),e.jsx(x,{children:"Language"}),e.jsx(x,{children:"Date"}),e.jsx(x,{children:"Translator"})]})}),e.jsx(Ye,{children:d.map(u=>e.jsxs(pe,{children:[e.jsx(x,{children:u.sourceText}),e.jsx(x,{children:u.targetText}),e.jsx(x,{children:u.language}),e.jsx(x,{children:u.date}),e.jsx(x,{children:u.translator})]},u.id))})]})})]}),e.jsxs(ga,{value:t,index:3,children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Review Queue"}),e.jsx(tt,{children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(pe,{children:[e.jsx(x,{children:"Source Text"}),e.jsx(x,{children:"Target Text"}),e.jsx(x,{children:"Language"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ye,{children:c.map(u=>e.jsxs(pe,{children:[e.jsx(x,{children:u.sourceText}),e.jsx(x,{children:u.targetText}),e.jsx(x,{children:u.language}),e.jsx(x,{children:e.jsx(X,{label:u.status.replace("_"," "),color:u.status==="approved"?"success":"warning",size:"small"})}),e.jsxs(x,{children:[e.jsx(H,{size:"small",variant:"contained",color:"success",sx:{mr:1},children:"Approve"}),e.jsx(H,{size:"small",variant:"outlined",color:"error",children:"Reject"})]})]},u.id))})]})})]})]})]})},kh=()=>{const t=xt(),{isAuthenticated:s}=ke(c=>c.auth),{currentWorkspaceProjectId:a,currentWorkspaceEnvironmentId:i}=ca(),{selectedProject:l}=ke(c=>c.app),{data:d=[]}=oa(a||"",{skip:!a});return o.useEffect(()=>{},[s]),o.useEffect(()=>{if(i&&d.length>0){const c=d.find(u=>u.id===i);c&&t(er(c))}},[i,d,t]),null},et=({children:t})=>{const s=xt(),a=us(),{isAuthenticated:i,isLoading:l}=ke(V=>V.auth),{currentView:d,selectedProject:c}=ke(V=>V.app),[u,f]=Ke.useState(!1);o.useEffect(()=>{if(l)f(!1);else if(i){const V=setTimeout(()=>{f(!0)},100);return()=>clearTimeout(V)}else f(!0)},[i,l]);const y=Ke.useRef(null);o.useEffect(()=>{if(y.current!==a.pathname&&(y.current=a.pathname,console.log("üîí ProtectedRoute: Location changed",{pathname:a.pathname,isAuthenticated:i,currentView:d,selectedProject:c?.name,isStateReady:u}),i&&u)){const V=setTimeout(()=>{s(ql({pathname:a.pathname}))},10);return()=>clearTimeout(V)}},[s,a.pathname,i,u,d,c]);const h=["/account","/users","/projects","/security-policies"],p=["/dashboard","/entities","/management","/migration","/backup/dashboard","/backup/jobs","/backup/restore","/backup/history","/translation/dashboard","/translation/languages","/translation/memory","/translation/progress","/translation/translations","/file-migration/upload","/file-migration/relationship","/file-migration/filter","/file-migration/metadata","/file-migration/cleanup","/file-migration/transform","/file-migration/mapping","/file-migration/validate","/file-migration/load","/file-migration/error","/file-migration/workflows","/file-migration/analysis","/file-migration/storage"],m=a.pathname.startsWith("/migration"),S=a.pathname.startsWith("/backup"),T=a.pathname.startsWith("/translation"),g=a.pathname.startsWith("/file-migration"),P=h.includes(a.pathname),$=p.includes(a.pathname)||m||S||T||g;return l||!u?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:e.jsx(ie,{})}):a.pathname==="/login"||a.pathname==="/register"?e.jsx(e.Fragment,{children:t}):i?m?e.jsx(e.Fragment,{children:t}):u&&d==="settings"&&!P&&a.pathname!=="/"?e.jsx(Jt,{to:"/account",replace:!0}):u&&d==="application"&&!$&&a.pathname!=="/"?c?.project_type==="backup"?e.jsx(Jt,{to:"/backup/dashboard",replace:!0}):c?.project_type==="translation"?e.jsx(Jt,{to:"/translation/dashboard",replace:!0}):c?.project_type==="file migration"||c?.project_type==="filemigration"?e.jsx(Jt,{to:"/file-migration/upload",replace:!0}):e.jsx(Jt,{to:"/dashboard",replace:!0}):e.jsx(e.Fragment,{children:t}):e.jsx(Jt,{to:"/login",replace:!0,state:{from:a}})},wh=()=>{const t=s=>{if(!(!s.key||!s.newValue))try{if(s.key==="accessToken"||s.key==="refreshToken"){const a=localStorage.getItem("accessToken"),i=localStorage.getItem("refreshToken");a&&i&&Er.dispatch(zs({accessToken:a,refreshToken:i}))}if(s.key==="accessToken"&&!s.newValue&&s.oldValue&&(localStorage.getItem("accessToken")||(Er.dispatch(Ot()),window.location.pathname!=="/login"&&(window.location.href="/login"))),s.key==="app_state")try{const a=JSON.parse(s.newValue);a.lastRoute&&(a.lastRoute,window.location.pathname)}catch(a){console.error("Failed to parse app_state from storage event:",a)}s.key}catch(a){console.error("Error handling storage event:",a)}};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},En=()=>{const t=Date.now().toString();localStorage.setItem("lastActivity",t),window.dispatchEvent(new CustomEvent("activityUpdated",{detail:t}))},Ch=()=>{const t=["mousedown","mousemove","keypress","scroll","touchstart","wheel","click"];let s=0;const a=1e3,i=()=>{const l=Date.now();l-s>=a&&(En(),s=l)};return t.forEach(l=>{document.addEventListener(l,i,{passive:!0})}),En(),()=>{t.forEach(l=>{document.removeEventListener(l,i)})}},Th=hl({palette:{primary:{main:"#0b378aff"},secondary:{main:"#dc004e"}},typography:{fontFamily:"Poppins, sans-serif"}}),Ih=()=>{const{selectedProject:t,lastRoute:s}=ke(l=>l.app),{isAuthenticated:a,isLoading:i}=ke(l=>l.auth);if(i)return e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:e.jsx(ie,{})});if(!a)return e.jsx(Jt,{to:"/login",replace:!0});if(s&&s!=="/"){const d=["/account","/users","/projects","/security-policies"].includes(s),c=s.startsWith("/migration"),u=s.startsWith("/backup"),f=s.startsWith("/translation"),y=s.startsWith("/file-migration");if(d||(s==="/dashboard"||s==="/entities"||s==="/management"||c||u||f||y)||c)return e.jsx(Jt,{to:s,replace:!0})}return t?.project_type==="backup"?e.jsx(Jt,{to:"/backup/dashboard",replace:!0}):t?.project_type==="translation"?e.jsx(Jt,{to:"/translation/dashboard",replace:!0}):t?.project_type==="file migration"||t?.project_type==="filemigration"?e.jsx(Jt,{to:"/file-migration/upload",replace:!0}):e.jsx(Jt,{to:"/dashboard",replace:!0})},Ph=()=>{const{showIdleDialog:t,countdown:s,handleStayActive:a,handleLogout:i}=Si(),{isAuthenticated:l}=ke(d=>d.auth);return o.useEffect(()=>wh(),[]),o.useEffect(()=>{if(l)return Ch()},[l]),e.jsxs(gl,{basename:"/react_dmt/",children:[e.jsx(kh,{}),e.jsx(_i,{open:t,countdown:s,onStayActive:a,onLogout:i}),e.jsxs(fl,{children:[e.jsx(Qe,{path:"/login",element:e.jsx(uu,{})}),e.jsx(Qe,{path:"/register",element:e.jsx(pu,{})}),e.jsx(Qe,{path:"/forgot-password",element:e.jsx(fu,{})}),e.jsx(Qe,{path:"/dashboard",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(ju,{})})})}),e.jsx(Qe,{path:"/entities",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(_u,{})})})}),e.jsx(Qe,{path:"/management",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Pu,{})})})}),e.jsx(Qe,{path:"/account",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Eu,{})})})}),e.jsx(Qe,{path:"/users",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx($u,{})})})}),e.jsx(Qe,{path:"/projects",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Vu,{})})})}),e.jsx(Qe,{path:"/security-policies",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Qu,{})})})}),e.jsx(Qe,{path:"/migration/:objectId/:tabName",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Tr,{})})})}),e.jsx(Qe,{path:"/migration/:objectId",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Tr,{})})})}),e.jsx(Qe,{path:"/migration",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Tr,{})})})}),e.jsx(Qe,{path:"/backup/dashboard",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(vh,{})})})}),e.jsx(Qe,{path:"/backup/jobs",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Backup Jobs Page"})})})}),e.jsx(Qe,{path:"/backup/restore",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Restore Page"})})})}),e.jsx(Qe,{path:"/backup/history",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Backup History Page"})})})}),e.jsx(Qe,{path:"/translation/dashboard",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(_h,{})})})}),e.jsx(Qe,{path:"/translation/languages",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Language Packs Page"})})})}),e.jsx(Qe,{path:"/translation/memory",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Translation Memory Page"})})})}),e.jsx(Qe,{path:"/translation/progress",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx("div",{children:"Progress Tracking Page"})})})}),e.jsx(Qe,{path:"/translation/translations",element:e.jsx(et,{children:e.jsx(bt,{children:e.jsx(Sh,{})})})}),e.jsx(Qe,{path:"/file-migration/upload",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/relationship",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/filter",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/metadata",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/cleanup",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/transform",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/mapping",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/validate",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/load",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/error",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/file-migration/workflows",element:e.jsx(et,{children:e.jsx(ss,{})})}),e.jsx(Qe,{path:"/",element:e.jsx(Ih,{})})]})]})},Rh=()=>e.jsx(xl,{store:Er,children:e.jsxs(pl,{theme:Th,children:[e.jsx(ml,{}),e.jsx(Ph,{})]})});jl.createRoot(document.getElementById("root")).render(e.jsx(Ke.StrictMode,{children:e.jsx(Rh,{})}));
